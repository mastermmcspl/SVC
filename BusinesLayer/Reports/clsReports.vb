Imports DatabaseLayer
Imports System
Imports System.Data
Imports BusinesLayer
Public Class clsReports
    Dim objDB As New DBHelper
    Dim objGen As New clsFASGeneral
    Private objFasAllgnrl As New clsGeneralFunctions

    Structure TrailBal
        Dim iGLID As Integer
        Dim iAccHead As Integer
        Dim iHead As Integer
        Dim dFromDate As Date
        Dim dToDate As Date
        Dim dOpDebit As Decimal
        Dim dOpCredit As Decimal
        Dim dTrDebit As Decimal
        Dim dTrCredit As Decimal
        Dim dClDebit As Decimal
        Dim dClCredit As Decimal
        Dim iYearId As Integer
        Dim iCompid As Integer
        Dim iUserid As Integer

        Dim iZoneID As Integer
        Dim iReigionID As Integer
        Dim iAreaID As Integer
        Dim iBranchID As Integer
    End Structure

    Dim dGrandOpnDebit As Double = 0
    Dim dGrandOpnCredit As Double = 0
    Dim dGrandTransDebit As Double = 0
    Dim dGrandTransCredit As Double = 0
    Dim dGrandCloseDebit As Double = 0
    Dim dGrandCloseCredit As Double = 0
    Public Function GetYear(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYear As Integer) As String
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim sYear As String = ""
        Try
            sSql = "Select YMS_To_Year from acc_year_Master where YMS_ID = " & iYear & " and YMS_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            If dt.Rows.Count > 0 Then
                sYear = dt.Rows(0)("YMS_To_Year").ToString()
            End If
            Return sYear
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function GetCustomers(ByVal sNameSpace As String, ByVal iCompID As Integer) As String
        Dim sSql As String = "", sValue As String = ""
        Try
            sSql = "Select Cust_Name from MST_Customer_Master Where Cust_CompID =" & iCompID & ""
            sValue = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return sValue
        Catch ex As Exception
            Throw
        End Try
    End Function

    'Public Function GetOpeningBalance(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
    '                                  ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer) As DataTable
    '    Dim dt As New DataTable, dtGL As New DataTable, dtOB As New DataTable
    '    Dim sSql As String = "", iSql As String = ""
    '    Dim i As Integer = 0, j As Integer = 0
    '    Dim dRow As DataRow
    '    Dim dDebit As Double = 0, dCredit As Double = 0, dBalance As Double = 0
    '    Dim dGrandDebitTotal As Double = 0, dGrandCreditTotal As Double = 0, dGrandBalanceTotal As Double = 0

    '    Dim dGLDebitTotal, dGLCreditTotal As Double
    '    Try
    '        dt.Columns.Add("gl_id")
    '        dt.Columns.Add("gl_glCode")
    '        dt.Columns.Add("gl_Parent")
    '        dt.Columns.Add("gl_Desc")
    '        dt.Columns.Add("gl_Head")
    '        dt.Columns.Add("Opn_DebitAmt")
    '        dt.Columns.Add("Opn_CreditAmount")
    '        dt.Columns.Add("Balance")

    '        sSql = "" : sSql = "Select A.gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
    '        sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
    '        sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
    '        sSql = sSql & "and A.gl_head in (2,3) and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
    '        dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGL.Rows.Count > 0 Then
    '            For i = 0 To dtGL.Rows.Count - 1
    '                dRow = dt.NewRow()

    '                If IsDBNull(dtGL.Rows(i)("gl_id").ToString()) = False Then
    '                    dRow("gl_id") = dtGL.Rows(i)("gl_id").ToString()
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
    '                    dRow("gl_glCode") = dtGL.Rows(i)("gl_glCode").ToString()
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                    dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("gl_head").ToString()) = False Then
    '                    dRow("gl_Head") = dtGL.Rows(i)("gl_head").ToString()
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("gl_Parent").ToString()) = False Then
    '                    dRow("gl_Parent") = dtGL.Rows(i)("gl_Parent").ToString()
    '                End If

    '                If (dtGL.Rows(i)("gl_AccHead").ToString() = "1") Or (dtGL.Rows(i)("gl_AccHead").ToString() = "4") Then
    '                    If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
    '                        iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If
    '                        dGLDebitTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

    '                        iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If
    '                        dGLCreditTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

    '                        dRow("Opn_DebitAmt") = dGLDebitTotal
    '                        dRow("Opn_CreditAmount") = dGLCreditTotal
    '                        dRow("Balance") = dGLDebitTotal - dGLCreditTotal

    '                    ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sun General Ledger
    '                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If
    '                        dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                        If dtOB.Rows.Count > 0 Then
    '                            If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                dRow("Opn_DebitAmt") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                dDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                dGrandDebitTotal = dGrandDebitTotal + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                            Else
    '                                dRow("Opn_DebitAmt") = "0.00"
    '                            End If

    '                            If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                dRow("Opn_CreditAmount") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                dCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                dGrandCreditTotal = dGrandCreditTotal + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                            Else
    '                                dRow("Opn_CreditAmount") = "0.00"
    '                            End If

    '                            dBalance = dDebit - dCredit
    '                            If IsDBNull(dBalance) = False Then
    '                                dRow("Balance") = dBalance
    '                                dGrandBalanceTotal = dGrandBalanceTotal + dBalance
    '                            Else
    '                                dRow("Balance") = "0.00"
    '                            End If
    '                        End If
    '                    End If

    '                Else
    '                    dRow("Opn_DebitAmt") = "0.00"
    '                    dRow("Opn_CreditAmount") = "0.00"
    '                    dRow("Balance") = "0.00"
    '                End If
    '                dt.Rows.Add(dRow)
    '            Next
    '        End If

    '        dRow = dt.NewRow()
    '        dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
    '        dRow("Opn_DebitAmt") = dGrandDebitTotal
    '        dRow("Opn_CreditAmount") = dGrandCreditTotal
    '        dRow("Balance") = dGrandBalanceTotal
    '        dt.Rows.Add(dRow)

    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function LoadSubLeadger(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer,
                                       ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)

        Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
        Dim dRow As DataRow
        Dim dt As New DataTable
        Dim dtGroup As New DataTable
        Dim dtSub As New DataTable
        Dim dtSub1 As New DataTable
        Dim dtSubGLHeading As New DataTable
        Dim dtFA As New DataTable
        Dim dtLink As New DataTable
        Dim dtArray As New DataTable
        Dim dtGLCount As New DataTable
        Dim dr As OleDb.OleDbDataReader
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0, a As Integer = 0, m As Integer = 0
        Dim sArray As Array
        Dim sArrayGL As Array
        Dim dDebit As Double = 0.00
        Dim dCredit As Double = 0.00

        Dim dLDebit As Double = 0.00
        Dim dLCredit As Double = 0.00

        Dim dTotalDebit As Double = 0.00
        Dim dTotalCredit As Double = 0.00


        Dim dGTotalDebitl As Double = 0.00
        Dim dGTotalCreditl As Double = 0.00

        Dim DGdtotaldebit As Double = 0.00
        Dim DGdTotalcredit As Double = 0.00

        Dim DGdLsttotaldebit As Double = 0.00
        Dim DGdLstTotalcredit As Double = 0.00

        Dim fnlLastYear As String = 0.00
        Dim fnlPresentYear As String = 0.00

        Dim dTotalLDebit As Double = 0.00
        Dim dTotalLCredit As Double = 0.00
        Dim dTotalLdedit As Double = 0.0
        Dim iHead As Integer = 0
        Dim iSLNo As Integer = 0
        Dim iLastYear As Integer = 0
        Dim iStatusCheck As Integer = 0


        Dim sLiPresentYear As String = "" : Dim sLiLastYear As String = ""
        Dim sAssetPresentYear As String = "" : Dim sAssetLastYear As String = ""
        Dim sInPresentYear As String = "" : Dim sInLastYear As String = ""
        Dim sExPresentYear As String = "" : Dim sExLastYear As String = ""

        Dim sLiTotalCurrentDebit As String = "" : Dim sLiTotalLastYearDebit As String = ""
        Dim sAssetTotalCurrentDebit As String = "" : Dim sAssetTotalLastYearDebit As String = ""
        Dim sInTotalCurrentDebit As String = "" : Dim sInTotalLastYearDebit As String = ""
        Dim sExTotalCurrentDebit As String = "" : Dim sExTotalLastYearDebit As String = ""
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("SLNo")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("NoteNo")
            dt.Columns.Add("PresentYear")
            dt.Columns.Add("LastYear")
            dt.Columns.Add("PCrDr")
            dt.Columns.Add("LCrDr")

            'Liabilites

            sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
            sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCompID & ")"
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                iLastYear = dr("YMS_ID")
            Else
                iLastYear = 0
            End If

            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_yearID =" & iYearID & ""
            If iZoneID > 0 Then
                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
            End If
            dr = objDB.SQLDataReader(sNameSpace, iSql)
            If dr.HasRows = True Then
                dr.Read()
                If dr("Opn_Status") = "F" Then
                    iStatusCheck = 0
                Else
                    iStatusCheck = 1
                End If
            Else
                iStatusCheck = 1
            End If

            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 4 and gl_Delflag ='C' and gl_Status ='A' and gl_CompID =" & iCompID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "EQUITY AND LIABILITIES" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = "<B>" & dtSub.Rows(j)("gl_Desc") & "</B>"
                            End If

                            dDebit = 0 : dCredit = 0
                            Dim iNoteSlno As Integer = 0
                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head = 4 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCompID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")

                                End If
                                dt.Rows.Add(dRow)

                                Dim iGLHeading As Integer = 0
                                Dim iSglId As Integer = 0
                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                sArrayGL = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArrayGL.Length - 1 Then
                                    For kb = 0 To sArrayGL.Length - 1
                                        If sArrayGL(kb) <> "" Then
                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                            dtSubGLHeading = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                            If dtSubGLHeading.Rows.Count > 0 Then
                                                For y = 0 To dtSubGLHeading.Rows.Count - 1
                                                    dRow = dt.NewRow()
                                                    If IsDBNull(dtSubGLHeading.Rows(y)("gl_Head").ToString()) = False Then
                                                        If dtSubGLHeading.Rows(y)("gl_head").ToString = 2 Then
                                                            iGLHeading = sArray(kb)
                                                            iSglId = dtSubGLHeading.Rows(y)("gl_id")
                                                            dRow("Particulars") = "<B>" & dtSubGLHeading.Rows(y)("gl_Desc") & "</B>"
                                                            iNoteSlno = iNoteSlno + 1
                                                            dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo") & "." & iNoteSlno
                                                            dt.Rows.Add(dRow)
                                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                            dtGLCount = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                            If dtGLCount.Rows.Count > 0 Then
                                                                For dw = 0 To dtGLCount.Rows.Count - 1
                                                                    If sArray.Length - 1 Then
                                                                        For k = 0 To sArray.Length - 1
                                                                            If sArray(k) <> "" Then
                                                                                If sArray(k) = dtGLCount.Rows(dw)("gl_id") Then
                                                                                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArray(k) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                                    dtSub1 = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                                    If dtSub1.Rows.Count > 0 Then
                                                                                        For z = 0 To dtSub1.Rows.Count - 1
                                                                                            dRow = dt.NewRow()
                                                                                            If IsDBNull(dtSub1.Rows(z)("gl_id").ToString()) = False Then
                                                                                                dRow("ID") = dtSub1.Rows(z)("gl_ID")
                                                                                            End If

                                                                                            If IsDBNull(dtSub1.Rows(z)("gl_Desc").ToString()) = False Then
                                                                                                dRow("Particulars") = dtSub1.Rows(z)("gl_Desc")
                                                                                            End If
                                                                                            If iStatusCheck = 0 Then
                                                                                                iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCompID & " and "
                                                                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                            '  DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If

                                                                                            Else
                                                                                                iSql = "" : iSql = "Select * from acc_Transactions_Details " 'Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                                                                iSql = iSql & " where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCompID & " and ATD_GL=" & iGLHeading & " and  ATD_SubGL =" & sArray(k) & " and ATD_Status='A'"
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                            ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                        End If
                                                                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If

                                                                                                iSql = "" : iSql = "Select * from acc_opening_balance "
                                                                                                iSql = iSql & " where opn_YearID =" & iYearID & " and opn_CompID =" & iCompID & " and Opn_GLID=" & sArray(k) & "  and opn_Status='A'"
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("Opn_DebitAmt").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())
                                                                                                            '  DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())
                                                                                                        End If
                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If

                                                                                            End If

                                                                                            'Last year 

                                                                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCompID & " and "
                                                                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                            End If
                                                                                            If iZoneID > 0 Then
                                                                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                            End If
                                                                                            If iRegionID > 0 Then
                                                                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                            End If
                                                                                            If iAreaID > 0 Then
                                                                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                            End If
                                                                                            If iBranchID > 0 Then
                                                                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                            End If
                                                                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                            If dtArray.Rows.Count > 0 Then
                                                                                                For a = 0 To dtArray.Rows.Count - 1
                                                                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                        dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        DGdLsttotaldebit = DGdLsttotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                    End If

                                                                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                        dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        DGdLstTotalcredit = DGdLstTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                    End If
                                                                                                Next
                                                                                            End If

                                                                                            If (dDebit <> 0) And (dCredit <> 0) Then
                                                                                                sLiPresentYear = dCredit - dDebit
                                                                                            ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                                                                                sLiPresentYear = dCredit - dDebit
                                                                                            ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                                                                                sLiPresentYear = dCredit
                                                                                            ElseIf (dDebit = 0) And (dCredit = 0) Then
                                                                                                sLiPresentYear = "0.00"
                                                                                            End If

                                                                                            If sLiPresentYear.StartsWith("-") = True Then
                                                                                                sLiPresentYear = sLiPresentYear.Remove(0, 1)
                                                                                                dTotalDebit = dTotalDebit - sLiPresentYear
                                                                                                dRow("PCrDr") = "Dr"
                                                                                            Else
                                                                                                dTotalDebit = dTotalDebit + sLiPresentYear
                                                                                                If sLiPresentYear = "0.00" Then
                                                                                                    dRow("PCrDr") = ""
                                                                                                Else
                                                                                                    dRow("PCrDr") = "Cr"
                                                                                                End If
                                                                                            End If
                                                                                            dRow("PresentYear") = sLiPresentYear
                                                                                            dDebit = 0 : dCredit = 0


                                                                                            If (dLDebit <> 0) And (dLCredit <> 0) Then
                                                                                                sLiLastYear = dLCredit - dLDebit
                                                                                            ElseIf dLDebit <> 0 Then
                                                                                                sLiLastYear = dLDebit
                                                                                            ElseIf dLCredit <> 0 Then
                                                                                                sLiLastYear = dLCredit
                                                                                            ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                                                                                sLiLastYear = "0.00"
                                                                                            End If

                                                                                            If sLiLastYear.StartsWith("-") = True Then
                                                                                                sLiLastYear = sLiLastYear.Remove(0, 1)
                                                                                                dTotalLDebit = dTotalLDebit - sLiLastYear
                                                                                                dRow("LCrDr") = "Dr"
                                                                                            Else
                                                                                                dTotalLDebit = dTotalLDebit + sLiLastYear
                                                                                                If sLiLastYear = "0.00" Then
                                                                                                    dRow("LCrDr") = ""
                                                                                                Else
                                                                                                    dRow("LCrDr") = "Cr"
                                                                                                End If
                                                                                            End If
                                                                                            dRow("LastYear") = sLiLastYear
                                                                                            dLDebit = 0 : dLCredit = 0
                                                                                            dt.Rows.Add(dRow)
                                                                                        Next
                                                                                    End If
                                                                                End If
                                                                            End If
                                                                        Next
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                    End If
                                                Next
                                            End If
                                        End If
                                    Next
                                End If
                            End If
                            dRow = dt.NewRow()
                            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                            sLiTotalCurrentDebit = dTotalDebit
                            If sLiTotalCurrentDebit.StartsWith("-") = True Then
                                sLiTotalCurrentDebit = sLiTotalCurrentDebit.Remove(0, 1)
                                DGdtotaldebit = DGdtotaldebit - sLiTotalCurrentDebit
                                dRow("PCrDr") = "Dr"
                            Else
                                DGdtotaldebit = DGdtotaldebit + sLiTotalCurrentDebit
                                If sLiTotalCurrentDebit = "0" Then
                                    dRow("PCrDr") = ""
                                Else
                                    dRow("PCrDr") = "Cr"
                                End If
                            End If

                            dRow("PresentYear") = sLiTotalCurrentDebit
                            sLiTotalLastYearDebit = dTotalLDebit
                            If sLiTotalLastYearDebit.StartsWith("-") = True Then
                                sLiTotalLastYearDebit = sLiTotalLastYearDebit.Remove(0, 1)
                                dGTotalDebitl = dGTotalDebitl - dTotalDebit
                                dRow("LCrDr") = "Dr"
                            Else
                                dGTotalDebitl = dGTotalDebitl + dTotalDebit
                                If sLiTotalLastYearDebit = "0" Then
                                    dRow("LCrDr") = ""
                                Else
                                    dRow("LCrDr") = "Cr"
                                End If
                            End If
                            dRow("LastYear") = sLiTotalLastYearDebit

                            dTotalDebit = 0
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next
            End If


            'Assets
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 1 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCompID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then
                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "ASSETS" & "</B>"
                dt.Rows.Add(dRow)
                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If
                    dRow("SLNo") = iSLNo + 1
                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)
                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_Delflag ='C' and "
                    aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCompID & "  order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If
                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = "<B>" & dtSub.Rows(j)("gl_Desc") & "</B>"
                            End If

                            dDebit = 0 : dCredit = 0
                            Dim iGLHeading As Integer = 0
                            Dim iNoteSlno As Integer = 0
                            dTotalDebit = 0 : dTotalCredit = 0
                            If dtSub.Rows(j)("gl_Desc").ToString() = "Fixed Assets" Then
                                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & dtSub.Rows(j)("gl_ID") & " and gl_Delflag ='C' and "
                                aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCompID & "  order by gl_id"
                                dtFA = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                If dtFA.Rows.Count > 0 Then
                                    'For m = 0 To dtFA.Rows.Count - 1
                                    ' dt.Rows.Add(dRow)
                                    ' dRow = dt.NewRow()

                                    ' If IsDBNull(dtFA.Rows(m)("gl_Desc").ToString()) = False Then
                                    'dRow("Particulars") = dtFA.Rows(m)("gl_Desc")
                                    'End If


                                    mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                                    mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCompID & ""
                                    dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                                    If dtLink.Rows.Count > 0 Then
                                        If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                            dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                        End If
                                        dt.Rows.Add(dRow)
                                        sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")

                                        sArrayGL = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")

                                        If sArrayGL.Length - 1 Then
                                            For kb = 0 To sArrayGL.Length - 1
                                                If sArrayGL(kb) <> "" Then
                                                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                    dtSubGLHeading = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                    If dtSubGLHeading.Rows.Count > 0 Then
                                                        For y = 0 To dtSubGLHeading.Rows.Count - 1
                                                            dRow = dt.NewRow()
                                                            If IsDBNull(dtSubGLHeading.Rows(y)("gl_Head").ToString()) = False Then
                                                                If dtSubGLHeading.Rows(y)("gl_head").ToString = 2 Then
                                                                    iGLHeading = sArray(kb)
                                                                    dRow("Particulars") = "<B>" & dtSubGLHeading.Rows(y)("gl_Desc") & "</B>"
                                                                    iNoteSlno = iNoteSlno + 1
                                                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo") & "." & iNoteSlno
                                                                    dt.Rows.Add(dRow)
                                                                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                    dtGLCount = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                    If dtGLCount.Rows.Count > 0 Then
                                                                        For dw = 0 To dtGLCount.Rows.Count - 1
                                                                            If sArray.Length - 1 Then
                                                                                For k = 0 To sArray.Length - 1
                                                                                    If sArray(k) <> "" Then
                                                                                        If sArray(k) = dtGLCount.Rows(dw)("gl_id") Then
                                                                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArray(k) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                                            dtSub1 = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                                            If dtSub1.Rows.Count > 0 Then
                                                                                                For z = 0 To dtSub1.Rows.Count - 1
                                                                                                    dRow = dt.NewRow()

                                                                                                    If IsDBNull(dtSub1.Rows(z)("gl_id").ToString()) = False Then
                                                                                                        dRow("ID") = dtSub1.Rows(z)("gl_ID")
                                                                                                    End If
                                                                                                    If IsDBNull(dtSub1.Rows(z)("gl_Desc").ToString()) = False Then
                                                                                                        dRow("Particulars") = dtSub1.Rows(z)("gl_Desc")
                                                                                                    End If
                                                                                                    If iStatusCheck = 0 Then
                                                                                                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCompID & " and "
                                                                                                        iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                                                                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                            iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                        End If
                                                                                                        If iZoneID > 0 Then
                                                                                                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                        End If
                                                                                                        If iRegionID > 0 Then
                                                                                                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                        End If
                                                                                                        If iAreaID > 0 Then
                                                                                                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                        End If
                                                                                                        If iBranchID > 0 Then
                                                                                                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                        End If
                                                                                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                        If dtArray.Rows.Count > 0 Then

                                                                                                            For a = 0 To dtArray.Rows.Count - 1
                                                                                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                                    ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                                End If

                                                                                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                                    DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                                End If
                                                                                                            Next
                                                                                                        End If
                                                                                                    Else
                                                                                                        iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                                                                        iSql = iSql & " where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCompID & " and atd_gl=" & iGLHeading & " and ATD_SubGL =" & sArray(k) & " and ATD_Status='A'"
                                                                                                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                            iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                        End If
                                                                                                        If iZoneID > 0 Then
                                                                                                            iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                                                                        End If
                                                                                                        If iRegionID > 0 Then
                                                                                                            iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                                                                        End If
                                                                                                        If iAreaID > 0 Then
                                                                                                            iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                                                                        End If
                                                                                                        If iBranchID > 0 Then
                                                                                                            iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                                                                        End If
                                                                                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                        If dtArray.Rows.Count > 0 Then
                                                                                                            For a = 0 To dtArray.Rows.Count - 1
                                                                                                                If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                                    ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                                End If

                                                                                                                If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                                    DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                                End If
                                                                                                            Next

                                                                                                        End If

                                                                                                        iSql = "" : iSql = "Select * from acc_opening_balance"
                                                                                                        iSql = iSql & " where opn_YearId =" & iYearID & " and opn_CompID =" & iCompID & " and opn_glid=" & sArray(k) & "  and opn_Status='A'"
                                                                                                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                            iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                        End If
                                                                                                        If iZoneID > 0 Then
                                                                                                            iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                                                                        End If
                                                                                                        If iRegionID > 0 Then
                                                                                                            iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                                                                        End If
                                                                                                        If iAreaID > 0 Then
                                                                                                            iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                                                                        End If
                                                                                                        If iBranchID > 0 Then
                                                                                                            iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                                                                        End If
                                                                                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                        If dtArray.Rows.Count > 0 Then
                                                                                                            For a = 0 To dtArray.Rows.Count - 1
                                                                                                                If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                                    ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                                End If

                                                                                                                If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                                    DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                                End If
                                                                                                            Next

                                                                                                        End If

                                                                                                    End If
                                                                                                    'Last year
                                                                                                    iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCompID & " and "
                                                                                                    iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                        iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                    End If
                                                                                                    If iZoneID > 0 Then
                                                                                                        iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                    End If
                                                                                                    If iRegionID > 0 Then
                                                                                                        iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                    End If
                                                                                                    If iAreaID > 0 Then
                                                                                                        iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                    End If
                                                                                                    If iBranchID > 0 Then
                                                                                                        iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                    End If
                                                                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                    If dtArray.Rows.Count > 0 Then
                                                                                                        For a = 0 To dtArray.Rows.Count - 1
                                                                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                                dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                                DGdLsttotaldebit = DGdLsttotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                            End If

                                                                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                                dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                                DGdLstTotalcredit = DGdLstTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                            End If
                                                                                                        Next

                                                                                                    End If





                                                                                                    If (dDebit <> 0) And (dCredit <> 0) Then
                                                                                                        sAssetPresentYear = dCredit - dDebit
                                                                                                    ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                                                                                        sAssetPresentYear = dCredit - dDebit
                                                                                                    ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                                                                                        sAssetPresentYear = dCredit
                                                                                                    ElseIf (dDebit = 0) And (dCredit = 0) Then
                                                                                                        sAssetPresentYear = "0.00"
                                                                                                    End If



                                                                                                    If sAssetPresentYear.StartsWith("-") = True Then
                                                                                                        sAssetPresentYear = sAssetPresentYear.Remove(0, 1)
                                                                                                        dTotalDebit = dTotalDebit - sAssetPresentYear
                                                                                                        dRow("PCrDr") = "Dr"
                                                                                                    Else
                                                                                                        dTotalDebit = dTotalDebit + sAssetPresentYear
                                                                                                        If sAssetPresentYear = "0.00" Then
                                                                                                            dRow("PCrDr") = ""
                                                                                                        Else
                                                                                                            dRow("PCrDr") = "Cr"
                                                                                                        End If

                                                                                                    End If
                                                                                                    dRow("PresentYear") = sAssetPresentYear

                                                                                                    dDebit = 0 : dCredit = 0

                                                                                                    If (dLDebit <> 0) And (dLCredit <> 0) Then
                                                                                                        sAssetLastYear = dLCredit - dLDebit
                                                                                                    ElseIf dLDebit <> 0 Then
                                                                                                        sAssetLastYear = dLDebit
                                                                                                    ElseIf dLCredit <> 0 Then
                                                                                                        sAssetLastYear = dLCredit
                                                                                                    ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                                                                                        sAssetLastYear = "0.00"
                                                                                                    End If

                                                                                                    If sAssetLastYear.StartsWith("-") = True Then
                                                                                                        sAssetLastYear = sAssetLastYear.Remove(0, 1)
                                                                                                        dTotalLDebit = dTotalLDebit - sAssetLastYear
                                                                                                        dRow("LCrDr") = "Dr"
                                                                                                    Else
                                                                                                        dTotalLDebit = dTotalLDebit + sAssetLastYear
                                                                                                        If sAssetLastYear = "0.00" Then
                                                                                                            dRow("LCrDr") = ""
                                                                                                        Else
                                                                                                            dRow("LCrDr") = "Cr"
                                                                                                        End If

                                                                                                    End If
                                                                                                    dRow("LastYear") = sAssetLastYear
                                                                                                    dLDebit = 0 : dLCredit = 0
                                                                                                    dt.Rows.Add(dRow)
                                                                                                Next
                                                                                            End If
                                                                                        End If
                                                                                    End If
                                                                                Next
                                                                            End If
                                                                        Next
                                                                    End If
                                                                End If
                                                            End If
                                                        Next
                                                    End If
                                                End If
                                            Next
                                        End If
                                    End If
                                    'Next
                                End If
                            Else

                                '------------------------------------------------------------------------------------------
                                dDebit = 0 : dCredit = 0
                                ' dTotalDebit = 0 : dTotalCredit = 0
                                mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                                mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCompID & ""
                                dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                                If dtLink.Rows.Count > 0 Then
                                    If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                        dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                    End If
                                    dt.Rows.Add(dRow)
                                    sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                    sArrayGL = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                    If sArrayGL.Length - 1 Then
                                        For kb = 0 To sArrayGL.Length - 1
                                            If sArrayGL(kb) <> "" Then
                                                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                dtSubGLHeading = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                If dtSubGLHeading.Rows.Count > 0 Then
                                                    For y = 0 To dtSubGLHeading.Rows.Count - 1
                                                        dRow = dt.NewRow()
                                                        If IsDBNull(dtSubGLHeading.Rows(y)("gl_Head").ToString()) = False Then
                                                            If dtSubGLHeading.Rows(y)("gl_head").ToString = 2 Then
                                                                iGLHeading = sArray(kb)
                                                                dRow("Particulars") = "<B>" & dtSubGLHeading.Rows(y)("gl_Desc") & "</B>"
                                                                iNoteSlno = iNoteSlno + 1
                                                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo") & "." & iNoteSlno
                                                                dt.Rows.Add(dRow)
                                                                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                dtGLCount = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                If dtGLCount.Rows.Count > 0 Then
                                                                    For dw = 0 To dtGLCount.Rows.Count - 1
                                                                        If sArray.Length - 1 Then
                                                                            For k = 0 To sArray.Length - 1
                                                                                If sArray(k) <> "" Then
                                                                                    If sArray(k) = dtGLCount.Rows(dw)("gl_id") Then
                                                                                        aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArray(k) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                                        dtSub1 = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                                        If dtSub1.Rows.Count > 0 Then
                                                                                            For z = 0 To dtSub1.Rows.Count - 1
                                                                                                dRow = dt.NewRow()
                                                                                                If IsDBNull(dtSub1.Rows(z)("gl_id").ToString()) = False Then
                                                                                                    dRow("ID") = dtSub1.Rows(z)("gl_ID")
                                                                                                End If
                                                                                                If IsDBNull(dtSub1.Rows(z)("gl_Desc").ToString()) = False Then
                                                                                                    dRow("Particulars") = dtSub1.Rows(z)("gl_Desc")
                                                                                                End If
                                                                                                If iStatusCheck = 0 Then
                                                                                                    iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCompID & " and "
                                                                                                    iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                        iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                    End If
                                                                                                    If iZoneID > 0 Then
                                                                                                        iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                    End If
                                                                                                    If iRegionID > 0 Then
                                                                                                        iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                    End If
                                                                                                    If iAreaID > 0 Then
                                                                                                        iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                    End If
                                                                                                    If iBranchID > 0 Then
                                                                                                        iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                    End If
                                                                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                    If dtArray.Rows.Count > 0 Then

                                                                                                        For a = 0 To dtArray.Rows.Count - 1
                                                                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                                ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                            End If

                                                                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                                DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                            End If
                                                                                                        Next
                                                                                                    End If
                                                                                                Else
                                                                                                    iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                                                                    iSql = iSql & " Where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCompID & " and atd_gl=" & iGLHeading & " and ATD_SubGL =" & sArray(k) & " and ATD_Status='A'"
                                                                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                        iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                    End If
                                                                                                    If iZoneID > 0 Then
                                                                                                        iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                                                                    End If
                                                                                                    If iRegionID > 0 Then
                                                                                                        iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                                                                    End If
                                                                                                    If iAreaID > 0 Then
                                                                                                        iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                                                                    End If
                                                                                                    If iBranchID > 0 Then
                                                                                                        iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                                                                    End If
                                                                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                    If dtArray.Rows.Count > 0 Then
                                                                                                        For a = 0 To dtArray.Rows.Count - 1
                                                                                                            If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                                'DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                            End If

                                                                                                            If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                                DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                            End If
                                                                                                        Next

                                                                                                    End If
                                                                                                    iSql = "" : iSql = "Select * from acc_opening_balance"
                                                                                                    iSql = iSql & " Where opn_YearId =" & iYearID & " and opn_CompID =" & iCompID & " and opn_glid=" & sArray(k) & "  and opn_Status='A'"
                                                                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                        iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                    End If
                                                                                                    If iZoneID > 0 Then
                                                                                                        iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                                                                    End If
                                                                                                    If iRegionID > 0 Then
                                                                                                        iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                                                                    End If
                                                                                                    If iAreaID > 0 Then
                                                                                                        iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                                                                    End If
                                                                                                    If iBranchID > 0 Then
                                                                                                        iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                                                                    End If
                                                                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                    If dtArray.Rows.Count > 0 Then
                                                                                                        For a = 0 To dtArray.Rows.Count - 1
                                                                                                            If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                                ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                            End If

                                                                                                            If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                                DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                            End If
                                                                                                        Next

                                                                                                    End If

                                                                                                End If
                                                                                                'last year
                                                                                                iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCompID & " and "
                                                                                                iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                            DGdLsttotaldebit = DGdLsttotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                            DGdLstTotalcredit = DGdLstTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        End If
                                                                                                    Next

                                                                                                End If




                                                                                                If (dDebit <> 0) And (dCredit <> 0) Then
                                                                                                    sAssetPresentYear = dCredit - dDebit
                                                                                                ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                                                                                    sAssetPresentYear = dCredit - dDebit
                                                                                                ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                                                                                    sAssetPresentYear = dCredit
                                                                                                ElseIf (dDebit = 0) And (dCredit = 0) Then
                                                                                                    sAssetPresentYear = "0.00"
                                                                                                End If



                                                                                                If sAssetPresentYear.StartsWith("-") = True Then
                                                                                                    sAssetPresentYear = sAssetPresentYear.Remove(0, 1)
                                                                                                    dTotalDebit = dTotalDebit - sAssetPresentYear
                                                                                                    dRow("PCrDr") = "Dr"
                                                                                                Else
                                                                                                    dTotalDebit = dTotalDebit + sAssetPresentYear
                                                                                                    If sAssetPresentYear = "0.00" Then
                                                                                                        dRow("PCrDr") = ""
                                                                                                    Else
                                                                                                        dRow("PCrDr") = "Cr"
                                                                                                    End If


                                                                                                End If
                                                                                                dRow("PresentYear") = sAssetPresentYear
                                                                                                dDebit = 0 : dCredit = 0

                                                                                                If (dLDebit <> 0) And (dLCredit <> 0) Then
                                                                                                    sAssetLastYear = dLCredit - dLDebit
                                                                                                ElseIf dLDebit <> 0 Then
                                                                                                    sAssetLastYear = dLDebit
                                                                                                ElseIf dLCredit <> 0 Then
                                                                                                    sAssetLastYear = dLCredit
                                                                                                ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                                                                                    sAssetLastYear = "0.00"
                                                                                                End If

                                                                                                If sAssetLastYear.StartsWith("-") = True Then
                                                                                                    sAssetLastYear = sAssetLastYear.Remove(0, 1)
                                                                                                    dTotalLDebit = dTotalLDebit - sAssetLastYear
                                                                                                    dRow("LCrDr") = "Dr"
                                                                                                Else
                                                                                                    dTotalLDebit = dTotalLDebit + sAssetLastYear
                                                                                                    If sAssetLastYear = "0.00" Then
                                                                                                        dRow("LCrDr") = ""
                                                                                                    Else
                                                                                                        dRow("LCrDr") = "Cr"
                                                                                                    End If

                                                                                                End If
                                                                                                dRow("LastYear") = sAssetLastYear

                                                                                                dLDebit = 0 : dLCredit = 0
                                                                                                dt.Rows.Add(dRow)
                                                                                            Next
                                                                                        End If
                                                                                    End If
                                                                                End If

                                                                            Next
                                                                        End If
                                                                    Next
                                                                End If

                                                            End If
                                                        End If
                                                    Next
                                                End If
                                            End If
                                        Next
                                    End If

                                    dRow = dt.NewRow()
                                    dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                                    sAssetTotalCurrentDebit = dTotalDebit
                                    If sAssetTotalCurrentDebit.StartsWith("-") = True Then
                                        sAssetTotalCurrentDebit = sAssetTotalCurrentDebit.Remove(0, 1)
                                        DGdtotaldebit = DGdtotaldebit - sAssetTotalCurrentDebit
                                        dRow("PCrDr") = "Dr"
                                    Else
                                        DGdtotaldebit = DGdtotaldebit + sAssetTotalCurrentDebit
                                        If sAssetTotalCurrentDebit = "0" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = "Cr"
                                        End If
                                    End If

                                    dRow("PresentYear") = sAssetTotalCurrentDebit

                                    sAssetTotalLastYearDebit = dTotalLDebit
                                    If sAssetTotalLastYearDebit.StartsWith("-") = True Then
                                        sAssetTotalLastYearDebit = sAssetTotalLastYearDebit.Remove(0, 1)
                                        dRow("LCrDr") = "Dr"
                                    Else
                                        If sAssetTotalLastYearDebit = "0" Then
                                            dRow("LCrDr") = ""
                                        Else
                                            dRow("LCrDr") = "Cr"
                                        End If
                                    End If
                                    dRow("LastYear") = sAssetTotalLastYearDebit
                                    dTotalDebit = 0
                                    dTotalLDebit = 0
                                    dt.Rows.Add(dRow)
                                End If


                            End If

                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next


            End If




            'Income
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 2 and gl_Delflag ='C' and "
            sSql = sSql & "gl_Status ='A' and gl_CompID =" & iCompID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "REVENUE" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " and gl_CompID =" & iCompID & " and "
                    aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = "<B>" & dtSub.Rows(j)("gl_Desc") & "</B>"
                            End If

                            dDebit = 0 : dCredit = 0
                            Dim iNoteSlno As Integer = 0
                            Dim iGLHeading As Integer = 0
                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =2 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCompID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If
                                dt.Rows.Add(dRow)
                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                sArrayGL = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArrayGL.Length - 1 Then
                                    For kb = 0 To sArrayGL.Length - 1
                                        If sArrayGL(kb) <> "" Then
                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                            dtSubGLHeading = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                            If dtSubGLHeading.Rows.Count > 0 Then
                                                For y = 0 To dtSubGLHeading.Rows.Count - 1
                                                    dRow = dt.NewRow()
                                                    If IsDBNull(dtSubGLHeading.Rows(y)("gl_Head").ToString()) = False Then
                                                        If dtSubGLHeading.Rows(y)("gl_head").ToString = 2 Then
                                                            iGLHeading = sArray(kb)
                                                            dRow("Particulars") = "<B>" & dtSubGLHeading.Rows(y)("gl_Desc") & "</B>"
                                                            iNoteSlno = iNoteSlno + 1
                                                            dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo") & "." & iNoteSlno
                                                            dt.Rows.Add(dRow)
                                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                            dtGLCount = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                            If dtGLCount.Rows.Count > 0 Then
                                                                For dw = 0 To dtGLCount.Rows.Count - 1
                                                                    If sArray.Length - 1 Then
                                                                        For k = 0 To sArray.Length - 1
                                                                            If sArray(k) <> "" Then
                                                                                If sArray(k) = dtGLCount.Rows(dw)("gl_id") Then
                                                                                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArray(k) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                                    dtSub1 = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                                    If dtSub1.Rows.Count > 0 Then
                                                                                        For z = 0 To dtSub1.Rows.Count - 1
                                                                                            dRow = dt.NewRow()

                                                                                            If IsDBNull(dtSub1.Rows(z)("gl_id").ToString()) = False Then
                                                                                                dRow("ID") = dtSub1.Rows(z)("gl_ID")
                                                                                            End If
                                                                                            If IsDBNull(dtSub1.Rows(z)("gl_Desc").ToString()) = False Then
                                                                                                dRow("Particulars") = dtSub1.Rows(z)("gl_Desc")
                                                                                            End If
                                                                                            If iStatusCheck = 0 Then
                                                                                                iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCompID & " and "
                                                                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)

                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                            '  DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If
                                                                                            Else
                                                                                                iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                                                                iSql = iSql & " where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCompID & " and atd_gl=" & iGLHeading & " and ATD_SubGL =" & sArray(k) & " and ATD_Status='A'"
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                            '  DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If

                                                                                                iSql = "" : iSql = "Select * from acc_opening_balance"
                                                                                                iSql = iSql & " where opn_YearId =" & iYearID & " and opn_CompID =" & iCompID & " and opn_glid=" & sArray(k) & " and opn_Status='A'"
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                            'DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAMt").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If

                                                                                            End If
                                                                                            'last year
                                                                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCompID & " and "
                                                                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                            End If
                                                                                            If iZoneID > 0 Then
                                                                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                            End If
                                                                                            If iRegionID > 0 Then
                                                                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                            End If
                                                                                            If iAreaID > 0 Then
                                                                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                            End If
                                                                                            If iBranchID > 0 Then
                                                                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                            End If
                                                                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                            If dtArray.Rows.Count > 0 Then
                                                                                                For a = 0 To dtArray.Rows.Count - 1
                                                                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                        dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        DGdLsttotaldebit = DGdLsttotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                    End If

                                                                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                        dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        DGdLstTotalcredit = DGdLstTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                    End If
                                                                                                Next
                                                                                            End If


                                                                                            If (dDebit <> 0) And (dCredit <> 0) Then
                                                                                                sInPresentYear = dCredit - dDebit
                                                                                            ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                                                                                sInPresentYear = dCredit - dDebit
                                                                                            ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                                                                                sInPresentYear = dCredit
                                                                                            ElseIf (dDebit = 0) And (dCredit = 0) Then
                                                                                                sInPresentYear = "0.00"
                                                                                            End If



                                                                                            If sInPresentYear.StartsWith("-") = True Then
                                                                                                sInPresentYear = sInPresentYear.Remove(0, 1)
                                                                                                dTotalDebit = dTotalDebit - sInPresentYear
                                                                                                dRow("PCrDr") = "Dr"
                                                                                            Else
                                                                                                dTotalDebit = dTotalDebit + sInPresentYear
                                                                                                If sInPresentYear = "0.00" Then
                                                                                                    dRow("PCrDr") = ""
                                                                                                Else
                                                                                                    dRow("PCrDr") = "Cr"
                                                                                                End If
                                                                                            End If
                                                                                            dRow("PresentYear") = sInPresentYear


                                                                                            dDebit = 0 : dCredit = 0


                                                                                            If (dLDebit <> 0) And (dLCredit <> 0) Then
                                                                                                sInLastYear = dLCredit - dLDebit
                                                                                            ElseIf dLDebit <> 0 Then
                                                                                                sInLastYear = dLDebit
                                                                                            ElseIf dLCredit <> 0 Then
                                                                                                sInLastYear = dLCredit
                                                                                            ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                                                                                sInLastYear = "0.00"
                                                                                            End If

                                                                                            If sInLastYear.StartsWith("-") = True Then
                                                                                                sInLastYear = sInLastYear.Remove(0, 1)
                                                                                                dTotalLDebit = dTotalLDebit - sInLastYear
                                                                                                dRow("LCrDr") = "Dr"
                                                                                            Else
                                                                                                dTotalLDebit = dTotalLDebit + sInLastYear
                                                                                                If sInLastYear = "0.00" Then
                                                                                                    dRow("LCrDr") = ""
                                                                                                Else
                                                                                                    dRow("LCrDr") = "Cr"
                                                                                                End If
                                                                                            End If
                                                                                            dRow("LastYear") = sInLastYear

                                                                                            dLDebit = 0 : dLCredit = 0
                                                                                            dt.Rows.Add(dRow)
                                                                                        Next
                                                                                    End If
                                                                                End If
                                                                            End If

                                                                        Next
                                                                    End If
                                                                Next
                                                            End If

                                                        End If
                                                    End If
                                                Next
                                            End If
                                        End If
                                    Next
                                End If


                            End If

                            dRow = dt.NewRow()
                            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                            sInTotalCurrentDebit = dTotalDebit
                            If sInTotalCurrentDebit.StartsWith("-") = True Then
                                sInTotalCurrentDebit = sInTotalCurrentDebit.Remove(0, 1)
                                DGdtotaldebit = DGdtotaldebit - sInTotalCurrentDebit
                                dRow("PCrDr") = "Dr"
                            Else
                                DGdtotaldebit = DGdtotaldebit + sInTotalCurrentDebit
                                If sInTotalCurrentDebit = "0" Then
                                    dRow("PCrDr") = ""
                                Else
                                    dRow("PCrDr") = "Cr"
                                End If
                            End If

                            dRow("PresentYear") = sInTotalCurrentDebit

                            sAssetTotalLastYearDebit = dTotalLDebit
                            If sAssetTotalLastYearDebit.StartsWith("-") = True Then
                                sAssetTotalLastYearDebit = sAssetTotalLastYearDebit.Remove(0, 1)
                                dRow("LCrDr") = "Dr"
                            Else
                                If sAssetTotalLastYearDebit = "0" Then
                                    dRow("LCrDr") = ""
                                Else
                                    dRow("LCrDr") = "Cr"
                                End If
                            End If
                            dRow("LastYear") = sAssetTotalLastYearDebit
                            dTotalDebit = 0
                            dTotalLDebit = 0
                            dt.Rows.Add(dRow)


                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next


            End If


            'Expenditure
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 3 and gl_Delflag ='C' and "
            sSql = sSql & "gl_Status ='A' and gl_CompID =" & iCompID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "EXPENDITURE" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " and "
                    aSql = aSql & "gl_CompID =" & iCompID & " And gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = "<B>" & dtSub.Rows(j)("gl_Desc") & "</B>"
                            End If

                            dDebit = 0 : dCredit = 0
                            Dim iNoteSlno As Integer = 0
                            Dim iGLHeading As Integer = 0
                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =3 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCompID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If
                                dt.Rows.Add(dRow)
                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                sArrayGL = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArrayGL.Length - 1 Then
                                    For kb = 0 To sArrayGL.Length - 1
                                        If sArrayGL(kb) <> "" Then
                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                            dtSubGLHeading = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                            If dtSubGLHeading.Rows.Count > 0 Then
                                                For y = 0 To dtSubGLHeading.Rows.Count - 1
                                                    dRow = dt.NewRow()
                                                    If IsDBNull(dtSubGLHeading.Rows(y)("gl_Head").ToString()) = False Then
                                                        If dtSubGLHeading.Rows(y)("gl_head").ToString = 2 Then
                                                            iGLHeading = sArray(kb)
                                                            dRow("Particulars") = "<B>" & dtSubGLHeading.Rows(y)("gl_Desc") & "</B>"
                                                            iNoteSlno = iNoteSlno + 1
                                                            dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo") & "." & iNoteSlno
                                                            dt.Rows.Add(dRow)
                                                            aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & sArrayGL(kb) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                            dtGLCount = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                            If dtGLCount.Rows.Count > 0 Then
                                                                For dw = 0 To dtGLCount.Rows.Count - 1
                                                                    If sArray.Length - 1 Then
                                                                        For k = 0 To sArray.Length - 1
                                                                            If sArray(k) <> "" Then
                                                                                If sArray(k) = dtGLCount.Rows(dw)("gl_id") Then
                                                                                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_id = " & sArray(k) & " and gl_CompID =" & iCompID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                                                                                    dtSub1 = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                                                                    If dtSub1.Rows.Count > 0 Then
                                                                                        For z = 0 To dtSub1.Rows.Count - 1
                                                                                            dRow = dt.NewRow()

                                                                                            If IsDBNull(dtSub1.Rows(z)("gl_id").ToString()) = False Then
                                                                                                dRow("ID") = dtSub1.Rows(z)("gl_ID")
                                                                                            End If
                                                                                            If IsDBNull(dtSub1.Rows(z)("gl_Desc").ToString()) = False Then
                                                                                                dRow("Particulars") = dtSub1.Rows(z)("gl_Desc")
                                                                                            End If
                                                                                            If iStatusCheck = 0 Then
                                                                                                iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCompID & " and "
                                                                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                            ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If
                                                                                            Else
                                                                                                iSql = "" : iSql = "Select * from acc_Transactions_Details"
                                                                                                iSql = iSql & " where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCompID & " and atd_gl=" & iGLHeading & " and ATD_SubGL =" & sArray(k) & " and ATD_Status='A'"
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                            'DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If

                                                                                                iSql = "" : iSql = "Select * from acc_opening_balance"
                                                                                                iSql = iSql & " where opn_YearId =" & iYearID & " and opn_CompID =" & iCompID & " and opn_glid=" & sArray(k) & " and opn_Status='A'"
                                                                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                    iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                                End If
                                                                                                If iZoneID > 0 Then
                                                                                                    iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                                                                End If
                                                                                                If iRegionID > 0 Then
                                                                                                    iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                                                                End If
                                                                                                If iAreaID > 0 Then
                                                                                                    iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                                                                End If
                                                                                                If iBranchID > 0 Then
                                                                                                    iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                                                                End If
                                                                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                                If dtArray.Rows.Count > 0 Then
                                                                                                    For a = 0 To dtArray.Rows.Count - 1
                                                                                                        If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                            ' DGdtotaldebit = DGdtotaldebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                                                        End If

                                                                                                        If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                            DGdTotalcredit = DGdTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                                                        End If
                                                                                                    Next
                                                                                                End If
                                                                                            End If

                                                                                            'last year
                                                                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCompID & " and "
                                                                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                                                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                                                            End If
                                                                                            If iZoneID > 0 Then
                                                                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                                                            End If
                                                                                            If iRegionID > 0 Then
                                                                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                                                            End If
                                                                                            If iAreaID > 0 Then
                                                                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                                                            End If
                                                                                            If iBranchID > 0 Then
                                                                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                                                            End If
                                                                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                                                            If dtArray.Rows.Count > 0 Then
                                                                                                For a = 0 To dtArray.Rows.Count - 1
                                                                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                                                        dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                        DGdLsttotaldebit = DGdLsttotaldebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                                                    End If

                                                                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                                                        dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                        DGdLstTotalcredit = DGdLstTotalcredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                                                    End If
                                                                                                Next
                                                                                            End If


                                                                                            If (dDebit <> 0) And (dCredit <> 0) Then
                                                                                                sExPresentYear = dCredit - dDebit
                                                                                            ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                                                                                sExPresentYear = dCredit - dDebit
                                                                                            ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                                                                                sExPresentYear = dCredit
                                                                                            ElseIf (dDebit = 0) And (dCredit = 0) Then
                                                                                                sExPresentYear = "0.00"
                                                                                            End If



                                                                                            If sExPresentYear.StartsWith("-") = True Then
                                                                                                sExPresentYear = sExPresentYear.Remove(0, 1)
                                                                                                dTotalDebit = dTotalDebit - sExPresentYear
                                                                                                dRow("PCrDr") = "Dr"
                                                                                            Else
                                                                                                dTotalDebit = dTotalDebit + sExPresentYear
                                                                                                If sExPresentYear = "0.00" Then
                                                                                                    dRow("PCrDr") = ""
                                                                                                Else
                                                                                                    dRow("PCrDr") = "Cr"
                                                                                                End If
                                                                                            End If
                                                                                            dRow("PresentYear") = sExPresentYear


                                                                                            dDebit = 0 : dCredit = 0

                                                                                            If (dLDebit <> 0) And (dLCredit <> 0) Then
                                                                                                sExLastYear = dLCredit - dLDebit
                                                                                            ElseIf dLDebit <> 0 Then
                                                                                                sExLastYear = dLDebit
                                                                                            ElseIf dLCredit <> 0 Then
                                                                                                sExLastYear = dLCredit
                                                                                            ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                                                                                sExLastYear = "0.00"
                                                                                            End If

                                                                                            If sExLastYear.StartsWith("-") = True Then
                                                                                                sExLastYear = sExLastYear.Remove(0, 1)
                                                                                                dTotalLDebit = dTotalLDebit - sExLastYear
                                                                                                dRow("LCrDr") = "Dr"
                                                                                            Else
                                                                                                dTotalLDebit = dTotalLDebit + sExLastYear
                                                                                                If sExLastYear = "0.00" Then
                                                                                                    dRow("LCrDr") = ""
                                                                                                Else
                                                                                                    dRow("LCrDr") = "Cr"
                                                                                                End If
                                                                                            End If
                                                                                            dRow("LastYear") = sExLastYear

                                                                                            dLDebit = 0 : dLCredit = 0

                                                                                            dt.Rows.Add(dRow)
                                                                                        Next
                                                                                    End If
                                                                                End If
                                                                            End If

                                                                        Next
                                                                    End If
                                                                Next
                                                            End If

                                                        End If
                                                    End If
                                                Next
                                            End If
                                        End If
                                    Next
                                End If


                                dRow = dt.NewRow()
                                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                                'dRow("PresentYear") = dTotalDebit
                                'dRow("LastYear") = dTotalLDebit

                                sExTotalCurrentDebit = dTotalDebit
                                If sExTotalCurrentDebit.StartsWith("-") = True Then
                                    sExTotalCurrentDebit = sExTotalCurrentDebit.Remove(0, 1)
                                    DGdtotaldebit = DGdtotaldebit - sExTotalCurrentDebit
                                    dRow("PCrDr") = "Dr"
                                Else
                                    DGdtotaldebit = DGdtotaldebit + sExTotalCurrentDebit
                                    If sExTotalCurrentDebit = "0" Then
                                        dRow("PCrDr") = ""
                                    Else
                                        dRow("PCrDr") = "Cr"
                                    End If
                                End If

                                dRow("PresentYear") = sExTotalCurrentDebit

                                sExTotalLastYearDebit = dTotalLDebit
                                If sExTotalLastYearDebit.StartsWith("-") = True Then
                                    sExTotalLastYearDebit = sExTotalLastYearDebit.Remove(0, 1)
                                    dRow("LCrDr") = "Dr"
                                Else
                                    If sExTotalLastYearDebit = "0" Then
                                        dRow("LCrDr") = ""
                                    Else
                                        dRow("LCrDr") = "Cr"
                                    End If
                                End If
                                dRow("LastYear") = sExTotalLastYearDebit
                                dTotalDebit = 0
                                dTotalLDebit = 0
                                dt.Rows.Add(dRow)

                            End If

                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

            End If
            'Grand total for Present year
            'If (DGdtotaldebit <> 0) And (DGdTotalcredit <> 0) Then
            '    'dRow("LastYear") = dLCredit - dLDebit
            '    fnlPresentYear = DGdTotalcredit - DGdtotaldebit
            'ElseIf (DGdtotaldebit <> 0) And (DGdTotalcredit = 0) Then
            '    'dRow("LastYear") = dLDebit
            '    fnlPresentYear = DGdTotalcredit - DGdtotaldebit
            'ElseIf (DGdTotalcredit <> 0) And (DGdtotaldebit = 0) Then
            '    'dRow("LastYear") = dLCredit
            '    fnlPresentYear = DGdTotalcredit
            'ElseIf (DGdtotaldebit = 0) And (DGdTotalcredit = 0) Then
            '    'dRow("LastYear") = "0.00"
            '    fnlPresentYear = "0.00"
            'End If

            'If DGdtotaldebit.StartsWith("-") = True Then
            '    DGdtotaldebit = DGdtotaldebit.Remove(0, 1)
            'End If

            'Grand total for last year
            If (DGdLsttotaldebit <> 0) And (DGdLstTotalcredit <> 0) Then
                'dRow("LastYear") = dLCredit - dLDebit
                fnlLastYear = DGdLstTotalcredit - DGdLsttotaldebit
            ElseIf DGdLsttotaldebit <> 0 Then
                'dRow("LastYear") = dLDebit
                fnlLastYear = DGdLsttotaldebit
            ElseIf DGdLstTotalcredit <> 0 Then
                'dRow("LastYear") = dLCredit
                fnlLastYear = DGdLstTotalcredit
            ElseIf (DGdLsttotaldebit = 0) And (DGdLstTotalcredit = 0) Then
                'dRow("LastYear") = "0.00"
                fnlLastYear = "0.00"
            End If

            If fnlLastYear.StartsWith("-") = True Then
                fnlLastYear = fnlLastYear.Remove(0, 1)
                dRow("LCrDr") = "Dr"
            Else
                If fnlLastYear = "0.00" Then
                    dRow("LCrDr") = ""
                Else
                    dRow("LCrDr") = "Cr"
                End If
            End If




            dRow = dt.NewRow()
            dRow("Particulars") = "<B>" & "GRAND TOTAL" & "</B>"
            dRow("PresentYear") = DGdtotaldebit

            dRow("LastYear") = fnlLastYear
            dt.Rows.Add(dRow)
            Return dt
        Catch ex As Exception
            Throw
        End Try

    End Function

    Public Function GetOpeningBalance(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                      ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable ', ByVal dFromDate As Date, ByVal dToDate As Date
        Dim dt As New DataTable, dtGL As New DataTable, dtOB As New DataTable
        Dim sSql As String = "", iSql As String = "", ssql2 As String = ""
        Dim i As Integer = 0, j As Integer = 0, count As Integer
        Dim dRow As DataRow
        Dim dGLD As Double, dGLC As Double
        Dim dDebit As Double = 0, dCredit As Double = 0, dBalance As Double = 0
        Dim dGrandDebitTotal As Double = 0, dGrandCreditTotal As Double = 0, dGrandBalanceTotal As Double = 0, dGLDebitGrandTotal As Double = 0, dGLCreditGrandTotal As Double = 0

        Dim dGLDebitTotal, dGLCreditTotal As Double
        Try
            dt.Columns.Add("gl_id")
            dt.Columns.Add("gl_glCode")
            dt.Columns.Add("gl_Parent")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("gl_Head")
            dt.Columns.Add("Opn_DebitAmt")
            dt.Columns.Add("Opn_CreditAmount")
            dt.Columns.Add("Balance")

            sSql = "" : sSql = "Select A.gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
            sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
            sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
            sSql = sSql & "and A.gl_head in (2,3) and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()

                    If IsDBNull(dtGL.Rows(i)("gl_id").ToString()) = False Then
                        dRow("gl_id") = dtGL.Rows(i)("gl_id").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
                        dRow("gl_glCode") = dtGL.Rows(i)("gl_glCode").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                        dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("gl_head").ToString()) = False Then
                        dRow("gl_Head") = dtGL.Rows(i)("gl_head").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("gl_Parent").ToString()) = False Then
                        dRow("gl_Parent") = dtGL.Rows(i)("gl_Parent").ToString()
                    End If

                    If (dtGL.Rows(i)("gl_AccHead").ToString() = "1") Or (dtGL.Rows(i)("gl_AccHead").ToString() = "4") Then
                        If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
                            ' iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_id =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                            End If
                            If iZoneID > 0 Then
                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            End If
                            If iRegionID > 0 Then
                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            End If
                            If iAreaID > 0 Then
                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            End If
                            If iBranchID > 0 Then
                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            End If

                            'dGLDebitTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)
                            dGLD = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

                            'Added count because before its Adding both gl and subgls values
                            ssql2 = "Select count(*) From Chart_Of_Accounts Where gl_head=3 and GL_parent= " & dtGL.Rows(i)("gl_id").ToString() & " and gl_status='A' and gl_compid=" & iCompID & ""
                            count = objDB.SQLExecuteScalar(sNameSpace, ssql2)
                            If (count = 0) Then
                                If IsDBNull(dGLD = False) Then
                                    dGLDebitTotal = objDB.SQLGetDescription(sNameSpace, iSql)
                                    dGLDebitGrandTotal = dGLDebitGrandTotal + objDB.SQLGetDescription(sNameSpace, iSql)
                                Else
                                    dGLDebitTotal = 0
                                    dGLDebitGrandTotal = dGLDebitGrandTotal + 0
                                End If
                            Else
                                If IsDBNull(dGLD = False) Then
                                    dGLDebitTotal = objDB.SQLGetDescription(sNameSpace, iSql)
                                Else
                                    dGLDebitTotal = 0
                                End If
                            End If

                            'iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_id =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                            End If
                            If iZoneID > 0 Then
                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            End If
                            If iRegionID > 0 Then
                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            End If
                            If iAreaID > 0 Then
                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            End If
                            If iBranchID > 0 Then
                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            End If

                            If (count = 0) Then
                                If IsDBNull(dGLC = False) Then
                                    dGLCreditTotal = objDB.SQLGetDescription(sNameSpace, iSql)
                                    dGLCreditGrandTotal = dGLCreditGrandTotal + objDB.SQLGetDescription(sNameSpace, iSql)
                                Else
                                    dGLCreditTotal = 0
                                    dGLCreditGrandTotal = dGLCreditGrandTotal + 0
                                End If
                            Else
                                If IsDBNull(dGLC = False) Then
                                    dGLCreditTotal = objDB.SQLGetDescription(sNameSpace, iSql)
                                Else
                                    dGLCreditTotal = 0
                                End If
                            End If
                            'If (count = 0) Then
                            '    dGLCreditTotal = objDB.SQLGetDescription(sNameSpace, iSql)
                            '    dGLCreditGrandTotal = dGLCreditGrandTotal + objDB.SQLGetDescription(sNameSpace, iSql)
                            'Else
                            '    dGLCreditTotal = objDB.SQLGetDescription(sNameSpace, iSql)
                            'End If
                            dRow("Opn_DebitAmt") = dGLDebitTotal
                            dRow("Opn_CreditAmount") = dGLCreditTotal
                            dRow("Balance") = dGLDebitTotal - dGLCreditTotal

                        ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sun General Ledger
                            ' iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_id =" & dtGL.Rows(i)("gl_id").ToString() & ") and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                            End If
                            If iZoneID > 0 Then
                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            End If
                            If iRegionID > 0 Then
                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            End If
                            If iAreaID > 0 Then
                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            End If
                            If iBranchID > 0 Then
                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            End If

                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                            If dtOB.Rows.Count > 0 Then
                                If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt")) = False Then
                                    dRow("Opn_DebitAmt") = dtOB.Rows(0)("Opn_DebitAmt")
                                    dDebit = dtOB.Rows(0)("Opn_DebitAmt")
                                    dGrandDebitTotal = dGrandDebitTotal + dtOB.Rows(0)("Opn_DebitAmt")
                                Else
                                    dRow("Opn_DebitAmt") = "0.00"
                                End If

                                If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount")) = False Then
                                    dRow("Opn_CreditAmount") = dtOB.Rows(0)("Opn_CreditAmount")
                                    dCredit = dtOB.Rows(0)("Opn_CreditAmount")
                                    dGrandCreditTotal = dGrandCreditTotal + dtOB.Rows(0)("Opn_CreditAmount")
                                Else
                                    dRow("Opn_CreditAmount") = "0.00"
                                End If

                                dBalance = dDebit - dCredit
                                If IsDBNull(dBalance) = False Then
                                    dRow("Balance") = dBalance
                                    dGrandBalanceTotal = dGrandBalanceTotal + dBalance
                                Else
                                    dRow("Balance") = "0.00"
                                End If
                            Else
                                dRow("Opn_DebitAmt") = "0.00"
                                dRow("Opn_CreditAmount") = "0.00"
                                dRow("Balance") = "0.00"
                            End If
                        End If

                    Else
                        dRow("Opn_DebitAmt") = "0.00"
                        dRow("Opn_CreditAmount") = "0.00"
                        dRow("Balance") = "0.00"
                    End If
                    dt.Rows.Add(dRow)
                Next
            End If

            dRow = dt.NewRow()
            dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
            dRow("Opn_DebitAmt") = dGrandDebitTotal + dGLDebitGrandTotal 'dGrandDebitTotal
            dRow("Opn_CreditAmount") = dGrandCreditTotal + dGLCreditGrandTotal 'dGrandCreditTotal
            dRow("Balance") = dRow("Opn_DebitAmt") - dRow("Opn_CreditAmount") 'dGrandBalanceTotal
            dt.Rows.Add(dRow)

            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetGrandTotal(ByVal dt As DataTable) As DataTable
        Dim dtGrand As New DataTable
        Dim dRow As DataRow
        Try
            dtGrand.Columns.Add("BillDate")
            dtGrand.Columns.Add("gl_Code")
            dtGrand.Columns.Add("TransactionType")
            dtGrand.Columns.Add("gl_Desc")
            dtGrand.Columns.Add("Narration")
            dtGrand.Columns.Add("CorresGLCode")
            dtGrand.Columns.Add("CorresDescription")
            dtGrand.Columns.Add("OpDebit")
            dtGrand.Columns.Add("OpCredit")
            dtGrand.Columns.Add("TransDebit")
            dtGrand.Columns.Add("TransCredit")
            dtGrand.Columns.Add("ClosingDebit")
            dtGrand.Columns.Add("ClosingCredit")
            dtGrand.Columns.Add("Status")

            dRow = dtGrand.NewRow
            dRow("Gl_Desc") = ""
            dtGrand.Rows.Add(dRow)


            For i = 0 To dt.Rows.Count - 1
                If (dt.Rows(i)("Status").ToString() = "0") Or (dt.Rows(i)("Status").ToString() = "1") Then
                    dGrandOpnDebit = dGrandOpnDebit + dt.Rows(i)("OpDebit").ToString()
                    dGrandOpnCredit = dGrandOpnCredit + dt.Rows(i)("OpCredit").ToString()

                    dGrandTransDebit = dGrandTransDebit + dt.Rows(i)("TransDebit").ToString()
                    dGrandTransCredit = dGrandTransCredit + dt.Rows(i)("TransCredit").ToString()

                    dGrandCloseDebit = dGrandCloseDebit + dt.Rows(i)("ClosingDebit").ToString()
                    dGrandCloseCredit = dGrandCloseCredit + dt.Rows(i)("ClosingCredit").ToString()
                End If
            Next

            dRow = dtGrand.NewRow
            dRow("BillDate") = ""
            dRow("gl_Code") = ""
            dRow("Gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
            dRow("TransactionType") = ""
            dRow("Narration") = ""
            dRow("CorresGLCode") = ""
            dRow("CorresDescription") = ""
            dRow("OpDebit") = Convert.ToDecimal(dGrandOpnDebit).ToString("#,##0.00")
            dRow("OpCredit") = Convert.ToDecimal(dGrandOpnCredit).ToString("#,##0.00")

            dRow("TransDebit") = Convert.ToDecimal(dGrandTransDebit).ToString("#,##0.00")
            dRow("TransCredit") = Convert.ToDecimal(dGrandTransCredit).ToString("#,##0.00")

            dRow("ClosingDebit") = Convert.ToDecimal(dGrandCloseDebit).ToString("#,##0.00")
            dRow("ClosingCredit") = Convert.ToDecimal(dGrandCloseCredit).ToString("#,##0.00")

            dtGrand.Rows.Add(dRow)
            Return dtGrand
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetMonthlyReports(ByVal dt As DataTable) As DataTable
        Dim dtMonth As New DataTable
        Dim dRow As DataRow
        Dim dOpnDebit As Double = 0, dOpnCredit As Double = 0
        Dim dTransDebit As Double = 0, dTransCredit As Double = 0
        Dim dCloseDebit As Double = 0, dCloseCredit As Double = 0
        Dim iStatus As Integer = 0

        Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
        Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
        Dim dTotalCloseDebit As Double = 0, dTotalCloseCredit As Double = 0

        Dim sMonth As String = "", sYear As String = ""
        Dim sCurrentMonth As String = "", sCurrentYear As String = ""

        Dim dClosingTotal As Double = 0
        Try
            dtMonth.Columns.Add("BillDate")
            dtMonth.Columns.Add("gl_Code")
            dtMonth.Columns.Add("TransactionType")
            dtMonth.Columns.Add("gl_Desc")
            dtMonth.Columns.Add("Narration")
            dtMonth.Columns.Add("CorresGLCode")
            dtMonth.Columns.Add("CorresDescription")
            dtMonth.Columns.Add("OpDebit")
            dtMonth.Columns.Add("OpCredit")
            dtMonth.Columns.Add("TransDebit")
            dtMonth.Columns.Add("TransCredit")
            dtMonth.Columns.Add("ClosingDebit")
            dtMonth.Columns.Add("ClosingCredit")
            dtMonth.Columns.Add("Status")

            For i = 0 To dt.Rows.Count - 1
                dRow = dtMonth.NewRow

                Dim dDate As Date = dt.Rows(i)("BillDate").ToString()

                If dDate.Month.ToString.Length = 1 Then
                    sCurrentMonth = "0" & dDate.Month
                    sCurrentYear = dDate.Year
                Else
                    sCurrentMonth = dDate.Month
                    sCurrentYear = dDate.Year
                End If

                If sMonth = "" Then
                    sMonth = sCurrentMonth
                    sYear = sCurrentYear
                End If

                '01/01/1900
                If (sCurrentMonth = "01") And (sCurrentYear = "1900") Then
                    dRow = dtMonth.NewRow
                    dRow("BillDate") = ""
                    dRow("gl_Code") = dt.Rows(i)("gl_Code").ToString()
                    dRow("Gl_Desc") = dt.Rows(i)("Gl_Desc").ToString()
                    dRow("TransactionType") = dt.Rows(i)("TransactionType").ToString()
                    dRow("Narration") = dt.Rows(i)("Narration").ToString()
                    dRow("CorresGLCode") = dt.Rows(i)("CorresGLCode").ToString()
                    dRow("CorresDescription") = dt.Rows(i)("CorresDescription").ToString()

                    If dt.Rows(i)("OpDebit").ToString() = "" Then
                        dRow("OpDebit") = "0.00" : dOpnDebit = 0
                        dGrandOpnDebit = dGrandOpnDebit + dOpnDebit
                    Else
                        dRow("OpDebit") = Convert.ToDecimal(dt.Rows(i)("OpDebit").ToString()).ToString("#,##0.00")
                        dOpnDebit = Convert.ToDecimal(dt.Rows(i)("OpDebit").ToString()).ToString("#,##0.00")
                    End If
                    dTotalOpnDebit = dOpnDebit

                    If dt.Rows(i)("OpCredit").ToString() = "" Then
                        dRow("OpCredit") = "0.00" : dOpnCredit = 0
                        dGrandOpnCredit = dGrandOpnCredit + dOpnCredit
                    Else
                        dRow("OpCredit") = Convert.ToDecimal(dt.Rows(i)("OpCredit").ToString()).ToString("#,##0.00")
                        dOpnCredit = Convert.ToDecimal(dt.Rows(i)("OpCredit").ToString()).ToString("#,##0.00")
                    End If
                    dTotalOpnCredit = dOpnCredit

                    If dt.Rows(i)("TransDebit").ToString() = "" Then
                        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    Else
                        dRow("TransDebit") = Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                        dTransDebit = Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                    End If

                    If dt.Rows(i)("TransCredit").ToString() = "" Then
                        dRow("TransCredit") = "0.00" : dTransCredit = 0
                        dGrandTransCredit = dGrandTransCredit + dTransCredit
                    Else
                        dRow("TransCredit") = Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                        dTransCredit = Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                    End If
                    dRow("Status") = "0"

                    dCloseDebit = dOpnDebit + dTransDebit
                    dCloseCredit = dOpnCredit + dTransCredit
                    dClosingTotal = dCloseDebit - dCloseCredit

                    If dClosingTotal >= 0 Then
                        dRow("ClosingDebit") = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                        dRow("ClosingCredit") = "0.00"
                    Else
                        dRow("ClosingCredit") = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                        dRow("ClosingDebit") = "0.00"
                    End If
                    dCloseDebit = 0 : dCloseCredit = 0 : dTotalCloseDebit = 0 : dTotalCloseCredit = 0
                    dtMonth.Rows.Add(dRow) : sMonth = ""
                Else

                    If (sMonth.Contains(sCurrentMonth) = True) And (sYear.Contains(sCurrentYear) = True) Then
                        dRow = dtMonth.NewRow
                        If dt.Rows(i)("BillDate").ToString() = "01/01/1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dt.Rows(i)("BillDate").ToString(), "D")
                        End If

                        dRow("gl_Code") = dt.Rows(i)("gl_Code").ToString()
                        dRow("Gl_Desc") = dt.Rows(i)("Gl_Desc").ToString()
                        dRow("TransactionType") = dt.Rows(i)("TransactionType").ToString()
                        dRow("Narration") = dt.Rows(i)("Narration").ToString()
                        dRow("CorresGLCode") = dt.Rows(i)("CorresGLCode").ToString()
                        dRow("CorresDescription") = dt.Rows(i)("CorresDescription").ToString()

                        If dt.Rows(i)("Status").ToString() = "1" Then
                            iStatus = 1
                            dRow("OpDebit") = "0.00" : dRow("OpCredit") = "0.00"
                            dGrandOpnDebit = dGrandOpnDebit + 0
                            dGrandOpnCredit = dGrandOpnCredit + 0

                            If dt.Rows(i)("TransDebit").ToString() = "" Then
                                dRow("TransDebit") = "0.00" : dTransDebit = 0
                                dTotalTransDebit = dTotalTransDebit + dTransDebit
                            Else
                                dRow("TransDebit") = Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                                dTransDebit = dOpnDebit + Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                                dTotalTransDebit = dTotalTransDebit + Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                            End If

                            If dt.Rows(i)("TransCredit").ToString() = "" Then
                                dRow("TransCredit") = "0.00" : dTransCredit = 0
                                dTotalTransCredit = dTotalTransCredit + dTransCredit
                            Else
                                dRow("TransCredit") = Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                                dTransCredit = dOpnCredit + Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                                dTotalTransCredit = dTotalTransCredit + Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                            End If

                            dClosingTotal = dTransDebit - dTransCredit

                            If dClosingTotal >= 0 Then
                                dRow("ClosingDebit") = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00") : dRow("ClosingCredit") = "0.00"
                                dOpnDebit = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                                dTotalCloseDebit = dTotalCloseDebit + Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                            Else
                                dRow("ClosingCredit") = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00") : dRow("ClosingDebit") = "0.00"
                                dOpnDebit = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                                dTotalCloseCredit = dTotalCloseCredit + Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                            End If
                        End If
                        dRow("Status") = "1"
                        dtMonth.Rows.Add(dRow)
                        sMonth = sCurrentMonth : sYear = sCurrentYear

                        If i = dt.Rows.Count - 1 Then
                            dRow = dtMonth.NewRow
                            dRow("Gl_Desc") = "<B>" & "TOTAL" & "</B>"
                            dRow("OpDebit") = Convert.ToDecimal(dTotalOpnDebit).ToString("#,##0.00")
                            dRow("OpCredit") = Convert.ToDecimal(dTotalOpnCredit).ToString("#,##0.00")

                            dRow("TransDebit") = Convert.ToDecimal(dTotalTransDebit).ToString("#,##0.00")
                            dRow("TransCredit") = Convert.ToDecimal(dTotalTransCredit).ToString("#,##0.00")

                            dRow("ClosingDebit") = "0.00"
                            dRow("ClosingCredit") = "0.00"

                            'dRow("ClosingDebit") = Convert.ToDecimal(dTotalCloseDebit).ToString("#,##0.00")
                            ' dRow("ClosingCredit") = Convert.ToDecimal(dTotalCloseCredit).ToString("#,##0.00")
                            dRow("Status") = "2"
                            dtMonth.Rows.Add(dRow)

                            dRow = dtMonth.NewRow
                            dRow("Gl_Desc") = ""
                            dtMonth.Rows.Add(dRow)
                            dTotalCloseDebit = 0 : dTotalCloseCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
                            'dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0 : dCloseDebit = 0 : dCloseCredit = 0
                        End If
                    Else
                        If iStatus = 1 Then
                            dRow = dtMonth.NewRow
                            dRow("Gl_Desc") = "<B>" & "TOTAL" & "</B>"
                            'dRow("OpDebit") = Convert.ToDecimal(dTotalOpnDebit).ToString("#,##0.00")
                            'dRow("OpCredit") = Convert.ToDecimal(dTotalOpnCredit).ToString("#,##0.00")

                            dRow("OpDebit") = "0.00"
                            dRow("OpCredit") = "0.00"

                            dRow("TransDebit") = Convert.ToDecimal(dTotalTransDebit).ToString("#,##0.00")
                            dRow("TransCredit") = Convert.ToDecimal(dTotalTransCredit).ToString("#,##0.00")

                            dRow("ClosingDebit") = "0.00"
                            dRow("ClosingCredit") = "0.00"
                            ' dRow("ClosingDebit") = Convert.ToDecimal(dTotalCloseDebit).ToString("#,##0.00")
                            'dRow("ClosingCredit") = Convert.ToDecimal(dTotalCloseCredit).ToString("#,##0.00")
                            dRow("Status") = "2"
                            dtMonth.Rows.Add(dRow)

                            dRow = dtMonth.NewRow
                            dRow("Gl_Desc") = ""
                            dtMonth.Rows.Add(dRow)
                            dTotalCloseDebit = 0 : dTotalCloseCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
                            'dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0 : dCloseDebit = 0 : dCloseCredit = 0

                            dRow = dtMonth.NewRow
                            dRow("Status") = "1"
                            If dt.Rows(i)("BillDate").ToString() = "01/01/1900" Then
                                dRow("BillDate") = ""
                            Else
                                dRow("BillDate") = objGen.FormatDtForRDBMS(dt.Rows(i)("BillDate").ToString(), "D")
                            End If

                            dRow("gl_Code") = dt.Rows(i)("gl_Code").ToString()
                            dRow("Gl_Desc") = dt.Rows(i)("Gl_Desc").ToString()
                            dRow("TransactionType") = dt.Rows(i)("TransactionType").ToString()
                            dRow("Narration") = dt.Rows(i)("Narration").ToString()
                            dRow("CorresGLCode") = dt.Rows(i)("CorresGLCode").ToString()
                            dRow("CorresDescription") = dt.Rows(i)("CorresDescription").ToString()
                            If dt.Rows(i)("Status").ToString() = "1" Then
                                iStatus = 1
                                If dt.Rows(i)("OpDebit").ToString() = "" Then
                                    dRow("OpDebit") = "0.00" : dOpnDebit = 0
                                Else
                                    dRow("OpDebit") = Convert.ToDecimal(dt.Rows(i)("OpDebit").ToString()).ToString("#,##0.00")
                                    dOpnDebit = dOpnDebit + Convert.ToDecimal(dt.Rows(i)("OpDebit").ToString()).ToString("#,##0.00")
                                End If

                                If dt.Rows(i)("OpCredit").ToString() = "" Then
                                    dRow("OpCredit") = "0.00" : dOpnCredit = 0
                                Else
                                    dRow("OpCredit") = Convert.ToDecimal(dt.Rows(i)("OpCredit").ToString()).ToString("#,##0.00")
                                    dOpnDebit = dOpnDebit + Convert.ToDecimal(dt.Rows(i)("OpCredit").ToString()).ToString("#,##0.00")
                                End If

                                If dt.Rows(i)("TransDebit").ToString() = "" Then
                                    dRow("TransDebit") = "0.00" : dTransDebit = 0
                                    dTotalTransDebit = dTotalTransDebit + dTransDebit
                                Else
                                    dRow("TransDebit") = Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                                    dTransDebit = dTransDebit + Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                                    dTotalTransDebit = dTotalTransDebit + Convert.ToDecimal(dt.Rows(i)("TransDebit").ToString()).ToString("#,##0.00")
                                End If

                                If dt.Rows(i)("TransCredit").ToString() = "" Then
                                    dRow("TransCredit") = "0.00" : dTransCredit = 0
                                    dTotalTransCredit = dTotalTransCredit + dTransCredit
                                Else
                                    dRow("TransCredit") = Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                                    dTransCredit = dTransCredit + Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                                    dGrandTransCredit = dGrandTransCredit + Convert.ToDecimal(dt.Rows(i)("TransCredit").ToString()).ToString("#,##0.00")
                                End If

                                dClosingTotal = dTransDebit - dTransCredit

                                If dClosingTotal >= 0 Then
                                    dRow("ClosingDebit") = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00") : dRow("ClosingCredit") = "0.00"
                                    dOpnDebit = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                                    dTotalCloseDebit = dTotalCloseDebit + Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                                Else
                                    dRow("ClosingCredit") = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00") : dRow("ClosingDebit") = "0.00"
                                    dOpnDebit = Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                                    dTotalCloseCredit = dTotalCloseCredit + Convert.ToDecimal(dClosingTotal).ToString("#,##0.00")
                                End If
                            End If
                            dtMonth.Rows.Add(dRow)
                            sMonth = sCurrentMonth : sYear = sCurrentYear

                            If i = dt.Rows.Count - 1 Then
                                dRow = dtMonth.NewRow
                                dRow("Gl_Desc") = "<B>" & "TOTAL" & "</B>"
                                dRow("OpDebit") = Convert.ToDecimal(dTotalOpnDebit).ToString("#,##0.00")
                                dRow("OpCredit") = Convert.ToDecimal(dTotalOpnCredit).ToString("#,##0.00")

                                dRow("TransDebit") = Convert.ToDecimal(dTotalTransDebit).ToString("#,##0.00")
                                dRow("TransCredit") = Convert.ToDecimal(dTotalTransCredit).ToString("#,##0.00")

                                dRow("ClosingDebit") = "0.00"
                                dRow("ClosingCredit") = "0.00"

                                'dRow("ClosingDebit") = Convert.ToDecimal(dTotalCloseDebit).ToString("#,##0.00")
                                'dRow("ClosingCredit") = Convert.ToDecimal(dTotalCloseCredit).ToString("#,##0.00")
                                dRow("Status") = "2"
                                dtMonth.Rows.Add(dRow)
                                dTotalCloseDebit = 0 : dTotalCloseCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
                                ' dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0 : dCloseDebit = 0 : dCloseCredit = 0
                            End If
                        End If
                    End If
                End If
            Next
            Return dtMonth
        Catch ex As Exception
            Throw
        End Try
    End Function
    'Public Function LoadBalanceSheet(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
    '                                 ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer)
    '    Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
    '    Dim dRow As DataRow
    '    Dim dt As New DataTable
    '    Dim dtGroup As New DataTable
    '    Dim dtSub As New DataTable
    '    Dim dtLink As New DataTable
    '    Dim dtArray As New DataTable
    '    Dim dr As OleDb.OleDbDataReader
    '    Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0
    '    Dim a As Integer = 0
    '    Dim sArray As Array
    '    Dim dDebit As Double = 0.00
    '    Dim dCredit As Double = 0.00

    '    Dim dLDebit As Double = 0.00
    '    Dim dLCredit As Double = 0.00

    '    Dim dTotalDebit As Double = 0.00
    '    Dim dTotalCredit As Double = 0.00

    '    Dim dTotalLDebit As Double = 0.00
    '    Dim dTotalLCredit As Double = 0.00

    '    Dim iHead As Integer = 0
    '    Dim iSLNo As Integer = 0
    '    Dim iLastYear As Integer = 0

    '    Dim iFixedAssets As Integer = 0

    '    Dim iStatusCheck As Integer = 0

    '    Dim sSPresentYear As String = "" : Dim sLastYear As String = ""
    '    Dim sAsseCurrentYear As String = "" : Dim sAssetLastYear As String = ""
    '    Try
    '        dt.Columns.Add("ID")
    '        dt.Columns.Add("SLNo")
    '        dt.Columns.Add("Particulars")
    '        dt.Columns.Add("NoteNo")
    '        dt.Columns.Add("PresentYear")
    '        dt.Columns.Add("LastYear")

    '        'Liabilites

    '        sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
    '        sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
    '        dr = objDB.SQLDataReader(sNameSpace, sSql)
    '        If dr.HasRows = True Then
    '            dr.Read()
    '            iLastYear = dr("YMS_ID")
    '        Else
    '            iLastYear = 0
    '        End If


    '        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_yearID =" & iYearID & ""
    '        If iZoneID > 0 Then
    '            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '        End If
    '        If iRegionID > 0 Then
    '            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '        End If
    '        If iAreaID > 0 Then
    '            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '        End If
    '        If iBranchID > 0 Then
    '            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '        End If
    '        dr = objDB.SQLDataReader(sNameSpace, iSql)
    '        If dr.HasRows = True Then
    '            dr.Read()
    '            If dr("Opn_Status") = "F" Then
    '                iStatusCheck = 0
    '            Else
    '                iStatusCheck = 1
    '            End If
    '        Else
    '            iStatusCheck = 1
    '        End If


    '        sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 4 and gl_Delflag ='C' and gl_Status ='A' and "
    '        sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
    '        dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGroup.Rows.Count > 0 Then

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "EQUITY And LIABILITIES" & "</B>"
    '            dt.Rows.Add(dRow)

    '            For i = 0 To dtGroup.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
    '                    dRow("ID") = dtGroup.Rows(i)("gl_ID")
    '                End If

    '                dRow("SLNo") = iSLNo + 1

    '                If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
    '                    dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
    '                End If
    '                dt.Rows.Add(dRow)

    '                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
    '                aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
    '                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtSub.Rows.Count > 0 Then
    '                    For j = 0 To dtSub.Rows.Count - 1
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
    '                            dRow("ID") = dtSub.Rows(j)("gl_ID")
    '                        End If

    '                        If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
    '                            dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
    '                        End If

    '                        mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head = 4 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
    '                        mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
    '                        dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                        If dtLink.Rows.Count > 0 Then
    '                            If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
    '                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
    '                            End If

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then

    '                                        If iStatusCheck = 0 Then
    '                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
    '                                            iSql = iSql & "Opn_GLID =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If
    '                                        Else
    '                                            iSql = "" : iSql = "Select * from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                                            iSql = iSql & " Where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If
    '                                        End If
    '                                    End If
    '                                Next


    '                                sSPresentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                If sSPresentYear.StartsWith("-") = True Then
    '                                    sSPresentYear = sSPresentYear.Remove(0, 1)
    '                                End If
    '                                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                dRow("PresentYear") = sSPresentYear

    '                                Dim dDbCr As Double = 0.00
    '                                dDbCr = dDebit - dCredit
    '                                'dTotalDebit = dTotalDebit + dDbCr
    '                                dTotalDebit = dTotalDebit + Convert.ToDouble(sSPresentYear)

    '                                dDebit = 0 : dCredit = 0
    '                            End If


    '                            'Last Year

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
    '                                        iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
    '                                        If iZoneID > 0 Then
    '                                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                        End If
    '                                        If iRegionID > 0 Then
    '                                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                        End If
    '                                        If iAreaID > 0 Then
    '                                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                        End If
    '                                        If iBranchID > 0 Then
    '                                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                        End If
    '                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                        If dtArray.Rows.Count > 0 Then
    '                                            For a = 0 To dtArray.Rows.Count - 1
    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                    dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                End If

    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                    dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                End If
    '                                            Next

    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                sLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                If sLastYear.StartsWith("-") = True Then
    '                                    sLastYear = sLastYear.Remove(0, 1)
    '                                End If
    '                                dRow("LastYear") = sLastYear

    '                                Dim dLDbCr As Double = 0.00
    '                                dLDbCr = dLDebit - dLCredit
    '                                'dTotalLDebit = dTotalLDebit + dLDbCr
    '                                dTotalLDebit = dTotalLDebit + Convert.ToDouble(sLastYear)

    '                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
    '                            End If
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next
    '                End If
    '                iSLNo = iSLNo + 1
    '            Next

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
    '            dRow("PresentYear") = dTotalDebit
    '            dRow("LastYear") = dTotalLDebit
    '            dt.Rows.Add(dRow)
    '        End If


    '        'Assets
    '        dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
    '        sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 1 and gl_Delflag ='C' and gl_Status ='A' and "
    '        sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
    '        dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGroup.Rows.Count > 0 Then

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "ASSETS" & "</B>"
    '            dt.Rows.Add(dRow)

    '            For i = 0 To dtGroup.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
    '                    dRow("ID") = dtGroup.Rows(i)("gl_ID")
    '                End If

    '                dRow("SLNo") = iSLNo + 1

    '                If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
    '                    dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
    '                End If
    '                dt.Rows.Add(dRow)

    '                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_Delflag ='C' and "
    '                aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
    '                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtSub.Rows.Count > 0 Then
    '                    For j = 0 To dtSub.Rows.Count - 1
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
    '                            dRow("ID") = dtSub.Rows(j)("gl_ID")
    '                        End If

    '                        If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
    '                            dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
    '                        End If

    '                        If (dtSub.Rows(j)("gl_Desc").ToString() = "Tangible Assets") Or (dtSub.Rows(j)("gl_Desc").ToString() = "Intangible Assets") Then
    '                            iFixedAssets = 1
    '                        Else
    '                            iFixedAssets = 0
    '                        End If

    '                        mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
    '                        mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
    '                        dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                        If dtLink.Rows.Count > 0 Then
    '                            If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
    '                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
    '                            End If

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        If iFixedAssets = 0 Then

    '                                            If iStatusCheck = 0 Then
    '                                                iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
    '                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
    '                                                If iZoneID > 0 Then
    '                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                                End If
    '                                                If iRegionID > 0 Then
    '                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                                End If
    '                                                If iAreaID > 0 Then
    '                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                                End If
    '                                                If iBranchID > 0 Then
    '                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                                End If
    '                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                                If dtArray.Rows.Count > 0 Then
    '                                                    For a = 0 To dtArray.Rows.Count - 1
    '                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                        End If

    '                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                        End If
    '                                                    Next

    '                                                End If
    '                                            Else
    '                                                iSql = "" : iSql = "Select * from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                                                iSql = iSql & " Where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & ""
    '                                                If iZoneID > 0 Then
    '                                                    iSql = iSql & " and ACC_PM_ZoneID=" & iZoneID & ""
    '                                                End If
    '                                                If iRegionID > 0 Then
    '                                                    iSql = iSql & " and ACC_PM_RegionID=" & iRegionID & ""
    '                                                End If
    '                                                If iAreaID > 0 Then
    '                                                    iSql = iSql & " and ACC_PM_AreaID=" & iAreaID & ""
    '                                                End If
    '                                                If iBranchID > 0 Then
    '                                                    iSql = iSql & " and ACC_PM_BranchID=" & iBranchID & ""
    '                                                End If
    '                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                                If dtArray.Rows.Count > 0 Then
    '                                                    For a = 0 To dtArray.Rows.Count - 1
    '                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
    '                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
    '                                                        End If

    '                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
    '                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
    '                                                        End If
    '                                                    Next

    '                                                End If
    '                                            End If
    '                                        End If
    '                                    End If
    '                                Next


    '                                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                sAsseCurrentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                If sAsseCurrentYear.StartsWith("-") = True Then
    '                                    sAsseCurrentYear = sAsseCurrentYear.Remove(0, 1)
    '                                End If
    '                                dRow("PresentYear") = sAsseCurrentYear

    '                                Dim dDbCr As Double = 0.00
    '                                dDbCr = dDebit - dCredit
    '                                'dTotalDebit = dTotalDebit + dDbCr
    '                                dTotalDebit = dTotalDebit + Convert.ToDouble(sAsseCurrentYear)

    '                                dDebit = 0 : dCredit = 0
    '                            End If

    '                            'Last Year
    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        If iFixedAssets = 0 Then
    '                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
    '                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                        dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                        dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If
    '                                        End If
    '                                    End If
    '                                Next
    '                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                sAssetLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                If sAssetLastYear.StartsWith("-") = True Then
    '                                    sAssetLastYear = sAssetLastYear.Remove(0, 1)
    '                                End If
    '                                dRow("LastYear") = sAssetLastYear

    '                                Dim dLDbCr As Double = 0.00
    '                                dLDbCr = dLDebit - dLCredit
    '                                'dTotalLDebit = dTotalLDebit + dLDbCr
    '                                dTotalLDebit = dTotalLDebit + Convert.ToDouble(sAssetLastYear)

    '                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
    '                            End If
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next
    '                End If
    '                iSLNo = iSLNo + 1
    '            Next

    '            Dim sStrTotalCurrentdebit As String = "" : Dim sStrTotalLastDebit As String = ""
    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

    '            sStrTotalCurrentdebit = dTotalDebit
    '            If sStrTotalCurrentdebit.StartsWith("-") = True Then
    '                sStrTotalCurrentdebit = sStrTotalCurrentdebit.Remove(0, 1)
    '            End If
    '            'dRow("PresentYear") = dTotalDebit
    '            dRow("PresentYear") = sStrTotalCurrentdebit

    '            sStrTotalLastDebit = dTotalLDebit
    '            If sStrTotalLastDebit.StartsWith("-") = True Then
    '                sStrTotalLastDebit.Remove(0, 1)
    '            End If
    '            'dRow("LastYear") = dTotalLDebit
    '            dRow("LastYear") = sStrTotalLastDebit
    '            dt.Rows.Add(dRow)
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    'Public Function LoadBalanceSheet(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
    '                                 ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer)
    '    Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
    '    Dim dRow As DataRow
    '    Dim dt As New DataTable
    '    Dim dtGroup As New DataTable
    '    Dim dtSub As New DataTable
    '    Dim dtLink As New DataTable
    '    Dim dtArray As New DataTable
    '    Dim dr As OleDb.OleDbDataReader
    '    Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0
    '    Dim a As Integer = 0
    '    Dim sArray As Array
    '    Dim dDebit As Double = 0.00
    '    Dim dCredit As Double = 0.00

    '    Dim dLDebit As Double = 0.00
    '    Dim dLCredit As Double = 0.00

    '    Dim dTotalDebit As Double = 0.00
    '    Dim dTotalCredit As Double = 0.00

    '    Dim dTotalLDebit As Double = 0.00
    '    Dim dTotalLCredit As Double = 0.00

    '    Dim iHead As Integer = 0
    '    Dim iSLNo As Integer = 0
    '    Dim iLastYear As Integer = 0

    '    Dim iFixedAssets As Integer = 0

    '    Dim iStatusCheck As Integer = 0

    '    Dim sSPresentYear As String = "" : Dim sLastYear As String = ""
    '    Dim sAsseCurrentYear As String = "" : Dim sAssetLastYear As String = ""
    '    Try
    '        dt.Columns.Add("ID")
    '        dt.Columns.Add("SLNo")
    '        dt.Columns.Add("Particulars")
    '        dt.Columns.Add("NoteNo")
    '        dt.Columns.Add("PresentYear")
    '        dt.Columns.Add("LastYear")

    '        'Liabilites

    '        sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
    '        sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
    '        dr = objDB.SQLDataReader(sNameSpace, sSql)
    '        If dr.HasRows = True Then
    '            dr.Read()
    '            iLastYear = dr("YMS_ID")
    '        Else
    '            iLastYear = 0
    '        End If

    '        sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 4 and gl_Delflag ='C' and gl_Status ='A' and "
    '        sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
    '        dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGroup.Rows.Count > 0 Then

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "EQUITY And LIABILITIES" & "</B>"
    '            dt.Rows.Add(dRow)

    '            For i = 0 To dtGroup.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
    '                    dRow("ID") = dtGroup.Rows(i)("gl_ID")
    '                End If

    '                dRow("SLNo") = iSLNo + 1

    '                If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
    '                    dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
    '                End If
    '                dt.Rows.Add(dRow)

    '                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
    '                aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
    '                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtSub.Rows.Count > 0 Then
    '                    For j = 0 To dtSub.Rows.Count - 1
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
    '                            dRow("ID") = dtSub.Rows(j)("gl_ID")
    '                        End If

    '                        If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
    '                            dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
    '                        End If

    '                        mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head = 4 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
    '                        mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
    '                        dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                        If dtLink.Rows.Count > 0 Then
    '                            If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
    '                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
    '                            End If

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then

    '                                        iSql = "" : iSql = "Select * from GL_Masters Where GM_Year =" & iYearID & " and GM_CompID =" & iCOmpID & " and GM_GL =" & sArray(k) & " "
    '                                        'If iZoneID > 0 Then
    '                                        '    iSql = iSql & " and ACC_PM_ZoneID=" & iZoneID & ""
    '                                        'End If
    '                                        'If iRegionID > 0 Then
    '                                        '    iSql = iSql & " and ACC_PM_RegionID=" & iRegionID & ""
    '                                        'End If
    '                                        'If iAreaID > 0 Then
    '                                        '    iSql = iSql & " and ACC_PM_AreaID=" & iAreaID & ""
    '                                        'End If
    '                                        'If iBranchID > 0 Then
    '                                        '    iSql = iSql & " and ACC_PM_BranchID=" & iBranchID & ""
    '                                        'End If
    '                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                        If dtArray.Rows.Count > 0 Then
    '                                            For a = 0 To dtArray.Rows.Count - 1
    '                                                If (IsDBNull(dtArray.Rows(a)("GM_TrDebit").ToString()) = False) And (dtArray.Rows(a)("GM_TrDebit").ToString() <> "") Then
    '                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("GM_TrDebit").ToString())
    '                                                End If

    '                                                If (IsDBNull(dtArray.Rows(a)("GM_TrCredit").ToString()) = False) And (dtArray.Rows(a)("GM_TrCredit").ToString() <> "") Then
    '                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("GM_TrCredit").ToString())
    '                                                End If
    '                                            Next
    '                                        End If

    '                                    End If
    '                                Next

    '                                sSPresentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                If sSPresentYear.StartsWith("-") = True Then
    '                                    sSPresentYear = sSPresentYear.Remove(0, 1)
    '                                End If
    '                                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                dRow("PresentYear") = sSPresentYear

    '                                Dim dDbCr As Double = 0.00
    '                                dDbCr = dDebit - dCredit
    '                                'dTotalDebit = dTotalDebit + dDbCr
    '                                dTotalDebit = dTotalDebit + Convert.ToDouble(sSPresentYear)

    '                                dDebit = 0 : dCredit = 0
    '                            End If


    '                            'Last Year

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
    '                                        iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
    '                                        If iZoneID > 0 Then
    '                                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                        End If
    '                                        If iRegionID > 0 Then
    '                                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                        End If
    '                                        If iAreaID > 0 Then
    '                                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                        End If
    '                                        If iBranchID > 0 Then
    '                                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                        End If
    '                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                        If dtArray.Rows.Count > 0 Then
    '                                            For a = 0 To dtArray.Rows.Count - 1
    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                    dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                End If

    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                    dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                End If
    '                                            Next

    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                sLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                If sLastYear.StartsWith("-") = True Then
    '                                    sLastYear = sLastYear.Remove(0, 1)
    '                                End If
    '                                dRow("LastYear") = sLastYear

    '                                Dim dLDbCr As Double = 0.00
    '                                dLDbCr = dLDebit - dLCredit
    '                                'dTotalLDebit = dTotalLDebit + dLDbCr
    '                                dTotalLDebit = dTotalLDebit + Convert.ToDouble(sLastYear)

    '                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
    '                            End If
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next
    '                End If
    '                iSLNo = iSLNo + 1
    '            Next

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
    '            dRow("PresentYear") = dTotalDebit
    '            dRow("LastYear") = dTotalLDebit
    '            dt.Rows.Add(dRow)
    '        End If


    '        'Assets
    '        dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
    '        sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 1 and gl_Delflag ='C' and gl_Status ='A' and "
    '        sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
    '        dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGroup.Rows.Count > 0 Then

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "ASSETS" & "</B>"
    '            dt.Rows.Add(dRow)

    '            For i = 0 To dtGroup.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
    '                    dRow("ID") = dtGroup.Rows(i)("gl_ID")
    '                End If

    '                dRow("SLNo") = iSLNo + 1

    '                If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
    '                    dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
    '                End If
    '                dt.Rows.Add(dRow)

    '                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_Delflag ='C' and "
    '                aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
    '                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtSub.Rows.Count > 0 Then
    '                    For j = 0 To dtSub.Rows.Count - 1
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
    '                            dRow("ID") = dtSub.Rows(j)("gl_ID")
    '                        End If

    '                        If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
    '                            dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
    '                        End If

    '                        If (dtSub.Rows(j)("gl_Desc").ToString() = "Tangible Assets") Or (dtSub.Rows(j)("gl_Desc").ToString() = "Intangible Assets") Then
    '                            iFixedAssets = 1
    '                        Else
    '                            iFixedAssets = 0
    '                        End If

    '                        mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
    '                        mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
    '                        dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                        If dtLink.Rows.Count > 0 Then
    '                            If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
    '                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
    '                            End If

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        If iFixedAssets = 0 Then

    '                                            iSql = "" : iSql = "Select * from GL_Masters Where GM_Year =" & iYearID & " and GM_CompID =" & iCOmpID & " and GM_GL =" & sArray(k) & " "
    '                                            'If iZoneID > 0 Then
    '                                            '    iSql = iSql & " and ACC_PM_ZoneID=" & iZoneID & ""
    '                                            'End If
    '                                            'If iRegionID > 0 Then
    '                                            '    iSql = iSql & " and ACC_PM_RegionID=" & iRegionID & ""
    '                                            'End If
    '                                            'If iAreaID > 0 Then
    '                                            '    iSql = iSql & " and ACC_PM_AreaID=" & iAreaID & ""
    '                                            'End If
    '                                            'If iBranchID > 0 Then
    '                                            '    iSql = iSql & " and ACC_PM_BranchID=" & iBranchID & ""
    '                                            'End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("GM_TrDebit").ToString()) = False) And (dtArray.Rows(a)("GM_TrDebit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("GM_TrDebit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("GM_TrCredit").ToString()) = False) And (dtArray.Rows(a)("GM_TrCredit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("GM_TrCredit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If

    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                sAsseCurrentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                If sAsseCurrentYear.StartsWith("-") = True Then
    '                                    sAsseCurrentYear = sAsseCurrentYear.Remove(0, 1)
    '                                End If
    '                                dRow("PresentYear") = sAsseCurrentYear

    '                                Dim dDbCr As Double = 0.00
    '                                dDbCr = dDebit - dCredit
    '                                'dTotalDebit = dTotalDebit + dDbCr
    '                                dTotalDebit = dTotalDebit + Convert.ToDouble(sAsseCurrentYear)

    '                                dDebit = 0 : dCredit = 0
    '                            End If

    '                            'Last Year
    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        If iFixedAssets = 0 Then
    '                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
    '                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                        dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                        dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If
    '                                        End If
    '                                    End If
    '                                Next
    '                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                sAssetLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                If sAssetLastYear.StartsWith("-") = True Then
    '                                    sAssetLastYear = sAssetLastYear.Remove(0, 1)
    '                                End If
    '                                dRow("LastYear") = sAssetLastYear

    '                                Dim dLDbCr As Double = 0.00
    '                                dLDbCr = dLDebit - dLCredit
    '                                'dTotalLDebit = dTotalLDebit + dLDbCr
    '                                dTotalLDebit = dTotalLDebit + Convert.ToDouble(sAssetLastYear)

    '                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
    '                            End If
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next
    '                End If
    '                iSLNo = iSLNo + 1
    '            Next

    '            Dim sStrTotalCurrentdebit As String = "" : Dim sStrTotalLastDebit As String = ""
    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

    '            sStrTotalCurrentdebit = dTotalDebit
    '            If sStrTotalCurrentdebit.StartsWith("-") = True Then
    '                sStrTotalCurrentdebit = sStrTotalCurrentdebit.Remove(0, 1)
    '            End If
    '            'dRow("PresentYear") = dTotalDebit
    '            dRow("PresentYear") = sStrTotalCurrentdebit

    '            sStrTotalLastDebit = dTotalLDebit
    '            If sStrTotalLastDebit.StartsWith("-") = True Then
    '                sStrTotalLastDebit.Remove(0, 1)
    '            End If
    '            'dRow("LastYear") = dTotalLDebit
    '            dRow("LastYear") = sStrTotalLastDebit
    '            dt.Rows.Add(dRow)
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function

    Public Function LoadBalanceSheet(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)
        Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
        Dim dRow As DataRow
        Dim dt As New DataTable
        Dim dtGroup As New DataTable
        Dim dtSub As New DataTable
        Dim dtLink As New DataTable
        Dim dtArray As New DataTable
        Dim dr As OleDb.OleDbDataReader
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0
        Dim a As Integer = 0
        Dim sArray As Array
        Dim dDebit As Double = 0.00
        Dim dCredit As Double = 0.00

        Dim dLDebit As Double = 0.00
        Dim dLCredit As Double = 0.00

        Dim dSumTotalDebit As Double = 0.00
        Dim dSumTotalCredit As Double = 0.00

        Dim dSumTotalLDebit As Double = 0.00
        Dim dSumTotalLCredit As Double = 0.00

        Dim dTotalDebit As Double = 0.00
        Dim dTotalCredit As Double = 0.00

        Dim dTotalLDebit As Double = 0.00
        Dim dTotalLCredit As Double = 0.00

        Dim iHead As Integer = 0
        Dim iSLNo As Integer = 0
        Dim iLastYear As Integer = 0

        Dim iFixedAssets As Integer = 0

        Dim iStatusCheck As Integer = 0

        Dim sSPresentYear As String = "" : Dim sLastYear As String = ""
        Dim sAsseCurrentYear As String = "" : Dim sAssetLastYear As String = ""

        Dim dtRsATDIncome, dtRsOpnIncome As New DataTable
        Dim dtRsATDExpense, dtRsOpnExpense As New DataTable
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("SLNo")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("NoteNo")
            dt.Columns.Add("PresentYear")
            dt.Columns.Add("LastYear")
            dt.Columns.Add("PCrDr")
            dt.Columns.Add("LCrDr")

            'Liabilites

            sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
            sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                iLastYear = dr("YMS_ID")
            Else
                iLastYear = 0
            End If

            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 4 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "EQUITY And LIABILITIES" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
                    aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head = 4 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                If dRow("Particulars") = "Reserves & Surplus" Then
                                    '---- Income
                                    aSql = "" : aSql = "Select sum(ATD_Debit) as ATD_Debit,sum(ATD_Credit) as ATD_Credit from acc_Transactions_details where atd_head=2 And ATD_CompID =" & iCOmpID & " And "
                                    aSql = aSql & "atd_Status ='A'"
                                    dtRsATDIncome = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                    If dtRsATDIncome.Rows.Count > 0 Then
                                        If (IsDBNull(dtRsATDIncome.Rows(0)("ATD_Debit").ToString()) = False) And (dtRsATDIncome.Rows(0)("ATD_Debit").ToString() <> "") Then
                                            dDebit = dDebit + Convert.ToDouble(dtRsATDIncome.Rows(0)("ATD_Debit").ToString())
                                        End If
                                        If (IsDBNull(dtRsATDIncome.Rows(0)("ATD_Credit").ToString()) = False) And (dtRsATDIncome.Rows(0)("ATD_Credit").ToString() <> "") Then
                                            dCredit = dCredit + Convert.ToDouble(dtRsATDIncome.Rows(0)("ATD_Credit").ToString())
                                        End If
                                    End If
                                    aSql = "" : aSql = "Select sum(Opn_DebitAmt) as Opn_DebitAmt,sum(Opn_CreditAmount) as Opn_CreditAmount from acc_opening_Balance where opn_acchead=2 And opn_CompID =" & iCOmpID & " And "
                                    aSql = aSql & "opn_Status ='A'"
                                    dtRsOpnIncome = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                    If dtRsOpnIncome.Rows.Count > 0 Then
                                        If (IsDBNull(dtRsOpnIncome.Rows(0)("Opn_DebitAmt").ToString()) = False) And (dtRsOpnIncome.Rows(0)("Opn_DebitAmt").ToString() <> "") Then
                                            dDebit = dDebit + Convert.ToDouble(dtRsOpnIncome.Rows(0)("Opn_DebitAmt").ToString())
                                        End If
                                        If (IsDBNull(dtRsOpnIncome.Rows(0)("Opn_CreditAmount").ToString()) = False) And (dtRsOpnIncome.Rows(0)("Opn_CreditAmount").ToString() <> "") Then
                                            dCredit = dCredit + Convert.ToDouble(dtRsOpnIncome.Rows(0)("Opn_CreditAmount").ToString())
                                        End If
                                    End If
                                    '---- Expenses
                                    aSql = "" : aSql = "Select sum(ATD_Debit) as ATD_Debit,sum(ATD_Credit) as ATD_Credit from acc_Transactions_details where atd_head=3 And ATD_CompID =" & iCOmpID & " And "
                                    aSql = aSql & "atd_Status ='A'"
                                    dtRsATDExpense = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                    If dtRsATDExpense.Rows.Count > 0 Then
                                        If (IsDBNull(dtRsATDExpense.Rows(0)("ATD_Debit").ToString()) = False) And (dtRsATDExpense.Rows(0)("ATD_Debit").ToString() <> "") Then
                                            dDebit = dDebit + Convert.ToDouble(dtRsATDExpense.Rows(0)("ATD_Debit").ToString())
                                        End If
                                        If (IsDBNull(dtRsATDExpense.Rows(0)("ATD_Credit").ToString()) = False) And (dtRsATDExpense.Rows(0)("ATD_Credit").ToString() <> "") Then
                                            dCredit = dCredit + Convert.ToDouble(dtRsATDExpense.Rows(0)("ATD_Credit").ToString())
                                        End If
                                    End If
                                    aSql = "" : aSql = "Select sum(Opn_DebitAmt) as Opn_DebitAmt,sum(Opn_CreditAmount) as Opn_CreditAmount from acc_opening_Balance where opn_acchead=3 And Opn_CompID =" & iCOmpID & " And "
                                    aSql = aSql & "Opn_Status ='A'"
                                    dtRsOpnExpense = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                    If dtRsOpnExpense.Rows.Count > 0 Then
                                        If (IsDBNull(dtRsOpnExpense.Rows(0)("Opn_DebitAmt").ToString()) = False) And (dtRsOpnExpense.Rows(0)("Opn_DebitAmt").ToString() <> "") Then
                                            dDebit = dDebit + Convert.ToDouble(dtRsOpnExpense.Rows(0)("Opn_DebitAmt").ToString())
                                        End If
                                        If (IsDBNull(dtRsOpnExpense.Rows(0)("Opn_CreditAmount").ToString()) = False) And (dtRsOpnExpense.Rows(0)("Opn_CreditAmount").ToString() <> "") Then
                                            dCredit = dCredit + Convert.ToDouble(dtRsOpnExpense.Rows(0)("Opn_CreditAmount").ToString())
                                        End If
                                    End If
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then

                                            iSql = "" : iSql = "Select ATD_Debit,ATD_Credit from Acc_Transactions_Details Where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and  ATD_Status='A' "
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & " and ATD_TransactionDate Between '" & dFromDate & "' And  '" & dToDate & "' "

                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                        ' dSumTotalDebit = dSumTotalDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())     added for testing purpose 04-08-2020
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                        ' dSumTotalCredit = dSumTotalCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())    added for testing purpose 04-08-2020
                                                    End If
                                                Next
                                            End If


                                            iSql = "" : iSql = "Select gl_head,Opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id Where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and  Opn_Status='A' "
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & " and Opn_Date Between '" & dFromDate & "' And '" & dToDate & "'"
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("Opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("Opn_DebitAmt").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())
                                                            'dSumTotalDebit = dSumTotalDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())    added for testing purpose 04-08-2020
                                                        End If
                                                    End If
                                                    If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                            'dSumTotalCredit = dSumTotalCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())    added for testing purpose 04-08-2020
                                                        End If
                                                    End If
                                                Next
                                            End If


                                            'Last Year
                                            iSql = "" : iSql = "Select top 1 * from Freeze_Ledger join chart_of_Accounts on FL_GL=gl_id where FL_Year =" & iLastYear & " and FL_CompID =" & iCOmpID & " and "
                                            iSql = iSql & "FL_Status ='F' and FL_GL =" & sArray(k) & ""
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                                            End If
                                            iSql = iSql & " order by fl_id desc"
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("FL_CloseDebit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseDebit").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseDebit").ToString())
                                                            ' dSumTotalLDebit = dSumTotalLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_TrDebit").ToString())  added for testing purpose 04-08-2020
                                                        End If
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("FL_CloseCredit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseCredit").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseCredit").ToString())
                                                            ' dSumTotalLCredit = dSumTotalLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_TrCredit").ToString())    added for testing purpose 04-08-2020
                                                        End If
                                                    End If
                                                Next

                                            End If
                                        End If
                                    Next

                                    sSPresentYear = String.Format("{0:0.00}", Convert.ToDecimal(dCredit - dDebit))
                                    If sSPresentYear.StartsWith("-") = True Then
                                        sSPresentYear = sSPresentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - Convert.ToDouble(sSPresentYear)
                                        dRow("PresentYear") = sSPresentYear
                                        dRow("PCrDr") = " Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + Convert.ToDouble(sSPresentYear)
                                        dRow("PresentYear") = sSPresentYear
                                        If dRow("PresentYear") = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = " Cr"
                                        End If

                                    End If
                                    'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))


                                    Dim dDbCr As Double = 0.00
                                    dDbCr = dDebit - dCredit
                                    'dTotalDebit = dTotalDebit + dDbCr


                                    dDebit = 0 : dCredit = 0




                                    'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
                                    sLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLCredit - dLDebit))
                                    If sLastYear.StartsWith("-") = True Then
                                        dTotalLDebit = dTotalLDebit - Convert.ToDouble(sLastYear)
                                        sLastYear = sLastYear.Remove(0, 1)
                                        dRow("LCrDr") = " Dr"
                                    Else
                                        dTotalLDebit = dTotalLDebit + Convert.ToDouble(sLastYear)
                                        sLastYear = sLastYear
                                        If sLastYear = "0.00" Then
                                            dRow("LCrDr") = ""
                                        Else
                                            dRow("LCrDr") = " Cr"
                                        End If

                                    End If
                                    dRow("LastYear") = sLastYear

                                    Dim dLDbCr As Double = 0.00
                                    dLDbCr = dLDebit - dLCredit
                                    'dTotalLDebit = dTotalLDebit + dLDbCr


                                    dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                End If



                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                dRow("PresentYear") = dTotalDebit
                If dRow("PresentYear").StartsWith("-") = True Then
                    dRow("PresentYear") = dRow("PresentYear").Remove(0, 1)
                    dRow("PresentYear") = dRow("PresentYear")
                    dRow("PCrDr") = " Dr"
                Else
                    If dRow("PresentYear") = "0" Then
                        dRow("PresentYear") = dRow("PresentYear")
                        dRow("PCrDr") = ""
                    Else
                        dRow("PresentYear") = dRow("PresentYear")
                        dRow("PCrDr") = " Cr"
                    End If
                End If
                dRow("LastYear") = dTotalLDebit
                If dRow("LastYear").StartsWith("-") = True Then
                    dRow("LastYear") = dRow("LastYear").Remove(0, 1)
                    dRow("LastYear") = dRow("LastYear")
                    dRow("LCrDr") = " Dr"
                Else
                    If dRow("LastYear") = "0" Then
                        dRow("LastYear") = dRow("LastYear")
                        dRow("LCrDr") = ""
                    Else
                        dRow("LastYear") = dRow("LastYear")
                        dRow("LCrDr") = " Cr"
                    End If

                End If
                dt.Rows.Add(dRow)
                dSumTotalCredit = 0 : dSumTotalDebit = 0
                dSumTotalLCredit = 0 : dSumTotalLDebit = 0
            End If


            'Assets
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head In(0) And gl_AccHead = 1 And gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "ASSETS" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_Delflag ='C' and "
                    aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            If (dtSub.Rows(j)("gl_Desc").ToString() = "Tangible Assets") Or (dtSub.Rows(j)("gl_Desc").ToString() = "Intangible Assets") Then
                                iFixedAssets = 1
                            Else
                                iFixedAssets = 0
                            End If

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            If iFixedAssets = 0 Then

                                                iSql = "" : iSql = "Select * from Acc_Transactions_Details Where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                                If dFromDate <> "01/01/1900" And dFromDate <> "01-01-1900" And dToDate <> "01/01/1900" And dToDate <> "01-01-1900" Then
                                                    iSql = iSql & " and ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                        End If
                                                    Next

                                                End If

                                                iSql = "" : iSql = "Select gl_head,Opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id Where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and  Opn_Status='A' "
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & " and Opn_Date Between '" & dFromDate & "' And '" & dToDate & "'"
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If (IsDBNull(dtArray.Rows(a)("Opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("Opn_DebitAmt").ToString() <> "") Then
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())
                                                            End If
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If

                                                'Last Year
                                                iSql = "" : iSql = "Select top 1 * from Freeze_Ledger join chart_of_Accounts on fl_Gl=gl_id where FL_Year =" & iLastYear & " and FL_CompID =" & iCOmpID & " and "
                                                iSql = iSql & "FL_Status ='F' and FL_GL =" & sArray(k) & ""

                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                                                End If
                                                iSql = iSql & " order by fl_id desc"
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If (IsDBNull(dtArray.Rows(a)("FL_TrDebit").ToString()) = False) And (dtArray.Rows(a)("FL_TrDebit").ToString() <> "") Then
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_TrDebit").ToString())
                                                            End If
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("FL_TrCredit").ToString()) = False) And (dtArray.Rows(a)("FL_TrCredit").ToString() <> "") Then
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_TrCredit").ToString())
                                                            End If
                                                        End If
                                                    Next

                                                End If
                                            End If
                                        End If
                                    Next

                                    'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
                                    sAsseCurrentYear = String.Format("{0:0.00}", Convert.ToDecimal(dCredit - dDebit))
                                    If sAsseCurrentYear.StartsWith("-") = True Then
                                        sAsseCurrentYear = sAsseCurrentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - Convert.ToDouble(sAsseCurrentYear)
                                        dRow("PresentYear") = sAsseCurrentYear
                                        dRow("PCrDr") = " Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + Convert.ToDouble(sAsseCurrentYear)
                                        dRow("PresentYear") = sAsseCurrentYear
                                        If sAsseCurrentYear = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = " Cr"
                                        End If

                                    End If


                                    Dim dDbCr As Double = 0.00
                                    dDbCr = dDebit - dCredit
                                    'dTotalDebit = dTotalDebit + dDbCr
                                    ' dTotalDebit = dTotalDebit + Convert.ToDouble(sAsseCurrentYear)

                                    dDebit = 0 : dCredit = 0
                                End If



                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
                                sAssetLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLCredit - dLDebit))
                                If sAssetLastYear.StartsWith("-") = True Then
                                    sAssetLastYear = sAssetLastYear.Remove(0, 1)
                                    dTotalLDebit = dTotalLDebit - Convert.ToDouble(sAssetLastYear)
                                    dRow("LastYear") = sAssetLastYear
                                    dRow("LCrDr") = " Dr"
                                Else
                                    dTotalLDebit = dTotalLDebit + Convert.ToDouble(sAssetLastYear)
                                    dRow("LastYear") = sAssetLastYear
                                    If sAssetLastYear = "0.00" Then
                                        dRow("LCrDr") = ""
                                    Else
                                        dRow("LCrDr") = " Cr"
                                    End If

                                End If


                                Dim dLDbCr As Double = 0.00
                                dLDbCr = dLDebit - dLCredit
                                'dTotalLDebit = dTotalLDebit + dLDbCr
                                'dTotalLDebit = dTotalLDebit + Convert.ToDouble(sAssetLastYear)

                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0

                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                Dim sStrTotalCurrentdebit As String = "" : Dim sStrTotalLastDebit As String = ""
                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

                sStrTotalCurrentdebit = dTotalDebit
                If sStrTotalCurrentdebit.StartsWith("-") = True Then
                    sStrTotalCurrentdebit = sStrTotalCurrentdebit.Remove(0, 1)
                    dRow("PCrDr") = " Dr"
                Else
                    sStrTotalCurrentdebit = sStrTotalCurrentdebit
                    If sStrTotalCurrentdebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = " Cr"
                    End If

                End If
                'dRow("PresentYear") = dTotalDebit
                dRow("PresentYear") = sStrTotalCurrentdebit

                sStrTotalLastDebit = dTotalLDebit
                If sStrTotalLastDebit.StartsWith("-") = True Then
                    sStrTotalLastDebit = sStrTotalLastDebit.Remove(0, 1)
                    dRow("LCrDr") = " Dr"
                Else
                    sStrTotalLastDebit = sStrTotalLastDebit
                    If sStrTotalLastDebit = "0" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = " Cr"
                    End If

                End If
                'dRow("LastYear") = dTotalLDebit
                dRow("LastYear") = sStrTotalLastDebit
                dt.Rows.Add(dRow)
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    'Public Function LoadPLReports(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
    '                              ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer)
    '    Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
    '    Dim dRow As DataRow
    '    Dim dt As New DataTable
    '    Dim dtGroup As New DataTable
    '    Dim dtSub As New DataTable
    '    Dim dtLink As New DataTable
    '    Dim dtArray As New DataTable
    '    Dim dr As OleDb.OleDbDataReader
    '    Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0, a As Integer = 0
    '    Dim sArray As Array
    '    Dim dDebit As Double = 0.00
    '    Dim dCredit As Double = 0.00

    '    Dim dLDebit As Double = 0.00
    '    Dim dLCredit As Double = 0.00

    '    Dim dTotalDebit As Double = 0.00
    '    Dim dTotalCredit As Double = 0.00

    '    Dim dTotalLDebit As Double = 0.00
    '    Dim dTotalLCredit As Double = 0.00

    '    Dim iHead As Integer = 0
    '    Dim iSLNo As Integer = 0
    '    Dim iLastYear As Integer = 0
    '    Dim iStatusCheck As Integer = 0

    '    Dim sSPresentYear As String = "" : Dim sLastYear As String = ""
    '    Dim sExCurrentYear As String = "" : Dim sExLastYear As String = ""
    '    Dim sTotalDebit As String = "" : Dim sTotalCredit As String = ""
    '    Dim sExTotalDebit As String = "" : Dim sExTotalCredit As String = ""
    '    Try
    '        dt.Columns.Add("ID")
    '        dt.Columns.Add("SLNo")
    '        dt.Columns.Add("Particulars")
    '        dt.Columns.Add("NoteNo")
    '        dt.Columns.Add("PresentYear")
    '        dt.Columns.Add("LastYear")


    '        sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
    '        sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
    '        dr = objDB.SQLDataReader(sNameSpace, sSql)
    '        If dr.HasRows = True Then
    '            dr.Read()
    '            iLastYear = dr("YMS_ID")
    '        Else
    '            iLastYear = 0
    '        End If

    '        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_yearID =" & iYearID & ""
    '        If iZoneID > 0 Then
    '            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '        End If
    '        If iRegionID > 0 Then
    '            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '        End If
    '        If iAreaID > 0 Then
    '            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '        End If
    '        If iBranchID > 0 Then
    '            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '        End If
    '        dr = objDB.SQLDataReader(sNameSpace, iSql)
    '        If dr.HasRows = True Then
    '            dr.Read()
    '            If dr("Opn_Status") = "F" Then
    '                iStatusCheck = 0
    '            Else
    '                iStatusCheck = 1
    '            End If
    '        Else
    '            iStatusCheck = 1
    '        End If

    '        'Income
    '        dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
    '        sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 2 and gl_Delflag ='C' and gl_Status ='A' and "
    '        sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
    '        dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGroup.Rows.Count > 0 Then

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "REVENUE" & "</B>"
    '            dt.Rows.Add(dRow)

    '            For i = 0 To dtGroup.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
    '                    dRow("ID") = dtGroup.Rows(i)("gl_ID")
    '                End If

    '                dRow("SLNo") = iSLNo + 1

    '                If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
    '                    dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
    '                End If
    '                dt.Rows.Add(dRow)

    '                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
    '                aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
    '                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtSub.Rows.Count > 0 Then
    '                    For j = 0 To dtSub.Rows.Count - 1
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
    '                            dRow("ID") = dtSub.Rows(j)("gl_ID")
    '                        End If

    '                        If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
    '                            dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
    '                        End If

    '                        mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =2 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
    '                        mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
    '                        dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                        If dtLink.Rows.Count > 0 Then
    '                            If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
    '                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
    '                            End If

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        If iStatusCheck = 0 Then
    '                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
    '                                            iSql = iSql & "Opn_GLID =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                    End If
    '                                                Next
    '                                            End If
    '                                        Else
    '                                            iSql = "" : iSql = "Select * from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                                            iSql = iSql & " where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
    '                                                    End If
    '                                                Next
    '                                            End If
    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                sSPresentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                If sSPresentYear.StartsWith("-") = True Then
    '                                    sSPresentYear = sSPresentYear.Remove(0, 1)
    '                                End If
    '                                dRow("PresentYear") = sSPresentYear

    '                                Dim dDbCr As Double = 0.00
    '                                dDbCr = dDebit - dCredit
    '                                dTotalDebit = dTotalDebit + dDbCr

    '                                dDebit = 0 : dCredit = 0
    '                            End If

    '                            'Last Year
    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
    '                                        iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
    '                                        If iZoneID > 0 Then
    '                                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                        End If
    '                                        If iRegionID > 0 Then
    '                                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                        End If
    '                                        If iAreaID > 0 Then
    '                                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                        End If
    '                                        If iBranchID > 0 Then
    '                                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                        End If
    '                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                        If dtArray.Rows.Count > 0 Then
    '                                            For a = 0 To dtArray.Rows.Count - 1
    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                    dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                End If

    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                    dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                End If
    '                                            Next

    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                sLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                If sLastYear.StartsWith("-") = True Then
    '                                    sLastYear = sLastYear.Remove(0, 1)
    '                                End If
    '                                dRow("LastYear") = sLastYear

    '                                Dim dLdbCr As Double = 0.00
    '                                dLdbCr = dLDebit - dLCredit
    '                                dTotalLDebit = dTotalLDebit + dLdbCr

    '                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
    '                            End If
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next
    '                End If
    '                iSLNo = iSLNo + 1
    '            Next

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

    '            'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
    '            'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))

    '            sTotalDebit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
    '            If sTotalDebit.StartsWith("-") = True Then
    '                sTotalDebit = sTotalDebit.Remove(0, 1)
    '            End If
    '            dRow("PresentYear") = sTotalDebit

    '            sTotalCredit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))
    '            If sTotalCredit.StartsWith("-") = True Then
    '                sTotalCredit = sTotalCredit.Remove(0, 1)
    '            End If
    '            dRow("LastYear") = sTotalCredit

    '            dt.Rows.Add(dRow)
    '        End If


    '        'Expenditure
    '        dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
    '        sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 3 and gl_Delflag ='C' and gl_Status ='A' and "
    '        sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
    '        dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGroup.Rows.Count > 0 Then

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "EXPENDITURE" & "</B>"
    '            dt.Rows.Add(dRow)

    '            For i = 0 To dtGroup.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
    '                    dRow("ID") = dtGroup.Rows(i)("gl_ID")
    '                End If

    '                dRow("SLNo") = iSLNo + 1

    '                If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
    '                    dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
    '                End If
    '                dt.Rows.Add(dRow)

    '                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
    '                aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
    '                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtSub.Rows.Count > 0 Then
    '                    For j = 0 To dtSub.Rows.Count - 1
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
    '                            dRow("ID") = dtSub.Rows(j)("gl_ID")
    '                        End If

    '                        If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
    '                            dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
    '                        End If

    '                        mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =3 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
    '                        mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
    '                        dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                        If dtLink.Rows.Count > 0 Then
    '                            If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
    '                                dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
    '                            End If

    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        If iStatusCheck = 0 Then
    '                                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
    '                                            iSql = iSql & "Opn_GLID =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If
    '                                        Else
    '                                            iSql = "" : iSql = "Select * from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                                            iSql = iSql & " where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & ""
    '                                            If iZoneID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_ZoneID=" & iZoneID & ""
    '                                            End If
    '                                            If iRegionID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_RegionID=" & iRegionID & ""
    '                                            End If
    '                                            If iAreaID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_AreaID=" & iAreaID & ""
    '                                            End If
    '                                            If iBranchID > 0 Then
    '                                                iSql = iSql & " and ACC_PM_BranchID=" & iBranchID & ""
    '                                            End If
    '                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                            If dtArray.Rows.Count > 0 Then
    '                                                For a = 0 To dtArray.Rows.Count - 1
    '                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
    '                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
    '                                                    End If

    '                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
    '                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
    '                                                    End If
    '                                                Next

    '                                            End If
    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                sExCurrentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
    '                                If sExCurrentYear.StartsWith("-") = True Then
    '                                    sExCurrentYear = sExCurrentYear.Remove(0, 1)
    '                                End If
    '                                dRow("PresentYear") = sExCurrentYear

    '                                Dim dDbCr As Double = 0.00
    '                                dDbCr = dDebit - dCredit
    '                                dTotalDebit = dTotalDebit + dDbCr

    '                                dDebit = 0 : dCredit = 0
    '                            End If

    '                            'Last Year
    '                            sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
    '                            If sArray.Length - 1 Then
    '                                For k = 0 To sArray.Length - 1
    '                                    If sArray(k) <> "" Then
    '                                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
    '                                        iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
    '                                        If iZoneID > 0 Then
    '                                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                                        End If
    '                                        If iRegionID > 0 Then
    '                                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                                        End If
    '                                        If iAreaID > 0 Then
    '                                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                                        End If
    '                                        If iBranchID > 0 Then
    '                                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                                        End If
    '                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                                        If dtArray.Rows.Count > 0 Then
    '                                            For a = 0 To dtArray.Rows.Count - 1
    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
    '                                                    dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
    '                                                End If

    '                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
    '                                                    dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
    '                                                End If
    '                                            Next

    '                                        End If
    '                                    End If
    '                                Next

    '                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                sExLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
    '                                If sExLastYear.StartsWith("-") = True Then
    '                                    sExLastYear = sExLastYear.Remove(0, 1)
    '                                End If
    '                                dRow("LastYear") = sExLastYear

    '                                Dim dLdbCr As Double = 0.00
    '                                dLdbCr = dLDebit - dLCredit
    '                                dTotalLDebit = dTotalLDebit + dLdbCr

    '                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
    '                            End If
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next
    '                End If
    '                iSLNo = iSLNo + 1
    '            Next

    '            dRow = dt.NewRow()
    '            dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

    '            'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
    '            sExTotalDebit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
    '            If sExTotalDebit.StartsWith("-") = True Then
    '                sExTotalDebit = sExTotalDebit.Remove(0, 1)
    '            End If
    '            dRow("PresentYear") = sExTotalDebit

    '            'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))
    '            sExTotalCredit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))
    '            If sExTotalCredit.StartsWith("-") = True Then
    '                sExTotalCredit = sExTotalCredit.Remove(0, 1)
    '            End If
    '            dRow("LastYear") = sExTotalCredit

    '            dt.Rows.Add(dRow)
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function LoadPLReports(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
                                  ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)
        Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
        Dim dRow As DataRow
        Dim dt As New DataTable
        Dim dtGroup As New DataTable
        Dim dtSub As New DataTable
        Dim dtLink As New DataTable
        Dim dtArray As New DataTable
        Dim dr As OleDb.OleDbDataReader
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0, a As Integer = 0
        Dim sArray As Array
        Dim dDebit As Double = 0.00
        Dim dCredit As Double = 0.00

        Dim dLDebit As Double = 0.00
        Dim dLCredit As Double = 0.00

        Dim dTotalDebit As Double = 0.00
        Dim dTotalCredit As Double = 0.00

        Dim dTotalLDebit As Double = 0.00
        Dim dTotalLCredit As Double = 0.00

        Dim iHead As Integer = 0
        Dim iSLNo As Integer = 0
        Dim iLastYear As Integer = 0
        Dim iStatusCheck As Integer = 0

        Dim sSPresentYear As String = "" : Dim sLastYear As String = ""
        Dim sExCurrentYear As String = "" : Dim sExLastYear As String = ""
        Dim sTotalDebit As String = "" : Dim sTotalCredit As String = ""
        Dim sExTotalDebit As String = "" : Dim sExTotalCredit As String = ""
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("SLNo")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("NoteNo")
            dt.Columns.Add("PresentYear")
            dt.Columns.Add("LastYear")
            dt.Columns.Add("PCrDr")
            dt.Columns.Add("LCrDr")


            sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
            sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                iLastYear = dr("YMS_ID")
            Else
                iLastYear = 0
            End If

            'Income
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 2 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "REVENUE" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
                    aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =2 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then

                                            iSql = "" : iSql = "Select ATD_Debit,ATD_Credit from Acc_Transactions_Details where ATD_YearID=" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & " and ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                    End If
                                                Next
                                            End If

                                            iSql = "" : iSql = "Select gl_head,Opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id Where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and  Opn_Status='A' "
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & " and Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("Opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("Opn_DebitAmt").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())
                                                        End If
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                        End If
                                                    End If
                                                Next
                                            End If


                                            'Last Year

                                            iSql = "" : iSql = "Select top 1 * from Freeze_Ledger join chart_of_Accounts on fl_Gl=gl_id where FL_Year =" & iLastYear & " and FL_CompID =" & iCOmpID & " and "
                                            iSql = iSql & "FL_Status ='F' and FL_GL =" & sArray(k) & " "
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                                            End If
                                            iSql = iSql & " order by fl_id desc"
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("FL_CloseDebit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseDebit").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseDebit").ToString())
                                                        End If
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("FL_CloseCredit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseCredit").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseCredit").ToString())
                                                        End If
                                                    End If
                                                Next

                                            End If

                                        End If
                                    Next

                                    'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
                                    sSPresentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
                                    If sSPresentYear.StartsWith("-") = True Then
                                        sSPresentYear = sSPresentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - sSPresentYear
                                        dRow("PCrDr") = " Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + sSPresentYear
                                        If sSPresentYear = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = " Cr"
                                        End If
                                    End If
                                    dRow("PresentYear") = sSPresentYear

                                    Dim dDbCr As Double = 0.00
                                    dDbCr = dDebit - dCredit
                                    ' dTotalDebit = dTotalDebit + dDbCr

                                    dDebit = 0 : dCredit = 0
                                End If

                                'Last Year


                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
                                sLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
                                If sLastYear.StartsWith("-") = True Then
                                    sLastYear = sLastYear.Remove(0, 1)
                                    dTotalLDebit = dTotalLDebit - sLastYear
                                    dRow("LCrDr") = " Dr"
                                Else
                                    dTotalLDebit = dTotalLDebit + sLastYear
                                    If sLastYear = "0.00" Then
                                        dRow("LCrDr") = ""
                                    Else
                                        dRow("PCrDr") = " Cr"
                                    End If

                                End If
                                dRow("LastYear") = sLastYear

                                Dim dLdbCr As Double = 0.00
                                dLdbCr = dLDebit - dLCredit
                                ' dTotalLDebit = dTotalLDebit + dLdbCr

                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0

                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))

                sTotalDebit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
                If sTotalDebit.StartsWith("-") = True Then
                    sTotalDebit = sTotalDebit.Remove(0, 1)
                    dRow("PCrDr") = " Dr"
                Else
                    sTotalDebit = sTotalDebit
                    If sTotalDebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = " Cr"
                    End If
                End If
                dRow("PresentYear") = sTotalDebit

                sTotalCredit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))
                If sTotalCredit.StartsWith("-") = True Then
                    sTotalCredit = sTotalCredit.Remove(0, 1)
                    dRow("LCrDr") = " Dr"
                Else
                    sTotalCredit = sTotalCredit
                    If sTotalCredit = "0.00" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = " Cr"
                    End If
                End If
                dRow("LastYear") = sTotalCredit

                dt.Rows.Add(dRow)
            End If


            'Expenditure
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 3 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "EXPENDITURE" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
                    aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =3 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then

                                            iSql = "" : iSql = "Select ATD_Debit,ATD_Credit from Acc_Transactions_Details where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & " and ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                        dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                        dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                    End If
                                                Next
                                            End If

                                            iSql = "" : iSql = "Select gl_head,Opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id Where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and  Opn_Status='A' "
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & " and Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("Opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("Opn_DebitAmt").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_DebitAmt").ToString())
                                                        End If
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                        End If
                                                    End If
                                                Next
                                            End If


                                            iSql = "" : iSql = "Select top 1 * from Freeze_Ledger join chart_of_Accounts on fl_Gl=gl_id where FL_Year =" & iLastYear & " and FL_CompID =" & iCOmpID & " and "
                                            iSql = iSql & "FL_Status ='F' and FL_GL =" & sArray(k) & ""
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                                            End If
                                            iSql = iSql & " order by fl_id desc"
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If (IsDBNull(dtArray.Rows(a)("FL_TrDebit").ToString()) = False) And (dtArray.Rows(a)("FL_TrDebit").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_TrDebit").ToString())
                                                        End If
                                                    End If

                                                    If (IsDBNull(dtArray.Rows(a)("FL_TrCredit").ToString()) = False) And (dtArray.Rows(a)("FL_TrCredit").ToString() <> "") Then
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_TrCredit").ToString())
                                                        End If
                                                    End If
                                                Next

                                            End If

                                        End If
                                    Next

                                    'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
                                    sExCurrentYear = String.Format("{0:0.00}", Convert.ToDecimal(dDebit - dCredit))
                                    If sExCurrentYear.StartsWith("-") = True Then
                                        sExCurrentYear = sExCurrentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - sExCurrentYear
                                        dRow("PCrDr") = " Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + sExCurrentYear
                                        If sExCurrentYear = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = " Cr"
                                        End If
                                    End If
                                    dRow("PresentYear") = sExCurrentYear

                                    Dim dDbCr As Double = 0.00
                                    dDbCr = dDebit - dCredit
                                    'dTotalDebit = dTotalDebit + dDbCr

                                    dDebit = 0 : dCredit = 0
                                End If

                                'Last Year



                                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
                                sExLastYear = String.Format("{0:0.00}", Convert.ToDecimal(dLDebit - dLCredit))
                                If sExLastYear.StartsWith("-") = True Then
                                    sExLastYear = sExLastYear.Remove(0, 1)
                                    dTotalLDebit = dTotalLDebit - sExLastYear
                                    dRow("PCrDr") = " Dr"
                                Else
                                    dTotalLDebit = dTotalLDebit + sExLastYear
                                    If sExLastYear = "0.00" Then
                                        dRow("LCrDr") = ""
                                    Else
                                        dRow("LCrDr") = " Cr"
                                    End If
                                End If
                                dRow("LastYear") = sExLastYear

                                Dim dLdbCr As Double = 0.00
                                dLdbCr = dLDebit - dLCredit
                                'dTotalLDebit = dTotalLDebit + dLdbCr

                                dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0

                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

                'dRow("PresentYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
                sExTotalDebit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalDebit))
                If sExTotalDebit.StartsWith("-") = True Then
                    sExTotalDebit = sExTotalDebit.Remove(0, 1)
                    dRow("PCrDr") = " Dr"
                Else
                    sExTotalDebit = sExTotalDebit
                    If sExTotalDebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = " Cr"
                    End If
                End If
                dRow("PresentYear") = sExTotalDebit

                'dRow("LastYear") = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))
                sExTotalCredit = String.Format("{0:0.00}", Convert.ToDecimal(dTotalLDebit))
                If sExTotalCredit.StartsWith("-") = True Then
                    sExTotalCredit = sExTotalCredit.Remove(0, 1)
                    dRow("LCrDr") = " Dr"
                Else
                    sExTotalCredit = sExTotalCredit
                    If sExTotalCredit = "0.00" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = " Cr"
                    End If
                End If
                dRow("LastYear") = sExTotalCredit

                dt.Rows.Add(dRow)
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadReceiptReportsDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iParty As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "" : sSql = "Select A.Acc_RM_Party,A.Acc_RM_TransactionNo,A.acc_RM_TransactionType,convert(Char(10),A.Acc_RM_BillDate,103) Acc_RM_BillDate,"
            sSql = sSql & "A.Acc_RM_BillNarration,C.ACM_ID,C.ACM_Name,B.ATD_GL, B.ATD_SubGL, B.ATD_Debit, B.ATD_Credit,d.gl_glcode As glcode, d.gl_desc,e.gl_glcode As subglcode, "
            sSql = sSql & "e.gl_desc As SubGLDesc,A.Acc_RM_BillAmount,A.Acc_RM_ChequeNo,convert(Char(10),A.Acc_RM_ChequeDate,103) Acc_RM_ChequeDate "
            sSql = sSql & "from acc_Receipt_Master A join Acc_Transactions_Details As B On A.Acc_RM_ID = B.ATD_BillID INNER JOIN Acc_Customer_Master As C On "
            sSql = sSql & "A.Acc_RM_Party = C.ACM_ID INNER JOIN chart_of_Accounts As d On B.atd_Gl = d.gl_id  INNER JOIN chart_of_Accounts As e On "
            sSql = sSql & "B.atd_subGl = E.gl_id  where B.atd_trtype = 3 And A.Acc_RM_CompID = " & iCompID & ""
            If iParty <> 0 Then
                sSql = sSql & " And C.ACM_ID =" & iParty & ""
            End If
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadReceiptReportsDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer, ByVal dPBillFromDate As String, ByVal dPBillToDate As String, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                              ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iReceiptVoucherType As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtReceipt As New DataTable
        Dim dRow As DataRow
        Try
            dt.Columns.Add("Srno")
            dt.Columns.Add("Acc_RM_TransactionNo")
            dt.Columns.Add("Acc_RM_InvoiceDate")
            dt.Columns.Add("Acc_RM_party")
            dt.Columns.Add("Acc_RM_BillType")
            dt.Columns.Add("Acc_RM_BillNo")
            dt.Columns.Add("Acc_RM_BillDate")
            dt.Columns.Add("Acc_RM_BillAmount")
            dt.Columns.Add("Acc_RM_BIllNarration")
            dt.Columns.Add("Acc_RM_ChequeNo")
            dt.Columns.Add("Acc_RM_ChequeDate")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("SubGLDescription")


            sSql = "" : sSql = "Select A.Acc_RM_ID,A.Acc_RM_TransactionNo,A.Acc_RM_party,A.Acc_RM_Location,A.Acc_RM_BillType,A.Acc_RM_BillNo,A.Acc_RM_BillDate,A.Acc_RM_BillAmount,A.Acc_RM_InvoiceDate,"
            sSql = sSql & "A.Acc_RM_BIllNarration,A.Acc_RM_ChequeNo,convert(Char(10),A.Acc_RM_ChequeDate,103) Acc_RM_ChequeDate,"
            sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode As GLCode, c.gl_Desc As GLDescription,"
            sSql = sSql & "D.gl_glCode As SubGLCode, D.gl_Desc As SubGLDescription "  'vijayalakshmi 06-03-19 c.gl_desc to d.gl_desc
            sSql = sSql & "from acc_Receipt_Master A join Acc_Transactions_Details B On A.Acc_RM_ID = B.ATD_BillID And B.atd_trtype = 3 And A.Acc_RM_CompID = " & iCompID & " And A.Acc_RM_Status='A' 

And A.Acc_RM_YearID=" & iYearID & " "

            If sPBillNo <> "" Then
                sSql = sSql & " And A.Acc_RM_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & " and A.Acc_RM_ID =" & iVoucher & ""
            End If

            If iReceiptVoucherType > 0 Then
                sSql = sSql & " and A.Acc_RM_BillType =" & iReceiptVoucherType & ""
            End If

            If (dPBillFromDate <> "01/01/1900") And (dPBillToDate <> "01/01/1900") Then
                sSql = sSql & " and Acc_RM_InvoiceDate Between '" & dPBillFromDate & "' And '" & dPBillToDate & "'  "
            End If

            If iMonthID > 0 And iPartyID = 0 Then
                sSql = sSql & " And Month(A.Acc_RM_InvoiceDate)=" & iMonthID & " "
            ElseIf iMonthID = 0 And iPartyID > 0 Then
                sSql = sSql & " And A.Acc_RM_Party=" & iPartyID & " "
            ElseIf iMonthID > 0 And iPartyID > 0 Then
                sSql = sSql & " And Month(A.Acc_RM_InvoiceDate)=" & iMonthID & " And A.Acc_RM_Party=" & iPartyID & " "
            End If

            sSql = sSql & " join chart_of_Accounts C On B.atd_Gl = C.gl_id Left join chart_of_Accounts D On B.atd_SubGl = D.gl_id Where Acc_RM_CompID=" & iCompID & ""
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_RM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_RM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_RM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_RM_BranchID=" & iBranchID & ""
            End If
            sSql = sSql & " order by A.Acc_RM_ID"
            dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtReceipt.Rows.Count > 0 Then
                For i = 0 To dtReceipt.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("Srno") = i + 1
                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_TransactionNo").ToString()) = False Then
                        dRow("Acc_RM_TransactionNo") = dtReceipt.Rows(i)("Acc_RM_TransactionNo")
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_InvoiceDate").ToString()) = False Then
                        dRow("Acc_RM_InvoiceDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(i)("Acc_RM_InvoiceDate").ToString(), "D")
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_Location").ToString()) = False Then
                        If dtReceipt.Rows(i)("Acc_RM_Location").ToString() = "1" Then
                            dRow("Acc_RM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select BM_Name + ' - ' + BM_Code as Name from sales_Buyers_Masters where BM_ID=" & dtReceipt.Rows(i)("Acc_RM_party") & " and  BM_Delflag='A' and BM_CompID =" & iCompID & "")
                        ElseIf dtReceipt.Rows(i)("Acc_RM_Location").ToString() = "2" Then
                            dRow("Acc_RM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select CSM_Name + ' - ' + CSM_Code as Name from CustomerSupplierMaster where CSM_ID=" & dtReceipt.Rows(i)("Acc_RM_party") & " and  CSM_Delflag='A' and CSM_CompID =" & iCompID & "")
                        ElseIf dtReceipt.Rows(i)("Acc_RM_Location").ToString() = "3" Then
                            dRow("Acc_RM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_Desc from chart_of_Accounts where gl_ID=" & dtReceipt.Rows(i)("Acc_RM_party") & " and  gl_Status='A' and gl_CompID =" & iCompID & "")
                        End If
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_BillType").ToString()) = False Then
                        dRow("Acc_RM_BillType") = objDB.SQLExecuteScalar(sNameSpace, "Select Mas_Desc from acc_General_Master where Mas_ID=" & dtReceipt.Rows(i)("Acc_RM_BillType") & " and  Mas_Status='A' and Mas_CompID =" & iCompID & "")
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_BillNo").ToString()) = False Then
                        dRow("Acc_RM_BillNo") = dtReceipt.Rows(i)("Acc_RM_BillNo").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_BillAmount").ToString()) = False Then
                        dRow("Acc_RM_BillAmount") = dtReceipt.Rows(i)("Acc_RM_BillAmount").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_BIllNarration").ToString()) = False Then
                        dRow("Acc_RM_BIllNarration") = dtReceipt.Rows(i)("Acc_RM_BIllNarration").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_RM_ChequeNo").ToString()) = False Then
                        If dtReceipt.Rows(i)("Acc_RM_ChequeNo").ToString() <> "" Then
                            dRow("Acc_RM_ChequeNo") = dtReceipt.Rows(i)("Acc_RM_ChequeNo").ToString()
                        Else
                            dRow("Acc_RM_ChequeNo") = "NIL"
                        End If
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtReceipt.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtReceipt.Rows(i)("ATD_Credit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtReceipt.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtReceipt.Rows(i)("GLDescription").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("SubGLCode").ToString()) = False Then
                        dRow("SubGLCode") = dtReceipt.Rows(i)("SubGLCode").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("SubGLDescription").ToString()) = False Then
                        dRow("SubGLDescription") = dtReceipt.Rows(i)("SubGLDescription").ToString()
                    End If

                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadReceiptReportsDetailsTotal(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer, ByVal dPBillFromDate As String, ByVal dPBillToDate As String, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                              ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iReceiptVoucherType As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtReceipt As New DataTable
        Dim dRow As DataRow
        Try
            dt.Columns.Add("Srno")
            dt.Columns.Add("Glcount")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("SubGLDescription")


            sSql = "" : sSql = "Select count(c.gl_glCode) As Glcount,b.atd_gl,C.gl_glCode As GLCode, c.gl_Desc As GLDescription,"
            sSql = sSql & " sum(B.ATD_Debit) as ATD_Debit, sum(B.ATD_Credit) as ATD_Credit from acc_Receipt_Master A"
            sSql = sSql & " join Acc_Transactions_Details B On A.Acc_RM_ID = B.ATD_BillID And B.atd_trtype = 3 And A.Acc_RM_CompID = " & iCompID & " And A.Acc_RM_Status='A' And A.Acc_RM_YearID=" & iYearID & " "

            If sPBillNo <> "" Then
                sSql = sSql & " And A.Acc_RM_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & " and A.Acc_RM_ID =" & iVoucher & ""
            End If

            If iReceiptVoucherType > 0 Then
                sSql = sSql & " and A.Acc_RM_BillType =" & iReceiptVoucherType & ""
            End If

            If (dPBillFromDate <> "01/01/1900") And (dPBillToDate <> "01/01/1900") Then
                sSql = sSql & " and Acc_RM_InvoiceDate Between '" & dPBillFromDate & "' And '" & dPBillToDate & "'  "
            End If

            If iMonthID > 0 And iPartyID = 0 Then
                sSql = sSql & " And Month(A.Acc_RM_InvoiceDate)=" & iMonthID & " "
            ElseIf iMonthID = 0 And iPartyID > 0 Then
                sSql = sSql & " And A.Acc_RM_Party=" & iPartyID & " "
            ElseIf iMonthID > 0 And iPartyID > 0 Then
                sSql = sSql & " And Month(A.Acc_RM_InvoiceDate)=" & iMonthID & " And A.Acc_RM_Party=" & iPartyID & " "
            End If

            sSql = sSql & " join chart_of_Accounts C On B.atd_Gl = C.gl_id Left join chart_of_Accounts D On B.atd_SubGl = D.gl_id Where Acc_RM_CompID=" & iCompID & ""
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_RM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_RM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_RM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_RM_BranchID=" & iBranchID & ""
            End If
            sSql = sSql & " group by C.gl_glCode,c.gl_Desc,b.atd_gl order by C.gl_glCode"
            dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtReceipt.Rows.Count > 0 Then
                For i = 0 To dtReceipt.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("Srno") = i + 1
                    If IsDBNull(dtReceipt.Rows(i)("Glcount").ToString()) = False Then
                        dRow("Glcount") = dtReceipt.Rows(i)("Glcount")
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtReceipt.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtReceipt.Rows(i)("ATD_Credit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtReceipt.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtReceipt.Rows(i)("GLDescription").ToString()
                    End If

                    'If IsDBNull(dtReceipt.Rows(i)("SubGLCode").ToString()) = False Then
                    '    dRow("SubGLCode") = dtReceipt.Rows(i)("SubGLCode").ToString()
                    'End If

                    'If IsDBNull(dtReceipt.Rows(i)("SubGLDescription").ToString()) = False Then
                    '    dRow("SubGLDescription") = dtReceipt.Rows(i)("SubGLDescription").ToString()
                    'End If

                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPettyCashReportsDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer,
                                                ByVal iMonthID As Integer, ByVal iParty As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtReceipt As New DataTable
        Dim dRow As DataRow
        Try
            dt.Columns.Add("Srno")
            dt.Columns.Add("Acc_PCM_TransactionNo")
            dt.Columns.Add("Acc_PCM_party")
            dt.Columns.Add("Acc_PCM_BillType")
            dt.Columns.Add("Acc_PCM_BillNo")
            dt.Columns.Add("Acc_PCM_BillDate")
            dt.Columns.Add("Acc_PCM_BillAmount")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("SubGLDescription")
            dt.Columns.Add("Acc_PCM_Narration")

            'sSql = "" : sSql = "Select A.Acc_PCM_ID, A.Acc_PCM_TransactionNo,A.Acc_PCM_party,A.Acc_PCM_Location,A.Acc_PCM_BillType,A.Acc_PCM_BillNo,A.Acc_PCM_BillDate,A.Acc_PCM_BillAmount,"
            'sSql = sSql & "A.Acc_PCM_PaymentNarration,"
            'sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode As GLCode, c.gl_Desc As GLDescription,"
            'sSql = sSql & "D.gl_glCode As SubGLCode, c.gl_Desc As SubGLDescription "
            'sSql = sSql & "from acc_pettycash_master A join Acc_Transactions_Details B On A.Acc_PCM_ID = B.ATD_BillID And B.atd_trtype = 2 And A.Acc_PCM_CompID = " & iCompID & " "
            'If sPBillNo <> "" Then
            '    sSql = sSql & " And A.Acc_PCM_BillNo ='" & sPBillNo & "'"
            'End If
            'If iVoucher > 0 Then
            '    sSql = sSql & "and A.Acc_PCM_ID =" & iVoucher & ""
            'End If

            'If dPBillFromDate <> "01/01/1900" Then
            '    sSql = sSql & " and ATD_TransactionDate between  '" & dPBillFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dPBillToDate & "'))"
            'End If
            'sSql = sSql & "join chart_of_Accounts C On B.atd_Gl = C.gl_id  join chart_of_Accounts D On B.atd_SubGl = D.gl_id  order by a.Acc_PCM_ID"

            sSql = "" : sSql = "Select A.Acc_PCM_ID, A.Acc_PCM_TransactionNo,A.Acc_PCM_party,A.Acc_PCM_Location,A.Acc_PCM_BillType,A.Acc_PCM_BillNo,A.Acc_PCM_InvoiceDate,A.Acc_PCM_BillAmount,"
            sSql = sSql & "A.Acc_PCM_PaymentNarration,"
            sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode as GLCode, c.gl_Desc as GLDescription"
            sSql = sSql & " from acc_pettycash_master A join Acc_Transactions_Details B on A.Acc_PCM_ID = B.ATD_BillID and B.atd_trtype = 2 and A.Acc_PCM_Status='A' And A.Acc_PCM_CompID = " & iCompID & " "
            If sPBillNo <> "" Then
                sSql = sSql & " and A.Acc_PCM_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & "and A.Acc_PCM_ID =" & iVoucher & ""
            End If

            'If dPBillFromDate <> "01/01/1900" Then
            '    sSql = sSql & " and ATD_TransactionDate between  '" & dPBillFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dPBillToDate & "'))"
            'End If

            If iMonthID > 0 And iParty = 0 Then
                sSql = sSql & " and Month(A.Acc_PCM_InvoiceDate) =" & iMonthID & ""
            ElseIf iMonthID = 0 And iParty > 0 Then
                sSql = sSql & " and A.Acc_PCM_Party =" & iParty & ""
            ElseIf iMonthID > 0 And iParty > 0 Then
                sSql = sSql & " and Month(A.Acc_PCM_InvoiceDate) =" & iMonthID & " and A.Acc_PCM_Party =" & iParty & " "
            End If

            sSql = sSql & " join chart_of_Accounts C On B.atd_Gl = C.gl_id Where A.Acc_PCM_CompID=" & iCompID & ""
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_PCM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_PCM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_PCM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_PCM_BranchID=" & iBranchID & ""
            End If
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and A.Acc_PCM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            sSql = sSql & " order by A.Acc_PCM_ID"
            dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtReceipt.Rows.Count > 0 Then
                For i = 0 To dtReceipt.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("Srno") = i + 1
                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_TransactionNo").ToString()) = False Then
                        dRow("Acc_PCM_TransactionNo") = dtReceipt.Rows(i)("Acc_PCM_TransactionNo")
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_InvoiceDate").ToString()) = False Then
                        dRow("Acc_PCM_BillDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(i)("Acc_PCM_InvoiceDate").ToString(), "D")
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_Location").ToString()) = False Then
                        If dtReceipt.Rows(i)("Acc_PCM_Location").ToString() = "1" Then
                            dRow("Acc_PCM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select BM_Name + ' - ' + BM_Code as Name from sales_Buyers_Masters where BM_ID=" & dtReceipt.Rows(i)("Acc_PCM_party") & " and  BM_Delflag='A' and BM_CompID =" & iCompID & "")
                        ElseIf dtReceipt.Rows(i)("Acc_PCM_Location").ToString() = "2" Then
                            dRow("Acc_PCM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select CSM_Name + ' - ' + CSM_Code as Name from CustomerSupplierMaster where CSM_ID=" & dtReceipt.Rows(i)("Acc_PCM_party") & " and  CSM_Delflag='A' and CSM_CompID =" & iCompID & "")
                        ElseIf dtReceipt.Rows(i)("Acc_PCM_Location").ToString() = "3" Then
                            dRow("Acc_PCM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_Desc from chart_of_Accounts where gl_ID=" & dtReceipt.Rows(i)("Acc_PCM_party") & " and  gl_Status='A' and gl_CompID =" & iCompID & "")
                        End If
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_BillType").ToString()) = False Then
                        dRow("Acc_PCM_BillType") = objDB.SQLExecuteScalar(sNameSpace, "Select Mas_Desc from acc_General_Master where Mas_ID=" & dtReceipt.Rows(i)("Acc_PCM_BillType") & " and  Mas_Status='A' and Mas_CompID =" & iCompID & "")
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_BillNo").ToString()) = False Then
                        dRow("Acc_PCM_BillNo") = dtReceipt.Rows(i)("Acc_PCM_BillNo").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_BillAmount").ToString()) = False Then
                        dRow("Acc_PCM_BillAmount") = dtReceipt.Rows(i)("Acc_PCM_BillAmount").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtReceipt.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtReceipt.Rows(i)("ATD_Credit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtReceipt.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtReceipt.Rows(i)("GLDescription").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                        If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                            dRow("SubGLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_glCode From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                        Else
                            dRow("SubGLCode") = ""
                        End If
                    Else
                        dRow("SubGLCode") = ""
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                        If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                            dRow("SubGLDescription") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                        Else
                            dRow("SubGLDescription") = ""
                        End If
                    Else
                        dRow("SubGLDescription") = ""
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("Acc_PCM_PaymentNarration").ToString()) = False Then
                        dRow("Acc_PCM_Narration") = dtReceipt.Rows(i)("Acc_PCM_PaymentNarration").ToString()
                    End If

                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPettyCashReportsDetailsTotal(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer,
                                                ByVal iMonthID As Integer, ByVal iParty As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtReceipt As New DataTable
        Dim dRow As DataRow
        Try
            dt.Columns.Add("Srno")
            dt.Columns.Add("Glcount")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            'dt.Columns.Add("SubGLCode")
            'dt.Columns.Add("SubGLDescription")

            'sSql = "" : sSql = "Select A.Acc_PCM_ID, A.Acc_PCM_TransactionNo,A.Acc_PCM_party,A.Acc_PCM_Location,A.Acc_PCM_BillType,A.Acc_PCM_BillNo,A.Acc_PCM_BillDate,A.Acc_PCM_BillAmount,"
            'sSql = sSql & "A.Acc_PCM_PaymentNarration,"
            'sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode as GLCode, c.gl_Desc as GLDescription,"
            'sSql = sSql & "D.gl_glCode as SubGLCode, c.gl_Desc as SubGLDescription "
            'sSql = sSql & "from acc_pettycash_master A join Acc_Transactions_Details B on A.Acc_PCM_ID = B.ATD_BillID and B.atd_trtype = 2 and A.Acc_PCM_CompID = " & iCompID & " "
            'If sPBillNo <> "" Then
            '    sSql = sSql & " and A.Acc_PCM_BillNo ='" & sPBillNo & "'"
            'End If
            'If iVoucher > 0 Then
            '    sSql = sSql & "and A.Acc_PCM_ID =" & iVoucher & ""
            'End If

            'If dPBillFromDate <> "01/01/1900" Then
            '    sSql = sSql & " and ATD_TransactionDate between  '" & dPBillFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dPBillToDate & "'))"
            'End If
            'sSql = sSql & "join chart_of_Accounts C On B.atd_Gl = C.gl_id  join chart_of_Accounts D On B.atd_SubGl = D.gl_id  order by a.Acc_PCM_ID"

            sSql = "" : sSql = "Select count (c.gl_glCode) as Glcount,c.gl_Desc,c.gl_glCode,C.gl_glCode as GLCode, c.gl_Desc as GLDescription,sum(B.ATD_Debit) as ATD_Debit,sum(B.ATD_Credit) as ATD_Credit from acc_pettycash_master A"
            sSql = sSql & " join Acc_Transactions_Details B on A.Acc_PCM_ID = B.ATD_BillID and B.atd_trtype = 2 and A.Acc_PCM_Status='A' And A.Acc_PCM_CompID = " & iCompID & " "
            If sPBillNo <> "" Then
                sSql = sSql & " and A.Acc_PCM_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & "and A.Acc_PCM_ID =" & iVoucher & ""
            End If

            'If dPBillFromDate <> "01/01/1900" Then
            '    sSql = sSql & " and ATD_TransactionDate between  '" & dPBillFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dPBillToDate & "'))"
            'End If

            If iMonthID > 0 And iParty = 0 Then
                sSql = sSql & " and Month(A.Acc_PCM_InvoiceDate) =" & iMonthID & ""
            ElseIf iMonthID = 0 And iParty > 0 Then
                sSql = sSql & " and A.Acc_PCM_Party =" & iParty & ""
            ElseIf iMonthID > 0 And iParty > 0 Then
                sSql = sSql & " and Month(A.Acc_PCM_InvoiceDate) =" & iMonthID & " and A.Acc_PCM_Party =" & iParty & " "
            End If

            sSql = sSql & " join chart_of_Accounts C On B.atd_Gl = C.gl_id Where A.Acc_PCM_CompID=" & iCompID & ""
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_PCM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_PCM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_PCM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_PCM_BranchID=" & iBranchID & ""
            End If
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and A.Acc_PCM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            sSql = sSql & " group by C.gl_glCode, c.gl_Desc order by gl_glCode"
            dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtReceipt.Rows.Count > 0 Then
                For i = 0 To dtReceipt.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("Srno") = i + 1
                    If IsDBNull(dtReceipt.Rows(i)("Glcount").ToString()) = False Then
                        dRow("Glcount") = dtReceipt.Rows(i)("Glcount")
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtReceipt.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtReceipt.Rows(i)("ATD_Credit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtReceipt.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtReceipt.Rows(i)("GLDescription").ToString()
                    End If

                    'If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                    '    If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                    '        dRow("SubGLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_glCode From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                    '    Else
                    '        dRow("SubGLCode") = ""
                    '    End If
                    'Else
                    '    dRow("SubGLCode") = ""
                    'End If

                    'If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                    '    If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                    '        dRow("SubGLDescription") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                    '    Else
                    '        dRow("SubGLDescription") = ""
                    '    End If
                    'Else
                    '    dRow("SubGLDescription") = ""
                    'End If
                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadJEReportsDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer, ByVal dPBillFromDate As String,
                                         ByVal dPBillToDate As String, ByVal iMonthID As Integer, ByVal iParty As Integer,
                                         ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iCustPartyType As Integer) As DataTable
        Dim sSql As String = "", ssql1 As String = ""
        Dim dt As New DataTable, dtReceipt As New DataTable
        Dim dRow As DataRow
        Dim Jebilldate As String, Jebilldate1 As String = ""
        Dim ds As DataSet
        Dim sBillno As String = ""
        Try
            dt.Columns.Add("Srno")
            dt.Columns.Add("Acc_JE_TransactionNo")
            dt.Columns.Add("Acc_JE_party")
            dt.Columns.Add("Acc_JE_BillType")
            dt.Columns.Add("Acc_JE_BillNo")
            dt.Columns.Add("Acc_JE_PaymentNarration")
            dt.Columns.Add("Acc_JE_InvoiceDate")
            dt.Columns.Add("Acc_JE_BillDate")
            dt.Columns.Add("Acc_JE_BillAmount")
            dt.Columns.Add("Acc_JE_ChequeNo")
            dt.Columns.Add("Acc_JE_ChequeDate")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("SubGLDescription")
            'sSql = "" : sSql = "Select A.Acc_JE_ID, A.Acc_JE_TransactionNo, A.Acc_JE_party, A.Acc_JE_Location, A.Acc_JE_BillType, A.Acc_JE_BillNo, A.Acc_JE_BillDate, "
            'sSql = sSql & " A.Acc_JE_BillAmount, A.Acc_JE_PaymentNarration, A.Acc_JE_ChequeNo, convert(char(10),A.Acc_JE_ChequeDate,103) Acc_JE_ChequeDate,"
            'sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode as GLCode, c.gl_Desc as GLDescription,"
            'sSql = sSql & "D.gl_glCode as SubGLCode, c.gl_Desc as SubGLDescription "
            'sSql = sSql & "from acc_je_master A join Acc_Transactions_Details B on A.Acc_JE_ID = B.ATD_BillID and B.atd_trtype = 4 and A.Acc_JE_CompID = " & iCompID & " "
            'If sPBillNo <> "" Then
            '    sSql = sSql & " and A.Acc_JE_BillNo ='" & sPBillNo & "'"
            'End If
            'If iVoucher > 0 Then
            '    sSql = sSql & "and A.Acc_JE_ID =" & iVoucher & ""
            'End If
            'If dPBillFromDate <> "01/01/1900" Then
            '    sSql = sSql & " and ATD_TransactionDate between  '" & dPBillFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dPBillToDate & "'))"
            'End If
            'sSql = sSql & "join chart_of_Accounts C On B.atd_Gl = C.gl_id  join chart_of_Accounts D On B.atd_SubGl = D.gl_id  order by a.Acc_JE_ID"
            sSql = "" : sSql = "Select A.Acc_JE_ID, A.Acc_JE_TransactionNo, A.Acc_JE_party, A.Acc_JE_Location, A.Acc_JE_BillType, A.Acc_JE_BillNo, A.Acc_JE_InvoiceDate,A.Acc_JE_BillDate,"
            sSql = sSql & " A.Acc_JE_BillAmount, A.Acc_JE_AdvanceNaration as Acc_JE_AdvanceNaration, A.Acc_JE_ChequeNo, convert(char(10),A.Acc_JE_ChequeDate,103) Acc_JE_ChequeDate,"
            sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode as GLCode, c.gl_Desc as GLDescription"
            sSql = sSql & " from acc_je_master A join Acc_Transactions_Details B on A.Acc_JE_ID = B.ATD_BillID and B.atd_trtype = 4 and A.Acc_JE_Status='A' And A.Acc_JE_CompID = " & iCompID & " "
            If sPBillNo <> "" Then
                sSql = sSql & " and A.Acc_JE_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & "and A.Acc_JE_ID =" & iVoucher & ""
            End If
            If (dPBillFromDate <> "01/01/1900") And (dPBillFromDate <> "01-01-1900") Then
                sSql = sSql & " and Acc_JE_InvoiceDate Between '" & dPBillFromDate & "' And '" & dPBillToDate & "'  "
            End If
            If iMonthID > 0 And iParty = 0 Then
                sSql = sSql & " and Month(A.Acc_JE_InvoiceDate) =" & iMonthID & ""
            ElseIf iMonthID = 0 And iParty > 0 Then
                sSql = sSql & " and A.Acc_JE_Party =" & iParty & ""
            ElseIf iMonthID > 0 And iParty > 0 Then
                sSql = sSql & " and Month(A.Acc_JE_InvoiceDate) =" & iMonthID & " and A.Acc_JE_Party =" & iParty & " "
            End If
            sSql = sSql & "join chart_of_Accounts C On B.atd_Gl = C.gl_id Where A.Acc_JE_CompID = " & iCompID & " "
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_JE_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_JE_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_JE_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_JE_BranchID=" & iBranchID & ""
            End If
            If iCustPartyType > 0 Then
                sSql = sSql & " and A.ACC_JE_Location=" & iCustPartyType & ""
            End If
            sSql = sSql & " order by a.Acc_JE_ID"
            dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtReceipt.Rows.Count > 0 Then
                For i = 0 To dtReceipt.Rows.Count - 1
                    Jebilldate = ""
                    Jebilldate1 = ""
                    If sBillno = "" Then
                    Else
                        If sBillno <> dtReceipt.Rows(i)("Acc_JE_TransactionNo") Then
                            dRow = dt.NewRow()
                            dt.Rows.Add(dRow)
                        Else
                        End If
                    End If
                    dRow = dt.NewRow()
                    dRow("Srno") = i + 1
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_TransactionNo").ToString()) = False Then
                        dRow("Acc_JE_TransactionNo") = dtReceipt.Rows(i)("Acc_JE_TransactionNo")
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_InvoiceDate").ToString()) = False Then
                        dRow("Acc_JE_InvoiceDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(i)("Acc_JE_InvoiceDate").ToString(), "D")
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_Location").ToString()) = False Then
                        If dtReceipt.Rows(i)("Acc_JE_Location").ToString() = "1" Then
                            dRow("Acc_JE_party") = objDB.SQLExecuteScalar(sNameSpace, "Select BM_Name + ' - ' + BM_Code as Name from sales_Buyers_Masters where BM_ID=" & dtReceipt.Rows(i)("Acc_JE_party") & " and  BM_Delflag='A' and BM_CompID =" & iCompID & "")
                        ElseIf dtReceipt.Rows(i)("Acc_JE_Location").ToString() = "2" Then
                            dRow("Acc_JE_party") = objDB.SQLExecuteScalar(sNameSpace, "Select CSM_Name + ' - ' + CSM_Code as Name from CustomerSupplierMaster where CSM_ID=" & dtReceipt.Rows(i)("Acc_JE_party") & " and  CSM_Delflag='A' and CSM_CompID =" & iCompID & "")
                        ElseIf dtReceipt.Rows(i)("Acc_JE_Location").ToString() = "3" Then
                            dRow("Acc_JE_party") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_Desc from chart_of_Accounts where gl_ID=" & dtReceipt.Rows(i)("Acc_JE_party") & " and  gl_Status='A' and gl_CompID =" & iCompID & " ")
                        End If
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_BillType").ToString()) = False Then
                        dRow("Acc_JE_BillType") = objDB.SQLExecuteScalar(sNameSpace, "Select Mas_Desc from acc_General_Master where Mas_ID=" & dtReceipt.Rows(i)("Acc_JE_BillType") & " and  Mas_Status='A' and Mas_CompID =" & iCompID & "")
                    End If
                    ssql1 = "select * from Acc_JE_Master_Details where AJE_MasterID=" & dtReceipt.Rows(i)("Acc_JE_ID") & ""
                    ds = objDB.SQLExecuteDataSet(sNameSpace, ssql1)
                    'If IsDBNull(dtReceipt.Rows(i)("Acc_JE_BillNo").ToString()) = False Then
                    '    dRow("Acc_JE_BillNo") = dtReceipt.Rows(i)("Acc_JE_BillNo").ToString() & " - " & dtReceipt.Rows(i)("Acc_JE_BillDate")
                    'End If
                    If ds.Tables(0).Rows.Count > 0 Then
                        If IsDBNull(ds.Tables(0).Rows(0)("AJE_BillNo").ToString()) = False Then ' If IsDBNull(ds.Tables(0).Rows(i)("AJE_BillNo").ToString()) = False Then (Commented on 10/07/2020 row value i to 0)
                            'dRow("Acc_JE_BillNo") = ds.Tables(0).Rows(0)("AJE_BillNo").ToString() & " - " & objGen.FormatDtForRDBMS(ds.Tables(0).Rows(0)("AJE_BillDate").ToString(), "D")
                            dRow("Acc_JE_BillNo") = ds.Tables(0).Rows(0)("AJE_BillNo").ToString()
                            Jebilldate = dRow("Acc_JE_BillNo")
                            If Jebilldate1 = "" Then
                                Jebilldate1 = Jebilldate
                            Else
                                Jebilldate1 = Jebilldate1 & "," & Jebilldate
                            End If
                            dRow("Acc_JE_BillNo") = Jebilldate1
                        End If
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_AdvanceNaration").ToString()) = False Then
                        dRow("Acc_JE_PaymentNarration") = dtReceipt.Rows(i)("Acc_JE_AdvanceNaration").ToString
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_BillAmount").ToString()) = False Then
                        dRow("Acc_JE_BillAmount") = dtReceipt.Rows(i)("Acc_JE_BillAmount").ToString()
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("Acc_JE_ChequeNo").ToString()) = False Then
                        If dtReceipt.Rows(i)("Acc_JE_ChequeNo").ToString() <> "" Then
                            dRow("Acc_JE_ChequeNo") = dtReceipt.Rows(i)("Acc_JE_ChequeNo").ToString() & " - " & objGen.FormatDtForRDBMS(dtReceipt.Rows(i)("Acc_JE_ChequeDate").ToString(), "D")
                        Else
                            dRow("Acc_JE_ChequeNo") = "NIL"
                        End If
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtReceipt.Rows(i)("ATD_Debit").ToString()
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtReceipt.Rows(i)("ATD_Credit").ToString()
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtReceipt.Rows(i)("GLCode").ToString()
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtReceipt.Rows(i)("GLDescription").ToString()
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                        If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                            dRow("SubGLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_glCode From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                        Else
                            dRow("SubGLCode") = ""
                        End If
                    Else
                        dRow("SubGLCode") = ""
                    End If
                    If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                        If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                            dRow("SubGLDescription") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                        Else
                            dRow("SubGLDescription") = ""
                        End If
                    Else
                        dRow("SubGLDescription") = ""
                    End If
                    dt.Rows.Add(dRow)
                    sBillno = dRow("Acc_JE_TransactionNo")
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function


    Public Function LoadJEReportsDetailsTotal(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer, ByVal dPBillFromDate As String,
                                         ByVal dPBillToDate As String, ByVal iMonthID As Integer, ByVal iParty As Integer,
                                         ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iCustPartyType As Integer) As DataTable
        Dim sSql As String = "", ssql1 As String = ""
        Dim dt As New DataTable, dtReceipt As New DataTable
        Dim dRow As DataRow
        Dim Jebilldate As String, Jebilldate1 As String = ""
        Dim ds As DataSet
        Try

            dt.Columns.Add("Srno")
            dt.Columns.Add("Glcount")
            dt.Columns.Add("Acc_JE_InvoiceDate")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            'dt.Columns.Add("SubGLCode")
            'dt.Columns.Add("SubGLDescription")


            'sSql = "" : sSql = "Select A.Acc_JE_ID, A.Acc_JE_TransactionNo, A.Acc_JE_party, A.Acc_JE_Location, A.Acc_JE_BillType, A.Acc_JE_BillNo, A.Acc_JE_BillDate, "
            'sSql = sSql & " A.Acc_JE_BillAmount, A.Acc_JE_PaymentNarration, A.Acc_JE_ChequeNo, convert(char(10),A.Acc_JE_ChequeDate,103) Acc_JE_ChequeDate,"
            'sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode as GLCode, c.gl_Desc as GLDescription,"
            'sSql = sSql & "D.gl_glCode as SubGLCode, c.gl_Desc as SubGLDescription "
            'sSql = sSql & "from acc_je_master A join Acc_Transactions_Details B on A.Acc_JE_ID = B.ATD_BillID and B.atd_trtype = 4 and A.Acc_JE_CompID = " & iCompID & " "
            'If sPBillNo <> "" Then
            '    sSql = sSql & " and A.Acc_JE_BillNo ='" & sPBillNo & "'"
            'End If
            'If iVoucher > 0 Then
            '    sSql = sSql & "and A.Acc_JE_ID =" & iVoucher & ""
            'End If

            'If dPBillFromDate <> "01/01/1900" Then
            '    sSql = sSql & " and ATD_TransactionDate between  '" & dPBillFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dPBillToDate & "'))"
            'End If
            'sSql = sSql & "join chart_of_Accounts C On B.atd_Gl = C.gl_id  join chart_of_Accounts D On B.atd_SubGl = D.gl_id  order by a.Acc_JE_ID"

            sSql = "" : sSql = "Select count(c.gl_glCode) as GLcount,sum(B.ATD_Debit) as ATD_Debit, sum(B.ATD_Credit) as ATD_Credit,C.gl_glCode as GLCode,"
            sSql = sSql & " c.gl_Desc as GLDescription from acc_je_master A "
            sSql = sSql & " join Acc_Transactions_Details B on A.Acc_JE_ID = B.ATD_BillID and B.atd_trtype = 4 and A.Acc_JE_Status='A' And A.Acc_JE_CompID = " & iCompID & " "
            If sPBillNo <> "" Then
                sSql = sSql & " and A.Acc_JE_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & "and A.Acc_JE_ID =" & iVoucher & ""
            End If
            If (dPBillFromDate <> "01/01/1900") And (dPBillFromDate <> "01-01-1900") Then
                sSql = sSql & " and Acc_JE_InvoiceDate Between '" & dPBillFromDate & "' And '" & dPBillToDate & "'  "
            End If


            If iMonthID > 0 And iParty = 0 Then
                sSql = sSql & " and Month(A.Acc_JE_InvoiceDate) =" & iMonthID & ""
            ElseIf iMonthID = 0 And iParty > 0 Then
                sSql = sSql & " and A.Acc_JE_Party =" & iParty & ""
            ElseIf iMonthID > 0 And iParty > 0 Then
                sSql = sSql & " and Month(A.Acc_JE_InvoiceDate) =" & iMonthID & " and A.Acc_JE_Party =" & iParty & " "
            End If
            sSql = sSql & "join chart_of_Accounts C On B.atd_Gl = C.gl_id Where A.Acc_JE_CompID = " & iCompID & " "
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_JE_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_JE_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_JE_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_JE_BranchID=" & iBranchID & ""
            End If
            If iCustPartyType > 0 Then
                sSql = sSql & " and A.ACC_JE_Location=" & iCustPartyType & ""
            End If
            sSql = sSql & " group by c.gl_glCode,c.gl_Desc order by c.gl_glCode"
            dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)



            If dtReceipt.Rows.Count > 0 Then
                For i = 0 To dtReceipt.Rows.Count - 1
                    Jebilldate = ""
                    Jebilldate1 = ""
                    dRow = dt.NewRow()
                    dRow("Srno") = i + 1
                    If IsDBNull(dtReceipt.Rows(i)("GLcount").ToString()) = False Then
                        dRow("GLcount") = dtReceipt.Rows(i)("GLcount")
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtReceipt.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtReceipt.Rows(i)("ATD_Credit").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtReceipt.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtReceipt.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtReceipt.Rows(i)("GLDescription").ToString()
                    End If

                    'If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                    '    If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                    '        dRow("SubGLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_glCode From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                    '    Else
                    '        dRow("SubGLCode") = ""
                    '    End If
                    'Else
                    '    dRow("SubGLCode") = ""
                    'End If

                    'If IsDBNull(dtReceipt.Rows(i)("ATD_SubGL").ToString()) = False Then
                    '    If dtReceipt.Rows(i)("ATD_SubGL") > 0 Then
                    '        dRow("SubGLDescription") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_ID=" & dtReceipt.Rows(i)("ATD_SubGL") & " ")
                    '    Else
                    '        dRow("SubGLDescription") = ""
                    '    End If
                    'Else
                    '    dRow("SubGLDescription") = ""
                    'End If

                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPettyCashBillNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_PCM_ID,Acc_PCM_BillNo from acc_pettycash_master where Acc_PCM_Status ='A' and Acc_PCM_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPettyCashVoucherNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_PCM_ID,Acc_PCM_TransactionNo from acc_pettycash_master where Acc_PCM_Status ='A' and Acc_PCM_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadJEBillNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_JE_ID,Acc_JE_BillNo from acc_je_master where Acc_JE_Status ='A' and Acc_JE_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadJEVoucherNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_JE_ID,Acc_JE_TransactionNo from acc_je_master where Acc_JE_Status ='A' and Acc_JE_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadScheduleReport(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
                                       ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)
        Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
        Dim dRow As DataRow
        Dim dt As New DataTable
        Dim dtGroup As New DataTable
        Dim dtSub As New DataTable
        Dim dtFA As New DataTable
        Dim dtLink As New DataTable
        Dim dtArray As New DataTable
        Dim dr As OleDb.OleDbDataReader
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0, a As Integer = 0, m As Integer = 0
        Dim sArray As Array
        Dim dDebit As Double = 0.00
        Dim dCredit As Double = 0.00

        Dim dLDebit As Double = 0.00
        Dim dLCredit As Double = 0.00

        Dim dTotalDebit As Double = 0.00
        Dim dTotalCredit As Double = 0.00

        Dim dTotalLDebit As Double = 0.00
        Dim dTotalLCredit As Double = 0.00

        Dim iHead As Integer = 0
        Dim iSLNo As Integer = 0
        Dim iLastYear As Integer = 0
        Dim iStatusCheck As Integer = 0


        Dim sLiPresentYear As String = "" : Dim sLiLastYear As String = ""
        Dim sAssetPresentYear As String = "" : Dim sAssetLastYear As String = ""
        Dim sInPresentYear As String = "" : Dim sInLastYear As String = ""
        Dim sExPresentYear As String = "" : Dim sExLastYear As String = ""

        Dim sLiTotalCurrentDebit As String = "" : Dim sLiTotalLastYearDebit As String = ""
        Dim sAssetTotalCurrentDebit As String = "" : Dim sAssetTotalLastYearDebit As String = ""
        Dim sInTotalCurrentDebit As String = "" : Dim sInTotalLastYearDebit As String = ""
        Dim sExTotalCurrentDebit As String = "" : Dim sExTotalLastYearDebit As String = ""
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("SLNo")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("NoteNo")
            dt.Columns.Add("PresentYear")
            dt.Columns.Add("LastYear")
            dt.Columns.Add("PCrDr")
            dt.Columns.Add("LCrDr")

            'Liabilites

            sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
            sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                iLastYear = dr("YMS_ID")
            Else
                iLastYear = 0
            End If

            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_yearID =" & iYearID & ""
            If iZoneID > 0 Then
                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
            End If
            dr = objDB.SQLDataReader(sNameSpace, iSql)
            If dr.HasRows = True Then
                dr.Read()
                If dr("Opn_Status") = "F" Then
                    iStatusCheck = 0
                Else
                    iStatusCheck = 1
                End If
            Else
                iStatusCheck = 1
            End If

            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 4 and gl_Delflag ='C' and gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "EQUITY AND LIABILITIES" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " and gl_CompID =" & iCOmpID & " and gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            dDebit = 0 : dCredit = 0

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head = 4 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            If iStatusCheck = 0 Then
                                                iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If
                                            Else
                                                iSql = "" : iSql = "Select * from acc_Transactions_Details " 'Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                iSql = iSql & " where ATD_YearID =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                        End If
                                                    Next
                                                End If

                                                iSql = "" : iSql = "Select gl_head,opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id "
                                                iSql = iSql & " where opn_YearID =" & iYearID & " and opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and opn_Status='A'"
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_Debitamt").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If


                                            End If
                                        End If
                                    Next

                                    If (dDebit <> 0) And (dCredit <> 0) Then
                                        'dRow("PresentYear") = dCredit - dDebit
                                        sLiPresentYear = dCredit - dDebit
                                    ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                        'dRow("PresentYear") = dDebit
                                        sLiPresentYear = dCredit - dDebit
                                    ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                        'dRow("PresentYear") = dCredit
                                        sLiPresentYear = dCredit
                                    ElseIf (dDebit = 0) And (dCredit = 0) Then
                                        'dRow("PresentYear") = "0.00"
                                        sLiPresentYear = "0.00"
                                    End If

                                    If sLiPresentYear.StartsWith("-") = True Then
                                        sLiPresentYear = sLiPresentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - sLiPresentYear
                                        dRow("PCrDr") = "Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + sLiPresentYear
                                        If sLiPresentYear = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = "Cr"
                                        End If
                                    End If
                                    dRow("PresentYear") = sLiPresentYear


                                    dDebit = 0 : dCredit = 0
                                End If


                                'Last Year

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id  where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If dtArray.Rows(a)("gl_head") = 2 Then
                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                        End If
                                                    End If
                                                Next
                                            End If
                                        End If
                                    Next

                                    If (dLDebit <> 0) And (dLCredit <> 0) Then
                                        'dRow("LastYear") = dLCredit - dLDebit
                                        sLiLastYear = dLCredit - dLDebit
                                    ElseIf (dLDebit <> 0) And (dLCredit = 0) Then
                                        'dRow("LastYear") = dLDebit
                                        sLiLastYear = dLCredit - dLDebit
                                    ElseIf (dLCredit <> 0) And (dLDebit = 0) Then
                                        'dRow("LastYear") = dLCredit
                                        sLiLastYear = dLCredit
                                    ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                        'dRow("LastYear") = "0.00"
                                        sLiLastYear = "0.00"
                                    End If

                                    If sLiLastYear.StartsWith("-") = True Then
                                        sLiLastYear = sLiLastYear.Remove(0, 1)
                                        dTotalLDebit = dTotalLDebit - sLiLastYear
                                        dRow("LCrDr") = "Dr"
                                    Else
                                        dTotalLDebit = dTotalLDebit + sLiLastYear
                                        If sLiLastYear = "0.00" Then
                                            dRow("LCrDr") = ""
                                        Else
                                            dRow("LCrDr") = "Cr"
                                        End If
                                    End If
                                    dRow("LastYear") = sLiLastYear


                                    dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                End If
                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                'dRow("PresentYear") = dTotalDebit 'dTotalCredit - dTotalDebit
                'dRow("LastYear") = dTotalLDebit 'dTotalLCredit - dTotalLDebit

                sLiTotalCurrentDebit = dTotalDebit
                If sLiTotalCurrentDebit.StartsWith("-") = True Then
                    sLiTotalCurrentDebit = sLiTotalCurrentDebit.Remove(0, 1)
                    dRow("PCrDr") = "Dr"
                Else
                    sLiTotalCurrentDebit = sLiTotalCurrentDebit
                    If sLiTotalCurrentDebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = "Cr"
                    End If
                End If
                dRow("PresentYear") = sLiTotalCurrentDebit

                sLiTotalLastYearDebit = dTotalLDebit
                If sLiTotalLastYearDebit.StartsWith("-") = True Then
                    sLiTotalLastYearDebit = sLiTotalLastYearDebit.Remove(0, 1)
                    dRow("LCrDr") = "Dr"
                Else
                    sLiTotalLastYearDebit = sLiTotalLastYearDebit
                    If sLiTotalLastYearDebit = "0" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = "Cr"
                    End If

                End If
                dRow("LastYear") = sLiTotalLastYearDebit

                dt.Rows.Add(dRow)
            End If


            'Assets
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 1 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "ASSETS" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_Delflag ='C' and "
                    aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & "  order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            dDebit = 0 : dCredit = 0

                            If dtSub.Rows(j)("gl_Desc").ToString() = "Fixed Assets" Then
                                aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtSub.Rows(j)("gl_ID") & " and gl_Delflag ='C' and "
                                aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & "  order by gl_id"
                                dtFA = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                ' If dtFA.Rows.Count > 0 Then
                                'For m = 0 To dtFA.Rows.Count - 1
                                'dt.Rows.Add(dRow)
                                '        dRow = dt.NewRow()

                                'If IsDBNull(dtFA.Rows(m)("gl_Desc").ToString()) = False Then
                                '    dRow("Particulars") = dtFA.Rows(m)("gl_Desc")
                                'End If

                                mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                                mSql = mSql & "SLM_SUbGroupID =" & dtFA.Rows(m)("gl_Parent") & " and SLM_CompID =" & iCOmpID & ""
                                dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                                If dtLink.Rows.Count > 0 Then
                                    If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                        dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                    End If

                                    sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                    If sArray.Length - 1 Then
                                        For k = 0 To sArray.Length - 1
                                            If sArray(k) <> "" Then
                                                If iStatusCheck = 0 Then
                                                    iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
                                                    iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                        iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                    End If
                                                    If iZoneID > 0 Then
                                                        iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                    End If
                                                    If iRegionID > 0 Then
                                                        iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                    End If
                                                    If iAreaID > 0 Then
                                                        iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                    End If
                                                    If iBranchID > 0 Then
                                                        iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                    End If
                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                    If dtArray.Rows.Count > 0 Then
                                                        For a = 0 To dtArray.Rows.Count - 1
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                End If

                                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                End If
                                                            End If
                                                        Next
                                                    End If
                                                Else
                                                    iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                    iSql = iSql & " where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                        iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                    End If
                                                    If iZoneID > 0 Then
                                                        iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                    End If
                                                    If iRegionID > 0 Then
                                                        iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                    End If
                                                    If iAreaID > 0 Then
                                                        iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                    End If
                                                    If iBranchID > 0 Then
                                                        iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                    End If
                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                    If dtArray.Rows.Count > 0 Then
                                                        For a = 0 To dtArray.Rows.Count - 1
                                                            If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                            End If
                                                        Next

                                                    End If

                                                    iSql = "" : iSql = "Select gl_head,opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id"
                                                    iSql = iSql & " where opn_YearId =" & iYearID & " and opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and opn_Status='A'"
                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                        iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                    End If
                                                    If iZoneID > 0 Then
                                                        iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                    End If
                                                    If iRegionID > 0 Then
                                                        iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                    End If
                                                    If iAreaID > 0 Then
                                                        iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                    End If
                                                    If iBranchID > 0 Then
                                                        iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                    End If
                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                    If dtArray.Rows.Count > 0 Then
                                                        For a = 0 To dtArray.Rows.Count - 1
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                                End If

                                                                If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                End If
                                                            End If
                                                        Next

                                                    End If


                                                End If

                                            End If
                                        Next


                                        If (dDebit <> 0) And (dCredit <> 0) Then
                                            'dRow("PresentYear") = dCredit - dDebit
                                            sAssetPresentYear = dCredit - dDebit
                                        ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                            'dRow("PresentYear") = dDebit
                                            sAssetPresentYear = dCredit - dDebit
                                        ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                            'dRow("PresentYear") = dCredit
                                            sAssetPresentYear = dCredit
                                        ElseIf (dDebit = 0) And (dCredit = 0) Then
                                            'dRow("PresentYear") = "0.00"
                                            sAssetPresentYear = "0.00"
                                        End If

                                        If sAssetPresentYear.StartsWith("-") = True Then
                                            sAssetPresentYear = sAssetPresentYear.Remove(0, 1)
                                            dTotalDebit = dTotalDebit - sAssetPresentYear
                                            dRow("PCrDr") = "Dr"
                                        Else
                                            dTotalDebit = dTotalDebit + sAssetPresentYear
                                            If sAssetPresentYear = "0.00" Then
                                                dRow("PCrDr") = ""
                                            Else
                                                dRow("PCrDr") = "Cr"
                                            End If
                                        End If
                                        dRow("PresentYear") = sAssetPresentYear

                                        ' dTotalDebit = dTotalDebit + dRow("PresentYear")
                                        dDebit = 0 : dCredit = 0
                                    End If

                                    'Last Year
                                    sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                    If sArray.Length - 1 Then
                                        For k = 0 To sArray.Length - 1
                                            If sArray(k) <> "" Then
                                                iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
                                                iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                            End If
                                                        End If
                                                    Next

                                                End If
                                            End If
                                        Next

                                        If (dLDebit <> 0) And (dLCredit <> 0) Then
                                            ' dRow("LastYear") = dLCredit - dLDebit
                                            sAssetLastYear = dLCredit - dLDebit
                                        ElseIf dLDebit <> 0 Then
                                            'dRow("LastYear") = dLDebit
                                            sAssetLastYear = dLDebit
                                        ElseIf dLCredit <> 0 Then
                                            'dRow("LastYear") = dLCredit
                                            sAssetLastYear = dLCredit
                                        ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                            'dRow("LastYear") = "0.00"
                                            sAssetLastYear = "0.00"
                                        End If

                                        If sAssetLastYear.StartsWith("-") = True Then
                                            sAssetLastYear = sAssetLastYear.Remove(0, 1)
                                            dTotalLDebit = dTotalLDebit - sAssetLastYear
                                            dRow("LCrDr") = "Dr"
                                        Else
                                            dTotalLDebit = dTotalLDebit + sAssetLastYear
                                            If sAssetLastYear = "0.00" Then
                                                dRow("LCrDr") = ""
                                            Else
                                                dRow("LCrDr") = "Cr"
                                            End If
                                        End If
                                        dRow("LastYear") = sAssetLastYear


                                        dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                    End If
                                End If
                                'Next
                                'End If

                            Else

                                '------------------------------------------------------------------------------------------
                                mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                                mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                                dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                                If dtLink.Rows.Count > 0 Then
                                    If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                        dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                    End If

                                    sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                    If sArray.Length - 1 Then
                                        For k = 0 To sArray.Length - 1
                                            If sArray(k) <> "" Then
                                                If iStatusCheck = 0 Then
                                                    iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
                                                    iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                        iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                    End If
                                                    If iZoneID > 0 Then
                                                        iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                    End If
                                                    If iRegionID > 0 Then
                                                        iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                    End If
                                                    If iAreaID > 0 Then
                                                        iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                    End If
                                                    If iBranchID > 0 Then
                                                        iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                    End If
                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                    If dtArray.Rows.Count > 0 Then
                                                        For a = 0 To dtArray.Rows.Count - 1
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                                End If

                                                                If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                                End If
                                                            End If
                                                        Next
                                                    End If
                                                Else
                                                    iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                    iSql = iSql & " Where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                        iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                    End If
                                                    If iZoneID > 0 Then
                                                        iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                    End If
                                                    If iRegionID > 0 Then
                                                        iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                    End If
                                                    If iAreaID > 0 Then
                                                        iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                    End If
                                                    If iBranchID > 0 Then
                                                        iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                    End If
                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                    If dtArray.Rows.Count > 0 Then
                                                        For a = 0 To dtArray.Rows.Count - 1
                                                            If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                            End If
                                                        Next

                                                    End If

                                                    iSql = "" : iSql = "Select gl_head,opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id"
                                                    iSql = iSql & " Where opn_YearId =" & iYearID & " and opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and opn_Status='A'"
                                                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                        iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                    End If
                                                    If iZoneID > 0 Then
                                                        iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                    End If
                                                    If iRegionID > 0 Then
                                                        iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                    End If
                                                    If iAreaID > 0 Then
                                                        iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                    End If
                                                    If iBranchID > 0 Then
                                                        iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                    End If
                                                    dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                    If dtArray.Rows.Count > 0 Then
                                                        For a = 0 To dtArray.Rows.Count - 1
                                                            If dtArray.Rows(a)("gl_head") = 2 Then
                                                                If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAMt").ToString())
                                                                End If

                                                                If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                                End If
                                                            End If
                                                        Next

                                                    End If

                                                End If

                                            End If
                                        Next

                                        If (dDebit <> 0) And (dCredit <> 0) Then
                                            'dRow("PresentYear") = dCredit - dDebit
                                            sAssetPresentYear = dCredit - dDebit
                                        ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                            'dRow("PresentYear") = dDebit
                                            sAssetPresentYear = dCredit - dDebit
                                        ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                            'dRow("PresentYear") = dCredit
                                            sAssetPresentYear = dCredit
                                        ElseIf (dDebit = 0) And (dCredit = 0) Then
                                            'dRow("PresentYear") = "0.00"
                                            sAssetPresentYear = "0.00"
                                        End If

                                        If sAssetPresentYear.StartsWith("-") = True Then
                                            sAssetPresentYear = sAssetPresentYear.Remove(0, 1)
                                            dTotalDebit = dTotalDebit - sAssetPresentYear
                                            dRow("PCrDr") = "Dr"
                                        Else
                                            dTotalDebit = dTotalDebit + sAssetPresentYear
                                            If sAssetPresentYear = "0.00" Then
                                                dRow("PCrDr") = ""
                                            Else
                                                dRow("PCrDr") = "Cr"
                                            End If
                                        End If
                                        dRow("PresentYear") = sAssetPresentYear

                                        ' dTotalDebit = dTotalDebit + dRow("PresentYear")
                                        dDebit = 0 : dCredit = 0
                                    End If

                                    'Last Year
                                    sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                    If sArray.Length - 1 Then
                                        For k = 0 To sArray.Length - 1
                                            If sArray(k) <> "" Then
                                                iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
                                                iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                            End If
                                                        End If
                                                    Next

                                                End If
                                            End If
                                        Next


                                        If (dLDebit <> 0) And (dLCredit <> 0) Then
                                            'dRow("LastYear") = dLCredit - dLDebit
                                            sAssetLastYear = dLCredit - dLDebit
                                        ElseIf dLDebit <> 0 Then
                                            'dRow("LastYear") = dLDebit
                                            sAssetLastYear = dLDebit
                                        ElseIf dLCredit <> 0 Then
                                            'dRow("LastYear") = dLCredit
                                            sAssetLastYear = dLCredit
                                        ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                            'dRow("LastYear") = "0.00"
                                            sAssetLastYear = "0.00"
                                        End If

                                        If sAssetLastYear.StartsWith("-") = True Then
                                            sAssetLastYear = sAssetLastYear.Remove(0, 1)
                                            dTotalLDebit = dTotalLDebit - sAssetLastYear
                                            dRow("LCrDr") = "Dr"
                                        Else
                                            dTotalLDebit = dTotalLDebit + sAssetLastYear
                                            If sAssetLastYear = "0.00" Then
                                                dRow("LCrDr") = ""
                                            Else
                                                dRow("LCrDr") = "Cr"
                                            End If
                                        End If
                                        dRow("LastYear") = sAssetLastYear


                                        dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                    End If
                                End If
                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                'dRow("PresentYear") = dTotalDebit
                'dRow("LastYear") = dTotalLDebit

                sAssetTotalCurrentDebit = dTotalDebit
                If sAssetTotalCurrentDebit.StartsWith("-") = True Then
                    sAssetTotalCurrentDebit = sAssetTotalCurrentDebit.Remove(0, 1)
                    dRow("PCrDr") = "Dr"
                Else
                    sAssetTotalCurrentDebit = sAssetTotalCurrentDebit
                    If sAssetTotalCurrentDebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = "Cr"
                    End If
                End If
                dRow("PresentYear") = sAssetTotalCurrentDebit

                sAssetTotalLastYearDebit = dTotalLDebit
                If sAssetTotalLastYearDebit.StartsWith("-") = True Then
                    sAssetTotalLastYearDebit = sAssetTotalLastYearDebit.Remove(0, 1)
                    dRow("LCrDr") = "Dr"
                Else
                    sAssetTotalLastYearDebit = sAssetTotalLastYearDebit
                    If sAssetTotalLastYearDebit = "0" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = "Cr"
                    End If
                End If
                dRow("LastYear") = sAssetTotalLastYearDebit

                dt.Rows.Add(dRow)
            End If




            'Income
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 2 and gl_Delflag ='C' and "
            sSql = sSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "REVENUE" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " and gl_CompID =" & iCOmpID & " and "
                    aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            dDebit = 0 : dCredit = 0

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =2 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            If iStatusCheck = 0 Then
                                                iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If
                                            Else
                                                iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                iSql = iSql & " where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                        End If
                                                    Next
                                                End If


                                                iSql = "" : iSql = "Select gl_head,opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id"
                                                iSql = iSql & " where opn_YearId =" & iYearID & " and opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and opn_Status='A'"
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If

                                            End If

                                        End If
                                    Next

                                    If (dDebit <> 0) And (dCredit <> 0) Then
                                        'dRow("PresentYear") = dCredit - dDebit
                                        sInPresentYear = dCredit - dDebit
                                    ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                        'dRow("PresentYear") = dDebit
                                        sInPresentYear = dCredit - dDebit
                                    ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                        'dRow("PresentYear") = dCredit
                                        sInPresentYear = dCredit
                                    ElseIf (dDebit = 0) And (dCredit = 0) Then
                                        'dRow("PresentYear") = "0.00"
                                        sInPresentYear = "0.00"
                                    End If

                                    If sInPresentYear.StartsWith("-") = True Then
                                        sInPresentYear = sInPresentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - sInPresentYear
                                        dRow("PCrDr") = "Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + sInPresentYear
                                        If sInPresentYear = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = "Cr"
                                        End If
                                    End If
                                    dRow("PresentYear") = sInPresentYear

                                    ' dTotalDebit = dTotalDebit + dRow("PresentYear")
                                    dDebit = 0 : dCredit = 0
                                End If

                                'Last Year
                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If dtArray.Rows(a)("gl_head") = 2 Then
                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                        End If
                                                    End If
                                                Next

                                            End If
                                        End If
                                    Next

                                    If (dLDebit <> 0) And (dLCredit <> 0) Then
                                        'dRow("LastYear") = dLCredit - dLDebit
                                        sInLastYear = dLCredit - dLDebit
                                    ElseIf dLDebit <> 0 Then
                                        'dRow("LastYear") = dLDebit
                                        sInLastYear = dLDebit
                                    ElseIf dLCredit <> 0 Then
                                        'dRow("LastYear") = dLCredit
                                        sInLastYear = dLCredit
                                    ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                        'dRow("LastYear") = "0.00"
                                        sInLastYear = "0.00"
                                    End If

                                    If sInLastYear.StartsWith("-") = True Then
                                        sInLastYear = sInLastYear.Remove(0, 1)
                                        dTotalLDebit = dTotalLDebit - sInLastYear
                                        dRow("LCrDr") = "Dr"
                                    Else
                                        dTotalLDebit = dTotalLDebit + sInLastYear
                                        If sInLastYear = "0.00" Then
                                            dRow("LCrDr") = ""
                                        Else
                                            dRow("LCrDr") = "Cr"
                                        End If
                                    End If
                                    dRow("LastYear") = sInLastYear


                                    dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                End If
                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                'dRow("PresentYear") = dTotalDebit
                'dRow("LastYear") = dTotalLDebit

                sInTotalCurrentDebit = dTotalDebit
                If sInTotalCurrentDebit.StartsWith("-") = True Then
                    sInTotalCurrentDebit = sInTotalCurrentDebit.Remove(0, 1)
                    dRow("PCrDr") = "Dr"
                Else
                    If sInTotalCurrentDebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = "Cr"
                    End If
                End If
                dRow("PresentYear") = sInTotalCurrentDebit

                sAssetTotalLastYearDebit = dTotalLDebit
                If sAssetTotalLastYearDebit.StartsWith("-") = True Then
                    sAssetTotalLastYearDebit = sAssetTotalLastYearDebit.Remove(0, 1)
                    dRow("LCrDr") = "Dr"
                Else
                    If sAssetTotalLastYearDebit = "0" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = "Cr"
                    End If
                End If
                dRow("LastYear") = sAssetTotalLastYearDebit

                dt.Rows.Add(dRow)
            End If


            'Expenditure
            dDebit = 0 : dCredit = 0 : dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 3 and gl_Delflag ='C' and "
            sSql = sSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "EXPENDITURE" & "</B>"
                dt.Rows.Add(dRow)

                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    If IsDBNull(dtGroup.Rows(i)("gl_ID").ToString()) = False Then
                        dRow("ID") = dtGroup.Rows(i)("gl_ID")
                    End If

                    dRow("SLNo") = iSLNo + 1

                    If IsDBNull(dtGroup.Rows(i)("gl_Desc").ToString()) = False Then
                        dRow("Particulars") = "<B>" & dtGroup.Rows(i)("gl_Desc") & "</B>"
                    End If
                    dt.Rows.Add(dRow)

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " and "
                    aSql = aSql & "gl_CompID =" & iCOmpID & " And gl_Delflag ='C' and gl_Status ='A'  order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1
                            dRow = dt.NewRow()
                            If IsDBNull(dtSub.Rows(j)("gl_ID").ToString()) = False Then
                                dRow("ID") = dtSub.Rows(j)("gl_ID")
                            End If

                            If IsDBNull(dtSub.Rows(j)("gl_Desc").ToString()) = False Then
                                dRow("Particulars") = dtSub.Rows(j)("gl_Desc")
                            End If

                            dDebit = 0 : dCredit = 0

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =3 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then
                                If IsDBNull(dtLink.Rows(0)("SLM_NoteNo").ToString()) = False Then
                                    dRow("NoteNo") = dtLink.Rows(0)("SLM_NoteNo")
                                End If

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            If iStatusCheck = 0 Then
                                                iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iYearID & " and Opn_CompID =" & iCOmpID & " and "
                                                iSql = iSql & "Opn_GLID =" & sArray(k) & ""
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If
                                            Else
                                                iSql = "" : iSql = "Select * from acc_Transactions_Details" ' Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                                                iSql = iSql & " where ATD_YearId =" & iYearID & " and ATD_CompID =" & iCOmpID & " and ATD_GL =" & sArray(k) & " and ATD_Status='A'"
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and ATD_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and ATD_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and ATD_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and ATD_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Debit").ToString()) = False) And (dtArray.Rows(a)("ATD_Debit").ToString() <> "") Then
                                                            dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("ATD_Debit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("ATD_Credit").ToString()) = False) And (dtArray.Rows(a)("ATD_Credit").ToString() <> "") Then
                                                            dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("ATD_Credit").ToString())
                                                        End If
                                                    Next
                                                End If
                                                iSql = "" : iSql = "Select gl_head,opn_DebitAmt,Opn_CreditAmount from acc_opening_balance join chart_of_Accounts on Opn_GlId=gl_id"
                                                iSql = iSql & " where opn_YearId =" & iYearID & " and opn_CompID =" & iCOmpID & " and Opn_GLID =" & sArray(k) & " and opn_Status='A'"
                                                If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                    iSql = iSql & "And opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and opn_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and opn_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and opn_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and opn_BranchID=" & iBranchID & ""
                                                End If
                                                dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                                If dtArray.Rows.Count > 0 Then
                                                    For a = 0 To dtArray.Rows.Count - 1
                                                        If dtArray.Rows(a)("gl_head") = 2 Then
                                                            If (IsDBNull(dtArray.Rows(a)("opn_DebitAmt").ToString()) = False) And (dtArray.Rows(a)("opn_DebitAmt").ToString() <> "") Then
                                                                dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("opn_DebitAmt").ToString())
                                                            End If

                                                            If (IsDBNull(dtArray.Rows(a)("Opn_CreditAmount").ToString()) = False) And (dtArray.Rows(a)("Opn_CreditAmount").ToString() <> "") Then
                                                                dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_CreditAmount").ToString())
                                                            End If
                                                        End If
                                                    Next
                                                End If
                                            End If
                                        End If
                                    Next

                                    If (dDebit <> 0) And (dCredit <> 0) Then
                                        'dRow("PresentYear") = dCredit - dDebit
                                        sExPresentYear = dCredit - dDebit
                                    ElseIf (dDebit <> 0) And (dCredit = 0) Then
                                        'dRow("PresentYear") = dDebit
                                        sExPresentYear = dCredit - dDebit
                                    ElseIf (dCredit <> 0) And (dDebit = 0) Then
                                        'dRow("PresentYear") = dCredit
                                        sExPresentYear = dCredit
                                    ElseIf (dDebit = 0) And (dCredit = 0) Then
                                        'dRow("PresentYear") = "0.00"
                                        sExPresentYear = "0.00"
                                    End If

                                    If sExPresentYear.StartsWith("-") = True Then
                                        sExPresentYear = sExPresentYear.Remove(0, 1)
                                        dTotalDebit = dTotalDebit - sExPresentYear
                                        dRow("PCrDr") = "Dr"
                                    Else
                                        dTotalDebit = dTotalDebit + sExPresentYear
                                        If sExPresentYear = "0.00" Then
                                            dRow("PCrDr") = ""
                                        Else
                                            dRow("PCrDr") = "Cr"
                                        End If
                                    End If
                                    dRow("PresentYear") = sExPresentYear

                                    dDebit = 0 : dCredit = 0
                                End If

                                'Last Year
                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            iSql = "" : iSql = "Select gl_head,Opn_ClosingBalanceDebit,Opn_ClosingBalanceCredit from acc_Opening_Balance join chart_of_Accounts on Opn_GlId=gl_id where Opn_YearID =" & iLastYear & " and Opn_CompID =" & iCOmpID & " and "
                                            iSql = iSql & "Opn_Status ='F' and Opn_GLID =" & sArray(k) & ""
                                            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                                iSql = iSql & "And Opn_Date Between '" & dFromDate & "' And '" & dToDate & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                            End If
                                            dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                            If dtArray.Rows.Count > 0 Then
                                                For a = 0 To dtArray.Rows.Count - 1
                                                    If dtArray.Rows(a)("gl_head") = 2 Then
                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString() <> "") Then
                                                            dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceDebit").ToString())
                                                        End If

                                                        If (IsDBNull(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString()) = False) And (dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString() <> "") Then
                                                            dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("Opn_ClosingBalanceCredit").ToString())
                                                        End If
                                                    End If
                                                Next
                                            End If
                                        End If
                                    Next

                                    If (dLDebit <> 0) And (dLCredit <> 0) Then
                                        'dRow("LastYear") = dLCredit - dLDebit
                                        sExLastYear = dLCredit - dLDebit
                                    ElseIf dLDebit <> 0 Then
                                        'dRow("LastYear") = dLDebit
                                        sExLastYear = dLDebit
                                    ElseIf dLCredit <> 0 Then
                                        'dRow("LastYear") = dLCredit
                                        sExLastYear = dLCredit
                                    ElseIf (dLDebit = 0) And (dLCredit = 0) Then
                                        'dRow("LastYear") = "0.00"
                                        sExLastYear = "0.00"
                                    End If

                                    If sExLastYear.StartsWith("-") = True Then
                                        sExLastYear = sExLastYear.Remove(0, 1)
                                        dTotalLDebit = dTotalLDebit - sExLastYear
                                        dRow("LCrDr") = "Dr"
                                    Else
                                        dTotalLDebit = dTotalLDebit + sExLastYear
                                        If sExLastYear = "0.00" Then
                                            dRow("LCrDr") = ""
                                        Else
                                            dRow("LCrDr") = "Cr"
                                        End If

                                    End If
                                    dRow("LastYear") = sExLastYear


                                    dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                End If
                            End If
                            dt.Rows.Add(dRow)
                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next

                dRow = dt.NewRow()
                dRow("Particulars") = "<B>" & "TOTAL" & "</B>"
                'dRow("PresentYear") = dTotalDebit
                'dRow("LastYear") = dTotalLDebit

                sExTotalCurrentDebit = dTotalDebit
                If sExTotalCurrentDebit.StartsWith("-") = True Then
                    sExTotalCurrentDebit = sExTotalCurrentDebit.Remove(0, 1)
                    dRow("PCrDr") = "Dr"
                Else
                    If sExTotalCurrentDebit = "0" Then
                        dRow("PCrDr") = ""
                    Else
                        dRow("PCrDr") = "Cr"
                    End If
                End If
                dRow("PresentYear") = sExTotalCurrentDebit

                sExTotalLastYearDebit = dTotalLDebit
                If sExTotalLastYearDebit.StartsWith("-") = True Then
                    sExTotalLastYearDebit = sExTotalLastYearDebit.Remove(0, 1)
                    dRow("LCrDr") = "Dr"
                Else
                    If sExTotalLastYearDebit = "0" Then
                        dRow("LCrDr") = ""
                    Else
                        dRow("LCrDr") = "Cr"
                    End If
                End If
                dRow("LastYear") = sExTotalLastYearDebit

                dt.Rows.Add(dRow)
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetGLCode(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iGLID As Integer)
        Dim sSql As String = ""
        Dim dr As OleDb.OleDbDataReader
        Dim sGLCode As String = ""
        Try
            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_id = " & iGLID & " and gl_CompID =" & iCOmpID & " "
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                sGLCode = dr("gl_Glcode")
            End If
            Return sGLCode
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadScheduleReportsNotes(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
                                             ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)
        Dim sSql As String = "", iSql As String = "", aSql As String = ""
        Dim dt As New DataTable, dtGroup As New DataTable, dtArray As New DataTable
        Dim dtSub As New DataTable
        Dim dr As OleDb.OleDbDataReader
        Dim iLastYear As Integer = 0
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0, a As Integer = 0
        Dim iStatusCheck As Integer = 0
        Dim dRow As DataRow
        Dim sArray As Array

        Dim dDebit As Double = 0.00
        Dim dCredit As Double = 0.00

        Dim dLDebit As Double = 0.00
        Dim dLCredit As Double = 0.00

        Dim dTotalDebit As Double = 0.00
        Dim dTotalCredit As Double = 0.00

        Dim dTotalLDebit As Double = 0.00
        Dim dTotalLCredit As Double = 0.00
        Try
            dt.Columns.Add("Particulars")
            dt.Columns.Add("PresentYear")
            dt.Columns.Add("LastYear")
            dt.Columns.Add("PCrDr")
            dt.Columns.Add("LCrDr")

            Dim dFdate As String = "00:00:00.001"
            Dim dTdate As String = "23:59:59.999"



            'dFromDate = objGen.FormatDtForRDBMS(dFromDate, "CT") '& " " & dFdate
            ' dToDate = objGen.FormatDtForRDBMS(dToDate, "CT") '& " " & dTdate


            sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
            sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and YMS_CompID =" & iCOmpID & ")"
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                iLastYear = dr("YMS_ID")
            Else
                iLastYear = 0
            End If

            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_yearID =" & iYearID & ""
            If iZoneID > 0 Then
                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
            End If
            dr = objDB.SQLDataReader(sNameSpace, iSql)
            If dr.HasRows = True Then
                dr.Read()
                If dr("Opn_Status") = "F" Then
                    iStatusCheck = 0
                Else
                    iStatusCheck = 1
                End If
            Else
                iStatusCheck = 1
            End If

            sSql = "" : sSql = "Select * from Schedule_Linkage_Master where SLM_CompID =" & iCOmpID & " and SLM_NoteNo <> 0 order by SLM_NoteNo"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then
                For i = 0 To dtGroup.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("Particulars") = "<B>" & "NOTE NO: " & dtGroup.Rows(i)("SLM_NoteNo") & " - " & objDB.SQLExecuteScalar(sNameSpace, "Select gl_desc from Chart_of_Accounts where gl_id = " & dtGroup.Rows(i)("SLM_SubGroupID") & "") & "</B>"
                    dt.Rows.Add(dRow)

                    sArray = dtGroup.Rows(i)("SLM_GLLedger").ToString().Split(",")
                    If sArray.Length > 0 Then
                        For k = 0 To sArray.Length - 1
                            If sArray(k) <> "" Then

                                aSql = "" : aSql = "Select * from Chart_of_Accounts where gl_id = " & sArray(k) & " and gl_compID = " & iCOmpID & " and gl_Status ='A' and gl_Delflag='C'"
                                dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                                If dtSub.Rows.Count > 0 Then
                                    If dtGroup.Rows.Count > 0 Then
                                        dRow = dt.NewRow()
                                        dRow("Particulars") = dtSub.Rows(0)("gl_glCode") & " - " & dtSub.Rows(0)("gl_Desc")

                                        'Current Year

                                        iSql = "" : iSql = "Select top 1 * from Freeze_Ledger where FL_Year =" & iYearID & " And FL_CompID =" & iCOmpID & " And "
                                        iSql = iSql & "FL_GL =" & sArray(k) & ""
                                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                            ' iSql = iSql & " and FL_CreatedOn Between '" & dFromDate & "' And '" & dToDate & "'"
                                            iSql = iSql & " and FL_fromdate >= cast( '" & dFromDate & "' as datetime) And FL_Todate <= cast('" & dToDate & "' as datetime)"
                                        End If
                                        If iZoneID > 0 Then
                                            iSql = iSql & " And FL_ZoneID = " & iZoneID & ""
                                        End If
                                        If iRegionID > 0 Then
                                            iSql = iSql & " And FL_RegionID = " & iRegionID & ""
                                        End If
                                        If iAreaID > 0 Then
                                            iSql = iSql & " And FL_AreaID = " & iAreaID & ""
                                        End If
                                        If iBranchID > 0 Then
                                            iSql = iSql & " And FL_BranchID = " & iBranchID & ""
                                        End If
                                        iSql = iSql & " order by fl_id desc"
                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                        If dtArray.Rows.Count > 0 Then
                                            For a = 0 To dtArray.Rows.Count - 1
                                                If (IsDBNull(dtArray.Rows(a)("FL_CloseDebit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseDebit").ToString() <> "") Then
                                                    dDebit = dDebit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseDebit").ToString())
                                                    If dtSub.Rows(0)("gl_head") = 2 Then
                                                        dTotalDebit = dTotalDebit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseDebit").ToString())
                                                    End If

                                                End If

                                                If (IsDBNull(dtArray.Rows(a)("FL_CloseCredit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseCredit").ToString() <> "") Then
                                                    dCredit = dCredit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseCredit").ToString())
                                                    If dtSub.Rows(0)("gl_head") = 2 Then
                                                        dTotalCredit = dTotalCredit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseCredit").ToString())
                                                    End If
                                                End If
                                            Next
                                        End If


                                        'Last year
                                        iSql = "" : iSql = "Select top 1 * from Freeze_Ledger where FL_Year =" & iLastYear & " And FL_CompID =" & iCOmpID & " And "
                                        iSql = iSql & "FL_Status ='F' and FL_GL =" & sArray(k) & ""
                                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                                            ' iSql = iSql & " and FL_CreatedOn Between '" & dFromDate & "' And '" & dToDate & "'"
                                            iSql = iSql & " and FL_fromdate >= cast( '" & dFromDate & "' as datetime) And FL_Todate <= cast('" & dToDate & "' as datetime)"
                                        End If
                                        If iZoneID > 0 Then
                                            iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                                        End If
                                        If iRegionID > 0 Then
                                            iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                                        End If
                                        If iAreaID > 0 Then
                                            iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                                        End If
                                        If iBranchID > 0 Then
                                            iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                                        End If
                                        iSql = iSql & " order by fl_id desc"
                                        dtArray = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                        If dtArray.Rows.Count > 0 Then
                                            For a = 0 To dtArray.Rows.Count - 1
                                                If (IsDBNull(dtArray.Rows(a)("FL_CloseDebit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseDebit").ToString() <> "") Then
                                                    dLDebit = dLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseDebit").ToString())
                                                    If dtSub.Rows(0)("gl_head") = 2 Then
                                                        dTotalLDebit = dTotalLDebit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseDebit").ToString())
                                                    End If
                                                End If

                                                If (IsDBNull(dtArray.Rows(a)("FL_CloseCredit").ToString()) = False) And (dtArray.Rows(a)("FL_CloseCredit").ToString() <> "") Then
                                                    dLCredit = dLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseCredit").ToString())
                                                    If dtSub.Rows(0)("gl_head") = 2 Then
                                                        dTotalLCredit = dTotalLCredit + Convert.ToDouble(dtArray.Rows(a)("FL_CloseCredit").ToString())
                                                    End If
                                                End If
                                            Next
                                        End If

                                        If dDebit > 0 Then
                                            dRow("PresentYear") = dDebit
                                            dRow("PCrDr") = "Dr"
                                        Else
                                            dRow("PresentYear") = dCredit
                                            If dRow("PresentYear") = "0" Then
                                                dRow("PCrDr") = ""
                                            Else
                                                dRow("PCrDr") = "Cr"
                                            End If

                                        End If

                                        If dLDebit > 0 Then
                                            dRow("LastYear") = dLDebit
                                            dRow("LCrDr") = "Dr"
                                        Else
                                            dRow("LastYear") = dLCredit
                                            If dRow("LastYear") = "0" Then
                                                dRow("LCrDr") = ""
                                            Else
                                                dRow("LCrDr") = "Cr"
                                            End If

                                        End If

                                        dt.Rows.Add(dRow)
                                        dDebit = 0 : dCredit = 0 : dLDebit = 0 : dLCredit = 0
                                    End If
                                End If
                            End If
                        Next

                        dRow = dt.NewRow()
                        dRow("Particulars") = "<B>" & "TOTAL" & "</B>"

                        If (dTotalDebit <> 0) And (dTotalCredit <> 0) Then
                            dRow("PresentYear") = dTotalDebit - dTotalCredit
                        ElseIf (dTotalDebit <> 0) And (dTotalCredit = 0) Then
                            dRow("PresentYear") = dTotalDebit
                        ElseIf (dTotalDebit = 0) And (dTotalCredit <> 0) Then
                            dRow("PresentYear") = dTotalCredit
                        ElseIf (dTotalDebit = 0) And (dTotalCredit = 0) Then
                            dRow("PresentYear") = "0.00"
                        End If
                        If dRow("PresentYear").StartsWith("-") = True Then
                            dRow("PresentYear") = dRow("PresentYear").Remove(0, 1)
                            dRow("PresentYear") = dRow("PresentYear")
                            dRow("PCrDr") = "Dr"
                        Else
                            dRow("PresentYear") = dRow("PresentYear")
                            If dRow("PresentYear") = "0.00" Then
                                dRow("PCrDr") = ""
                            ElseIf dTotalDebit > dTotalCredit Then
                                dRow("PCrDr") = "Dr"
                            Else
                                dRow("PCrDr") = "Cr"
                            End If

                        End If

                        If (dTotalLDebit <> 0) And (dTotalLCredit <> 0) Then
                            dRow("LastYear") = dTotalLDebit - dTotalLCredit
                        ElseIf (dTotalLDebit <> 0) And (dTotalLCredit = 0) Then
                            dRow("LastYear") = dTotalLDebit
                        ElseIf (dTotalLDebit = 0) And (dTotalLCredit <> 0) Then
                            dRow("LastYear") = dTotalLCredit
                        ElseIf (dTotalLDebit = 0) And (dTotalLCredit = 0) Then
                            dRow("LastYear") = "0.00"
                        End If
                        If dRow("LastYear").StartsWith("-") = True Then
                            dRow("LastYear") = dRow("LastYear").Remove(0, 1)
                            dRow("LastYear") = dRow("LastYear")
                            dRow("LCrDr") = "Dr"
                        Else
                            dRow("LastYear") = dRow("LastYear")
                            If dRow("LastYear") = "0.00" Then
                                dRow("LCrDr") = ""
                            ElseIf dTotalDebit > dTotalCredit Then
                                dRow("LCrDr") = "Dr"
                            Else
                                dRow("LCrDr") = "Cr"
                            End If

                        End If

                        dt.Rows.Add(dRow)

                        dRow = dt.NewRow()
                        dRow("Particulars") = ""
                        dt.Rows.Add(dRow)
                        dTotalDebit = 0 : dTotalCredit = 0 : dTotalLDebit = 0 : dTotalLCredit = 0
                    End If
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadDebtorsOrCreditors(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iParty As Integer, ByVal iGL As Integer,
                                           ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iYearId As Integer)
        Dim dt As New DataTable, dtTrans As New DataTable, dtType As New DataTable
        Dim sSql As String = "", aSql As String = ""
        Dim dRow As DataRow
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
        Try
            dt.Columns.Add("Date")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("TransactionType")
            dt.Columns.Add("DocumentRefNo")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TrDebit")
            dt.Columns.Add("TrCredit")
            dt.Columns.Add("ClDebit")
            dt.Columns.Add("ClCredit")
            dt.Columns.Add("Customer")

            sSql = "" : sSql = "Select * from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID where ATD_YearID=" & iYearId & " and ATD_CompID =" & iCompID & " "
            If (dFromDate <> "01/01/1900") And (dToDate <> "01/01/1900") Then
                sSql = sSql & " and ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            If iZoneID > 0 Then
                aSql = aSql & " and ACC_PM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                aSql = aSql & " and ACC_PM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                aSql = aSql & " and ACC_PM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                aSql = aSql & " and ACC_PM_BranchID=" & iBranchID & ""
            End If
            If iParty > 0 Then
                sSql = sSql & " and ATD_SubGL =" & iParty & ""
            Else
                sSql = sSql & " and ATD_SubGL in(Select gl_id from  chart_of_Accounts where gl_Parent = " & iGL & " and gl_CompID =" & iCompID & ")"
            End If
            sSql = sSql & " Order by ATD_SubGL"

            dtTrans = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            If dtTrans.Rows.Count > 0 Then

                For j = 0 To dtTrans.Rows.Count - 1


                    'Payment
                    If dtTrans.Rows(j)("ATD_TrType").ToString() = 1 Then
                        aSql = "" : aSql = "Select * from acc_Payment_Master where Acc_PM_ID =" & dtTrans.Rows(j)("ATD_BillID").ToString() & " And Acc_PM_CompID =" & iCompID & " and Acc_PM_YearID=" & iYearId & ""
                        If iZoneID > 0 Then
                            aSql = aSql & " and ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If (dFromDate <> "01/01/1900") And (dToDate <> "01/01/1900") Then
                            sSql = sSql & " and Acc_PM_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                        dtType = objDB.SQLExecuteDataTable(sNameSpace, aSql)
                        If dtType.Rows.Count > 0 Then
                            dRow = dt.NewRow()
                            If (dtType.Rows(0)("Acc_PM_BillNo").ToString() = "") Then 'Vijaylakshmi 20-05-19
                                dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_PM_InvoiceDate").ToString(), "D")
                            Else
                                dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_PM_BillDate").ToString(), "D")
                            End If
                            dRow("VoucherNo") = dtType.Rows(0)("Acc_PM_TransactionNo").ToString()
                            dRow("TransactionType") = "Payment"   'vijaylakshmi 06-03-19 changed "Purchase" to Payment
                            dRow("DocumentRefNo") = dtType.Rows(0)("Acc_PM_BillNo").ToString()
                            dRow("TrDebit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Debit").ToString()).ToString("#,##0.00")
                            dRow("TrCredit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Credit").ToString()).ToString("#,##0.00")
                            dRow("Customer") = objDB.SQLExecuteScalar(sNameSpace, "SElect gl_Desc from chart_of_Accounts where gl_id = " & dtTrans.Rows(j)("ATD_SubGL").ToString() & " and gl_CompID =" & iCompID & "")
                            dt.Rows.Add(dRow)
                        End If
                    End If


                    'Receipt
                    If dtTrans.Rows(j)("ATD_TrType").ToString() = 3 Then
                        aSql = "" : aSql = "Select * from acc_Receipt_Master where Acc_RM_ID =" & dtTrans.Rows(j)("ATD_BillID").ToString() & " And Acc_RM_CompID =" & iCompID & " and Acc_RM_YearID=" & iYearId & ""
                        If iZoneID > 0 Then
                            aSql = aSql & " and ACC_RM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and ACC_RM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and ACC_RM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and ACC_RM_BranchID=" & iBranchID & ""
                        End If
                        If (dFromDate <> "01/01/1900") And (dToDate <> "01/01/1900") Then
                            sSql = sSql & " and Acc_RM_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                        dtType = objDB.SQLExecuteDataTable(sNameSpace, aSql)
                        If dtType.Rows.Count > 0 Then
                            dRow = dt.NewRow()
                            If (dtType.Rows(0)("Acc_RM_BillNo").ToString() = "") Then 'Vijaylakshmi 20-05-19
                                dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_RM_InvoiceDate").ToString(), "D")
                            Else
                                dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_RM_BillDate").ToString(), "D")
                            End If

                            dRow("VoucherNo") = dtType.Rows(0)("Acc_RM_TransactionNo").ToString()
                            dRow("TransactionType") = "Receipt"
                            dRow("DocumentRefNo") = dtType.Rows(0)("Acc_RM_BillNo").ToString()
                            dRow("TrDebit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Debit").ToString()).ToString("#,##0.00")
                            dRow("TrCredit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Credit").ToString()).ToString("#,##0.00")
                            dRow("Customer") = objDB.SQLExecuteScalar(sNameSpace, "SElect gl_Desc from chart_of_Accounts where gl_id = " & dtTrans.Rows(j)("ATD_SubGL").ToString() & " and gl_CompID =" & iCompID & "")
                            dt.Rows.Add(dRow)
                        End If
                    End If

                    'JournalEntry Vijayalakshmi 07-03-19
                    If dtTrans.Rows(j)("ATD_TrType").ToString() = 4 Then
                        aSql = "" : aSql = "Select * from Acc_JE_Master where Acc_JE_ID =" & dtTrans.Rows(j)("ATD_BillID").ToString() & " And Acc_JE_CompID =" & iCompID & " and Acc_JE_YearID=" & iYearId & ""
                        If iZoneID > 0 Then
                            aSql = aSql & " and ACC_JE_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and ACC_JE_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and ACC_JE_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and ACC_JE_BranchID=" & iBranchID & ""
                        End If
                        If (dFromDate <> "01/01/1900") And (dToDate <> "01/01/1900") Then
                            sSql = sSql & " and Acc_JE_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                        dtType = objDB.SQLExecuteDataTable(sNameSpace, aSql)
                        If dtType.Rows.Count > 0 Then
                            dRow = dt.NewRow()
                            If (dtType.Rows(0)("Acc_JE_BillNo").ToString() = "") Then 'Vijaylakshmi 20-05-19
                                dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_JE_InvoiceDate").ToString(), "D")
                            Else
                                dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_JE_BillDate").ToString(), "D")
                            End If

                            dRow("VoucherNo") = dtType.Rows(0)("Acc_JE_TransactionNo").ToString()
                            dRow("TransactionType") = "Journal Entry"
                            dRow("DocumentRefNo") = dtType.Rows(0)("Acc_JE_BillNo").ToString()
                            dRow("TrDebit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Debit").ToString()).ToString("#,##0.00")
                            dRow("TrCredit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Credit").ToString()).ToString("#,##0.00")
                            dRow("Customer") = objDB.SQLExecuteScalar(sNameSpace, "SElect gl_Desc from chart_of_Accounts where gl_id = " & dtTrans.Rows(j)("ATD_SubGL").ToString() & " and gl_CompID =" & iCompID & "")
                            dt.Rows.Add(dRow)
                        End If
                    End If

                    'Sales Vijayalakshmi 07-03-19
                    If dtTrans.Rows(j)("ATD_TrType").ToString() = 9 Then
                        aSql = "" : aSql = "Select * from acc_Sales_masters where Acc_Sales_ID =" & dtTrans.Rows(j)("ATD_BillID").ToString() & " And Acc_Sales_CompID =" & iCompID & " and Acc_Sales_Year=" & iYearId & ""
                        If iZoneID > 0 Then
                            aSql = aSql & " and ACC_Sales_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and ACC_Sales_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and ACC_Sales_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and ACC_Sales_BranchID=" & iBranchID & ""
                        End If
                        If (dFromDate <> "01/01/1900") And (dToDate <> "01/01/1900") Then
                            sSql = sSql & " and Acc_Sales_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                        dtType = objDB.SQLExecuteDataTable(sNameSpace, aSql)
                        If dtType.Rows.Count > 0 Then
                            dRow = dt.NewRow()
                            dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_Sales_BillDate").ToString(), "D")
                            dRow("VoucherNo") = dtType.Rows(0)("Acc_Sales_TransactionNo").ToString()
                            dRow("TransactionType") = "Sales"
                            dRow("DocumentRefNo") = dtType.Rows(0)("Acc_Sales_BillNo").ToString()
                            dRow("TrDebit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Debit").ToString()).ToString("#,##0.00")
                            dRow("TrCredit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Credit").ToString()).ToString("#,##0.00")
                            dRow("Customer") = objDB.SQLExecuteScalar(sNameSpace, "SElect gl_Desc from chart_of_Accounts where gl_id = " & dtTrans.Rows(j)("ATD_SubGL").ToString() & " and gl_CompID =" & iCompID & "")
                            dt.Rows.Add(dRow)
                        End If
                    End If


                    'Purchase Vijayalakshmi 07-03-19
                    If dtTrans.Rows(j)("ATD_TrType").ToString() = 8 Then
                        aSql = "" : aSql = "Select * from acc_purchase_master where Acc_purchase_ID =" & dtTrans.Rows(j)("ATD_BillID").ToString() & " And Acc_purchase_CompID =" & iCompID & " and Acc_Purchase_Year=" & iYearId & ""
                        If iZoneID > 0 Then
                            aSql = aSql & " and ACC_purchase_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and ACC_purchase_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and ACC_purchase_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and ACC_purchase_BranchID=" & iBranchID & ""
                        End If
                        If (dFromDate <> "01/01/1900") And (dToDate <> "01/01/1900") Then
                            sSql = sSql & " and Acc_purchase_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                        dtType = objDB.SQLExecuteDataTable(sNameSpace, aSql)
                        If dtType.Rows.Count > 0 Then
                            dRow = dt.NewRow()
                            dRow("Date") = objGen.FormatDtForRDBMS(dtType.Rows(0)("Acc_purchase_BillDate").ToString(), "D")
                            dRow("VoucherNo") = dtType.Rows(0)("Acc_purchase_TransactionNo").ToString()
                            dRow("TransactionType") = "Purchase"
                            dRow("DocumentRefNo") = dtType.Rows(0)("Acc_purchase_BillNo").ToString()
                            dRow("TrDebit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Debit").ToString()).ToString("#,##0.00")
                            dRow("TrCredit") = Convert.ToDecimal(dtTrans.Rows(j)("ATD_Credit").ToString()).ToString("#,##0.00")
                            dRow("Customer") = objDB.SQLExecuteScalar(sNameSpace, "SElect gl_Desc from chart_of_Accounts where gl_id = " & dtTrans.Rows(j)("ATD_SubGL").ToString() & " and gl_CompID =" & iCompID & "")
                            dt.Rows.Add(dRow)
                        End If
                    End If


                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadDebtorsOrCreditorsGL(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtCr As New DataTable
        Dim dRow As DataRow
        Try
            dtCr.Columns.Add("ID")
            dtCr.Columns.Add("Description")

            sSql = "" : sSql = "Select Acc_GL from acc_Application_Settings where Acc_Types = 'Customer' and Acc_LedgerType = 'Customer' and Acc_CompID = " & iCompID & ""
            dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            If dt.Rows.Count > 0 Then
                dRow = dtCr.NewRow()
                dRow("ID") = dt.Rows(0)("Acc_GL").ToString()
                dRow("Description") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_glCode + ' - ' + gl_Desc from chart_of_Accounts where gl_id =" & dt.Rows(0)("Acc_GL").ToString() & " and gl_CompID =" & iCompID & "")
                dtCr.Rows.Add(dRow)
            End If

            sSql = "" : sSql = "Select Acc_GL from acc_Application_Settings where Acc_Types = 'Supplier' and Acc_LedgerType = 'Supplier' and Acc_CompID = " & iCompID & ""
            dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            If dt.Rows.Count > 0 Then
                dRow = dtCr.NewRow()
                dRow("ID") = dt.Rows(0)("Acc_GL").ToString()
                dRow("Description") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_glCode + ' - ' + gl_Desc from chart_of_Accounts where gl_id =" & dt.Rows(0)("Acc_GL").ToString() & " and gl_CompID =" & iCompID & "")
                dtCr.Rows.Add(dRow)
            End If

            'sSql = "" : sSql = "Select Acc_Group from acc_Application_Settings where Acc_Types = 'Customer' and Acc_LedgerType = 'Sales' and Acc_CompID = " & iCompID & ""
            'dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            'If dt.Rows.Count > 0 Then
            '    dRow = dtCr.NewRow()
            '    dRow("ID") = dt.Rows(0)("Acc_Group").ToString()
            '    dRow("Description") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_glCode + ' - ' + gl_Desc from chart_of_Accounts where gl_id =" & dt.Rows(0)("Acc_Group").ToString() & " and gl_CompID =" & iCompID & "")
            '    dtCr.Rows.Add(dRow)
            'End If

            'sSql = "" : sSql = "Select Acc_Group from acc_Application_Settings where Acc_Types = 'Supplier' and Acc_LedgerType = 'Purchase' and Acc_CompID = " & iCompID & ""
            'dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            'If dt.Rows.Count > 0 Then
            '    dRow = dtCr.NewRow()
            '    dRow("ID") = dt.Rows(0)("Acc_Group").ToString()
            '    dRow("Description") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_glCode + ' - ' + gl_Desc from chart_of_Accounts where gl_id =" & dt.Rows(0)("Acc_Group").ToString() & " and gl_CompID =" & iCompID & "")
            '    dtCr.Rows.Add(dRow)
            'End If
            Return dtCr
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadAllGlList(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtCr As New DataTable

        Try

            sSql = "" : sSql = "Select gl_id,gl_desc from chart_of_Accounts where gl_CompID = " & iCompID & " and gl_head=2"
            dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetchartofAccounts(ByVal sNameSpace As String) As DataTable
        Dim sSql As String
        Try
            sSql = "Select gl_id, gl_glCode, gl_Parent, gl_desc from chart_of_Accounts"
            Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetPaymentMaster(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iCustPartyType As Integer, ByVal iYearId As Integer) As DataTable
        Dim sSql As String
        Try
            'sSql = "Select Acc_PM_ID,Acc_PM_Party,Acc_PM_TransactionNo,Acc_PM_InvoiceDate,Month(Acc_PM_InvoiceDate) As InvoiceDateMonth,Acc_PM_Location,Acc_PM_BillNo from acc_payment_master"
            'sSql = sSql & " Where Acc_PM_CompID=" & iCompID & " and Acc_PM_YearID=" & iYearId & " and ACC_PM_Status ='A'"
            'If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
            '    sSql = sSql & " and Acc_PM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            'End If
            'If iZoneID > 0 Then
            '    sSql = sSql & " and ACC_PM_ZoneID=" & iZoneID & ""
            'End If
            'If iRegionID > 0 Then
            '    sSql = sSql & " and ACC_PM_RegionID=" & iRegionID & ""
            'End If
            'If iAreaID > 0 Then
            '    sSql = sSql & " and ACC_PM_AreaID=" & iAreaID & ""
            'End If
            'If iBranchID > 0 Then
            '    sSql = sSql & " and ACC_PM_BranchID=" & iBranchID & ""
            'End If
            'If iCustPartyType > 0 Then
            '    sSql = sSql & " and ACC_PM_Location=" & iCustPartyType & ""
            'End If
            'sSql = sSql & " Order By Acc_PM_InvoiceDate"


            sSql = "Select Acc_PM_ID,Acc_PM_TransactionNo,Acc_PM_InvoiceDate,Month(Acc_PM_InvoiceDate) As InvoiceDateMonth,Acc_PM_Location,Acc_PM_BillNo,ATD_GL as Acc_PM_Party,ATD_SubGL From acc_transactions_details left Join acc_payment_master On ATD_BillId=Acc_PM_ID"

            sSql = sSql & " Where ATD_CompID=" & iCompID & " and ATD_YearID=" & iYearId & " and ATD_Status ='A' and atd_trtype=1"
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                    sSql = sSql & " and Acc_PM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                End If
                If iZoneID > 0 Then
                    sSql = sSql & " and ATD_ZoneID=" & iZoneID & ""
                End If
                If iRegionID > 0 Then
                    sSql = sSql & " and ATD_RegionID=" & iRegionID & ""
                End If
                If iAreaID > 0 Then
                    sSql = sSql & " and ATD_AreaID=" & iAreaID & ""
                End If
                If iBranchID > 0 Then
                    sSql = sSql & " and ATD_BranchID=" & iBranchID & ""
                End If
                If iCustPartyType > 0 Then
                sSql = sSql & " and Acc_Pm_Location=" & iCustPartyType & ""
            End If
                sSql = sSql & " Order By Acc_PM_InvoiceDate"
                Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetReceiptMaster(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iCustPartyType As Integer, ByVal iYearId As Integer) As DataTable
        Dim sSql As String
        Try
            'sSql = "Select Acc_RM_ID,Acc_RM_Party,Acc_RM_TransactionNo,Acc_RM_InvoiceDate,Month(Acc_RM_InvoiceDate) As InvoiceDateMonth,Acc_RM_Location,Acc_RM_BillNo from acc_receipt_master"
            'sSql = sSql & " Where Acc_RM_CompID=" & iCompID & " and Acc_RM_YearID=" & iYearId & " and Acc_RM_Status='A'"
            'If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
            '    sSql = sSql & " and Acc_RM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            'End If
            'If iZoneID > 0 Then
            '    sSql = sSql & " and ACC_RM_ZoneID=" & iZoneID & ""
            'End If
            'If iRegionID > 0 Then
            '    sSql = sSql & " and ACC_RM_RegionID=" & iRegionID & ""
            'End If
            'If iAreaID > 0 Then
            '    sSql = sSql & " and ACC_RM_AreaID=" & iAreaID & ""
            'End If
            'If iBranchID > 0 Then
            '    sSql = sSql & " and ACC_RM_BranchID=" & iBranchID & ""
            'End If
            'If iCustPartyType > 0 Then
            '    sSql = sSql & " and ACC_RM_Location=" & iCustPartyType & ""
            'End If
            'sSql = sSql & " Order By Acc_RM_InvoiceDate"


            sSql = "Select Acc_RM_ID,Acc_RM_TransactionNo,Acc_RM_InvoiceDate,Month(Acc_RM_InvoiceDate) As InvoiceDateMonth,Acc_RM_Location,Acc_RM_BillNo,ATD_GL as Acc_RM_Party,ATD_SubGL From acc_transactions_details left Join acc_receipt_master On ATD_BillId=Acc_RM_ID"

            sSql = sSql & " Where ATD_CompID=" & iCompID & " and ATD_YearID=" & iYearId & " and ATD_Status ='A' and atd_trtype=3"
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_RM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and ATD_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ATD_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ATD_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ATD_BranchID=" & iBranchID & ""
            End If
            If iCustPartyType > 0 Then
                sSql = sSql & " and ACC_RM_Location=" & iCustPartyType & ""
            End If
            sSql = sSql & " Order By Acc_RM_InvoiceDate"
            Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetPettyCashMaster(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iCustPartyType As Integer, ByVal iYearId As Integer) As DataTable
        Dim sSql As String
        Try
            'sSql = "Select Acc_PCM_ID,Acc_PCM_Party,Acc_PCM_TransactionNo,Acc_PCM_InvoiceDate,Month(Acc_PCM_InvoiceDate) As BillDateMonth,Acc_PCM_Location,Acc_PCM_BillNo from acc_pettycash_master "
            'sSql = sSql & " Where Acc_PCM_CompID=" & iCompID & " and Acc_PCM_YearID=" & iYearId & " and Acc_PCM_Status='A'"
            'If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
            '    sSql = sSql & " and Acc_PCM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            'End If
            'If iZoneID > 0 Then
            '    sSql = sSql & " and ACC_PCM_ZoneID=" & iZoneID & ""
            'End If
            'If iRegionID > 0 Then
            '    sSql = sSql & " and ACC_PCM_RegionID=" & iRegionID & ""
            'End If
            'If iAreaID > 0 Then
            '    sSql = sSql & " and ACC_PCM_AreaID=" & iAreaID & ""
            'End If
            'If iBranchID > 0 Then
            '    sSql = sSql & " and ACC_PCM_BranchID=" & iBranchID & ""
            'End If
            'If iCustPartyType > 0 Then
            '    sSql = sSql & " and ACC_PCM_Location=" & iCustPartyType & ""
            'End If
            'sSql = sSql & " Order By Acc_PCM_BillDate"

            sSql = "Select Acc_PCM_ID,Acc_PCM_TransactionNo,Acc_PCM_InvoiceDate,Month(Acc_PCM_InvoiceDate) As BillDateMonth,Acc_PCM_Location,Acc_PCM_BillNo,ATD_GL as Acc_PCM_Party,ATD_SubGL From acc_transactions_details left Join acc_pettycash_master On ATD_BillId=Acc_PCM_ID"

            sSql = sSql & " Where ATD_CompID=" & iCompID & " and ATD_YearID=" & iYearId & " and ATD_Status ='A' and atd_trtype=2"
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_PCM_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and ATD_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ATD_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ATD_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ATD_BranchID=" & iBranchID & ""
            End If
            If iCustPartyType > 0 Then
                sSql = sSql & " and ACC_PCM_Location=" & iCustPartyType & ""
            End If
            sSql = sSql & " Order By Acc_PCM_InvoiceDate"

            Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetJournalEntryMaster(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iCustPartyType As Integer, ByVal iYearId As Integer) As DataTable
        Dim sSql As String
        Try
            'sSql = "Select Acc_JE_ID,Acc_JE_Party,Acc_JE_TransactionNo,Acc_JE_BillDate,Month(Acc_JE_BillDate) As BillDateMonth,Acc_JE_Location,Acc_JE_BillNo from acc_je_master"
            'sSql = sSql & " Where Acc_JE_CompID=" & iCompID & " and Acc_JE_YearID=" & iYearId & " and Acc_JE_Status='A'"
            'If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
            '    sSql = sSql & " and Acc_JE_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            'End If
            'If iZoneID > 0 Then
            '    sSql = sSql & " and ACC_JE_ZoneID=" & iZoneID & ""
            'End If
            'If iRegionID > 0 Then
            '    sSql = sSql & " and ACC_JE_RegionID=" & iRegionID & ""
            'End If
            'If iAreaID > 0 Then
            '    sSql = sSql & " and ACC_JE_AreaID=" & iAreaID & ""
            'End If
            'If iBranchID > 0 Then
            '    sSql = sSql & " and ACC_JE_BranchID=" & iBranchID & ""
            'End If
            'If iCustPartyType > 0 Then
            '    sSql = sSql & " and ACC_JE_Location=" & iCustPartyType & ""
            'End If
            'sSql = sSql & " Order By Acc_JE_BillDate"

            sSql = "Select Acc_JE_ID,Acc_JE_TransactionNo,Acc_JE_BillDate,Month(Acc_JE_BillDate) As BillDateMonth,Acc_JE_Location,Acc_JE_BillNo,ATD_GL as Acc_JE_Party,ATD_SubGL From acc_transactions_details left Join acc_je_master On ATD_BillId=Acc_JE_ID"

            sSql = sSql & " Where ATD_CompID=" & iCompID & " and ATD_YearID=" & iYearId & " and ATD_Status ='A' and atd_trtype=4"
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_JE_InvoiceDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and ATD_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ATD_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ATD_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ATD_BranchID=" & iBranchID & ""
            End If
            If iCustPartyType > 0 Then
                sSql = sSql & " and ACC_JE_Location=" & iCustPartyType & ""
            End If
            sSql = sSql & " Order By Acc_JE_InvoiceDate"
            Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetWeekBackDate(ByVal sAC As String) As String
        Dim sSql As String
        Try
            sSql = "Select Convert(Varchar(10),Getdate()-7,103)"
            Return objDB.SQLExecuteScalar(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetCurrentDate(ByVal sAC As String) As String
        Dim sSql As String = ""
        Try
            sSql = "Select Convert(Varchar(10),Getdate(),103)"
            Return objDB.SQLExecuteScalar(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadBankBookReport(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal imonthID As Integer, ByVal iParty As Integer,
                                       ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim dt As New DataTable, dtGL As New DataTable, dtBank As New DataTable, dtSubGL As New DataTable, dtPay As New DataTable, dtReceipt As New DataTable, dtPetty As New DataTable, dtJE As New DataTable
        Dim sSql As String = "", iSql As String = "", aSql As String = "", strUser As String = ""
        Dim i As Integer = 0, j As Integer = 0, GLid As Integer = 0
        Dim dRow As DataRow
        Dim drUsr As OleDb.OleDbDataReader

        Dim dtData As New DataTable

        dtPay = GetPaymentMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, 0, iYearId)
        dtSubGL = GetchartofAccounts(sNameSpace)
        dtReceipt = GetReceiptMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, 0, iYearId)
        dtPetty = GetPettyCashMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, 0, iYearId)
        dtJE = GetJournalEntryMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, 0, iYearId)

        'Dim dFromDateF As Date : Dim dToDateT As Date
        Try
            dt.Columns.Add("ATD_TransactionDate")
            dt.Columns.Add("ATD_BillId")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("ATD_TrType")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDesc")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("subDesc")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("SupplierCustomer")

            'dFromDateF = Date.ParseExact(dFromDate, "dd/MM/yyyy", System.Globalization.CultureInfo.CurrentCulture)
            'dToDateT = Date.ParseExact(dToDate, "dd/MM/yyyy", System.Globalization.CultureInfo.CurrentCulture)

            sSql = "Select Acc_GL from acc_application_settings where Acc_Types='Bank'"
            GLid = objDB.SQLExecuteScalar(sNameSpace, sSql)
            If GLid > 0 Then
                aSql = " Select GL_ID From chart_of_accounts Where gl_parent = " & GLid & ""
            End If
            drUsr = objDB.SQLDataReader(sNameSpace, aSql)
            If drUsr.HasRows Then
                While drUsr.Read
                    strUser = strUser & "," & drUsr("GL_ID")
                End While
                strUser = Right(strUser, Len(strUser) - 1)
            Else
                strUser = "Null"
            End If

            'sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
            'sSql = sSql & " where ATD_TransactionDate between '" & dFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dToDate & "')) And ATD_CompID= " & iCompID & " And ATD_SubGL In (" & strUser & ") "
            'sSql = sSql & "order by ATD_BillID"

            'sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
            'sSql = sSql & " where ATD_TransactionDate between '" & objGen.FormatDtForRDBMS(dFromDate, "CT") & "' And DateAdd(s, -1, DateAdd(d, 1,'" & objGen.FormatDtForRDBMS(dToDate, "CT") & "')) And ATD_CompID=" & iCompID & " And ATD_SubGL In (" & strUser & ") "
            'sSql = sSql & "order by ATD_BillID"

            If iParty > 0 Then
                sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
                sSql = sSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                sSql = sSql & " where ATD_YearID=" & iYearId & " and ATD_GL=" & GLid & " And ATD_SubGL=" & iParty & " And ATD_CompID= " & iCompID & " and ATD_Status='A' "
                If iZoneID > 0 Then
                    sSql = sSql & " and ACC_PM_ZoneID=" & iZoneID & ""
                End If
                If iRegionID > 0 Then
                    sSql = sSql & " and ACC_PM_RegionID=" & iRegionID & ""
                End If
                If iAreaID > 0 Then
                    sSql = sSql & " and ACC_PM_AreaID=" & iAreaID & ""
                End If
                If iBranchID > 0 Then
                    sSql = sSql & " and ACC_PM_BranchID=" & iBranchID & ""
                End If
                sSql = sSql & "order by ATD_BillID"
            Else
                sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
                sSql = sSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                sSql = sSql & " where ATD_YearID=" & iYearId & " and ATD_CompID= " & iCompID & " And ATD_SubGL In (" & strUser & ") and ATD_Status='A'"
                If iZoneID > 0 Then
                    sSql = sSql & " and ACC_PM_ZoneID=" & iZoneID & ""
                End If
                If iRegionID > 0 Then
                    sSql = sSql & " and ACC_PM_RegionID=" & iRegionID & ""
                End If
                If iAreaID > 0 Then
                    sSql = sSql & " and ACC_PM_AreaID=" & iAreaID & ""
                End If
                If iBranchID > 0 Then
                    sSql = sSql & " and ACC_PM_BranchID=" & iBranchID & ""
                End If
                sSql = sSql & "order by ATD_BillID"
            End If

            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()

                    'If IsDBNull(dtGL.Rows(i)("ATD_TransactionDate").ToString()) = False Then
                    '    dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("ATD_TransactionDate").ToString(), "D")
                    'End If

                    If IsDBNull(dtGL.Rows(i)("ATD_BillId").ToString()) = False Then
                        If dtGL.Rows(i)("ATD_TrType").ToString() = "1" Then 'Payment
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtPay)

                            DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " " 'And Acc_PM_InvoiceDate=" & Pdate & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_PM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_PM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_PM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Payment"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PM_Party"), dttrans.Rows(0)("Acc_PM_Location"))
                            End If
                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "2" Then 'Petty Cash
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtPetty)

                            DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " " 'And Acc_PCM_BillDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_PCM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_PCM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_PCM_BillDate"), "D")
                                dRow("ATD_TrType") = "Petty Cash"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PCM_Party"), dttrans.Rows(0)("Acc_PCM_Location"))
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "3" Then 'Receipt
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtReceipt)

                            DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_RM_InvoiceDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_RM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_RM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_RM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Receipt"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_RM_Party"), dttrans.Rows(0)("Acc_RM_Location"))
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "4" Then 'JE
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtJE)

                            DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 Then
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_JE_BillDate in(" & Pdate & ")  "
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_JE_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_JE_BillNo")
                                dRow("ATD_TransactionDate") = objDB.SQLExecuteScalar(sNameSpace, "Select AJE_BillDate from Acc_JE_Master_Details Where AJE_MasterID=" & dttrans.Rows(0)("Acc_JE_ID") & " And AJE_CompID=" & iCompID & " And AJE_yearID=" & iYearId & " ").ToString
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dRow("ATD_TransactionDate"), "D")
                                If dRow("ATD_TransactionDate") = "01/01/1900" Then
                                    dRow("ATD_TransactionDate") = ""
                                End If
                                'dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_JE_BillDate"), "D")
                                dRow("ATD_TrType") = "Journal Entry"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_JE_Party"), dttrans.Rows(0)("Acc_JE_Location"))
                            End If

                        End If
                    End If

                    If dtData.Rows.Count > 0 Then
                        If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                            dttab = DVGLCODE.ToTable
                            If dtGL.Rows.Count > 0 Then
                                dRow("GLCode") = dttab.Rows(0)("gl_glCode")
                            End If
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                            dttab = DVGLCODE.ToTable
                            If dtGL.Rows.Count > 0 Then
                                dRow("GLDesc") = dttab.Rows(0)("gl_Desc")
                            End If
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                            dttab = DVGLCODE.ToTable
                            If dtGL.Rows.Count > 0 Then
                                dRow("SubGLCode") = dttab.Rows(0)("gl_glCode")
                            End If
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                            dttab = DVGLCODE.ToTable
                            If dtGL.Rows.Count > 0 Then
                                dRow("subDesc") = dttab.Rows(0)("gl_Desc")
                            End If
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_Debit").ToString()) = False Then
                            dRow("ATD_Debit") = dtGL.Rows(i)("ATD_Debit").ToString()
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_Credit").ToString()) = False Then
                            dRow("ATD_Credit") = dtGL.Rows(i)("ATD_Credit").ToString()
                        End If
                        dt.Rows.Add(dRow)
                    End If

                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPaymentBillNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_PM_ID,Acc_PM_BillNo from Acc_Payment_Master where Acc_PM_Status ='A' and Acc_PM_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPaymentVoucherNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_PM_ID,Acc_PM_TransactionNo from Acc_Payment_Master where Acc_PM_Status ='A' and Acc_PM_CompID =" & iCompID & " order by Acc_PM_ID"
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadReceiptBillNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_RM_ID,Acc_RM_BillNo from acc_Receipt_Master where Acc_RM_Status ='A' and Acc_RM_CompID =" & iCompID & " order by Acc_RM_ID"
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadReceiptVoucherNo(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_RM_ID,Acc_RM_TransactionNo from acc_Receipt_Master where Acc_RM_Status ='A' and Acc_RM_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function SubLedgerWithDetail(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal PartyID As Integer, ByVal glID As Integer,
                                        ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)
        Dim sSql As String = "", aSql As String = "", iSql As String = ""
        Dim pSql As String = ""
        Dim dtGL As New DataTable
        Dim dtSubGL As New DataTable
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
        Dim dRow As DataRow
        Dim dtOB As New DataTable
        Dim sStr As String = ""
        Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
        Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
        Dim dTotalClsDebit As Double = 0, dTotalClsCredit As Double = 0
        Dim dtCheck As New DataTable
        Dim iTotalCheck As Integer = 0
        Dim dtPayment As New DataTable, dtReceipt As New DataTable, dtPettyCash As New DataTable, dtJE As New DataTable
        Dim dtFinal As New DataTable
        Dim dtDateSort As New DataTable, dtPV As New DataTable, dtSV As New DataTable, dtgledger As New DataTable
        Dim dt As New DataTable
        Dim dreultDabitcredit As Double, dTotalCredit As Double, dtotaldebit As Double
        Dim dTransDebit As Double = 0, dTransCredit As Double = 0
        Try
            dt.Columns.Add("BillDate")
            dt.Columns.Add("gl_Code")
            dt.Columns.Add("TransactionType")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("Narration")
            dt.Columns.Add("CorresGLCode")
            dt.Columns.Add("CorresDescription")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TransDebit")
            dt.Columns.Add("TransCredit")
            dt.Columns.Add("ClosingDebit")
            dt.Columns.Add("ClosingCredit")
            dt.Columns.Add("Status")
            sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
            sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
            sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
            sSql = sSql & "and A.gl_head in(2,3) and A.gl_CompID =" & iCompID & " and A.gl_Delflag='C' and A.gl_Status ='A'"
            If (glID > 0) Then
                sSql = sSql & " and A.gl_Parent=" & glID & ""
            End If
            sSql = sSql & " order by A.gl_glcode"

            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    iTotalCheck = 0
                    dTotalOpnDebit = 0 : dTotalOpnCredit = 0
                    dTotalTransDebit = 0 : dTotalTransCredit = 0
                    dTotalClsDebit = 0 : dTotalClsCredit = 0
                    dTotalCredit = 0 : dtotaldebit = 0
                    dreultDabitcredit = 0
                    dRow = dt.NewRow()
                    If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
                        dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
                    End If
                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                        dRow("Gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                    End If
                    dRow("BillDate") = ""
                    dRow("Status") = "0"
                    iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_ID").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                        iSql = iSql & " and Opn_date Between '" & dFromDate & "' And '" & dToDate & "'  "
                    End If
                    If iZoneID > 0 Then
                        iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                    End If
                    If iRegionID > 0 Then
                        iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                    End If
                    If iAreaID > 0 Then
                        iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                    End If
                    If iBranchID > 0 Then
                        iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                    End If
                    dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                    If dtOB.Rows.Count > 0 Then
                        If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                            dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                            dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                        Else
                            dRow("OpDebit") = "0.00"
                        End If


                        If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                            dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                            dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                        Else
                            dRow("OpCredit") = "0.00"
                        End If
                        dRow("TransDebit") = GetTotalSubGlnDabitAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)
                        dRow("TransCredit") = GetTotalSubglCreditAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)
                        If IsDBNull(dtOB.Rows(0)("Opn_ClosingBalanceDebit").ToString()) = False Then
                            If dtOB.Rows(0)("Opn_ClosingBalanceDebit").ToString() <> "" Then
                                dRow("ClosingDebit") = dtOB.Rows(0)("Opn_ClosingBalanceDebit").ToString()
                            Else
                                dRow("ClosingDebit") = "0.00"
                            End If
                        Else
                            dRow("ClosingDebit") = "0.00"
                        End If
                        If IsDBNull(dtOB.Rows(0)("Opn_ClosingBalanceCredit").ToString()) = False Then
                            If dtOB.Rows(0)("Opn_ClosingBalanceCredit").ToString() <> "" Then
                                dRow("ClosingCredit") = dtOB.Rows(0)("Opn_ClosingBalanceCredit").ToString()
                            Else
                                dRow("ClosingCredit") = "0.00"
                            End If
                        Else
                            dRow("ClosingCredit") = "0.00"
                        End If
                        'dRow("ClosingDebit") = Convert.ToDouble(dRow("TransDebit")) + Convert.ToDouble(dRow("OpDebit"))
                        'dRow("ClosingCredit") = Convert.ToDouble(dRow("TransCredit")) + Convert.ToDouble(dRow("OpCredit"))
                        dtotaldebit = Convert.ToDouble(dRow("TransDebit")) + Convert.ToDouble(dRow("OpDebit"))
                        dTotalCredit = Convert.ToDouble(dRow("TransCredit")) + Convert.ToDouble(dRow("OpCredit"))
                        dreultDabitcredit = dtotaldebit - dTotalCredit
                        If (dreultDabitcredit > 0) Then
                            dRow("ClosingDebit") = dreultDabitcredit
                        Else
                            dreultDabitcredit = (-1) * dreultDabitcredit
                            dRow("ClosingCredit") = dreultDabitcredit
                        End If
                    Else
                        dRow("OpDebit") = "0.00"
                        dRow("OpCredit") = "0.00"
                        dRow("TransDebit") = GetTotalSubGlnDabitAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)
                        dRow("TransCredit") = GetTotalSubglCreditAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)
                        dtotaldebit = Convert.ToDouble(dRow("TransDebit")) + Convert.ToDouble(dRow("OpDebit"))
                        dTotalCredit = Convert.ToDouble(dRow("TransCredit")) + Convert.ToDouble(dRow("OpCredit"))
                        dreultDabitcredit = dtotaldebit - dTotalCredit
                        If (dreultDabitcredit > 0) Then
                            dRow("ClosingDebit") = dreultDabitcredit
                        Else
                            dreultDabitcredit = (-1) * dreultDabitcredit
                            dRow("ClosingCredit") = dreultDabitcredit
                        End If
                    End If
                    dt.Rows.Add(dRow)
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetTotalCreditAmount(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal GlCode As Integer) As Decimal
        Dim sSql As String = ""
        Dim iCOA As Decimal = 0
        Try
            sSql = "" : sSql = "Select ISNULL(sum(Opn_CreditAmount),0) from ACC_Opening_Balance where Opn_GLCode In(Select gl_glcode  from chart_of_Accounts where gl_parent=" & GlCode & ")"
            iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            'sSql = "" : sSql = "Select ISNULL(sum(ATD_Credit),0) from acc_Transactions_Details where  ATD_GL=" & GlCode & " and ATD_BillId<>0)"
            'iCOA = iCOA + objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return iCOA
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetTotalTrnCreditAmount(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal GlCode As Integer) As Decimal
        Dim sSql As String = ""
        Dim iCOA As Decimal = 0
        Try
            'sSql = "" : sSql = "Select ISNULL(sum(Opn_CreditAmount),0) from ACC_Opening_Balance where Opn_GLCode In(Select gl_glcode  from chart_of_Accounts where gl_parent=" & GlCode & ")"
            'iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            sSql = "" : sSql = "Select ISNULL(sum(ATD_Credit),0) from acc_Transactions_Details where  ATD_GL=" & GlCode & " and ATD_BillId<>0"
            iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return iCOA
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetTotalDabitAmount(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal GlCode As Integer) As Decimal
        Dim sSql As String = ""
        Dim iCOA As Decimal = 0
        Try
            sSql = "" : sSql = "Select ISNULL(sum(Opn_DebitAmt),0) from ACC_Opening_Balance where Opn_GLCode In(Select gl_glcode  from chart_of_Accounts where gl_parent=" & GlCode & ")"
            iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return iCOA
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetTotalTrnctnDabitAmount(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal GlCode As Integer) As Decimal
        Dim sSql As String = ""
        Dim iCOA As Decimal = 0
        Try

            sSql = "" : sSql = "Select ISNULL(sum(ATD_Debit),0) from acc_Transactions_Details where  ATD_SubGL=" & GlCode & " and ATD_BillId<>0"
            iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return iCOA
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetTotalSubGlnDabitAmount(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal GlCode As Integer, ByVal iYearId As Integer, ByVal iZoneID As Integer, ByVal iAreaID As Integer, ByVal iRegionID As Integer, ByVal iBranchID As Integer) As Decimal
        Dim sSql As String = ""
        Dim iCOA As Decimal = 0
        Try

            sSql = "" : sSql = "Select ISNULL(sum(ATD_Debit),0) from acc_Transactions_Details where ATD_YearID=" & iYearId & " and ATD_SubGL=" & GlCode & " and ATD_BillId<>0 and ATD_Status='A'"
            If iZoneID > 0 Then
                sSql = sSql & " and ATD_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ATD_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ATD_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ATD_BranchID=" & iBranchID & ""
            End If
            iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return iCOA
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetTotalSubglCreditAmount(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal GlCode As Integer, ByVal iYearId As Integer, ByVal iZoneID As Integer, ByVal iAreaID As Integer, ByVal iRegionID As Integer, ByVal iBranchID As Integer) As Decimal
        Dim sSql As String = ""
        Dim iCOA As Decimal = 0
        Try
            'sSql = "" : sSql = "Select ISNULL(sum(Opn_CreditAmount),0) from ACC_Opening_Balance where Opn_GLCode In(Select gl_glcode  from chart_of_Accounts where gl_parent=" & GlCode & ")"
            'iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            sSql = "" : sSql = "Select ISNULL(sum(ATD_Credit),0) from acc_Transactions_Details where ATD_YearID=" & iYearId & " and  ATD_SubGL=" & GlCode & " and ATD_BillId<>0 and ATD_Status='A'"
            If iZoneID > 0 Then
                sSql = sSql & " and ATD_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ATD_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ATD_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ATD_BranchID=" & iBranchID & ""
            End If
            iCOA = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return iCOA
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function PartySubledgerLedgerWithDetail(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal PartyID As Integer, ByVal glID As Integer,
                                                   ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String)
        Dim sSql As String = "", aSql As String = "", iSql As String = ""
        Dim pSql As String = ""
        Dim dtGL As New DataTable
        Dim dtSubGL As New DataTable
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
        Dim dRow As DataRow
        Dim dtOB As New DataTable
        Dim sStr As String = ""
        Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
        Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
        Dim dTotalClsDebit As Double = 0, dTotalClsCredit As Double = 0

        Dim dtCheck As New DataTable
        Dim iTotalCheck As Integer = 0
        Dim dtPayment As New DataTable, dtReceipt As New DataTable, dtPettyCash As New DataTable, dtJE As New DataTable
        Dim dtFinal As New DataTable
        Dim dtDateSort As New DataTable, dtPV As New DataTable, dtSV As New DataTable, dtgledger As New DataTable
        Dim dt As New DataTable
        Dim dTransDebit As Double = 0, dTransCredit As Double = 0, dreultDabitcredit As Double, dTotalCredit As Double, dtotaldebit As Double
        Try
            dt.Columns.Add("BillDate")
            dt.Columns.Add("gl_Code")
            dt.Columns.Add("TransactionType")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("Narration")
            dt.Columns.Add("CorresGLCode")
            dt.Columns.Add("CorresDescription")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TransDebit")
            dt.Columns.Add("TransCredit")
            dt.Columns.Add("ClosingDebit")
            dt.Columns.Add("ClosingCredit")
            dt.Columns.Add("Status")

            sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
            sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
            sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
            sSql = sSql & "and A.gl_head in(2,3) and A.gl_CompID =" & iCompID & " and A.gl_Delflag='C' and A.gl_Status ='A'"
            If (PartyID > 0) Then
                sSql = sSql & " and A.gl_id=" & PartyID & ""
            End If
            sSql = sSql & " order by A.gl_glcode"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    iTotalCheck = 0
                    dTotalOpnDebit = 0 : dTotalOpnCredit = 0
                    dTotalTransDebit = 0 : dTotalTransCredit = 0
                    dTotalClsDebit = 0 : dTotalCredit = 0 : dtotaldebit = 0
                    dreultDabitcredit = 0
                    dRow = dt.NewRow()
                    If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
                        dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
                    End If
                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                        dRow("Gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                    End If
                    dRow("BillDate") = ""
                    dRow("Status") = "0"
                    iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_ID").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                    If iZoneID > 0 Then
                        iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                    End If
                    If iRegionID > 0 Then
                        iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                    End If
                    If iAreaID > 0 Then
                        iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                    End If
                    If iBranchID > 0 Then
                        iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                    End If
                    If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                        iSql = iSql & " and Opn_date Between '" & dFromDate & "' And '" & dToDate & "'  "
                    End If
                    dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                    If dtOB.Rows.Count > 0 Then

                        If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                            dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                            dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                        Else
                            dRow("OpDebit") = "0.00"
                        End If
                        If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                            dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                            dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                        Else
                            dRow("OpCredit") = "0.00"
                        End If

                        If IsDBNull(dtOB.Rows(0)("Opn_ClosingBalanceDebit").ToString()) = False Then
                            If dtOB.Rows(0)("Opn_ClosingBalanceDebit").ToString() <> "" Then
                                dRow("ClosingDebit") = dtOB.Rows(0)("Opn_ClosingBalanceDebit").ToString()
                            Else
                                dRow("ClosingDebit") = "0.00"
                            End If
                        Else
                            dRow("ClosingDebit") = "0.00"
                        End If

                        If IsDBNull(dtOB.Rows(0)("Opn_ClosingBalanceCredit").ToString()) = False Then
                            If dtOB.Rows(0)("Opn_ClosingBalanceCredit").ToString() <> "" Then
                                dRow("ClosingCredit") = dtOB.Rows(0)("Opn_ClosingBalanceCredit").ToString()
                            Else
                                dRow("ClosingCredit") = "0.00"
                            End If
                        Else
                            dRow("ClosingCredit") = "0.00"
                        End If

                        dRow("TransDebit") = GetTotalSubGlnDabitAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID) 'vijaylakshmi 02/08/2019 added zone region area n branch id
                        dRow("TransCredit") = GetTotalSubglCreditAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)
                        dtotaldebit = Convert.ToDouble(dRow("TransDebit")) + Convert.ToDouble(dRow("OpDebit"))
                        dTotalCredit = Convert.ToDouble(dRow("TransCredit")) + Convert.ToDouble(dRow("OpCredit"))
                        dreultDabitcredit = dtotaldebit - dTotalCredit
                        If (dreultDabitcredit > 0) Then
                            dRow("ClosingDebit") = dreultDabitcredit
                        Else
                            dreultDabitcredit = (-1) * dreultDabitcredit
                            dRow("ClosingCredit") = dreultDabitcredit
                        End If
                    Else
                        dRow("OpDebit") = "0.00"
                        dRow("OpCredit") = "0.00"
                        dRow("TransDebit") = GetTotalSubGlnDabitAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)
                        dRow("TransCredit") = GetTotalSubglCreditAmount(sNameSpace, iCompID, dtGL.Rows(i)("gl_ID").ToString(), iYearId, iZoneID, iAreaID, iRegionID, iBranchID)

                        dtotaldebit = Convert.ToDouble(dRow("TransDebit")) + Convert.ToDouble(dRow("OpDebit"))
                        dTotalCredit = Convert.ToDouble(dRow("TransCredit")) + Convert.ToDouble(dRow("OpCredit"))
                        dreultDabitcredit = dtotaldebit - dTotalCredit
                        If (dreultDabitcredit > 0) Then
                            dRow("ClosingDebit") = dreultDabitcredit
                        Else
                            dreultDabitcredit = (-1) * dreultDabitcredit
                            dRow("ClosingCredit") = dreultDabitcredit
                        End If

                    End If
                    dt.Rows.Add(dRow)
                    'SubLeger Opening Balance
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_SLJE_BillDate as BillDate, C.Acc_SLJE_RefNo as BillNo,C.Acc_SLJE_TransactionNo as VoucherNo "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Ledger_JE_Master C On B.ATD_BillID = C.Acc_SLJE_ID and C.Acc_SLJE_Status = 'A' "
                        aSql = aSql & "join Acc_Payment_Master D On B.ATD_BillID = D.Acc_PM_ID"
                        If iZoneID > 0 Then
                            aSql = aSql & " and D.ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and D.ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and D.ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and D.ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and D.ACC_PM_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_SLJE_BillDate as BillDate, C.Acc_SLJE_RefNo as BillNo,C.Acc_SLJE_TransactionNo as VoucherNo "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Ledger_JE_Master C On B.ATD_BillID = C.Acc_SLJE_ID and C.Acc_SLJE_Status = 'A' "
                        aSql = aSql & "join Acc_Payment_Master D On B.ATD_BillID = D.Acc_PM_ID"
                        If iZoneID > 0 Then
                            aSql = aSql & " and D.ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and D.ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and D.ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and D.ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and D.ACC_PM_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_SLJE_BillDate as BillDate, C.Acc_SLJE_RefNo as BillNo,C.Acc_SLJE_TransactionNo as VoucherNo "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Ledger_JE_Master C On B.ATD_BillID = C.Acc_SLJE_ID and C.Acc_SLJE_Status = 'A' "
                        aSql = aSql & "join Acc_Payment_Master D On B.ATD_BillID = D.Acc_PM_ID"
                        If iZoneID > 0 Then
                            aSql = aSql & " and D.ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and D.ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and D.ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and D.ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and D.ACC_PM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If



                    dtJE = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtJE.Rows.Count - 1
                        dRow = dt.NewRow()
                        'dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "SubLedger BillWise Entry"
                        dRow("Narration") = "Bill Date:-" & dtJE.Rows(j)("BillDate").ToString() & "/Bill Reference No:-" & dtJE.Rows(j)("BillNo").ToString()

                        If dtJE.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtJE.Rows(j)("Debit").ToString()
                        End If

                        If dtJE.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtJE.Rows(j)("Credit").ToString()
                        End If
                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next

                    'Payment     
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_PM_BillDate as BillDate, C.Acc_PM_BillNo as BillNo,C.Acc_PM_TransactionNo as VoucherNo, C.Acc_Bill_Narration,"
                        aSql = aSql & "C.Acc_PM_Party as party,C.Acc_PM_ChequeNo as chequeNo,C.Acc_PM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 1 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Payment_Master C On B.ATD_BillID = C.Acc_PM_ID And C.Acc_PM_Status = 'A'"
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_PM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_PM_BillDate as BillDate, C.Acc_PM_BillNo as BillNo,C.Acc_PM_TransactionNo as VoucherNo, C.Acc_Bill_Narration,"
                        aSql = aSql & "C.Acc_PM_Party as party,C.Acc_PM_ChequeNo as chequeNo,C.Acc_PM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 1 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Payment_Master C On B.ATD_BillID = C.Acc_PM_ID And C.Acc_PM_Status = 'A'"
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_PM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_PM_BillDate as BillDate, C.Acc_PM_BillNo as BillNo,C.Acc_PM_TransactionNo as VoucherNo, C.Acc_Bill_Narration,"
                        aSql = aSql & "C.Acc_PM_Party as party,C.Acc_PM_ChequeNo as chequeNo,C.Acc_PM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 1 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Payment_Master C On B.ATD_BillID = C.Acc_PM_ID And C.Acc_PM_Status = 'A'"
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_PM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_PM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_PM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_PM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_PM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If

                    dtPayment = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtPayment.Rows.Count - 1
                        dRow = dt.NewRow()
                        'dRow("BillDate") = objGen.FormatDtForRDBMS(dtPayment.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtPayment.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtPayment.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "Payment"
                        dRow("Narration") = dtPayment.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtPayment.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "") & "/" & dtPayment.Rows(j)("ChequeNo").ToString()

                        If dtPayment.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtPayment.Rows(j)("Debit").ToString()
                        End If

                        If dtPayment.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtPayment.Rows(j)("Credit").ToString()
                        End If
                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next

                    'PettyCash                   
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_PCM_BillDate as BillDate, C.Acc_PCM_BillNo as BillNo,C.Acc_PCM_TransactionNo as VoucherNo, C.Acc_PCM_PaymentNarration,"
                        aSql = aSql & "C.Acc_PCM_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 2 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_PettyCash_Master C On B.ATD_BillID = C.Acc_PCM_ID and C.Acc_PCM_Status = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_PCM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_PCM_BillDate as BillDate, C.Acc_PCM_BillNo as BillNo,C.Acc_PCM_TransactionNo as VoucherNo, C.Acc_PCM_PaymentNarration,"
                        aSql = aSql & "C.Acc_PCM_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 2 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_PettyCash_Master C On B.ATD_BillID = C.Acc_PCM_ID and C.Acc_PCM_Status = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_PCM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_PCM_BillDate as BillDate, C.Acc_PCM_BillNo as BillNo,C.Acc_PCM_TransactionNo as VoucherNo, C.Acc_PCM_PaymentNarration,"
                        aSql = aSql & "C.Acc_PCM_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 2 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_PettyCash_Master C On B.ATD_BillID = C.Acc_PCM_ID and C.Acc_PCM_Status = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_PCM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_PCM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If

                    dtPettyCash = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtPettyCash.Rows.Count - 1
                        dRow = dt.NewRow()
                        'dRow("BillDate") = objGen.FormatDtForRDBMS(dtPettyCash.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtPettyCash.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtPettyCash.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "Petty Cash"
                        dRow("Narration") = dtPettyCash.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtPettyCash.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "")

                        If dtPettyCash.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtPettyCash.Rows(j)("Debit").ToString()
                        End If

                        If dtPettyCash.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtPettyCash.Rows(j)("Credit").ToString()
                        End If

                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next
                    'Receipt                   
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_RM_BillDate as BillDate, C.Acc_RM_BillNo as BillNo,C.Acc_RM_TransactionNo as VoucherNo, C.Acc_RM_BillNarration,"
                        aSql = aSql & "C.Acc_RM_Party as party,C.Acc_RM_ChequeNo as chequeNo,C.Acc_RM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 3 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Receipt_Master C On B.ATD_BillID = C.Acc_RM_ID and C.Acc_RM_Status = 'A'"
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_RM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_RM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_RM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_RM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_RM_BillDate between'" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_RM_BillDate as BillDate, C.Acc_RM_BillNo as BillNo,C.Acc_RM_TransactionNo as VoucherNo, C.Acc_RM_BillNarration,"
                        aSql = aSql & "C.Acc_RM_Party as party,C.Acc_RM_ChequeNo as chequeNo,C.Acc_RM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 3 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Receipt_Master C On B.ATD_BillID = C.Acc_RM_ID and C.Acc_RM_Status = 'A'"
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_RM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_RM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_RM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_RM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_RM_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_RM_BillDate as BillDate, C.Acc_RM_BillNo as BillNo,C.Acc_RM_TransactionNo as VoucherNo, C.Acc_RM_BillNarration,"
                        aSql = aSql & "C.Acc_RM_Party as party,C.Acc_RM_ChequeNo as chequeNo,C.Acc_RM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 3 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Receipt_Master C On B.ATD_BillID = C.Acc_RM_ID and C.Acc_RM_Status = 'A'"
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_RM_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_RM_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_RM_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_RM_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_RM_BillDate between'" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If
                    dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtReceipt.Rows.Count - 1
                        dRow = dt.NewRow()
                        ' dRow("BillDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "Receipt"
                        dRow("Narration") = dtReceipt.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtReceipt.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "") & "/" & dtReceipt.Rows(j)("ChequeNo").ToString()

                        If dtReceipt.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtReceipt.Rows(j)("Debit").ToString()
                        End If

                        If dtReceipt.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtReceipt.Rows(j)("Credit").ToString()
                        End If

                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next
                    'Purchase voucher                 
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_Purchase_BillDate as BillDate, C.Acc_Purchase_BillNo as BillNo,C.Acc_Purchase_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Purchase_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_purchase_Master C On B.ATD_BillID = C.Acc_Purchase_ID and C.Acc_Purchase_DelFlag = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            iSql = iSql & " and C.ACC_Purchase_BillDate '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_Purchase_BillDate as BillDate, C.Acc_Purchase_BillNo as BillNo,C.Acc_Purchase_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Purchase_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_purchase_Master C On B.ATD_BillID = C.Acc_Purchase_ID and C.Acc_Purchase_DelFlag = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_Purchase_BillDate between'" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_Purchase_BillDate as BillDate, C.Acc_Purchase_BillNo as BillNo,C.Acc_Purchase_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Purchase_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_purchase_Master C On B.ATD_BillID = C.Acc_Purchase_ID and C.Acc_Purchase_DelFlag = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_Purchase_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_Purchase_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If
                    dtPV = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtPV.Rows.Count - 1
                        dRow = dt.NewRow()
                        'dRow("BillDate") = objGen.FormatDtForRDBMS(dtPV.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtPV.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtPV.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "Purchase Voucher"
                        dRow("Narration") = dtPV.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select CSM_Name from CustomerSupplierMaster where CSM_ID =" & dtPV.Rows(j)("Party").ToString() & " and CSM_CompID =" & iCompID & "")

                        If dtPV.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtPV.Rows(j)("Debit").ToString()
                        End If

                        If dtPV.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtPV.Rows(j)("Credit").ToString()
                        End If

                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next
                    'Sales voucher                 
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "Select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_Sales_BillDate as BillDate, C.Acc_Sales_BillNo as BillNo,C.Acc_Sales_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Sales_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 8 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_Sales_masters C On B.ATD_BillID = C.Acc_Sales_ID and C.Acc_Sales_DelFlag = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_Sales_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_Sales_BillDate as BillDate, C.Acc_Sales_BillNo as BillNo,C.Acc_Sales_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Sales_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 8 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_Sales_masters C On B.ATD_BillID = C.Acc_Sales_ID and C.Acc_Sales_DelFlag = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_Sales_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.Acc_Sales_BillDate as BillDate, C.Acc_Sales_BillNo as BillNo,C.Acc_Sales_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Sales_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 8 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_Sales_masters C On B.ATD_BillID = C.Acc_Sales_ID and C.Acc_Sales_DelFlag = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_Sales_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_Sales_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If
                    dtSV = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtSV.Rows.Count - 1
                        dRow = dt.NewRow()
                        ' dRow("BillDate") = objGen.FormatDtForRDBMS(dtSV.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtSV.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtSV.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "Sales Voucher"
                        dRow("Narration") = dtSV.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select BM_Name from sales_Buyers_Masters where BM_ID =" & dtSV.Rows(j)("Party").ToString() & " and BM_CompID =" & iCompID & "")

                        If dtSV.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtSV.Rows(j)("Debit").ToString()
                        End If

                        If dtSV.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtSV.Rows(j)("Credit").ToString()
                        End If

                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next

                    'Journal Entry                    
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.acc_JE_InvoiceDate as BillDate, C.Acc_JE_BillNo as BillNo,C.Acc_JE_TransactionNo as VoucherNo, C.Acc_JE_PaymentNarration,"
                        aSql = aSql & "C.Acc_JE_Party as party,C.Acc_JE_ChequeNo as chequeNo,C.Acc_JE_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 4 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_JE_Master C On B.ATD_BillID = C.Acc_JE_ID and C.Acc_JE_Status = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_JE_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_JE_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_JE_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_JE_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_JE_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.acc_JE_InvoiceDate as BillDate, C.Acc_JE_BillNo as BillNo,C.Acc_JE_TransactionNo as VoucherNo, C.Acc_JE_PaymentNarration,"
                        aSql = aSql & "C.Acc_JE_Party as party,C.Acc_JE_ChequeNo as chequeNo,C.Acc_JE_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 4 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_JE_Master C On B.ATD_BillID = C.Acc_JE_ID and C.Acc_JE_Status = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_JE_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_JE_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_JE_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_JE_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_JE_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "1" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,B.ATD_Debit as Debit, B.ATD_Credit as Credit,"
                        aSql = aSql & "C.acc_JE_InvoiceDate as BillDate, C.Acc_JE_BillNo as BillNo,C.Acc_JE_TransactionNo as VoucherNo, C.Acc_JE_PaymentNarration,"
                        aSql = aSql & "C.Acc_JE_Party as party,C.Acc_JE_ChequeNo as chequeNo,C.Acc_JE_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 4 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & "B.ATD_CompID = " & iCompID & " And B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_JE_Master C On B.ATD_BillID = C.Acc_JE_ID and C.Acc_JE_Status = 'A' "
                        If iZoneID > 0 Then
                            aSql = aSql & " and C.ACC_JE_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " and C.ACC_JE_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " and C.ACC_JE_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " and C.ACC_JE_BranchID=" & iBranchID & ""
                        End If
                        If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                            aSql = aSql & " and C.ACC_JE_BillDate between '" & dFromDate & "' And '" & dToDate & "'  "
                        End If
                    End If
                    dtJE = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    For j = 0 To dtJE.Rows.Count - 1
                        dRow = dt.NewRow()
                        'dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                        dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                        If dRow("BillDate") = "01-01-1990" Or dRow("BillDate") = "01/01/1900" Or dRow("BillDate") = "01/01/1990" Or dRow("BillDate") = "01-01-1900" Then
                            dRow("BillDate") = ""
                        Else
                            dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                        End If
                        dRow("TransactionType") = "Journal Entry"
                        dRow("Narration") = dtJE.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtJE.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "") & "/" & dtJE.Rows(j)("ChequeNo").ToString()
                        dRow("CorresGLCode") = dtJE.Rows(j)("GLcode").ToString()
                        dRow("CorresDescription") = dtJE.Rows(j)("GLDescription").ToString()

                        If dtJE.Rows(j)("Debit").ToString() = "" Then
                            dRow("TransDebit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransDebit") = dtJE.Rows(j)("Debit").ToString()
                        End If

                        If dtJE.Rows(j)("Credit").ToString() = "" Then
                            dRow("TransCredit") = "0.00" : dTransDebit = 0
                        Else
                            dRow("TransCredit") = dtJE.Rows(j)("Credit").ToString()
                        End If
                        dRow("Status") = "1"
                        dt.Rows.Add(dRow)
                    Next
                Next
            End If

            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    'Public Function LoadPurchaseRegister(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
    '                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer) As DataTable
    '    Dim sSql As String = ""
    '    Dim dt As New DataTable
    '    Dim dtGL As New DataTable
    '    Dim i As Integer = 0
    '    Dim dRow As DataRow

    '    Dim dGrossTotal As Double = 0 : Dim dVatAmount As Double = 0 : Dim dOtherCharge As Double = 0
    '    Dim dRoundOff As Double = 0 : Dim dGrandTotal As Double = 0
    '    Dim dTradeDisAmt, dTradeNetAmt As Double
    '    Try
    '        dt.Columns.Add("Date")
    '        dt.Columns.Add("Particulars")
    '        dt.Columns.Add("VoucherType")
    '        dt.Columns.Add("VoucherNo")
    '        dt.Columns.Add("SupplierInvoiceNo")
    '        dt.Columns.Add("GrossTotal")
    '        dt.Columns.Add("VatRate")
    '        dt.Columns.Add("VatAmount")
    '        dt.Columns.Add("OtherCharge")
    '        dt.Columns.Add("RoundOff")
    '        dt.Columns.Add("GrandTotal")
    '        dt.Columns.Add("TradeDisAmt")
    '        dt.Columns.Add("TradeNetAmt")

    '        'sSql = "" : sSql = "Select A.Acc_Purchase_ReceiptDate,A.Acc_Purchase_BillDate,C.CSM_Name,A.Acc_Purchase_TransactionNo,A.Acc_Purchase_BillNo,
    '        '                    Sum(B.PD_DiscountAmount) as DiscountAmt,Sum(B.PD_ChargePerItem) as Charge,Sum(B.PD_Amount) as BasicAmt,Sum(B.PD_GSTAmount) as GSTAmount,Sum(B.PD_FinalTotal) as FinalAmt
    '        '                    from acc_Purchase_Master A 
    '        '                    join acc_Purchase_Details B ON A.Acc_Purchase_ID = B.PD_MasterID 
    '        '                    join CustomerSupplierMaster C On A.Acc_Purchase_Party=C.CSM_ID 
    '        '                    Where A.Acc_Purchase_Status='A' And A.ACC_Purchase_Year=" & iYearID & " "


    '        sSql = "" : sSql = "Select A.Acc_Purchase_ReceiptDate,A.Acc_Purchase_BillDate,C.CSM_Name,A.Acc_Purchase_TransactionNo,A.Acc_Purchase_BillNo,A.Acc_Purchase_OtherCharges,"
    '        sSql = sSql & "Sum(B.Acc_PMD_Amount) as Gross,Sum(B.Acc_PMD_TaxAmount) as VatAmount,A.Acc_Purchase_OtherCharges,D.gl_reason_Creation as VatRate,B.Acc_PMD_RoundOff,Sum(B.Acc_PMD_TradeDisAmt) as TradeDisAmt,Sum(B.Acc_PMD_NetAmount ) as TradeNetAmt "
    '        sSql = sSql & "from acc_Purchase_Master A join acc_Purchase_Master_Details B ON "
    '        sSql = sSql & "A.Acc_Purchase_ID = B.Acc_PMD_MasterID "
    '        sSql = sSql & "join CustomerSupplierMaster C On A.Acc_Purchase_Party=C.CSM_ID "
    '        sSql = sSql & "join Chart_of_Accounts D on D.gl_id = B.Acc_PMD_TaxRate Where A.Acc_Purchase_Status='A' And A.ACC_Purchase_Year=" & iYearID & " "

    '        If iMonthID > 0 And iPartyID = 0 Then
    '            sSql = sSql & " And Month(A.ACC_Purchase_BillDate) =" & iMonthID & " "
    '        ElseIf iMonthID = 0 And iPartyID > 0 Then
    '            sSql = sSql & " And A.ACC_Purchase_Party =" & iPartyID & ""
    '        ElseIf iMonthID > 0 And iPartyID > 0 Then
    '            sSql = sSql & " And Month(A.ACC_Purchase_BillDate) =" & iMonthID & " And A.ACC_Purchase_Party =" & iPartyID & ""
    '        End If
    '        If iZoneID > 0 Then
    '            sSql = sSql & " and A.ACC_Purchase_ZoneID=" & iZoneID & ""
    '        End If
    '        If iRegionID > 0 Then
    '            sSql = sSql & " and A.ACC_Purchase_RegionID=" & iRegionID & ""
    '        End If
    '        If iAreaID > 0 Then
    '            sSql = sSql & " and A.ACC_Purchase_AreaID=" & iAreaID & ""
    '        End If
    '        If iBranchID > 0 Then
    '            sSql = sSql & " and A.ACC_Purchase_BranchID=" & iBranchID & ""
    '        End If
    '        sSql = sSql & "Group by A.Acc_Purchase_ReceiptDate,A.Acc_Purchase_BillDate,C.CSM_Name,A.Acc_Purchase_TransactionNo,"
    '        sSql = sSql & "A.Acc_Purchase_BillNo,A.Acc_Purchase_OtherCharges,D.gl_reason_Creation,B.Acc_PMD_RoundOff "
    '        sSql = sSql & " Order by A.Acc_Purchase_BillDate"

    '        'sSql = sSql & "Group by A.Acc_Purchase_ReceiptDate,A.Acc_Purchase_BillDate,C.CSM_Name,A.Acc_Purchase_TransactionNo,A.Acc_Purchase_BillNo Order by A.Acc_Purchase_BillDate"

    '        dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGL.Rows.Count > 0 Then
    '            For i = 0 To dtGL.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If dtGL.Rows(i)("Acc_Purchase_BillDate").ToString() = "" Then
    '                    dRow("Date") = ""
    '                Else
    '                    dRow("Date") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("Acc_Purchase_BillDate").ToString(), "D")
    '                End If

    '                If dtGL.Rows(i)("CSM_Name").ToString() = "" Then
    '                    dRow("Particulars") = ""
    '                Else
    '                    dRow("Particulars") = dtGL.Rows(i)("CSM_Name").ToString()
    '                End If

    '                dRow("VoucherType") = "Purchase"

    '                If dtGL.Rows(i)("Acc_Purchase_TransactionNo").ToString() = "" Then
    '                    dRow("VoucherNo") = ""
    '                Else
    '                    dRow("VoucherNo") = dtGL.Rows(i)("Acc_Purchase_TransactionNo").ToString()
    '                End If

    '                If dtGL.Rows(i)("Acc_Purchase_BillNo").ToString() = "" Then
    '                    dRow("SupplierInvoiceNo") = ""
    '                Else
    '                    dRow("SupplierInvoiceNo") = dtGL.Rows(i)("Acc_Purchase_BillNo").ToString() & " - " & objGen.FormatDtForRDBMS(dtGL.Rows(i)("Acc_Purchase_BillDate").ToString(), "D")
    '                End If

    '                If dtGL.Rows(i)("Gross").ToString() = "" Then
    '                    dRow("GrossTotal") = "0"
    '                Else
    '                    dGrossTotal = dGrossTotal + Convert.ToDecimal(dtGL.Rows(i)("Gross").ToString()).ToString("#,##0.00")
    '                    dRow("GrossTotal") = Convert.ToDecimal(dtGL.Rows(i)("Gross").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("VatRate").ToString() = "" Then
    '                    dRow("VatRate") = "0"
    '                Else
    '                    dRow("VatRate") = dtGL.Rows(i)("VatRate").ToString() & " %"
    '                End If

    '                If dtGL.Rows(i)("VatAmount").ToString() = "" Then
    '                    dRow("VatAmount") = "0"
    '                Else
    '                    dVatAmount = dVatAmount + Convert.ToDecimal(dtGL.Rows(i)("VatAmount").ToString()).ToString("#,##0.00")
    '                    dRow("VatAmount") = Convert.ToDecimal(dtGL.Rows(i)("VatAmount").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("Acc_Purchase_OtherCharges").ToString() = "" Then
    '                    dRow("OtherCharge") = "0"
    '                Else
    '                    dOtherCharge = dOtherCharge + Convert.ToDecimal(dtGL.Rows(i)("Acc_Purchase_OtherCharges").ToString()).ToString("#,##0.00")
    '                    dRow("OtherCharge") = Convert.ToDecimal(dtGL.Rows(i)("Acc_Purchase_OtherCharges").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("Acc_PMD_RoundOff").ToString() = "" Then
    '                    dRow("RoundOff") = "0"
    '                Else
    '                    dRoundOff = dRoundOff + Convert.ToDecimal(dtGL.Rows(i)("Acc_PMD_RoundOff").ToString()).ToString("#,##0.00")
    '                    dRow("RoundOff") = Convert.ToDecimal(dtGL.Rows(i)("Acc_PMD_RoundOff").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("TradeDisAmt").ToString() = "" Then
    '                    dRow("TradeDisAmt") = "0"
    '                Else
    '                    dTradeDisAmt = dTradeDisAmt + Convert.ToDecimal(dtGL.Rows(i)("TradeDisAmt").ToString()).ToString("#,##0.00")
    '                    dRow("TradeDisAmt") = Convert.ToDecimal(dtGL.Rows(i)("TradeDisAmt").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("TradeNetAmt").ToString() = "" Then
    '                    dRow("TradeNetAmt") = "0"
    '                Else
    '                    dTradeNetAmt = dTradeNetAmt + Convert.ToDecimal(dtGL.Rows(i)("TradeNetAmt").ToString()).ToString("#,##0.00")
    '                    dRow("TradeNetAmt") = Convert.ToDecimal(dtGL.Rows(i)("TradeNetAmt").ToString()).ToString("#,##0.00")
    '                End If

    '                dGrandTotal = dGrandTotal + Convert.ToDouble(dRow("TradeNetAmt")) + Convert.ToDouble(dRow("VatAmount")) + Convert.ToDouble(dtGL.Rows(i)("Acc_Purchase_OtherCharges"))
    '                dRow("GrandTotal") = Convert.ToDouble(dRow("TradeNetAmt")) + Convert.ToDouble(dRow("VatAmount")) + Convert.ToDouble(dtGL.Rows(i)("Acc_Purchase_OtherCharges"))

    '                dt.Rows.Add(dRow)
    '            Next
    '        End If

    '        dRow = dt.NewRow()
    '        dRow("Particulars") = "TOTAL"
    '        dRow("GrossTotal") = Convert.ToDecimal(dGrossTotal).ToString("#,##0.00")
    '        dRow("VatAmount") = Convert.ToDecimal(dVatAmount).ToString("#,##0.00")
    '        dRow("OtherCharge") = Convert.ToDecimal(dOtherCharge).ToString("#,##0.00")
    '        dRow("RoundOff") = Convert.ToDecimal(dRoundOff).ToString("#,##0.00")
    '        dRow("GrandTotal") = Convert.ToDecimal(dGrandTotal).ToString("#,##0.00")
    '        dRow("TradeDisAmt") = Convert.ToDecimal(dTradeDisAmt).ToString("#,##0.00")
    '        dRow("TradeNetAmt") = Convert.ToDecimal(dTradeNetAmt).ToString("#,##0.00")
    '        dt.Rows.Add(dRow)

    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function LoadPurchaseRegister(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                         ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dtGL As New DataTable
        Dim i As Integer = 0
        Dim dRow As DataRow
        Try
            dt.Columns.Add("Date")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("VoucherType")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("SupplierInvoiceNo")
            dt.Columns.Add("Total")
            dt.Columns.Add("DiscountAmt")
            dt.Columns.Add("Charge")
            dt.Columns.Add("Amount")
            dt.Columns.Add("GSTAmt")
            dt.Columns.Add("NetAmount")

            sSql = "" : sSql = "Select A.Acc_Purchase_BillDate,C.CSM_Name,A.Acc_Purchase_TransactionNo,A.Acc_Purchase_BillNo,"
            sSql = sSql & " Sum(B.PD_RateAmount) as Total,Sum(B.PD_DiscountAmount) as DiscountAmt,Sum(B.PD_ChargePerItem) as Charge,Sum(B.PD_Amount ) as Amount,"
            sSql = sSql & " Sum(B.PD_GSTAmount ) as GSTAmt, Sum(B.PD_FinalTotal ) as NetAmount"
            sSql = sSql & " from acc_Purchase_Master A join ACC_Purchase_Details B ON A.Acc_Purchase_ID = B.PD_MasterID"
            sSql = sSql & " join CustomerSupplierMaster C On A.Acc_Purchase_Party=C.CSM_ID"
            sSql = sSql & " Where A.Acc_Purchase_Status='A' And A.ACC_Purchase_Year=" & iYearID & " "

            If iMonthID > 0 And iPartyID = 0 Then
                sSql = sSql & " And Month(A.ACC_Purchase_BillDate) =" & iMonthID & " "
            ElseIf iMonthID = 0 And iPartyID > 0 Then
                sSql = sSql & " And A.ACC_Purchase_Party =" & iPartyID & ""
            ElseIf iMonthID > 0 And iPartyID > 0 Then
                sSql = sSql & " And Month(A.ACC_Purchase_BillDate) =" & iMonthID & " And A.ACC_Purchase_Party =" & iPartyID & ""
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_Purchase_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_Purchase_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_Purchase_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_Purchase_BranchID=" & iBranchID & ""
            End If
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and acc_purchase_billdate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            sSql = sSql & "Group by A.Acc_Purchase_BillDate,C.CSM_Name,A.Acc_Purchase_TransactionNo,A.Acc_Purchase_BillNo"
            sSql = sSql & " Order by A.Acc_Purchase_BillDate"

            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()
                    If dtGL.Rows(i)("Acc_Purchase_BillDate").ToString() = "" Then
                        dRow("Date") = ""
                    Else
                        dRow("Date") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("Acc_Purchase_BillDate").ToString(), "D")
                    End If

                    If dtGL.Rows(i)("CSM_Name").ToString() = "" Then
                        dRow("Particulars") = ""
                    Else
                        dRow("Particulars") = dtGL.Rows(i)("CSM_Name").ToString()
                    End If

                    dRow("VoucherType") = "Purchase"

                    If dtGL.Rows(i)("Acc_Purchase_TransactionNo").ToString() = "" Then
                        dRow("VoucherNo") = ""
                    Else
                        dRow("VoucherNo") = dtGL.Rows(i)("Acc_Purchase_TransactionNo").ToString()
                    End If

                    If dtGL.Rows(i)("Acc_Purchase_BillNo").ToString() = "" Then
                        dRow("SupplierInvoiceNo") = ""
                    Else
                        dRow("SupplierInvoiceNo") = dtGL.Rows(i)("Acc_Purchase_BillNo").ToString() & " - " & objGen.FormatDtForRDBMS(dtGL.Rows(i)("Acc_Purchase_BillDate").ToString(), "D")
                    End If

                    If dtGL.Rows(i)("Total").ToString() = "" Then
                        dRow("Total") = "0"
                    Else
                        dRow("Total") = Convert.ToDecimal(dtGL.Rows(i)("Total").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("DiscountAmt").ToString() = "" Then
                        dRow("DiscountAmt") = "0"
                    Else
                        dRow("DiscountAmt") = Convert.ToDecimal(dtGL.Rows(i)("DiscountAmt").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("Charge").ToString() = "" Then
                        dRow("Charge") = "0"
                    Else
                        dRow("Charge") = Convert.ToDecimal(dtGL.Rows(i)("Charge").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("Amount").ToString() = "" Then
                        dRow("Amount") = "0"
                    Else
                        dRow("Amount") = Convert.ToDecimal(dtGL.Rows(i)("Amount").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("GSTAmt").ToString() = "" Then
                        dRow("GSTAmt") = "0"
                    Else
                        dRow("GSTAmt") = Convert.ToDecimal(dtGL.Rows(i)("GSTAmt").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("NetAmount").ToString() = "" Then
                        dRow("NetAmount") = "0"
                    Else
                        dRow("NetAmount") = Convert.ToDecimal(dtGL.Rows(i)("NetAmount").ToString()).ToString("#,##0.00")
                    End If

                    dt.Rows.Add(dRow)
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    'Public Function LoadSalesRegister(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
    '                                  ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer) As DataTable
    '    Dim sSql As String = ""
    '    Dim dt As New DataTable
    '    Dim dtGL As New DataTable
    '    Dim i As Integer = 0
    '    Dim dRow As DataRow

    '    Dim dGrossTotal As Double = 0 : Dim dVatAmount As Double = 0 : Dim dOtherCharge As Double = 0
    '    Dim dRoundOff As Double = 0 : Dim dGrandTotal As Double = 0
    '    Dim dTradeDisAmt, dTradeNetAmt As Double
    '    Try
    '        dt.Columns.Add("Date")
    '        dt.Columns.Add("Particulars")
    '        dt.Columns.Add("VoucherType")
    '        dt.Columns.Add("VoucherNo")
    '        dt.Columns.Add("SupplierInvoiceNo")
    '        dt.Columns.Add("GrossTotal")
    '        dt.Columns.Add("VatRate")
    '        dt.Columns.Add("VatAmount")
    '        dt.Columns.Add("OtherCharge")
    '        dt.Columns.Add("RoundOff")
    '        dt.Columns.Add("GrandTotal")
    '        dt.Columns.Add("TradeDisAmt")
    '        dt.Columns.Add("TradeNetAmt")

    '        'sSql = "" : sSql = "Select A.Acc_Sales_ReceiptDate,A.Acc_Sales_BillDate,C.BM_Name,A.Acc_Sales_TransactionNo,A.Acc_Sales_BillNo,
    '        '                    Sum(B.PD_DiscountAmount) as DiscountAmt,Sum(B.PD_ChargePerItem) as Charge,Sum(B.PD_Amount) as BasicAmt,Sum(B.PD_GSTAmount) as GSTAmount,Sum(B.PD_FinalTotal) as FinalAmt
    '        '                    from acc_Sales_Masters A 
    '        '                    join acc_Sales_Details B ON A.Acc_Sales_ID = B.PD_MasterID 
    '        '                    join Sales_Buyers_Masters C On A.Acc_Sales_Party=C.BM_ID 
    '        '                    Where A.Acc_Sales_Status='A' And A.ACC_Sales_Year=" & iYearID & ""

    '        sSql = "" : sSql = "Select A.Acc_Sales_ReceiptDate,A.Acc_Sales_BillDate,C.BM_Name,A.Acc_Sales_TransactionNo,A.Acc_Sales_BillNo,A.Acc_Sales_OtherCharges,"
    '        sSql = sSql & "Sum(B.Acc_SMD_Amount) as Gross,Sum(B.Acc_SMD_TaxAmount) as VatAmount,A.Acc_Sales_OtherCharges,D.gl_reason_Creation as VatRate,B.Acc_SMD_RoundOff,Sum(B.Acc_SMD_TradeDisAmt ) as TradeDisAmt,Sum(B.Acc_SMD_NetAmount ) as TradeNetAmt "
    '        sSql = sSql & "from acc_Sales_Masters A join acc_Sales_Masters_Details B ON "
    '        sSql = sSql & "A.Acc_Sales_ID = B.Acc_SMD_MasterID "
    '        sSql = sSql & "join Sales_Buyers_Masters C On A.Acc_Sales_Party=C.BM_ID "
    '        sSql = sSql & "join Chart_of_Accounts D on D.gl_id = B.Acc_SMD_TaxRate Where A.Acc_Sales_Status='A' And A.ACC_Sales_Year=" & iYearID & " "

    '        If iMonthID > 0 And iPartyID = 0 Then
    '            sSql = sSql & " And Month(A.ACC_Sales_BillDate) =" & iMonthID & " "
    '        ElseIf iMonthID = 0 And iPartyID > 0 Then
    '            sSql = sSql & " And A.ACC_Sales_Party =" & iPartyID & ""
    '        ElseIf iMonthID > 0 And iPartyID > 0 Then
    '            sSql = sSql & " And Month(A.ACC_Sales_BillDate) =" & iMonthID & " And A.ACC_Sales_Party =" & iPartyID & ""
    '        End If
    '        If iZoneID > 0 Then
    '            sSql = sSql & " and A.ACC_Sales_ZoneID=" & iZoneID & ""
    '        End If
    '        If iRegionID > 0 Then
    '            sSql = sSql & " and A.ACC_Sales_RegionID=" & iRegionID & ""
    '        End If
    '        If iAreaID > 0 Then
    '            sSql = sSql & " and A.ACC_Sales_AreaID=" & iAreaID & ""
    '        End If
    '        If iBranchID > 0 Then
    '            sSql = sSql & " and A.ACC_Sales_BranchID=" & iBranchID & ""
    '        End If
    '        sSql = sSql & "Group by A.Acc_Sales_ReceiptDate,A.Acc_Sales_BillDate,C.BM_Name,A.Acc_Sales_TransactionNo,"
    '        sSql = sSql & "A.Acc_Sales_BillNo,A.Acc_Sales_OtherCharges,D.gl_reason_Creation,B.Acc_SMD_RoundOff "
    '        sSql = sSql & " Order by A.ACC_Sales_BillDate"

    '        'sSql = sSql & "Group by A.Acc_Sales_ReceiptDate,A.Acc_Sales_BillDate,C.BM_Name,A.Acc_Sales_TransactionNo,A.Acc_Sales_BillNo Order by A.Acc_Sales_BillDate"

    '        dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGL.Rows.Count > 0 Then
    '            For i = 0 To dtGL.Rows.Count - 1
    '                dRow = dt.NewRow()
    '                If dtGL.Rows(i)("ACC_Sales_BillDate").ToString() = "" Then
    '                    dRow("Date") = ""
    '                Else
    '                    dRow("Date") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("ACC_Sales_BillDate").ToString(), "D")
    '                End If

    '                If dtGL.Rows(i)("BM_Name").ToString() = "" Then
    '                    dRow("Particulars") = ""
    '                Else
    '                    dRow("Particulars") = dtGL.Rows(i)("BM_Name").ToString()
    '                End If

    '                dRow("VoucherType") = "Sales"

    '                If dtGL.Rows(i)("Acc_Sales_TransactionNo").ToString() = "" Then
    '                    dRow("VoucherNo") = ""
    '                Else
    '                    dRow("VoucherNo") = dtGL.Rows(i)("Acc_Sales_TransactionNo").ToString()
    '                End If

    '                If dtGL.Rows(i)("Acc_Sales_BillNo").ToString() = "" Then
    '                    dRow("SupplierInvoiceNo") = ""
    '                Else
    '                    dRow("SupplierInvoiceNo") = dtGL.Rows(i)("Acc_Sales_BillNo").ToString() & " - " & objGen.FormatDtForRDBMS(dtGL.Rows(i)("Acc_Sales_BillDate").ToString(), "D")
    '                End If

    '                If dtGL.Rows(i)("Gross").ToString() = "" Then
    '                    dRow("GrossTotal") = "0"
    '                Else
    '                    dGrossTotal = dGrossTotal + Convert.ToDecimal(dtGL.Rows(i)("Gross").ToString()).ToString("#,##0.00")
    '                    dRow("GrossTotal") = Convert.ToDecimal(dtGL.Rows(i)("Gross").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("VatRate").ToString() = "" Then
    '                    dRow("VatRate") = "0"
    '                Else
    '                    dRow("VatRate") = dtGL.Rows(i)("VatRate").ToString() & " %"
    '                End If

    '                If dtGL.Rows(i)("VatAmount").ToString() = "" Then
    '                    dRow("VatAmount") = "0"
    '                Else
    '                    dVatAmount = dVatAmount + Convert.ToDecimal(dtGL.Rows(i)("VatAmount").ToString()).ToString("#,##0.00")
    '                    dRow("VatAmount") = Convert.ToDecimal(dtGL.Rows(i)("VatAmount").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("Acc_Sales_OtherCharges").ToString() = "" Then
    '                    dRow("OtherCharge") = "0"
    '                Else
    '                    dOtherCharge = dOtherCharge + Convert.ToDecimal(dtGL.Rows(i)("Acc_Sales_OtherCharges").ToString()).ToString("#,##0.00")
    '                    dRow("OtherCharge") = Convert.ToDecimal(dtGL.Rows(i)("Acc_Sales_OtherCharges").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("Acc_SMD_RoundOff").ToString() = "" Then
    '                    dRow("RoundOff") = ""
    '                Else
    '                    dRoundOff = dRoundOff + Convert.ToDecimal(dtGL.Rows(i)("Acc_SMD_RoundOff").ToString()).ToString("#,##0.00")
    '                    dRow("RoundOff") = Convert.ToDecimal(dtGL.Rows(i)("Acc_SMD_RoundOff").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("TradeDisAmt").ToString() = "" Then
    '                    dRow("TradeDisAmt") = "0"
    '                Else
    '                    dTradeDisAmt = dTradeDisAmt + Convert.ToDecimal(dtGL.Rows(i)("TradeDisAmt").ToString()).ToString("#,##0.00")
    '                    dRow("TradeDisAmt") = Convert.ToDecimal(dtGL.Rows(i)("TradeDisAmt").ToString()).ToString("#,##0.00")
    '                End If

    '                If dtGL.Rows(i)("TradeNetAmt").ToString() = "" Then
    '                    dRow("TradeNetAmt") = "0"
    '                Else
    '                    dTradeNetAmt = dTradeNetAmt + Convert.ToDecimal(dtGL.Rows(i)("TradeNetAmt").ToString()).ToString("#,##0.00")
    '                    dRow("TradeNetAmt") = Convert.ToDecimal(dtGL.Rows(i)("TradeNetAmt").ToString()).ToString("#,##0.00")
    '                End If

    '                dGrandTotal = dGrandTotal + Convert.ToDouble(dRow("TradeNetAmt")) + Convert.ToDouble(dRow("VatAmount")) + Convert.ToDouble(dtGL.Rows(i)("Acc_Sales_OtherCharges"))
    '                dRow("GrandTotal") = Convert.ToDouble(dRow("TradeNetAmt")) + Convert.ToDouble(dRow("VatAmount")) + Convert.ToDouble(dtGL.Rows(i)("Acc_Sales_OtherCharges"))

    '                dt.Rows.Add(dRow)
    '            Next
    '        End If

    '        dRow = dt.NewRow()
    '        dRow("Particulars") = "TOTAL"
    '        dRow("GrossTotal") = Convert.ToDecimal(dGrossTotal).ToString("#,##0.00")
    '        dRow("VatAmount") = Convert.ToDecimal(dVatAmount).ToString("#,##0.00")
    '        dRow("OtherCharge") = Convert.ToDecimal(dOtherCharge).ToString("#,##0.00")
    '        dRow("RoundOff") = Convert.ToDecimal(dRoundOff).ToString("#,##0.00")
    '        dRow("GrandTotal") = Convert.ToDecimal(dGrandTotal).ToString("#,##0.00")
    '        dRow("TradeDisAmt") = Convert.ToDecimal(dTradeDisAmt).ToString("#,##0.00")
    '        dRow("TradeNetAmt") = Convert.ToDecimal(dTradeNetAmt).ToString("#,##0.00")
    '        dt.Rows.Add(dRow)
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function LoadSalesRegister(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                      ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dtGL As New DataTable
        Dim i As Integer = 0
        Dim dRow As DataRow
        Try
            dt.Columns.Add("Date")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("VoucherType")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("SupplierInvoiceNo")
            dt.Columns.Add("Total")
            dt.Columns.Add("DiscountAmt")
            dt.Columns.Add("Charge")
            dt.Columns.Add("Amount")
            dt.Columns.Add("GSTAmt")
            dt.Columns.Add("NetAmount")

            sSql = "" : sSql = "Select A.Acc_Sales_BillDate,C.BM_Name,A.Acc_Sales_TransactionNo,A.Acc_Sales_BillNo,"
            sSql = sSql & " Sum(B.PD_RateAmount) as Total,Sum(B.PD_DiscountAmount) as DiscountAmt,Sum(B.PD_ChargePerItem) as Charge,Sum(B.PD_Amount ) as Amount,"
            sSql = sSql & " Sum(B.PD_GSTAmount ) as GSTAmt, Sum(B.PD_FinalTotal ) as NetAmount from acc_Sales_Masters A"
            sSql = sSql & " join acc_Sales_Details B ON A.Acc_Sales_ID = B.PD_MasterID  "
            sSql = sSql & " join Sales_Buyers_Masters C On A.Acc_Sales_Party=C.BM_ID "
            sSql = sSql & " Where A.Acc_Sales_Status='A' And A.ACC_Sales_Year=" & iYearID & " "
            If iMonthID > 0 And iPartyID = 0 Then
                sSql = sSql & " And Month(A.ACC_Sales_BillDate) =" & iMonthID & " "
            ElseIf iMonthID = 0 And iPartyID > 0 Then
                sSql = sSql & " And A.ACC_Sales_Party =" & iPartyID & ""
            ElseIf iMonthID > 0 And iPartyID > 0 Then
                sSql = sSql & " And Month(A.ACC_Sales_BillDate) =" & iMonthID & " And A.ACC_Sales_Party =" & iPartyID & ""
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_Sales_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_Sales_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_Sales_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_Sales_BranchID=" & iBranchID & ""
            End If
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and acc_sales_billdate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            sSql = sSql & " Group by A.Acc_Sales_BillDate,C.BM_Name,A.Acc_Sales_TransactionNo,A.Acc_Sales_BillNo"
            sSql = sSql & " Order by A.ACC_Sales_BillDate"

            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()
                    If dtGL.Rows(i)("ACC_Sales_BillDate").ToString() = "" Then
                        dRow("Date") = ""
                    Else
                        dRow("Date") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("ACC_Sales_BillDate").ToString(), "D")
                    End If

                    If dtGL.Rows(i)("BM_Name").ToString() = "" Then
                        dRow("Particulars") = ""
                    Else
                        dRow("Particulars") = dtGL.Rows(i)("BM_Name").ToString()
                    End If

                    dRow("VoucherType") = "Sales"

                    If dtGL.Rows(i)("Acc_Sales_TransactionNo").ToString() = "" Then
                        dRow("VoucherNo") = ""
                    Else
                        dRow("VoucherNo") = dtGL.Rows(i)("Acc_Sales_TransactionNo").ToString()
                    End If

                    If dtGL.Rows(i)("Acc_Sales_BillNo").ToString() = "" Then
                        dRow("SupplierInvoiceNo") = ""
                    Else
                        dRow("SupplierInvoiceNo") = dtGL.Rows(i)("Acc_Sales_BillNo").ToString() & " - " & objGen.FormatDtForRDBMS(dtGL.Rows(i)("Acc_Sales_BillDate").ToString(), "D")
                    End If

                    If dtGL.Rows(i)("Total").ToString() = "" Then
                        dRow("Total") = "0"
                    Else
                        dRow("Total") = Convert.ToDecimal(dtGL.Rows(i)("Total").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("DiscountAmt").ToString() = "" Then
                        dRow("DiscountAmt") = "0"
                    Else
                        dRow("DiscountAmt") = Convert.ToDecimal(dtGL.Rows(i)("DiscountAmt").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("Charge").ToString() = "" Then
                        dRow("Charge") = "0"
                    Else
                        dRow("Charge") = Convert.ToDecimal(dtGL.Rows(i)("Charge").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("Amount").ToString() = "" Then
                        dRow("Amount") = "0"
                    Else
                        dRow("Amount") = Convert.ToDecimal(dtGL.Rows(i)("Amount").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("GSTAmt").ToString() = "" Then
                        dRow("GSTAmt") = "0"
                    Else
                        dRow("GSTAmt") = Convert.ToDecimal(dtGL.Rows(i)("GSTAmt").ToString()).ToString("#,##0.00")
                    End If

                    If dtGL.Rows(i)("NetAmount").ToString() = "" Then
                        dRow("NetAmount") = "0"
                    Else
                        dRow("NetAmount") = Convert.ToDecimal(dtGL.Rows(i)("NetAmount").ToString()).ToString("#,##0.00")
                    End If
                    dt.Rows.Add(dRow)
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadSuppliers(sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select CSM_ID,CSM_Code + ' - ' + CSM_Name as Name  from CustomerSupplierMaster where CSM_DelFlag='A' and CSM_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadCustomers(sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select BM_ID,BM_Code + ' - ' + BM_Name as Name  from sales_Buyers_Masters where BM_DelFlag='A' and BM_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadAllGLCodes(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "" : sSql = "Select gl_Id, gl_glcode + '-' + gl_desc as GlDesc FROM chart_of_accounts where "
            sSql = sSql & "gl_compid=" & iCompID & " and gl_head = 2 and gl_Delflag ='C' and gl_status='A' order by gl_glcode"
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPaymentReportsDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer, ByVal dPBillFromDate As String,
                                              ByVal dPBillToDate As String, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                              ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iPaymentVoucherType As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtPayment As New DataTable
        Dim dRow As DataRow
        Try
            dt.Columns.Add("SrNo")
            dt.Columns.Add("Acc_PM_TransactionNo")
            dt.Columns.Add("Acc_PM_party")
            dt.Columns.Add("Acc_PM_BillType")
            dt.Columns.Add("Acc_PM_BillNo")
            dt.Columns.Add("Acc_PM_BillDate")
            dt.Columns.Add("Acc_PM_BillAmount")
            dt.Columns.Add("Acc_BIll_Narration")
            dt.Columns.Add("Acc_PM_ChequeNo")
            dt.Columns.Add("Acc_PM_ChequeDate")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("SubGLDescription")


            sSql = "" : sSql = "Select A.Acc_PM_ID,A.Acc_PM_TransactionNo,A.Acc_PM_party,A.Acc_PM_Location,A.Acc_PM_BillType,A.Acc_PM_BillNo,A.Acc_PM_BillDate,A.Acc_PM_BillAmount,A.Acc_PM_InvoiceDate,"
            sSql = sSql & "A.Acc_BIll_Narration,A.Acc_PM_ChequeNo,convert(char(10),A.Acc_PM_ChequeDate,103) Acc_PM_ChequeDate,"
            sSql = sSql & "B.ATD_GL, B.ATD_SubGL,B.ATD_Debit, B.ATD_Credit,C.gl_glCode as GLCode, c.gl_Desc as GLDescription,"
            sSql = sSql & "D.gl_glCode as SubGLCode, D.gl_Desc as SubGLDescription "
            sSql = sSql & "from acc_Payment_Master A join Acc_Transactions_Details B on A.Acc_PM_ID = B.ATD_BillID and B.atd_trtype = 1 and A.Acc_PM_CompID = " & iCompID & " And A.Acc_PM_Status='A' And A.Acc_PM_YearID=" & iYearID & " "

            If sPBillNo <> "" Then
                sSql = sSql & " and A.Acc_PM_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & " and A.Acc_PM_ID =" & iVoucher & ""
            End If
            If dPBillFromDate <> "01/01/1900" And dPBillToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_PM_InvoiceDate Between '" & dPBillFromDate & "' And '" & dPBillToDate & "'  "
            End If

            If iMonthID > 0 And iPartyID = 0 Then
                sSql = sSql & " and Month(A.Acc_PM_InvoiceDate) = " & iMonthID & "  "
            ElseIf iMonthID = 0 And iPartyID > 0 Then
                sSql = sSql & " and A.Acc_PM_Party =" & iPartyID & " "
            ElseIf iMonthID > 0 And iPartyID > 0 Then
                sSql = sSql & " and Month(A.Acc_PM_InvoiceDate) = " & iMonthID & " And A.Acc_PM_Party =" & iPartyID & " "
            End If

            sSql = sSql & " join chart_of_Accounts C On B.atd_Gl = C.gl_id Left join chart_of_Accounts D On B.atd_SubGl = D.gl_id  Where A.Acc_PM_CompID=" & iCompID & ""
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_PM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_PM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_PM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_PM_BranchID=" & iBranchID & ""
            End If
            If iPaymentVoucherType > 0 Then
                sSql = sSql & " and A.Acc_PM_BillType =" & iPaymentVoucherType & ""
            End If
            sSql = sSql & " order by A.Acc_PM_ID"
            dtPayment = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtPayment.Rows.Count > 0 Then
                For i = 0 To dtPayment.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("SrNo") = i + 1
                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_TransactionNo").ToString()) = False Then
                        'dRow("Acc_PM_TransactionNo") = dtPayment.Rows(i)("Acc_PM_TransactionNo") & " - " & objGen.FormatDtForRDBMS(dtPayment.Rows(i)("Acc_PM_InvoiceDate").ToString(), "D")
                        dRow("Acc_PM_TransactionNo") = dtPayment.Rows(i)("Acc_PM_TransactionNo")
                    End If
                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_BillDate").ToString()) = False Then
                        dRow("Acc_PM_BillDate") = objGen.FormatDtForRDBMS(dtPayment.Rows(i)("Acc_PM_InvoiceDate").ToString(), "D")
                    End If
                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_Location").ToString()) = False Then
                        If dtPayment.Rows(i)("Acc_PM_Location").ToString() = "1" Then
                            dRow("Acc_PM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select BM_Name + ' - ' + BM_Code as Name from sales_Buyers_Masters where BM_ID=" & dtPayment.Rows(i)("Acc_PM_party") & " and  BM_Delflag='A' and BM_CompID =" & iCompID & "")
                        ElseIf dtPayment.Rows(i)("Acc_PM_Location").ToString() = "2" Then
                            dRow("Acc_PM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select CSM_Name + ' - ' + CSM_Code as Name from CustomerSupplierMaster where CSM_ID=" & dtPayment.Rows(i)("Acc_PM_party") & " and  CSM_Delflag='A' and CSM_CompID =" & iCompID & "")
                        ElseIf dtPayment.Rows(i)("Acc_PM_Location").ToString() = "3" Then
                            dRow("Acc_PM_party") = objDB.SQLExecuteScalar(sNameSpace, "Select gl_Desc from chart_of_Accounts where gl_ID=" & dtPayment.Rows(i)("Acc_PM_party") & " and  gl_Status='A' and gl_CompID =" & iCompID & "")
                        End If
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_BillType").ToString()) = False Then
                        dRow("Acc_PM_BillType") = objDB.SQLExecuteScalar(sNameSpace, "Select Mas_Desc from acc_General_Master where Mas_ID=" & dtPayment.Rows(i)("Acc_PM_BillType") & " and Mas_Status='A' and Mas_CompID =" & iCompID & "")
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_BillNo").ToString()) = False Then
                        dRow("Acc_PM_BillNo") = dtPayment.Rows(i)("Acc_PM_BillNo").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_BillAmount").ToString()) = False Then
                        dRow("Acc_PM_BillAmount") = dtPayment.Rows(i)("Acc_PM_BillAmount").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Acc_BIll_Narration").ToString()) = False Then
                        dRow("Acc_BIll_Narration") = dtPayment.Rows(i)("Acc_BIll_Narration").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Acc_PM_ChequeNo").ToString()) = False Then
                        If dtPayment.Rows(i)("Acc_PM_ChequeNo").ToString() <> "" Then
                            dRow("Acc_PM_ChequeNo") = dtPayment.Rows(i)("Acc_PM_ChequeNo").ToString()
                        Else
                            dRow("Acc_PM_ChequeNo") = "NIL"
                        End If
                    End If

                    If IsDBNull(dtPayment.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtPayment.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtPayment.Rows(i)("ATD_Credit").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtPayment.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtPayment.Rows(i)("GLDescription").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("SubGLCode").ToString()) = False Then
                        dRow("SubGLCode") = dtPayment.Rows(i)("SubGLCode").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("SubGLDescription").ToString()) = False Then
                        dRow("SubGLDescription") = dtPayment.Rows(i)("SubGLDescription").ToString()
                    End If

                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadPaymentReportsDetailsTota(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sPBillNo As String, ByVal iVoucher As Integer, ByVal dPBillFromDate As String,
                                              ByVal dPBillToDate As String, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                              ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iPaymentVoucherType As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable, dtPayment As New DataTable, dtglcount As New DataTable
        Dim dRow As DataRow
        Try
            dt.Columns.Add("SrNo")
            dt.Columns.Add("GLcount")
            dt.Columns.Add("Acc_PM_TransactionNo")
            dt.Columns.Add("Acc_PM_BillType")
            dt.Columns.Add("Acc_PM_BillDate")
            dt.Columns.Add("Debit")
            dt.Columns.Add("Credit")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDescription")
            'dt.Columns.Add("SubGLCode")
            'dt.Columns.Add("SubGLDescription")


            sSql = "" : sSql = "Select count (C.gl_glCode) as GLcount,C.gl_glCode as GLCode, c.gl_Desc as GLDescription,"
            sSql = sSql & " sum(B.ATD_Debit) as Debit , sum(B.ATD_Credit) as Credit from acc_Payment_Master A"
            sSql = sSql & " join Acc_Transactions_Details B on A.Acc_PM_ID = B.ATD_BillID and B.atd_trtype = 1 and A.Acc_PM_CompID = " & iCompID & " And A.Acc_PM_Status='A' And A.Acc_PM_YearID=" & iYearID & " "

            If sPBillNo <> "" Then
                sSql = sSql & " and A.Acc_PM_BillNo ='" & sPBillNo & "'"
            End If
            If iVoucher > 0 Then
                sSql = sSql & " and A.Acc_PM_ID =" & iVoucher & ""
            End If
            If dPBillFromDate <> "01/01/1900" And dPBillToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_PM_InvoiceDate Between '" & dPBillFromDate & "' And '" & dPBillToDate & "'  "
            End If

            If iMonthID > 0 And iPartyID = 0 Then
                sSql = sSql & " and Month(A.Acc_PM_InvoiceDate) = " & iMonthID & "  "
            ElseIf iMonthID = 0 And iPartyID > 0 Then
                sSql = sSql & " and A.Acc_PM_Party =" & iPartyID & " "
            ElseIf iMonthID > 0 And iPartyID > 0 Then
                sSql = sSql & " and Month(A.Acc_PM_InvoiceDate) = " & iMonthID & " And A.Acc_PM_Party =" & iPartyID & " "
            End If

            sSql = sSql & " join chart_of_Accounts C On B.atd_Gl = C.gl_id Left join chart_of_Accounts D On B.atd_SubGl = D.gl_id  Where A.Acc_PM_CompID=" & iCompID & ""
            If iZoneID > 0 Then
                sSql = sSql & " and A.ACC_PM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and A.ACC_PM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and A.ACC_PM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and A.ACC_PM_BranchID=" & iBranchID & ""
            End If
            If iPaymentVoucherType > 0 Then
                sSql = sSql & " and A.Acc_PM_BillType =" & iPaymentVoucherType & ""
            End If
            sSql = sSql & " group by B.ATD_GL,C.gl_glCode,c.gl_Desc order by C.gl_glCode "
            dtPayment = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            'sSql = ""
            'sSql = "Select count (C.gl_glCode) as GLcount,c.gl_glCode,c.gl_Desc,A.Acc_PM_InvoiceDate  from acc_Payment_Master A "
            'sSql = sSql & "join Acc_Transactions_Details B on A.Acc_PM_ID = B.ATD_BillID and B.atd_trtype = 1 and A.Acc_PM_CompID = 1 And A.Acc_PM_Status='A'"
            'sSql = sSql & " And A.Acc_PM_YearID=7  and Acc_PM_InvoiceDate Between '04/01/2020 ' And '03/31/ 2021'   join chart_of_Accounts C On B.atd_Gl = C.gl_id"
            'sSql = sSql & " Left join chart_of_Accounts D On B.atd_SubGl = D.gl_id"
            'sSql = sSql & " Where A.Acc_PM_CompID=1 and A.ACC_PM_ZoneID=2 and A.ACC_PM_RegionID=3 and A.ACC_PM_AreaID=5 and A.ACC_PM_BranchID=6 group by c.gl_glCode, c.gl_Desc ,A.Acc_PM_InvoiceDate"
            'sSql = sSql & " order by A.Acc_PM_InvoiceDate"
            'dtglcount = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtPayment.Rows.Count > 0 Then
                For i = 0 To dtPayment.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("SrNo") = i + 1
                    If IsDBNull(dtPayment.Rows(i)("GLcount").ToString()) = False Then
                        dRow("GLcount") = dtPayment.Rows(i)("GLcount")
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Debit").ToString()) = False Then
                        dRow("Debit") = dtPayment.Rows(i)("Debit").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("Credit").ToString()) = False Then
                        dRow("Credit") = dtPayment.Rows(i)("Credit").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("GLCode").ToString()) = False Then
                        dRow("GLCode") = dtPayment.Rows(i)("GLCode").ToString()
                    End If

                    If IsDBNull(dtPayment.Rows(i)("GLDescription").ToString()) = False Then
                        dRow("GLDescription") = dtPayment.Rows(i)("GLDescription").ToString()
                    End If

                    'If IsDBNull(dtPayment.Rows(i)("SubGLCode").ToString()) = False Then
                    '    dRow("SubGLCode") = dtPayment.Rows(i)("SubGLCode").ToString()
                    'End If

                    'If IsDBNull(dtPayment.Rows(i)("SubGLDescription").ToString()) = False Then
                    '    dRow("SubGLDescription") = dtPayment.Rows(i)("SubGLDescription").ToString()
                    'End If
                    dt.Rows.Add(dRow)
                Next

            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetPurchaseMaster(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iParty As Integer, ByVal iYearId As Integer) As DataTable
        Dim sSql As String
        Try
            sSql = "Select Acc_Purchase_ID,Acc_Purchase_Party,Acc_Purchase_TransactionNo,Acc_Purchase_BillDate,Month(Acc_Purchase_BillDate) As BillDateMonth,Acc_Purchase_BillNo  from Acc_Purchase_Master"
            sSql = sSql & " Where Acc_Purchase_CompID=" & iCompID & " and acc_purchase_year=" & iYearId & ""
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_Purchase_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and ACC_Purchase_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ACC_Purchase_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ACC_Purchase_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ACC_Purchase_BranchID=" & iBranchID & ""
            End If
            If iParty > 0 Then
                sSql = sSql & " and ACC_Purchase_Party=" & iParty & ""
            End If
            Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetSalesMaster(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String, ByVal iParty As Integer, ByVal iYearId As Integer) As DataTable
        Dim sSql As String
        Try
            sSql = "Select Acc_Sales_ID,Acc_Sales_Party,Acc_Sales_TransactionNo,Acc_Sales_BillDate,Month(Acc_Sales_BillDate) As BillDateMonth,Acc_Sales_BillNo  from Acc_Sales_Masters"
            sSql = sSql & " Where Acc_Sales_CompID=" & iCompID & " and acc_sales_year=" & iYearId & ""
            If dFromDate <> "01/01/1900" And dToDate <> "01/01/1900" Then
                sSql = sSql & " and Acc_Sales_BillDate Between '" & dFromDate & "' And '" & dToDate & "'  "
            End If
            If iZoneID > 0 Then
                sSql = sSql & " and ACC_Sales_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ACC_Sales_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ACC_Sales_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ACC_Sales_BranchID=" & iBranchID & ""
            End If
            If iParty > 0 Then
                sSql = sSql & " and ACC_Sales_Party=" & iParty & ""
            End If
            Return objDB.SQLExecuteDataTable(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadDayBookReport(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal iMonthID As Integer, ByVal iParty As Integer, ByVal iCustPartyType As Integer,
                                      ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim dt As New DataTable, dtGL As New DataTable, dtSubGL As New DataTable, dtPay As New DataTable, dtReceipt As New DataTable, dtPetty As New DataTable, dtJE As New DataTable
        Dim sSql As String = "", iSql As String = ""
        Dim i As Integer = 0, j As Integer = 0
        Dim dRow As DataRow

        Dim dtPurchase, dtSales As New DataTable
        Dim dtData As New DataTable
        Try
            dt.Columns.Add("ATD_TransactionDate")
            dt.Columns.Add("ATD_BillID")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("ATD_TrType")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDesc")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("subDesc")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("SupplierCustomer")

            dtSubGL = GetchartofAccounts(sNameSpace)
            dtPay = GetPaymentMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)
            dtReceipt = GetReceiptMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)
            dtPetty = GetPettyCashMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)
            dtJE = GetJournalEntryMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)

            dtPurchase = GetPurchaseMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iParty, iYearId)
            dtSales = GetSalesMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iParty, iYearId)

            sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType,ATD_BillId, ATD_Debit,ATD_Credit,ATD_GL, ATD_SubGL from Acc_Transactions_Details"
            sSql = sSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
            sSql = sSql & " where ATD_CompID= " & iCompID & " and ATD_YearID=" & iYearId & " And  (ATD_Trtype=1 Or ATD_Trtype=2 Or ATD_Trtype=3 Or ATD_Trtype=4 Or ATD_Trtype=8 Or ATD_Trtype=9)"

            If iZoneID > 0 Then
                sSql = sSql & " And ATD_ZoneID = " & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " And ATD_RegionID = " & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " And ATD_AreaID = " & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " And ATD_BranchID = " & iBranchID & ""
            End If
            sSql = sSql & "Order by ATD_TransactionDate"


            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()

                    'If IsDBNull(dtGL.Rows(i)("ATD_TransactionDate").ToString()) = False Then
                    '    dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("ATD_TransactionDate").ToString(), "D")
                    'End If

                    If IsDBNull(dtGL.Rows(i)("ATD_BillId").ToString()) = False Then
                        If dtGL.Rows(i)("ATD_TrType").ToString() = "1" Then ' Payment
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtPay)

                            If iMonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & iMonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf iMonthID = 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = " Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_PM_Party=" & iParty & "" 'Acc_PM_Party=" & iParty & 
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf iMonthID > 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & iMonthID & " And Acc_PM_Party=" & iParty & "" '
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                    DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " " 'And Acc_PM_InvoiceDate=" & Pdate & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_PM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_PM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_PM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Payment"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PM_Party"), dttrans.Rows(0)("Acc_PM_Location"))

                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "2" Then 'Petty Cash
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtPetty)

                            If iMonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf iMonthID = 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_PCM_Party=" & iParty & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf iMonthID > 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID & " And Acc_PCM_Party=" & iParty & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " " 'And Acc_PCM_BillDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_PCM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_PCM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_PCM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Petty Cash"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PCM_Party"), dttrans.Rows(0)("Acc_PCM_Location"))
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "3" Then 'Receipt
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtReceipt)

                            If iMonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & iMonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf iMonthID = 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_RM_Party=" & iParty & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf iMonthID > 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & iMonthID & " And Acc_RM_Party=" & iParty & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_RM_InvoiceDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_RM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_RM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_RM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Receipt"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_RM_Party"), dttrans.Rows(0)("Acc_RM_Location"))
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "4" Then 'JE
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtJE)

                            If iMonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf iMonthID = 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_JE_Party=" & iParty & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf iMonthID > 0 And iParty > 0 Then
                                If dtGL.Rows(i)("ATD_GL") = iParty Then
                                    DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID & " And Acc_JE_Party=" & iParty & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then

                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_JE_BillDate in(" & Pdate & ")  "
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_JE_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_JE_BillNo")
                                dRow("ATD_TransactionDate") = objDB.SQLExecuteScalar(sNameSpace, "Select AJE_BillDate from Acc_JE_Master_Details Where AJE_MasterID=" & dttrans.Rows(0)("Acc_JE_ID") & " And AJE_CompID=" & iCompID & " And AJE_yearID=" & iYearId & " ").ToString
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dRow("ATD_TransactionDate"), "D")
                                If dRow("ATD_TransactionDate") = "01/01/1900" Then
                                    dRow("ATD_TransactionDate") = ""
                                End If
                                'dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_JE_BillDate"), "D")
                                dRow("ATD_TrType") = "Journal Entry"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_JE_Party"), dttrans.Rows(0)("Acc_JE_Location"))
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "8" Then 'Purchase
                            If (iCustPartyType = 2 Or iCustPartyType = 0 Or iCustPartyType = 3) Then
                                Dim dttrans As New DataTable
                                Dim DVGLCODE As New DataView(dtPurchase)

                                If iMonthID > 0 And iParty = 0 Then
                                    DVGLCODE.RowFilter = "Acc_Purchase_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID
                                    dttrans = DVGLCODE.ToTable
                                ElseIf iMonthID = 0 And iParty > 0 Then
                                    If dtGL.Rows(i)("ATD_GL") = iParty Then
                                        DVGLCODE.RowFilter = "Acc_Purchase_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_Purchase_Party=" & iParty & ""
                                        dttrans = DVGLCODE.ToTable
                                    End If
                                ElseIf iMonthID > 0 And iParty > 0 Then
                                    If dtGL.Rows(i)("ATD_GL") = iParty Then
                                        DVGLCODE.RowFilter = "Acc_Purchase_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID & " And Acc_Purchase_Party=" & iParty & ""
                                        dttrans = DVGLCODE.ToTable
                                    End If
                                ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                    DVGLCODE.RowFilter = "Acc_Purchase_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_Purchase_BillDate=" & dtGL.Rows(i)("ATD_TransactionDate") & "  "
                                    dttrans = DVGLCODE.ToTable
                                End If
                                dtData = dttrans

                                If dttrans.Rows.Count > 0 Then
                                    dRow("ATD_BillId") = dttrans.Rows(0)("Acc_Purchase_TransactionNo")
                                    dRow("VoucherNo") = dttrans.Rows(0)("Acc_Purchase_BillNo")
                                    dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_Purchase_BillDate"), "D")
                                    dRow("ATD_TrType") = "Purchase"
                                    dRow("SupplierCustomer") = GetSupplierName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_Purchase_Party"))
                                End If
                            End If
                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "9" Then 'Sales
                            If (iCustPartyType = 1 Or iCustPartyType = 0 Or iCustPartyType = 3) Then
                                Dim dttrans As New DataTable
                                Dim DVGLCODE As New DataView(dtSales)

                                If iMonthID > 0 And iParty = 0 Then
                                    DVGLCODE.RowFilter = "Acc_Sales_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & iMonthID
                                    dttrans = DVGLCODE.ToTable
                                ElseIf iMonthID = 0 And iParty > 0 Then
                                    If dtGL.Rows(i)("ATD_GL") = iParty Then
                                        DVGLCODE.RowFilter = "Acc_Sales_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_Sales_Party=" & iParty & ""
                                        dttrans = DVGLCODE.ToTable
                                    End If
                                ElseIf iMonthID > 0 And iParty > 0 Then
                                    If dtGL.Rows(i)("ATD_GL") = iParty Then
                                        DVGLCODE.RowFilter = "Acc_Sales_Id=" & dtGL.Rows(i)("ATD_BillId") & " And  BillDateMonth=" & iMonthID & " And Acc_Sales_Party=" & iParty & ""
                                        dttrans = DVGLCODE.ToTable
                                    End If
                                ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                    DVGLCODE.RowFilter = "Acc_Sales_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_Sales_BillDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                    dttrans = DVGLCODE.ToTable
                                End If
                                dtData = dttrans

                                If dttrans.Rows.Count > 0 Then
                                    dRow("ATD_BillId") = dttrans.Rows(0)("Acc_Sales_TransactionNo")
                                    dRow("VoucherNo") = dttrans.Rows(0)("Acc_Sales_BillNo")
                                    dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_Sales_BillDate"), "D")
                                    dRow("ATD_TrType") = "Sales"
                                    dRow("SupplierCustomer") = GetCustomerName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_Sales_Party"))
                                End If
                            End If
                        End If

                    End If

                    '***'
                    If ((dtGL.Rows(i)("ATD_TrType").ToString() = "8") And (iCustPartyType = 2 Or iCustPartyType = 0 Or iCustPartyType = 3)) Then
                        If dtData.Rows.Count > 0 Then
                            If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    dRow("GLCode") = dttab.Rows(0)("gl_glCode")
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    dRow("GLDesc") = dttab.Rows(0)("gl_Desc")
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    If dttab.Rows.Count > 0 Then
                                        dRow("SubGLCode") = dttab.Rows(0)("gl_glCode")
                                    Else
                                        dRow("SubGLCode") = ""
                                    End If
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    If dttab.Rows.Count > 0 Then
                                        dRow("subDesc") = dttab.Rows(0)("gl_Desc")
                                    Else
                                        dRow("subDesc") = ""
                                    End If
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_Debit").ToString()) = False Then
                                dRow("ATD_Debit") = dtGL.Rows(i)("ATD_Debit").ToString()
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_Credit").ToString()) = False Then
                                dRow("ATD_Credit") = dtGL.Rows(i)("ATD_Credit").ToString()
                            End If
                            dt.Rows.Add(dRow)
                        End If
                    End If

                    If ((dtGL.Rows(i)("ATD_TrType").ToString() = "9") And (iCustPartyType = 1 Or iCustPartyType = 0 Or iCustPartyType = 3)) Then
                        If dtData.Rows.Count > 0 Then
                            If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    dRow("GLCode") = dttab.Rows(0)("gl_glCode")
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    dRow("GLDesc") = dttab.Rows(0)("gl_Desc")
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    If dttab.Rows.Count > 0 Then
                                        dRow("SubGLCode") = dttab.Rows(0)("gl_glCode")
                                    Else
                                        dRow("SubGLCode") = ""
                                    End If
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    If dttab.Rows.Count > 0 Then
                                        dRow("subDesc") = dttab.Rows(0)("gl_Desc")
                                    Else
                                        dRow("subDesc") = ""
                                    End If
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_Debit").ToString()) = False Then
                                dRow("ATD_Debit") = dtGL.Rows(i)("ATD_Debit").ToString()
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_Credit").ToString()) = False Then
                                dRow("ATD_Credit") = dtGL.Rows(i)("ATD_Credit").ToString()
                            End If
                            dt.Rows.Add(dRow)
                        End If
                    End If

                    If ((dtGL.Rows(i)("ATD_TrType").ToString() <> "8") And (dtGL.Rows(i)("ATD_TrType").ToString() <> "9")) Then

                        If dtData.Rows.Count > 0 Then
                            If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    dRow("GLCode") = dttab.Rows(0)("gl_glCode")
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    dRow("GLDesc") = dttab.Rows(0)("gl_Desc")
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    If dttab.Rows.Count > 0 Then
                                        dRow("SubGLCode") = dttab.Rows(0)("gl_glCode")
                                    Else
                                        dRow("SubGLCode") = ""
                                    End If
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                                Dim dttab As New DataTable
                                Dim DVGLCODE As New DataView(dtSubGL)
                                DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                                dttab = DVGLCODE.ToTable
                                If dtGL.Rows.Count > 0 Then
                                    If dttab.Rows.Count > 0 Then
                                        dRow("subDesc") = dttab.Rows(0)("gl_Desc")
                                    Else
                                        dRow("subDesc") = ""
                                    End If
                                End If
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_Debit").ToString()) = False Then
                                dRow("ATD_Debit") = dtGL.Rows(i)("ATD_Debit").ToString()
                            End If

                            If IsDBNull(dtGL.Rows(i)("ATD_Credit").ToString()) = False Then
                                dRow("ATD_Credit") = dtGL.Rows(i)("ATD_Credit").ToString()
                            End If
                            dt.Rows.Add(dRow)
                        End If
                    End If
                    '***'

                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadPettyCashDayBook(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal imonthID As Integer, ByVal iParty As Integer, ByVal iCustPartyType As Integer,
                                       ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim dt As New DataTable, dtGL As New DataTable, dtBank As New DataTable, dtSubGL As New DataTable, dtPay As New DataTable, dtReceipt As New DataTable, dtPetty As New DataTable, dtJE As New DataTable
        Dim sSql As String = "", iSql As String = "", aSql As String = "", strUser As String = ""
        Dim i As Integer = 0, j As Integer = 0, GLid As Integer = 0
        Dim dRow, dRow1 As DataRow, ds As New DataTable
        Dim drUsr As OleDb.OleDbDataReader
        Dim sDate As Date
        Dim dtData As New DataTable
        Dim dtAll As New DataTable
        Dim dtDistinct As New DataTable
        Dim dtMerge As New DataTable
        Dim sPerticular As String = ""
        Dim arr() As String
        Try
            dt.Columns.Add("CashReceived")
            dt.Columns.Add("Date")
            dt.Columns.Add("Particulars")
            dt.Columns.Add("V_No")
            dt.Columns.Add("TotalPayment")


            'Dim yForm = "yyyy/dd/MM"
            'Dim dFromD = Format(CDate(dFromDate), yForm)
            'Dim dToD = Format(CDate(dToDate), yForm)

            sSql = "" : sSql = "Select PDBDD_pkid,PDBD_CashReceived,pdbd_Date,PDBD_Particulars,PDBD_DebitAmount,PDBD_Voucherno from ACC_PettyCashDayBookMaster_Details "
            sSql = sSql & " where  PDBD_CompID= " & iCompID & " and pdbd_date BETWEEN '" & dFromDate & "' AND '" & dToDate & "' and pdbd_status='A'"
            sSql = sSql & "order by pdbd_Date"
            dtAll = objDB.SQLExecuteDataTable(sNameSpace, sSql)

            sSql = "" : sSql = "Select distinct(PDBD_Particulars) from ACC_PettyCashDayBookMaster_Details "
            sSql = sSql & " where  PDBD_CompID= " & iCompID & " and pdbd_date BETWEEN '" & dFromDate & "' AND '" & dToDate & "' and pdbd_status='A' and PDBD_CashReceived='0.00'"
            dtDistinct = objDB.SQLExecuteDataTable(sNameSpace, sSql)

            If dtDistinct.Rows.Count > 0 Then
                For i = 0 To dtDistinct.Rows.Count - 1
                    sPerticular = LoadPereticularsDes(sNameSpace, dtDistinct.Rows(i)("PDBD_PArticulars"))
                    sPerticular = sPerticular & " '$' "
                    dtData.Columns.Add(sPerticular)
                Next
            End If

            For i = 0 To dtAll.Rows.Count - 1
                dRow = dt.NewRow()
                dRow1 = dtData.NewRow()


                If dtAll.Rows(i)("PDBD_CashReceived") = 0 Then
                    dRow("CashReceived") = ""
                Else
                    dRow("CashReceived") = dtAll.Rows(i)("PDBD_CashReceived")
                End If

                sDate = dtAll.Rows(i)("pdbd_date").ToString()
                dRow("Date") = Convert.ToString(sDate.ToString("dd/MM/yyyy"))
                'dRow("Date") = ds.Rows(i)("pdbd_Date")
                dRow("Particulars") = LoadPereticulars(sNameSpace, (dtAll.Rows(i)("PDBD_PArticulars")))
                If dtAll.Rows(i)("PDBD_Voucherno") = "" Then
                    dRow("V_No") = ""
                Else
                    dRow("V_No") = dtAll.Rows(i)("PDBD_Voucherno")
                End If
                If dtAll.Rows(i)("PDBD_DebitAmount") = 0 Then
                    dRow("TotalPayment") = ""
                Else
                    dRow("TotalPayment") = dtAll.Rows(i)("PDBD_DebitAmount")
                End If
                dt.Rows.Add(dRow)
                ' dtData.Rows.Add(dRow1)
            Next

            dt.Merge(dtData)


            For j = 0 To dt.Rows.Count - 1   ' From here bt we should reduce the code kindly intimate me on monday about this okay , don't forget

                For m = 0 To dtDistinct.Rows.Count - 1
                    Dim input As String = ""
                    Dim input2 As String = dt.Rows(j)("Particulars")
                    input = input2.Substring(input2.LastIndexOf("-") + 1)
                    Dim input3 As String = ""
                    input3 = LoadPereticularsDes(sNameSpace, (dtDistinct.Rows(m)("PDBD_Particulars")))
                    ' Dim input4 As String = ""
                    ' input4 = input3.Substring(input2.LastIndexOf("-") + 1)
                    If input = input3 Then
                        dt.Rows(j).Item(m + 5) = dtAll.Rows(j)("PDBD_DebitAmount")
                    End If
                Next
            Next
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadPereticulars(ByVal sNameSpace As String, ByVal iPerticulars As String) As String
        Dim sSql As String
        Dim perticular As String
        Try
            sSql = "Select  gl_glcode + '-' + gl_desc as GlDesc From chart_of_Accounts  Where  gl_id=" & iPerticulars & " "
            perticular = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return perticular
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetSupplierCustomerOrGenName(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iID As Integer, ByVal iPartyType As Integer) As String
        Dim sSql As String = ""
        Dim sName As String = ""
        Try
            If iPartyType = 1 Then 'Customer
                sSql = "" : sSql = "Select BM_Name from sales_Buyers_Masters where BM_ID=" & iID & " And BM_DelFlag='A' and BM_CompID =" & iCompID & ""
                sName = objDB.SQLGetDescription(sNameSpace, sSql)
            End If
            If iPartyType = 2 Then 'Supplier
                sSql = "" : sSql = "Select CSM_Name from CustomerSupplierMaster where CSM_ID=" & iID & " And CSM_DelFlag='A' and CSM_CompID =" & iCompID & ""
                sName = objDB.SQLGetDescription(sNameSpace, sSql)
            End If
            If iPartyType = 3 Then 'GL
                sSql = "" : sSql = "Select gl_desc FROM chart_of_accounts where "
                sSql = sSql & " gl_Id=" & iID & " And gl_compid=" & iCompID & " and gl_head = 2 and gl_Delflag ='C' and gl_status='A' order by gl_glcode"
                sName = objDB.SQLGetDescription(sNameSpace, sSql)
            End If
            Return sName
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetSupplierName(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iID As Integer) As String
        Dim sSql As String = ""
        Dim sName As String = ""
        Try
            sSql = "" : sSql = "Select CSM_Name from CustomerSupplierMaster where CSM_ID=" & iID & " And CSM_DelFlag='A' and CSM_CompID =" & iCompID & ""
            sName = objDB.SQLGetDescription(sNameSpace, sSql)
            Return sName
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetCustomerName(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iID As Integer) As String
        Dim sSql As String = ""
        Dim sName As String = ""
        Try
            sSql = "" : sSql = "Select BM_Name from sales_Buyers_Masters where BM_ID=" & iID & " And BM_DelFlag='A' and BM_CompID =" & iCompID & ""
            sName = objDB.SQLGetDescription(sNameSpace, sSql)
            Return sName
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadCashBookReport(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal imonthID As Integer, ByVal iParty As Integer, ByVal iCustPartyType As Integer,
                                       ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim dt As New DataTable, dtGL As New DataTable, dtBank As New DataTable, dtSubGL As New DataTable, dtPay As New DataTable, dtReceipt As New DataTable, dtPetty As New DataTable, dtJE As New DataTable
        Dim sSql As String = "", iSql As String = "", aSql As String = "", strUser As String = ""
        Dim i As Integer = 0, j As Integer = 0, GLid As Integer = 0
        Dim dRow As DataRow
        Dim drUsr As OleDb.OleDbDataReader

        Dim dtData As New DataTable

        dtPay = GetPaymentMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)
        dtSubGL = GetchartofAccounts(sNameSpace)
        dtReceipt = GetReceiptMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)
        dtPetty = GetPettyCashMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)
        dtJE = GetJournalEntryMaster(sNameSpace, iCompID, iZoneID, iRegionID, iAreaID, iBranchID, dFromDate, dToDate, iCustPartyType, iYearId)

        'Dim dFromDateF As Date : Dim dToDateT As Date
        Try
            dt.Columns.Add("ATD_TransactionDate")
            dt.Columns.Add("ATD_BillId")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("ATD_TrType")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("GLDesc")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("subDesc")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("SupplierCustomer")

            'dFromDateF = Date.ParseExact(dFromDate, "dd/MM/yyyy", System.Globalization.CultureInfo.CurrentCulture)
            'dToDateT = Date.ParseExact(dToDate, "dd/MM/yyyy", System.Globalization.CultureInfo.CurrentCulture)

            sSql = "Select Acc_GL from acc_application_settings where Acc_Types='Cash'"
            GLid = objDB.SQLExecuteScalar(sNameSpace, sSql)
            'If GLid > 0 Then
            '    aSql = " Select GL_ID From chart_of_accounts Where gl_parent = " & GLid & ""
            'End If
            'drUsr = objDB.SQLDataReader(sNameSpace, aSql)
            'If drUsr.HasRows Then
            '    While drUsr.Read
            '        strUser = strUser & "," & drUsr("GL_ID")
            '    End While
            '    strUser = Right(strUser, Len(strUser) - 1)
            'Else
            '    strUser = "Null"
            'End If

            'sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
            'sSql = sSql & " where ATD_TransactionDate between '" & dFromDate & "' And DateAdd(s, -1, DateAdd(d, 1,'" & dToDate & "')) And ATD_CompID= " & iCompID & " And ATD_SubGL In (" & strUser & ") "
            'sSql = sSql & "order by ATD_BillID"

            'sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
            'sSql = sSql & " where ATD_TransactionDate between '" & objGen.FormatDtForRDBMS(dFromDate, "CT") & "' And DateAdd(s, -1, DateAdd(d, 1,'" & objGen.FormatDtForRDBMS(dToDate, "CT") & "')) And ATD_CompID=" & iCompID & " And ATD_SubGL In (" & strUser & ") "
            'sSql = sSql & "order by ATD_BillID"


            sSql = "" : sSql = "Select ATD_TransactionDate, ATD_TrType, ATD_BillId, ATD_Debit, ATD_Credit, ATD_GL, ATD_SubGL from Acc_Transactions_Details "
            sSql = sSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
            sSql = sSql & " where ATD_YearID=" & iYearId & " and ATD_CompID= " & iCompID & " And ATD_GL In (" & GLid & ") "
            If iZoneID > 0 Then
                sSql = sSql & " and ACC_PM_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and ACC_PM_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and ACC_PM_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and ACC_PM_BranchID=" & iBranchID & ""
            End If
            sSql = sSql & "order by ATD_BillID"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()

                    'If IsDBNull(dtGL.Rows(i)("ATD_TransactionDate").ToString()) = False Then
                    '    dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("ATD_TransactionDate").ToString(), "D")
                    'End If

                    If IsDBNull(dtGL.Rows(i)("ATD_BillId").ToString()) = False Then
                        If dtGL.Rows(i)("ATD_TrType").ToString() = "1" Then 'Payment
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtPay)

                            DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID = 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_PM_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID > 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & imonthID & " And Acc_PM_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_PM_Id=" & dtGL.Rows(i)("ATD_BillId") & " " 'And Acc_PM_InvoiceDate=" & Pdate & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_PM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_PM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_PM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Payment"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PM_Party"), dttrans.Rows(0)("Acc_PM_Location"))
                                If UCase(dRow("SupplierCustomer")) = UCase("Cash in Hand") Then
                                    dRow("SupplierCustomer") = GetSubGLName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PM_Party"), 1, dttrans.Rows(0)("Acc_PM_Id"))
                                End If
                            End If
                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "2" Then 'Petty Cash
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtPetty)

                            DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID = 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_PCM_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID > 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & imonthID & " And Acc_PCM_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_PCM_Id=" & dtGL.Rows(i)("ATD_BillId") & " " 'And Acc_PCM_BillDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_PCM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_PCM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_PCM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Petty Cash"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PCM_Party"), dttrans.Rows(0)("Acc_PCM_Location"))
                                If UCase(dRow("SupplierCustomer")) = UCase("Cash in Hand") Then
                                    dRow("SupplierCustomer") = GetSubGLName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_PCM_Party"), 2, dttrans.Rows(0)("Acc_PCM_Id"))
                                End If
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "3" Then 'Receipt
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtReceipt)

                            DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID = 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_RM_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID > 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & " And InvoiceDateMonth=" & imonthID & " And Acc_RM_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                DVGLCODE.RowFilter = "Acc_RM_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_RM_InvoiceDate=" & dtGL.Rows(i)("ATD_TransactionDate") & ""
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_RM_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_RM_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_RM_InvoiceDate"), "D")
                                dRow("ATD_TrType") = "Receipt"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_RM_Party"), dttrans.Rows(0)("Acc_RM_Location"))
                                If UCase(dRow("SupplierCustomer")) = UCase("Cash in Hand") Then
                                    dRow("SupplierCustomer") = GetSubGLName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_RM_Party"), 3, dttrans.Rows(0)("Acc_RM_Id"))
                                End If
                            End If

                        ElseIf dtGL.Rows(i)("ATD_TrType").ToString() = "4" Then 'JE
                            Dim dttrans As New DataTable
                            Dim DVGLCODE As New DataView(dtJE)

                            DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId")
                            dttrans = DVGLCODE.ToTable
                            If imonthID > 0 And iParty = 0 Then
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & imonthID
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID = 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And Acc_JE_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf imonthID > 0 And iParty > 0 Then
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & " And BillDateMonth=" & imonthID & " And Acc_JE_Party=" & iParty & ""
                                dttrans = DVGLCODE.ToTable
                            ElseIf (dFromDate <> "01/01/1900" And dToDate <> "01/01/1900") Then
                                'Dim Pdate As Date
                                'Pdate = dtGL.Rows(i)("ATD_TransactionDate")
                                DVGLCODE.RowFilter = "Acc_JE_Id=" & dtGL.Rows(i)("ATD_BillId") & "" ' And Acc_JE_BillDate in(" & Pdate & ")  "
                                dttrans = DVGLCODE.ToTable
                            End If
                            dtData = dttrans

                            If dttrans.Rows.Count > 0 Then
                                dRow("ATD_BillId") = dttrans.Rows(0)("Acc_JE_TransactionNo")
                                dRow("VoucherNo") = dttrans.Rows(0)("Acc_JE_BillNo")
                                dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dttrans.Rows(0)("Acc_JE_BillDate"), "D")
                                dRow("ATD_TrType") = "Journal Entry"
                                dRow("SupplierCustomer") = GetSupplierCustomerOrGenName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_JE_Party"), dttrans.Rows(0)("Acc_JE_Location"))
                                If UCase(dRow("SupplierCustomer")) = UCase("Cash in Hand") Then
                                    dRow("SupplierCustomer") = GetSubGLName(sNameSpace, iCompID, dttrans.Rows(0)("Acc_JE_Party"), 4, dttrans.Rows(0)("Acc_JE_Id"))
                                End If
                            End If

                        End If
                    End If

                    If dtData.Rows.Count > 0 Then
                        If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                            dttab = DVGLCODE.ToTable
                            If dtGL.Rows.Count > 0 Then
                                dRow("GLCode") = dttab.Rows(0)("gl_glCode")
                            End If
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_GL")
                            dttab = DVGLCODE.ToTable
                            If dtGL.Rows.Count > 0 Then
                                dRow("GLDesc") = dttab.Rows(0)("gl_Desc")
                            End If
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                            dttab = DVGLCODE.ToTable
                            If dttab.Rows.Count > 0 Then
                                dRow("SubGLCode") = dttab.Rows(0)("gl_glCode")
                            Else
                                dRow("SubGLCode") = ""
                            End If

                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_SubGL").ToString()) = False Then
                            Dim dttab As New DataTable
                            Dim DVGLCODE As New DataView(dtSubGL)
                            DVGLCODE.RowFilter = "Gl_id=" & dtGL.Rows(i)("ATD_SubGL")
                            dttab = DVGLCODE.ToTable
                            If dttab.Rows.Count > 0 Then
                                dRow("subDesc") = dttab.Rows(0)("gl_Desc")
                            Else
                                dRow("subDesc") = ""
                            End If

                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_Debit").ToString()) = False Then
                            dRow("ATD_Debit") = dtGL.Rows(i)("ATD_Debit").ToString()
                        End If

                        If IsDBNull(dtGL.Rows(i)("ATD_Credit").ToString()) = False Then
                            dRow("ATD_Credit") = dtGL.Rows(i)("ATD_Credit").ToString()
                        End If
                        dt.Rows.Add(dRow)
                    End If

                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadBankNames(sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = "", aSql As String = ""
        Dim dt As New DataTable
        Dim GLid As Integer = 0
        Try
            sSql = "Select Acc_Gl from acc_application_settings where Acc_Types='Bank' and Acc_LedgerType='Bank' and Acc_CompID=" & iCompID & ""
            GLid = objDB.SQLExecuteScalar(sNameSpace, sSql)
            If GLid > 0 Then
                aSql = " Select gl_Id, GL_Desc From chart_of_accounts Where gl_parent = " & GLid & " And gl_Status='A' order by gl_id"
            End If
            dt = objDB.SQLExecuteDataTable(sNameSpace, aSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetSubGLName(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iParty As Integer, ByVal iVoucherType As Integer, ByVal iVoucherID As Integer) As String
        Dim sSql As String = ""
        Try
            sSql = "Select Gl_Desc From Chart_Of_Accounts Where GL_ID In (Select ATD_SubGL From Acc_Transactions_Details Where ATD_GL <> " & iParty & " And ATD_TrType=" & iVoucherType & " And ATD_BillID=" & iVoucherID & " And ATD_ComPID=" & iCompID & ") "
            GetSubGLName = objDB.SQLGetDescription(sNameSpace, sSql)
            Return GetSubGLName
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GeneralLedgerWithDetail(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                            ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer)
        Dim sSql As String = "", aSql As String = "", iSql As String = ""
        Dim pSql As String = ""
        Dim dtGL As New DataTable
        Dim dtSubGL As New DataTable
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
        Dim dRow As DataRow
        Dim dtOB As New DataTable
        Dim sStr As String = ""
        Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
        Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
        Dim dTotalClsDebit As Double = 0, dTotalClsCredit As Double = 0
        Dim dtCheck As New DataTable
        Dim iTotalCheck As Integer = 0
        Dim dtPayment As New DataTable, dtReceipt As New DataTable, dtPettyCash As New DataTable, dtJE As New DataTable
        Dim dtFinal As New DataTable
        Dim dtDateSort As New DataTable, dtPV As New DataTable, dtSV As New DataTable

        Dim dt As New DataTable
        Dim dTransDebit As Double = 0, dTransCredit As Double = 0
        Try
            dt.Columns.Add("BillDate")
            dt.Columns.Add("gl_Code")
            dt.Columns.Add("TransactionType")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("Narration")
            dt.Columns.Add("CorresGLCode")
            dt.Columns.Add("CorresDescription")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TransDebit")
            dt.Columns.Add("TransCredit")
            dt.Columns.Add("ClosingDebit")
            dt.Columns.Add("ClosingCredit")
            dt.Columns.Add("Status")

            sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
            sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
            sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
            sSql = sSql & "and A.gl_head in (2,3) and A.gl_CompID =" & iCompID & " and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1

                    iTotalCheck = 0
                    dTotalOpnDebit = 0 : dTotalOpnCredit = 0
                    dTotalTransDebit = 0 : dTotalTransCredit = 0
                    dTotalClsDebit = 0 : dTotalClsCredit = 0
                    dRow = dt.NewRow()

                    If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
                        dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
                    End If

                    If dtGL.Rows(i)("gl_glCode").ToString() = "A020202" Or dtGL.Rows(i)("gl_glCode").ToString() = "L030201" Then
                        If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                            dRow("Gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
                        End If
                    Else
                        If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                            dRow("Gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                        End If
                    End If

                    If (dtGL.Rows(i)("Gl_Parent").ToString() = "141" Or dtGL.Rows(i)("Gl_Parent").ToString() = "67") Then
                        dRow("Gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
                    End If

                    dRow("BillDate") = ""
                    dRow("Status") = "0"

                    iSql = "" : iSql = "Select * from Acc_Ledger_Masters where ALM_GL ='" & dtGL.Rows(i)("gl_ID").ToString() & "' and  ALM_Year =" & iYearId & " and ALM_CompID =" & iCompID & ""
                    dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                    If dtOB.Rows.Count > 0 Then

                        If IsDBNull(dtOB.Rows(0)("ALM_OBDebit").ToString()) = False Then
                            dRow("OpDebit") = dtOB.Rows(0)("ALM_OBDebit").ToString()
                            dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("ALM_OBDebit").ToString()
                        Else
                            dRow("OpDebit") = "0.00"
                        End If

                        If IsDBNull(dtOB.Rows(0)("ALM_OBCredit").ToString()) = False Then
                            dRow("OpCredit") = dtOB.Rows(0)("ALM_OBCredit").ToString()
                            dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("ALM_OBCredit").ToString()
                        Else
                            dRow("OpCredit") = "0.00"
                        End If

                        'Extra'
                        If IsDBNull(dtOB.Rows(0)("ALM_TrDebit").ToString()) = False Then
                            If dtOB.Rows(0)("ALM_TrDebit").ToString() <> "" Then
                                dRow("TransDebit") = dtOB.Rows(0)("ALM_TrDebit").ToString()
                            Else
                                dRow("TransDebit") = "0.00"
                            End If
                        Else
                            dRow("TransDebit") = "0.00"
                        End If

                        If IsDBNull(dtOB.Rows(0)("ALM_TrCredit").ToString()) = False Then
                            If dtOB.Rows(0)("ALM_TrCredit").ToString() <> "" Then
                                dRow("TransCredit") = dtOB.Rows(0)("ALM_TrCredit").ToString()
                            Else
                                dRow("TransCredit") = "0.00"
                            End If
                        Else
                            dRow("TransCredit") = "0.00"
                        End If
                        'Extra'

                        If IsDBNull(dtOB.Rows(0)("ALM_CloseDebit").ToString()) = False Then
                            If dtOB.Rows(0)("ALM_CloseDebit").ToString() <> "" Then
                                dRow("ClosingDebit") = dtOB.Rows(0)("ALM_CloseDebit").ToString()
                            Else
                                dRow("ClosingDebit") = "0.00"
                            End If
                        Else
                            dRow("ClosingDebit") = "0.00"
                        End If

                        If IsDBNull(dtOB.Rows(0)("ALM_CloseCredit").ToString()) = False Then
                            If dtOB.Rows(0)("ALM_CloseCredit").ToString() <> "" Then
                                dRow("ClosingCredit") = dtOB.Rows(0)("ALM_CloseCredit").ToString()
                            Else
                                dRow("ClosingCredit") = "0.00"
                            End If
                        Else
                            dRow("ClosingCredit") = "0.00"
                        End If
                    End If
                    dt.Rows.Add(dRow)


                    'Payment     
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_PM_BillDate as BillDate, C.Acc_PM_BillNo as BillNo,C.Acc_PM_TransactionNo as VoucherNo, C.Acc_Bill_Narration,"
                        aSql = aSql & "C.Acc_PM_Party as party,C.Acc_PM_ChequeNo as chequeNo,C.Acc_PM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 1 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Payment_Master C On B.ATD_BillID = C.Acc_PM_ID And C.Acc_PM_Status = 'A'"
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_PM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_PM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_PM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_PM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_PM_BillDate as BillDate, C.Acc_PM_BillNo as BillNo,C.Acc_PM_TransactionNo as VoucherNo, C.Acc_Bill_Narration,"
                        aSql = aSql & "C.Acc_PM_Party as party,C.Acc_PM_ChequeNo as chequeNo,C.Acc_PM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 1 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Payment_Master C On B.ATD_BillID = C.Acc_PM_ID And C.Acc_PM_Status = 'A'"
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_PM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_PM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_PM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_PM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If
                    dtPayment = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtPayment.Rows.Count - 1
                    '    dRow = dt.NewRow()
                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtPayment.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "Payment"
                    '    dRow("Narration") = dtPayment.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtPayment.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "") & "/" & dtPayment.Rows(j)("ChequeNo").ToString()

                    '    If dtPayment.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtPayment.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtPayment.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtPayment.Rows(j)("Credit").ToString()
                    '    End If
                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next

                    'PettyCash                   
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_PCM_BillDate as BillDate, C.Acc_PCM_BillNo as BillNo,C.Acc_PCM_TransactionNo as VoucherNo, C.Acc_PCM_PaymentNarration,"
                        aSql = aSql & "C.Acc_PCM_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 2 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_PettyCash_Master C On B.ATD_BillID = C.Acc_PCM_ID and C.Acc_PCM_Status = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_PCM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_PCM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_PCM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_PCM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_PCM_BillDate as BillDate, C.Acc_PCM_BillNo as BillNo,C.Acc_PCM_TransactionNo as VoucherNo, C.Acc_PCM_PaymentNarration,"
                        aSql = aSql & "C.Acc_PCM_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 2 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_PettyCash_Master C On B.ATD_BillID = C.Acc_PCM_ID and C.Acc_PCM_Status = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & "  C.ACC_PCM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_PCM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_PCM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_PCM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If

                    dtPettyCash = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtPettyCash.Rows.Count - 1
                    '    dRow = dt.NewRow()

                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtPettyCash.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "Petty Cash"
                    '    dRow("Narration") = dtPettyCash.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtPettyCash.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "")

                    '    If dtPettyCash.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtPettyCash.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtPettyCash.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtPettyCash.Rows(j)("Credit").ToString()
                    '    End If

                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next


                    'Receipt                   
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_RM_BillDate as BillDate, C.Acc_RM_BillNo as BillNo,C.Acc_RM_TransactionNo as VoucherNo, C.Acc_RM_BillNarration,"
                        aSql = aSql & "C.Acc_RM_Party as party,C.Acc_RM_ChequeNo as chequeNo,C.Acc_RM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 3 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Receipt_Master C On B.ATD_BillID = C.Acc_RM_ID and C.Acc_RM_Status = 'A'"
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_RM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_RM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_RM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_RM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_RM_BillDate as BillDate, C.Acc_RM_BillNo as BillNo,C.Acc_RM_TransactionNo as VoucherNo, C.Acc_RM_BillNarration,"
                        aSql = aSql & "C.Acc_RM_Party as party,C.Acc_RM_ChequeNo as chequeNo,C.Acc_RM_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 3 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Receipt_Master C On B.ATD_BillID = C.Acc_RM_ID and C.Acc_RM_Status = 'A'"
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_RM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_RM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_RM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_RM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If

                    dtReceipt = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtReceipt.Rows.Count - 1
                    '    dRow = dt.NewRow()

                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtReceipt.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "Receipt"
                    '    dRow("Narration") = dtReceipt.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtReceipt.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "") & "/" & dtReceipt.Rows(j)("ChequeNo").ToString()

                    '    If dtReceipt.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtReceipt.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtReceipt.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtReceipt.Rows(j)("Credit").ToString()
                    '    End If

                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next


                    'Journal Entry                    
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_JE_BillDate as BillDate, C.Acc_JE_BillNo as BillNo,C.Acc_JE_TransactionNo as VoucherNo, C.Acc_JE_PaymentNarration,"
                        aSql = aSql & "C.Acc_JE_Party as party,C.Acc_JE_ChequeNo as chequeNo,C.Acc_JE_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 4 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_JE_Master C On B.ATD_BillID = C.Acc_JE_ID and C.Acc_JE_Status = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & "  C.ACC_JE_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_JE_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_JE_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_JE_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_JE_BillDate as BillDate, C.Acc_JE_BillNo as BillNo,C.Acc_JE_TransactionNo as VoucherNo, C.Acc_JE_PaymentNarration,"
                        aSql = aSql & "C.Acc_JE_Party as party,C.Acc_JE_ChequeNo as chequeNo,C.Acc_JE_ChequeDate "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 4 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_JE_Master C On B.ATD_BillID = C.Acc_JE_ID and C.Acc_JE_Status = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_JE_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_JE_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_JE_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_JE_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If

                    dtJE = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtJE.Rows.Count - 1
                    '    dRow = dt.NewRow()

                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "Journal Entry"
                    '    dRow("Narration") = dtJE.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select APM_Name from accounts_Party_Master where APM_ID =" & dtJE.Rows(j)("Party").ToString() & " and APM_CompID =" & iCompID & "") & "/" & dtJE.Rows(j)("ChequeNo").ToString()
                    '    ' dRow("CorresGLCode") = dtJE.Rows(j)("CorresGLcode").ToString()
                    '    'dRow("CorresDescription") = dtJE.Rows(j)("CorresDescription").ToString()

                    '    If dtJE.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtJE.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtJE.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtJE.Rows(j)("Credit").ToString()
                    '    End If
                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next


                    'SubLeger Opening Balance
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_SLJE_BillDate as BillDate, C.Acc_SLJE_RefNo as BillNo,C.Acc_SLJE_TransactionNo as VoucherNo "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Ledger_JE_Master C On B.ATD_BillID = C.Acc_SLJE_ID and C.Acc_SLJE_Status = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL"
                        aSql = aSql & " Left Join Acc_payment_master On Acc_PM_ID=B.ATD_BillId Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " ACC_PM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " ACC_PM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " ACC_PM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " ACC_PM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_SLJE_BillDate as BillDate, C.Acc_SLJE_RefNo as BillNo,C.Acc_SLJE_TransactionNo as VoucherNo "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 7 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join Acc_Ledger_JE_Master C On B.ATD_BillID = C.Acc_SLJE_ID and C.Acc_SLJE_Status = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL"
                        aSql = aSql & " Left Join Acc_payment_master On Acc_PM_ID=B.ATD_BillId Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " ACC_PM_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " ACC_PM_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " ACC_PM_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " ACC_PM_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If

                    dtJE = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtJE.Rows.Count - 1
                    '    dRow = dt.NewRow()

                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtJE.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "SubLedger BillWise Entry"
                    '    dRow("Narration") = "Bill Date:-" & dtJE.Rows(j)("BillDate").ToString() & "/Bill Reference No:-" & dtJE.Rows(j)("BillNo").ToString()
                    '    'dRow("CorresGLCode") = dtJE.Rows(j)("CorresGLcode").ToString()
                    '    'dRow("CorresDescription") = dtJE.Rows(j)("CorresDescription").ToString()

                    '    If dtJE.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtJE.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtJE.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtJE.Rows(j)("Credit").ToString()
                    '    End If
                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next


                    'Purchase voucher                 
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_Purchase_BillDate as BillDate, C.Acc_Purchase_BillNo as BillNo,C.Acc_Purchase_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Purchase_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 8 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_purchase_Master C On B.ATD_BillID = C.Acc_Purchase_ID and C.Acc_Purchase_DelFlag = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_Purchase_BillDate as BillDate, C.Acc_Purchase_BillNo as BillNo,C.Acc_Purchase_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Purchase_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 8 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_purchase_Master C On B.ATD_BillID = C.Acc_Purchase_ID and C.Acc_Purchase_DelFlag = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_Purchase_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If

                    dtPV = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtPV.Rows.Count - 1
                    '    dRow = dt.NewRow()

                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtPV.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "Purchase Voucher"
                    '    dRow("Narration") = dtPV.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select CSM_Name from CustomerSupplierMaster where CSM_ID =" & dtPV.Rows(j)("Party").ToString() & " and CSM_CompID =" & iCompID & "")

                    '    If dtPV.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtPV.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtPV.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtPV.Rows(j)("Credit").ToString()
                    '    End If

                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next

                    'Sales voucher                 
                    If dtGL.Rows(i)("gl_head").ToString() = "2" Then
                        aSql = "" : aSql = "Select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_Sales_BillDate as BillDate, C.Acc_Sales_BillNo as BillNo,C.Acc_Sales_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Sales_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_GL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_SubGL = 0  and B.ATD_TRType = 9 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_Sales_masters C On B.ATD_BillID = C.Acc_Sales_ID and C.Acc_Sales_DelFlag = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_GL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_Sales_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_Sales_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_Sales_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_Sales_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    ElseIf dtGL.Rows(i)("gl_head").ToString() = "3" Then
                        aSql = "" : aSql = "select A.gl_Glcode as GLCode, A.gl_Desc as GlDescription,D.ALM_TrDebit as Debit, D.ALM_TrCredit as Credit,"
                        aSql = aSql & "C.Acc_Sales_BillDate as BillDate, C.Acc_Sales_BillNo as BillNo,C.Acc_Sales_TransactionNo as VoucherNo,"
                        aSql = aSql & "C.Acc_Sales_Party as party "
                        aSql = aSql & "from chart_of_Accounts A  join acc_Transactions_Details B On "
                        aSql = aSql & "B.ATD_SubGL = " & dtGL.Rows(i)("gl_Id").ToString() & " and B.ATD_TRType = 9 and B.ATD_YearID = " & iYearId & " and "
                        aSql = aSql & " B.ATD_GL = A.gl_ID "
                        aSql = aSql & "join acc_Sales_masters C On B.ATD_BillID = C.Acc_Sales_ID and C.Acc_Sales_DelFlag = 'A' "
                        aSql = aSql & "Join Acc_Ledger_Masters D On D.ALM_GL= B.ATD_SubGL Where "
                        If iZoneID > 0 Then
                            aSql = aSql & " C.ACC_Sales_ZoneID=" & iZoneID & " And "
                        End If
                        If iRegionID > 0 Then
                            aSql = aSql & " C.ACC_Sales_RegionID=" & iRegionID & " And "
                        End If
                        If iAreaID > 0 Then
                            aSql = aSql & " C.ACC_Sales_AreaID=" & iAreaID & " And "
                        End If
                        If iBranchID > 0 Then
                            aSql = aSql & " C.ACC_Sales_BranchID=" & iBranchID & " And "
                        End If
                        aSql = aSql & " B.ATD_CompID = " & iCompID & " "
                    End If
                    dtSV = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    'For j = 0 To dtSV.Rows.Count - 1
                    '    dRow = dt.NewRow()

                    '    dRow("BillDate") = objGen.FormatDtForRDBMS(dtSV.Rows(j)("BillDate").ToString(), "D")
                    '    dRow("TransactionType") = "Sales Voucher"
                    '    dRow("Narration") = dtSV.Rows(j)("VoucherNo").ToString() & "/" & objDB.SQLExecuteScalar(sNameSpace, "Select BM_Name from sales_Buyers_Masters where BM_ID =" & dtSV.Rows(j)("Party").ToString() & " and BM_CompID =" & iCompID & "")

                    '    If dtSV.Rows(j)("Debit").ToString() = "" Then
                    '        dRow("TransDebit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransDebit") = dtSV.Rows(j)("Debit").ToString()
                    '    End If

                    '    If dtSV.Rows(j)("Credit").ToString() = "" Then
                    '        dRow("TransCredit") = "0.00" : dTransDebit = 0
                    '    Else
                    '        dRow("TransCredit") = dtSV.Rows(j)("Credit").ToString()
                    '    End If

                    '    dRow("Status") = "1"
                    '    dt.Rows.Add(dRow)
                    'Next
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadTrialBalance(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim sSql As String = "", aSql As String = "", iSql As String = ""
        Dim mSql As String = "", kSql As String = "", lSql As String = ""
        Dim dt As New DataTable
        Dim dtGL As New DataTable, dtSubGL As New DataTable
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
        Dim dRow As DataRow

        Dim dtOBGL As New DataTable

        Dim dtOB As New DataTable
        Dim dtTrans As New DataTable
        Dim sStr As String = ""

        Dim dOpnDebit As Double = 0, dOpnCredit As Double = 0
        Dim dTransDebit As Double = 0, dTransCredit As Double = 0
        Dim dCloseDebit As Double = 0, dCloseCredit As Double = 0
        Dim iNext As Integer = 0

        Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
        Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
        Dim dTotalCloseDebit As Double = 0, dTotalCloseCredit As Double = 0

        Dim dGrandTotalOpnDebit As Double = 0 : Dim dGrandTotalOpnCredit As Double = 0
        Dim dGrandTotalTransDebit As Double = 0, dGrandTotalTransCredit As Double = 0
        Dim dGrandTotalCloseDebit As Double = 0, dGrandTotalCloseCredit As Double = 0

        Dim sCloseDebit As String = "" : Dim sCloseCredit As String = ""
        Dim sSubDebit As String = "" : Dim sSubCredit As String = ""
        Dim sSubTotalDebit As String = "" : Dim sSubTotalCredit As String = ""
        Dim sGrandTotalDebit As String = "" : Dim sGrandTotalCredit As String = ""

        Dim dtATD As New DataTable
        Try
            dt.Columns.Add("gl_id")
            dt.Columns.Add("gl_Code")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("gl_Head")
            dt.Columns.Add("gl_AccHead")
            dt.Columns.Add("gl_Parent")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TransDebit")
            dt.Columns.Add("TransCredit")
            dt.Columns.Add("ClosingDebit")
            dt.Columns.Add("ClosingCredit")


            sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
            sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
            sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
            sSql = sSql & "and A.gl_head in (2) and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
                    dTotalOpnDebit = 0 : dTotalOpnCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
                    dTotalCloseDebit = 0 : dTotalCloseCredit = 0
                    dRow = dt.NewRow()

                    If IsDBNull(dtGL.Rows(i)("gl_id").ToString()) = False Then
                        dRow("gl_id") = dtGL.Rows(i)("gl_id").ToString()
                    End If

                    If dtGL.Rows(i)("gl_glCode").ToString() = "A020301" Then
                        dRow("gl_id") = ""
                    End If

                    If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
                        dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
                    End If

                    If (dtGL.Rows(i)("gl_glCode").ToString() = "A020202" Or dtGL.Rows(i)("gl_glCode").ToString() = "L030201") Then
                        If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                            dRow("gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
                        End If
                    Else
                        If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                            If dtGL.Rows(i)("gl_Head").ToString() = "2" Then
                                dRow("gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
                            Else
                                dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                            End If


                        End If
                    End If

                    'If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                    '    dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                    'End If

                    If IsDBNull(dtGL.Rows(i)("gl_head").ToString()) = False Then
                        dRow("gl_Head") = dtGL.Rows(i)("gl_head").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("gl_Parent").ToString()) = False Then
                        dRow("gl_Parent") = dtGL.Rows(i)("gl_Parent").ToString()
                    End If
                    Dim dGLDebitTotal, dGLCreditTotal As Double
                    If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
                        Dim iGLCount As Integer

                        iSql = "" : iSql = "Select Count(Opn_id) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                        If iZoneID > 0 Then
                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                        End If
                        iGLCount = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

                        If iGLCount = 0 Then
                            iSql = "" : iSql = "Select Sum(Opn_DebitAmt) as Opn_DebitAmt,Sum(Opn_CreditAmount) as Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_id =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                        Else
                            iSql = "" : iSql = "Select Sum(Opn_DebitAmt) as Opn_DebitAmt,Sum(Opn_CreditAmount) as Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                        End If

                        If iZoneID > 0 Then
                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                        End If

                        dtOBGL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                        If dtOBGL.Rows.Count > 0 Then
                            If (dtOBGL.Rows(0)("Opn_DebitAmt") Is "" And dtOBGL.Rows(0)("Opn_CreditAmount") Is "") Then
                                dRow("OpDebit") = "0.00"
                                dRow("OpDebit") = "0.00"
                            Else
                                If IsDBNull(dtOBGL.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                                    If dtOBGL.Rows(0)("Opn_DebitAmt").ToString() <> "" Then
                                        dRow("OpDebit") = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
                                        dGLDebitTotal = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
                                        dOpnDebit = dGLDebitTotal
                                    Else
                                        dRow("OpDebit") = "0.00"
                                    End If

                                Else
                                    dRow("OpDebit") = "0.00"
                                End If

                                If IsDBNull(dtOBGL.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                                    If dtOBGL.Rows(0)("Opn_CreditAmount").ToString() <> "" Then
                                        dRow("OpCredit") = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
                                        dGLCreditTotal = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
                                        dOpnCredit = dGLCreditTotal
                                    Else
                                        dRow("OpCredit") = "0.00"
                                    End If
                                Else
                                    dRow("OpCredit") = "0.00"
                                End If
                            End If
                        End If

                        ' This is commented by vijaylakshmi 28-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )
                        'iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                        'If iZoneID > 0 Then
                        '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                        'End If
                        'If iRegionID > 0 Then
                        '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                        'End If
                        'If iAreaID > 0 Then
                        '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                        'End If
                        'If iBranchID > 0 Then
                        '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                        'End If
                        'dGLDebitTotal = Convert.ToDouble(objDB.SQLGetDescription(sNameSpace, iSql))

                        'iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                        'If iZoneID > 0 Then
                        '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                        'End If
                        'If iRegionID > 0 Then
                        '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                        'End If
                        'If iAreaID > 0 Then
                        '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                        'End If
                        'If iBranchID > 0 Then
                        '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                        'End If
                        'dGLCreditTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

                        'dRow("OpDebit") = dGLDebitTotal
                        'dOpnDebit = dGLDebitTotal
                        'dRow("OpCredit") = dGLCreditTotal
                        'dOpnCredit = dGLCreditTotal
                        ' This is commented by vijaylakshmi 28-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )

                    ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger
                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                        If iZoneID > 0 Then
                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                        End If
                        dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                        If dtOB.Rows.Count > 0 Then

                            If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                                dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                            Else
                                dRow("OpDebit") = "0.00"
                            End If

                            If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                                dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                            Else
                                dRow("OpCredit") = "0.00"
                            End If
                        End If
                    End If

                    '*** Working But for deactivated record not worinkg so commented ***'
                    'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details"
                    'aSql = aSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                    'aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
                    '*** Working But for deactivated record not worinkg so commented ***'
                    ' dFromDate = objGen.FormatDtForRDBMS(dFromDate, "CT")
                    '  dToDate = objGen.FormatDtForRDBMS(dToDate, "CT")

                    If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
                        aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details"
                        aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status<>'D' and atd_status<>'W' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                    ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger
                        aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details"
                        aSql = aSql & " where ATD_SubGL in (Select gl_ID From Chart_Of_Accounts Where gl_Parent = '" & dtGL.Rows(i)("gl_id").ToString() & "') and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status<>'D' and atd_status<>'W' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "
                    End If

                    If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
                    ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
                    ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
                    ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
                    ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
                    ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
                    ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                    End If

                    dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtTrans.Rows.Count > 0 Then
                        If (dtTrans.Rows(0)("Debit") Is "" And dtTrans.Rows(0)("Credit") Is "") Then
                            dRow("TransDebit") = "0.00"
                            dRow("TransCredit") = "0.00"
                        Else
                            If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
                                If dtTrans.Rows(0)("Debit").ToString() <> "" Then
                                    dRow("TransDebit") = dtTrans.Rows(0)("Debit").ToString()
                                    dTransDebit = dtTrans.Rows(0)("Debit").ToString()
                                    dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
                                Else
                                    dRow("TransDebit") = "0.00"
                                End If
                            Else
                                dRow("TransDebit") = "0.00"
                            End If

                            If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
                                If dtTrans.Rows(0)("Credit").ToString() <> "" Then
                                    dRow("TransCredit") = dtTrans.Rows(0)("Credit").ToString()
                                    dTransCredit = dtTrans.Rows(0)("Credit").ToString()
                                    dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
                                Else
                                    dRow("TransCredit") = "0.00"
                                End If
                            Else
                                dRow("TransCredit") = "0.00"
                            End If
                        End If
                    Else
                        dRow("TransCredit") = "0.00"
                        dRow("TransCredit") = "0.00"
                    End If



                    Dim dClosingDborCr As Double = 0
                    dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
                    If dClosingDborCr > 0 Then
                        sCloseDebit = dClosingDborCr
                        'dRow("ClosingDebit") = dClosingDborCr
                        If sCloseDebit.StartsWith("-") = True Then
                            sCloseDebit = sCloseDebit.Remove(0, 1)
                        End If
                        dRow("ClosingDebit") = dClosingDborCr

                        dRow("ClosingCredit") = "0.00"
                        dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
                        dGrandTotalCloseDebit = dGrandTotalCloseDebit + dClosingDborCr
                    Else
                        'dRow("ClosingCredit") = dClosingDborCr
                        sCloseCredit = dClosingDborCr
                        If sCloseCredit.StartsWith("-") = True Then
                            sCloseCredit = sCloseCredit.Remove(0, 1)
                        End If
                        dRow("ClosingCredit") = sCloseCredit

                        dRow("ClosingDebit") = "0.00"
                        dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
                        dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
                    End If

                    'Commented since GL Total has to be displayed.

                    'Dim dtCheckSubGLs As New DataTable
                    'dtCheckSubGLs = objDB.SQLExecuteDataSet(sNameSpace, "Select * From Chart_Of_Accounts Where GL_Parent=" & dtGL.Rows(i)("gl_id").ToString() & " And gl_CompID=" & iCompID & " ").Tables(0)
                    'If dtCheckSubGLs.Rows.Count > 0 Then
                    '    dRow("OpDebit") = "0.00"
                    '    dRow("OpCredit") = "0.00"

                    '    dRow("TransDebit") = "0.00"
                    '    dRow("TransCredit") = "0.00"

                    '    dRow("ClosingDebit") = "0.00"
                    '    dRow("ClosingCredit") = "0.00"
                    'End If
                    'Commented since GL Total has to be displayed.

                    dt.Rows.Add(dRow)


                    '' SUb GL
                    mSql = "" : mSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGL.Rows(i)("gl_id").ToString() & " and gl_CompID =" & iCompID & " and "
                    mSql = mSql & " gl_head in (3) And gl_Delflag='C' and gl_Status ='A' Order by gl_glcode"
                    dtSubGL = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                    If dtSubGL.Rows.Count > 0 Then
                        For j = 0 To dtSubGL.Rows.Count - 1
                            dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
                            dRow = dt.NewRow()
                            If IsDBNull(dtSubGL.Rows(j)("gl_id").ToString()) = False Then
                                dRow("gl_id") = dtSubGL.Rows(j)("gl_id").ToString()
                            End If

                            If IsDBNull(dtSubGL.Rows(j)("gl_glCode").ToString()) = False Then
                                dRow("gl_Code") = dtSubGL.Rows(j)("gl_glCode").ToString()
                            End If

                            'If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
                            '    dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
                            'End If
                            If (dtSubGL.Rows(j)("gl_Parent").ToString() = "141" Or dtSubGL.Rows(j)("gl_Parent").ToString() = "67") Then
                                If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
                                    dRow("gl_Desc") = "<b>" & dtSubGL.Rows(j)("Gl_Desc").ToString() & "</b>"
                                End If
                            Else
                                If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
                                    dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
                                End If
                            End If

                            If IsDBNull(dtSubGL.Rows(j)("gl_head").ToString()) = False Then
                                dRow("gl_Head") = dtSubGL.Rows(j)("gl_head").ToString()
                            End If

                            If IsDBNull(dtSubGL.Rows(j)("gl_Parent").ToString()) = False Then
                                dRow("gl_Parent") = dtSubGL.Rows(j)("gl_Parent").ToString()
                            End If

                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtSubGL.Rows(j)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                            If iZoneID > 0 Then
                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            End If
                            If iRegionID > 0 Then
                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            End If
                            If iAreaID > 0 Then
                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            End If
                            If iBranchID > 0 Then
                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            End If
                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                            If dtOB.Rows.Count > 0 Then

                                If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                                    dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                    dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                    dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                    dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                Else
                                    dRow("OpDebit") = "0.00"
                                End If

                                If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                                    dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                    dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                    dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                    dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                Else
                                    dRow("OpCredit") = "0.00"
                                End If
                            End If

                            '*** Working But for deactivated record not worinkg so commented ***'
                            'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                            'aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
                            '*** Working But for deactivated record not worinkg so commented ***'

                            aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details "
                            aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status<>'D' and ATD_Status<>'W' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "'  "

                            If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
                            ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
                            ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
                            ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
                            ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
                            ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
                            ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                            End If

                            dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                            If dtTrans.Rows.Count > 0 Then
                                If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
                                    If dtTrans.Rows(0)("Debit").ToString() <> "" Then
                                        dRow("TransDebit") = dtTrans.Rows(0)("Debit").ToString()
                                        dTransDebit = dtTrans.Rows(0)("Debit").ToString()
                                        dTotalTransDebit = dTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
                                        dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
                                    Else
                                        dRow("TransDebit") = "0.00"
                                    End If
                                Else
                                    dRow("TransDebit") = "0.00"
                                End If

                                If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
                                    If dtTrans.Rows(0)("Credit").ToString() <> "" Then
                                        dRow("TransCredit") = dtTrans.Rows(0)("Credit").ToString()
                                        dTransCredit = dtTrans.Rows(0)("Credit").ToString()
                                        dTotalTransCredit = dTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
                                        dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
                                    Else
                                        dRow("TransCredit") = "0.00"
                                    End If
                                Else
                                    dRow("TransCredit") = "0.00"
                                End If
                            Else
                                dRow("TransCredit") = "0.00"
                                dRow("TransCredit") = "0.00"
                            End If

                            dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
                            If dClosingDborCr > 0 Then
                                'dRow("ClosingDebit") = dClosingDborCr
                                sSubDebit = dClosingDborCr
                                If sSubDebit.StartsWith("-") = True Then
                                    sSubDebit = sSubDebit.Remove(0, 1)
                                End If
                                dRow("ClosingDebit") = sSubDebit

                                dRow("ClosingCredit") = "0.00"
                                'dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
                                dGrandTotalCloseDebit = dGrandTotalCloseDebit + dRow("ClosingDebit")
                            Else
                                'dRow("ClosingCredit") = dClosingDborCr
                                sSubCredit = dClosingDborCr
                                If sSubCredit.StartsWith("-") = True Then
                                    sSubCredit = sSubCredit.Remove(0, 1)
                                End If
                                dRow("ClosingCredit") = sSubCredit

                                dRow("ClosingDebit") = "0.00"
                                'dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
                                dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
                            End If
                            dt.Rows.Add(dRow)
                        Next

                        If j = dtSubGL.Rows.Count Then
                            dRow = dt.NewRow()
                            dRow("gl_Desc") = "<B>" & "TOTAL" & "</B>"
                            dRow("OpDebit") = dTotalOpnDebit
                            dRow("OpCredit") = dTotalOpnCredit
                            dRow("TransDebit") = dTotalTransDebit
                            dRow("TransCredit") = dTotalTransCredit

                            'dRow("ClosingDebit") = dTotalCloseDebit
                            'dRow("ClosingCredit") = dTotalCloseCredit
                            sSubTotalDebit = dTotalCloseDebit
                            If sSubTotalDebit.StartsWith("-") = True Then
                                sSubTotalDebit = sSubTotalDebit.Remove(0, 1)
                            End If
                            dRow("ClosingDebit") = sSubTotalDebit

                            sSubTotalCredit = dTotalCloseCredit
                            If sSubTotalCredit.StartsWith("-") = True Then
                                sSubTotalCredit = sSubTotalCredit.Remove(0, 1)
                            End If
                            dRow("ClosingCredit") = sSubTotalCredit

                            dt.Rows.Add(dRow)
                        End If
                    End If
                Next
            End If

            If dt.Rows.Count > 0 Then
                dOpnDebit = 0 : dOpnCredit = 0
                dTransDebit = 0 : dTransCredit = 0
                dCloseDebit = 0 : dCloseCredit = 0
                For l = 0 To dt.Rows.Count - 1
                    If dt.Rows(l)("gl_Head").ToString() = "2" Then
                        If dt.Rows(l)("OpDebit").ToString() <> "" Then
                            dOpnDebit = dOpnDebit + dt.Rows(l)("OpDebit").ToString()
                        Else
                            dOpnDebit = dOpnDebit + 0
                        End If

                        If dt.Rows(l)("OpCredit").ToString() <> "" Then
                            dOpnCredit = dOpnCredit + dt.Rows(l)("OpCredit").ToString()
                        Else
                            dOpnCredit = dOpnCredit + 0
                        End If

                        If dt.Rows(l)("TransDebit").ToString() <> "" Then
                            dTransDebit = dTransDebit + dt.Rows(l)("TransDebit").ToString()
                        Else
                            dTransDebit = dTransDebit + 0
                        End If

                        If dt.Rows(l)("TransCredit").ToString() <> "" Then
                            dTransCredit = dTransCredit + dt.Rows(l)("TransCredit").ToString()
                        Else
                            dTransCredit = dTransCredit + 0
                        End If

                        If dt.Rows(l)("ClosingDebit").ToString() <> "" Then
                            dCloseDebit = dCloseDebit + dt.Rows(l)("ClosingDebit").ToString()
                        Else
                            dCloseDebit = dCloseDebit + 0
                        End If

                        If dt.Rows(l)("ClosingCredit").ToString() <> "" Then
                            dCloseCredit = dCloseCredit + dt.Rows(l)("ClosingCredit").ToString()
                        Else
                            dCloseCredit = dCloseCredit + 0
                        End If

                    End If
                Next

                dRow = dt.NewRow
                dt.Rows.Add(dRow)

                dRow = dt.NewRow
                dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
                dRow("OpDebit") = dOpnDebit
                dRow("OpCredit") = dOpnCredit
                dRow("TransDebit") = dTransDebit
                dRow("TransCredit") = dTransCredit

                'dRow("ClosingDebit") = dCloseDebit
                'dRow("ClosingCredit") = dCloseCredit

                sGrandTotalDebit = dCloseDebit
                If sGrandTotalDebit.StartsWith("-") = True Then
                    sGrandTotalDebit = sGrandTotalDebit.Remove(0, 1)
                End If
                dRow("ClosingDebit") = sGrandTotalDebit

                'sGrandTotalCredit = dCloseDebit
                sGrandTotalCredit = dCloseCredit
                If sGrandTotalCredit.StartsWith("-") = True Then
                    sGrandTotalCredit = sGrandTotalCredit.Remove(0, 1)
                End If
                dRow("ClosingCredit") = sGrandTotalCredit

                dt.Rows.Add(dRow)
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadExistingVoucherNo(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_Purchase_TransactionNo,Acc_Purchase_ID from  Acc_Purchase_Master where Acc_Purchase_CompID=" & iCompID & " and Acc_Purchase_Year=" & iYearID & " And Acc_Purchase_Status='A' order by Acc_Purchase_ID Desc"
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadExistingSalesVocher(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Acc_Sales_TransactionNo,Acc_Sales_ID from  Acc_Sales_Masters where Acc_Sales_CompID=" & iCompID & " and Acc_Sales_Year=" & iYearID & " And Acc_Sales_Status='A' order by Acc_Sales_ID Desc"
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function BindItemsData(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                         ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iTRID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dtTab As New DataTable
        Dim dt As New DataTable
        Dim dRow As DataRow
        Dim i As Integer
        Try
            dtTab.Columns.Add("HSNCode")
            dtTab.Columns.Add("Commodity")
            dtTab.Columns.Add("Goods")

            dtTab.Columns.Add("Unit")
            dtTab.Columns.Add("MRP")
            dtTab.Columns.Add("Qty")

            dtTab.Columns.Add("RateAMt")
            dtTab.Columns.Add("Discount")
            dtTab.Columns.Add("DiscountAmt")

            dtTab.Columns.Add("Charge")
            dtTab.Columns.Add("Total")
            dtTab.Columns.Add("GST")
            dtTab.Columns.Add("GSTAmt")
            dtTab.Columns.Add("NetAmount")

            If iTRID > 0 Then
                sSql = "" : sSql = "Select * From ACC_Purchase_Details Left Join acc_Purchase_Master On PD_MasterID=Acc_Purchase_ID"
                sSql = sSql & " Where PD_MasterID=" & iTRID & " And PD_CompID =" & iCompID & " And PD_YearID =" & iYearID & ""
                If iMonthID > 0 And iPartyID = 0 Then
                    sSql = sSql & " And Month(ACC_Purchase_BillDate) =" & iMonthID & " "
                ElseIf iMonthID = 0 And iPartyID > 0 Then
                    sSql = sSql & " And ACC_Purchase_Party =" & iPartyID & ""
                ElseIf iMonthID > 0 And iPartyID > 0 Then
                    sSql = sSql & " And Month(ACC_Purchase_BillDate) =" & iMonthID & " And ACC_Purchase_Party =" & iPartyID & ""
                End If
                If iZoneID > 0 Then
                    sSql = sSql & " and ACC_Purchase_ZoneID=" & iZoneID & ""
                End If
                If iRegionID > 0 Then
                    sSql = sSql & " and ACC_Purchase_RegionID=" & iRegionID & ""
                End If
                If iAreaID > 0 Then
                    sSql = sSql & " and ACC_Purchase_AreaID=" & iAreaID & ""
                End If
                If iBranchID > 0 Then
                    sSql = sSql & " and ACC_Purchase_BranchID=" & iBranchID & ""
                End If
            End If
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dt.Rows.Count > 0 Then
                For i = 0 To dt.Rows.Count - 1
                    dRow = dtTab.NewRow
                    dRow("HSNCode") = dt.Rows(i)("PD_HSNCode")
                    dRow("Commodity") = objDB.SQLGetDescription(sNameSpace, "Select INV_Description From Inventory_master Where INV_ID=" & dt.Rows(i)("PD_Commodity") & " And INV_Parent=0 And INV_CompID=" & iCompID & " ")
                    dRow("Goods") = objDB.SQLGetDescription(sNameSpace, "Select INV_Description From Inventory_master Where INV_ID=" & dt.Rows(i)("PD_Goods") & " And INV_Parent=" & dt.Rows(i)("PD_Commodity") & " And INV_CompID=" & iCompID & " ")
                    If (dt.Rows(i)("PD_Unit") = "--- Unit of Measurement ---") Then
                        dRow("Unit") = ""
                    Else
                        dRow("Unit") = objDB.SQLGetDescription(sNameSpace, "Select Mas_Desc From Acc_General_master Where Mas_ID=" & dt.Rows(i)("PD_Unit") & " And MAS_CompID=" & iCompID & " And MAS_DelFlag='A' And MAS_Master in(Select MAS_ID From Acc_Master_Type where Mas_Type='Unit of Measurement') ")
                    End If


                    dRow("MRP") = dt.Rows(i)("PD_Rate")
                    dRow("Qty") = dt.Rows(i)("PD_Quantity")
                    dRow("RateAMt") = dt.Rows(i)("PD_RateAmount")
                    dRow("Discount") = dt.Rows(i)("PD_Discount")
                    dRow("DiscountAmt") = dt.Rows(i)("PD_DiscountAmount")
                    dRow("Charge") = dt.Rows(i)("PD_ChargePerItem")
                    dRow("Total") = dt.Rows(i)("PD_Amount")
                    dRow("GST") = dt.Rows(i)("PD_GSTRate")
                    dRow("GSTAmt") = dt.Rows(i)("PD_GSTAmount")
                    dRow("NetAmount") = dt.Rows(i)("PD_FinalTotal")

                    dtTab.Rows.Add(dRow)
                Next
            End If
            Return dtTab
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetPurchaseDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iPurchaseID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "" : sSql = "Select * from Acc_Purchase_Master where Acc_Purchase_ID =" & iPurchaseID & " And Acc_Purchase_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetSalesDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iPaymentID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "" : sSql = "Select * from Acc_Sales_Masters where Acc_Sales_ID =" & iPaymentID & " and Acc_Sales_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataTable(sNameSpace, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function BindItemsDataSales(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iMonthID As Integer, ByVal iPartyID As Integer,
                                         ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iTRID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dtTab As New DataTable
        Dim dt As New DataTable
        Dim dRow As DataRow
        Dim i As Integer
        Try
            dtTab.Columns.Add("HSNCode")
            dtTab.Columns.Add("Commodity")
            dtTab.Columns.Add("Goods")

            dtTab.Columns.Add("Unit")
            dtTab.Columns.Add("MRP")
            dtTab.Columns.Add("Qty")

            dtTab.Columns.Add("RateAMt")
            dtTab.Columns.Add("Discount")
            dtTab.Columns.Add("DiscountAmt")

            dtTab.Columns.Add("Charge")
            dtTab.Columns.Add("Total")
            dtTab.Columns.Add("GST")
            dtTab.Columns.Add("GSTAmt")
            dtTab.Columns.Add("NetAmount")

            If iTRID > 0 Then
                sSql = "" : sSql = "Select * From ACC_Sales_Details Left Join acc_Sales_Masters On Acc_Sales_ID=PD_MasterID"
                sSql = sSql & " Where PD_MasterID=" & iTRID & " And PD_CompID =" & iCompID & " And PD_YearID =" & iYearID & ""
                If iMonthID > 0 And iPartyID = 0 Then
                    sSql = sSql & " And Month(ACC_Sales_BillDate) =" & iMonthID & " "
                ElseIf iMonthID = 0 And iPartyID > 0 Then
                    sSql = sSql & " And ACC_Sales_Party =" & iPartyID & ""
                ElseIf iMonthID > 0 And iPartyID > 0 Then
                    sSql = sSql & " And Month(ACC_Sales_BillDate) =" & iMonthID & " And ACC_Sales_Party =" & iPartyID & ""
                End If
                If iZoneID > 0 Then
                    sSql = sSql & " and ACC_Sales_ZoneID=" & iZoneID & ""
                End If
                If iRegionID > 0 Then
                    sSql = sSql & " and ACC_Sales_RegionID=" & iRegionID & ""
                End If
                If iAreaID > 0 Then
                    sSql = sSql & " and ACC_Sales_AreaID=" & iAreaID & ""
                End If
                If iBranchID > 0 Then
                    sSql = sSql & " and ACC_Sales_BranchID=" & iBranchID & ""
                End If
            End If
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dt.Rows.Count > 0 Then
                For i = 0 To dt.Rows.Count - 1
                    dRow = dtTab.NewRow
                    dRow("HSNCode") = dt.Rows(i)("PD_HSNCode")
                    dRow("Commodity") = objDB.SQLGetDescription(sNameSpace, "Select INV_Description From Inventory_master Where INV_ID=" & dt.Rows(i)("PD_Commodity") & " And INV_Parent=0 And INV_CompID=" & iCompID & " ")
                    dRow("Goods") = objDB.SQLGetDescription(sNameSpace, "Select INV_Description From Inventory_master Where INV_ID=" & dt.Rows(i)("PD_Goods") & " And INV_Parent=" & dt.Rows(i)("PD_Commodity") & " And INV_CompID=" & iCompID & " ")
                    If (dt.Rows(i)("PD_Unit") = "--- Unit of Measurement ---") Then
                        dRow("Unit") = ""
                    Else
                        dRow("Unit") = objDB.SQLGetDescription(sNameSpace, "Select Mas_Desc From Acc_General_master Where Mas_ID=" & dt.Rows(i)("PD_Unit") & " And MAS_CompID=" & iCompID & " And MAS_DelFlag='A' And MAS_Master in(Select MAS_ID From Acc_Master_Type where Mas_Type='Unit of Measurement') ")
                    End If


                    dRow("MRP") = dt.Rows(i)("PD_Rate")
                    dRow("Qty") = dt.Rows(i)("PD_Quantity")
                    dRow("RateAMt") = dt.Rows(i)("PD_RateAmount")
                    dRow("Discount") = dt.Rows(i)("PD_Discount")
                    dRow("DiscountAmt") = dt.Rows(i)("PD_DiscountAmount")
                    dRow("Charge") = dt.Rows(i)("PD_ChargePerItem")
                    dRow("Total") = dt.Rows(i)("PD_Amount")
                    dRow("GST") = dt.Rows(i)("PD_GSTRate")
                    dRow("GSTAmt") = dt.Rows(i)("PD_GSTAmount")
                    dRow("NetAmount") = dt.Rows(i)("PD_FinalTotal")
                    dtTab.Rows.Add(dRow)
                Next
            End If
            Return dtTab
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetFrequency(ByVal sNameSpace As String, ByVal iCompID As Integer)
        Dim sSql As String = ""
        Try
            sSql = "Select AS_Frequency from Application_Settings Where AS_Default=1 And AS_CompID=1"
            GetFrequency = objDB.SQLGetDescription(sNameSpace, sSql)
            Return GetFrequency
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetMonth(ByVal sNameSpace As String, ByVal iCompID As Integer) As Integer
        Dim sSql As String = ""
        Try
            sSql = "SELECT DATEPART(month, getdate())"
            GetMonth = objDB.SQLExecuteScalarInt(sNameSpace, sSql)
            Return GetMonth
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetWriteGLTableMonth(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iUserID As Integer, ByVal sFrequency As String) As Integer
        Dim sSql As String = ""
        Dim sStartDtae As Date : Dim sEndDate As Date
        Dim dt, dtTR As New DataTable
        Dim dOpenDebit, dOpenCredit, dTrDebitTotal, dTrCreditTotal, dClosingDebit, dClosingCredit As Double
        Dim iMax As Integer : Dim bCheck As Boolean
        Dim sFreqcy As String = ""
        Try
            sSql = sSql & "Select * From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
            bCheck = objDB.DBCheckForRecord(sNameSpace, sSql)
            If bCheck = True Then
                sFreqcy = objDB.SQLGetDescription(sNameSpace, "Select Distinct(GM_Frequency) From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & "")
                If sFrequency <> sFreqcy Then 'Write to GL table
                    sSql = sSql & "Delete From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
                    objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                    sSql = "SELECT DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0)"
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sSql = "" : sSql = "Select DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))"
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                    sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                    dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dt.Rows.Count > 0 Then
                        For i = 0 To dt.Rows.Count - 1
                            sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                            dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtTR.Rows.Count > 0 Then
                                dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                                dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                            End If
                            dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                            dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                            dClosingDebit = dTrDebitTotal + dOpenDebit
                            dClosingCredit = dTrCreditTotal + dOpenCredit

                            iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                            sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                            sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                            objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                            dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                        Next
                    End If

                Else    'do not write to GL table
                End If
            Else
                sSql = "SELECT DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0)"
                sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                sSql = "" : sSql = "Select DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))"
                sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                If dt.Rows.Count > 0 Then
                    For i = 0 To dt.Rows.Count - 1
                        sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                        dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                        If dtTR.Rows.Count > 0 Then
                            dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                            dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                        End If
                        dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                        dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                        dClosingDebit = dTrDebitTotal + dOpenDebit
                        dClosingCredit = dTrCreditTotal + dOpenCredit

                        iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                        sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                        sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                        objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                        dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                    Next
                End If
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetWriteGLTableYear(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iUserID As Integer, ByVal sFrequency As String) As Integer
        Dim sSql As String = ""
        Dim sStartDtae As Date : Dim sEndDate As Date
        Dim dt, dtTR As New DataTable
        Dim dOpenDebit, dOpenCredit, dTrDebitTotal, dTrCreditTotal, dClosingDebit, dClosingCredit As Double
        Dim iMax As Integer
        Dim bCheck As Boolean : Dim sFreqcy As String = ""
        Try
            sSql = sSql & "Select * From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
            bCheck = objDB.DBCheckForRecord(sNameSpace, sSql)

            If bCheck = True Then
                sFreqcy = objDB.SQLGetDescription(sNameSpace, "Select Distinct(GM_Frequency) From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & "")
                If sFrequency <> sFreqcy Then 'Write to GL table
                    sSql = sSql & "Delete From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
                    objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                    sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                    sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                    dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dt.Rows.Count > 0 Then
                        For i = 0 To dt.Rows.Count - 1
                            sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                            dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtTR.Rows.Count > 0 Then
                                dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                                dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                            End If
                            dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                            dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                            dClosingDebit = dTrDebitTotal + dOpenDebit
                            dClosingCredit = dTrCreditTotal + dOpenCredit

                            iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                            sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                            sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                            objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                            dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                        Next
                    End If
                Else

                End If
            Else
                sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
                sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
                sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                If dt.Rows.Count > 0 Then
                    For i = 0 To dt.Rows.Count - 1
                        sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                        dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                        If dtTR.Rows.Count > 0 Then
                            dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                            dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                        End If
                        dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                        dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                        dClosingDebit = dTrDebitTotal + dOpenDebit
                        dClosingCredit = dTrCreditTotal + dOpenCredit

                        iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                        sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                        sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                        objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                        dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                    Next
                End If
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetWriteGLTableHalfYear(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iUserID As Integer, ByVal sFrequency As String) As Integer
        Dim sSql As String = ""
        Dim sStartDtae As Date : Dim sEndDate As Date
        Dim dt, dtTR As New DataTable
        Dim dOpenDebit, dOpenCredit, dTrDebitTotal, dTrCreditTotal, dClosingDebit, dClosingCredit As Double
        Dim iMax As Integer : Dim iMonth As Integer
        Dim sFirstHalf, sSecondHalf As Date
        Dim sYear As String = "" : Dim bCheck As Boolean : Dim sFreqcy As String = ""
        Try
            sSql = sSql & "Select * From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
            bCheck = objDB.DBCheckForRecord(sNameSpace, sSql)

            If bCheck = True Then
                sFreqcy = objDB.SQLGetDescription(sNameSpace, "Select Distinct(GM_Frequency) From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & "")
                If sFrequency <> sFreqcy Then 'Write to GL table
                    sSql = sSql & "Delete From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
                    objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                    iMonth = GetMonth(sNameSpace, iCompID)
                    If iMonth > 4 And iMonth <= 9 Then
                        sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
                        sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sFirstHalf = "05-09-" & sYear
                        sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                        sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                    ElseIf iMonth = 1 And iMonth <= 4 Then
                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sSecondHalf = "05-10-" & sYear

                        sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                        sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                        sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
                        sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)
                    End If

                    sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                    dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dt.Rows.Count > 0 Then
                        For i = 0 To dt.Rows.Count - 1
                            sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                            dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtTR.Rows.Count > 0 Then
                                dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                                dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                            End If
                            dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                            dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                            dClosingDebit = dTrDebitTotal + dOpenDebit
                            dClosingCredit = dTrCreditTotal + dOpenCredit

                            iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                            sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                            sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                            objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                            dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                        Next
                    End If
                Else

                End If
            Else
                iMonth = GetMonth(sNameSpace, iCompID)
                If iMonth > 4 And iMonth <= 9 Then
                    sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sFirstHalf = "05-09-" & sYear
                    sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                ElseIf iMonth = 1 And iMonth <= 4 Then
                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sSecondHalf = "05-10-" & sYear

                    sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)
                End If

                sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                If dt.Rows.Count > 0 Then
                    For i = 0 To dt.Rows.Count - 1
                        sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                        dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                        If dtTR.Rows.Count > 0 Then
                            dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                            dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                        End If
                        dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                        dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                        dClosingDebit = dTrDebitTotal + dOpenDebit
                        dClosingCredit = dTrCreditTotal + dOpenCredit

                        iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                        sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                        sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                        objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                        dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                    Next
                End If
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetWriteGLTableQuarter(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal iUserID As Integer, ByVal sFrequency As String) As Integer
        Dim sSql As String = ""
        Dim sStartDtae As Date : Dim sEndDate As Date
        Dim dt, dtTR As New DataTable
        Dim dOpenDebit, dOpenCredit, dTrDebitTotal, dTrCreditTotal, dClosingDebit, dClosingCredit As Double
        Dim iMax As Integer : Dim iMonth As Integer
        Dim sFirstHalf, sSecondHalf As Date
        Dim sYear As String = "" : Dim bCheck As Boolean : Dim sFreqcy As String = ""
        Try
            sSql = sSql & "Select * From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
            bCheck = objDB.DBCheckForRecord(sNameSpace, sSql)

            If bCheck = True Then
                sFreqcy = objDB.SQLGetDescription(sNameSpace, "Select Distinct(GM_Frequency) From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & "")
                If sFrequency <> sFreqcy Then 'Write to GL table
                    sSql = sSql & "Delete From GL_Masters Where GM_Year=" & iYearID & " And GM_CompID=" & iCompID & " "
                    objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                    iMonth = GetMonth(sNameSpace, iCompID)
                    If iMonth > 4 And iMonth <= 6 Then
                        sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
                        sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sFirstHalf = "05-06-" & sYear
                        sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                        sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)
                    ElseIf iMonth > 6 And iMonth <= 9 Then
                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sSecondHalf = "05-07-" & sYear

                        sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                        sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sFirstHalf = "05-09-" & sYear
                        sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                        sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)


                    ElseIf iMonth > 9 And iMonth <= 12 Then
                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sSecondHalf = "05-10-" & sYear

                        sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                        sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                        sFirstHalf = "05-12-" & sYear
                        sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                        sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                    ElseIf iMonth = 1 And iMonth <= 4 Then
                        sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID + 1 & " And YMS_CompID=" & iCompID & "")
                        sSecondHalf = "05-01-" & sYear

                        sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                        sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                        sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
                        sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)
                    End If

                    sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                    dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dt.Rows.Count > 0 Then
                        For i = 0 To dt.Rows.Count - 1
                            sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                            dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtTR.Rows.Count > 0 Then
                                dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                                dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                            End If
                            dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                            dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                            dClosingDebit = dTrDebitTotal + dOpenDebit
                            dClosingCredit = dTrCreditTotal + dOpenCredit

                            iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                            sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                            sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                            objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                            dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                        Next
                    End If
                Else

                End If
            Else
                iMonth = GetMonth(sNameSpace, iCompID)
                If iMonth > 4 And iMonth <= 6 Then
                    sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sFirstHalf = "05-06-" & sYear
                    sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)
                ElseIf iMonth > 6 And iMonth <= 9 Then
                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sSecondHalf = "05-07-" & sYear

                    sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sFirstHalf = "05-09-" & sYear
                    sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)


                ElseIf iMonth > 9 And iMonth <= 12 Then
                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sSecondHalf = "05-10-" & sYear

                    sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & "")
                    sFirstHalf = "05-12-" & sYear
                    sSql = "" : sSql = "SELECT EOMONTH ('" & objGen.FormatDtForRDBMS(sFirstHalf, "CT") & "')"
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)

                ElseIf iMonth = 1 And iMonth <= 4 Then
                    sYear = objDB.SQLGetDescription(sNameSpace, "Select YMS_From_Year From Acc_Year_Master Where YMS_ID=" & iYearID + 1 & " And YMS_CompID=" & iCompID & "")
                    sSecondHalf = "05-01-" & sYear

                    sSql = "SELECT DATEADD(m, DATEDIFF(m, 0, '" & objGen.FormatDtForRDBMS(sSecondHalf, "CT") & "'), 0) "
                    sStartDtae = objDB.SQLGetDescription(sNameSpace, sSql)

                    sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
                    sEndDate = objDB.SQLGetDescription(sNameSpace, sSql)
                End If

                sSql = "" : sSql = "Select Distinct(ATD_GL),ATD_Head From Acc_Transactions_Details Where (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                If dt.Rows.Count > 0 Then
                    For i = 0 To dt.Rows.Count - 1
                        sSql = "" : sSql = "Select Sum(ATD_Debit) As ATD_Debit,Sum(ATD_Credit) As ATD_Credit From Acc_Transactions_Details Where ATD_GL=" & dt.Rows(i)("ATD_GL") & " And (ATD_TransactionDate >='" & objGen.FormatDtForRDBMS(sStartDtae, "CT") & "' And ATD_TransactionDate <= '" & objGen.FormatDtForRDBMS(sEndDate, "CT") & "') And ATD_Status='A' And ATD_CompID=" & iCompID & " "
                        dtTR = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                        If dtTR.Rows.Count > 0 Then
                            dTrDebitTotal = dtTR.Rows(0)("ATD_Debit")
                            dTrCreditTotal = dtTR.Rows(0)("ATD_Credit")
                        End If
                        dOpenDebit = objDB.SQLGetDescription(sNameSpace, "Select Opn_DebitAmt From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")
                        dOpenCredit = objDB.SQLGetDescription(sNameSpace, "Select Opn_CreditAmount From Acc_Opening_Balance Where Opn_YearID=" & iYearID & " And Opn_GLID=" & dt.Rows(i)("ATD_GL") & " And Opn_CompID=" & iCompID & " ")

                        dClosingDebit = dTrDebitTotal + dOpenDebit
                        dClosingCredit = dTrCreditTotal + dOpenCredit

                        iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "GL_Masters", "GM_ID", "GM_CompID")
                        sSql = "" : sSql = "Insert Into GL_Masters(GM_ID,GM_AccountType,GM_Head,GM_GL,GM_OBDebit,GM_OBCredit,GM_TrDebit,GM_TrCredit,GM_CloseDebit,GM_CloseCredit,GM_Year,GM_CompID,GM_Createdby,GM_CreatedOn,GM_Frequency)"
                        sSql = sSql & "Values(" & iMax & "," & dt.Rows(i)("ATD_Head") & ",3," & dt.Rows(i)("ATD_GL") & "," & dOpenDebit & "," & dOpenCredit & "," & dTrDebitTotal & "," & dTrCreditTotal & "," & dClosingDebit & "," & dClosingCredit & "," & iYearID & "," & iCompID & "," & iUserID & ",GetDate(),'" & sFrequency & "')"
                        objDB.SQLExecuteNonQuery(sNameSpace, sSql)

                        dTrDebitTotal = 0 : dTrCreditTotal = 0 : dOpenDebit = 0 : dOpenCredit = 0 : dClosingDebit = 0 : dClosingCredit = 0
                    Next
                End If
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetStatus(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As Integer
        Dim sSql As String = "" : Dim sCurrentDate, sStartDtae, sEndDate As Date
        Try
            sSql = "" : sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
            sStartDtae = objGen.FormatDtForRDBMS(objDB.SQLGetDescription(sNameSpace, sSql), "D")

            sSql = "" : sSql = "Select YMS_ToDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & ""
            sEndDate = objGen.FormatDtForRDBMS(objDB.SQLGetDescription(sNameSpace, sSql), "D")

            sSql = "" : sSql = "Select GetDate()"
            sCurrentDate = objGen.FormatDtForRDBMS(objDB.SQLGetDescription(sNameSpace, sSql), "D")

            If (sCurrentDate > sStartDtae) And (sCurrentDate > sEndDate) Then   'Previous year
                GetStatus = 1
            ElseIf (sCurrentDate < sStartDtae) And (sCurrentDate < sEndDate) Then   'Next year
                GetStatus = 2
            End If
            Return GetStatus
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function FreezBalanceSheet(ByVal sNameSpace As String, ByVal iCOmpID As Integer, ByVal iYearID As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As Date, ByVal dToDate As Date)
        Dim sSql As String = "", aSql As String = "", mSql As String = "", iSql As String = ""
        Dim dRow As DataRow
        Dim dt As New DataTable
        Dim dtGroup As New DataTable
        Dim dtSub As New DataTable
        Dim dtLink As New DataTable
        Dim dtArray As New DataTable
        Dim dr As OleDb.OleDbDataReader
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, l As Integer = 0
        Dim a As Integer = 0
        Dim sArray As Array

        Dim iHead As Integer = 0
        Dim iSLNo As Integer = 0
        Dim iLastYear As Integer = 0

        Dim iFixedAssets As Integer = 0
        Dim iStatusCheck As Integer = 0
        Try
            'Liabilites
            sSql = "" : sSql = "Select YMS_ID,(Convert(nvarchar(50),YMS_From_Year)+'-'+Convert(nvarchar(50),YMS_To_Year)) as year from "
            sSql = sSql & "acc_Year_Master where yms_To_year in(Select yms_From_Year from acc_Year_Master where yms_id = " & iYearID & " and Yms_CompID =" & iCOmpID & ")"
            dr = objDB.SQLDataReader(sNameSpace, sSql)
            If dr.HasRows = True Then
                dr.Read()
                iLastYear = dr("YMS_ID")
            Else
                iLastYear = 0
            End If

            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 4 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                For i = 0 To dtGroup.Rows.Count - 1

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_CompID =" & iCOmpID & " And "
                    aSql = aSql & "gl_Delflag ='C' and gl_Status ='A' order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head = 4 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then

                                            iSql = "" : iSql = "Update Acc_Ledger_Masters Set ALM_Status='F' Where ALM_Year =" & iYearID & " and ALM_CompID =" & iCOmpID & " and ALM_GL =" & sArray(k) & " "
                                            If dFromDate <> "01/01/1900" And dFromDate <> "01-01-1900" And dToDate <> "01/01/1900" And dToDate <> "01-01-1900" Then
                                                iSql = iSql & " and ALM_TrDate Between '" & objGen.FormatDtForRDBMS(dFromDate, "CT") & "' And '" & objGen.FormatDtForRDBMS(dToDate, "CT") & "' "
                                            End If
                                            If iZoneID > 0 Then
                                                iSql = iSql & " and ALM_ZoneID=" & iZoneID & ""
                                            End If
                                            If iRegionID > 0 Then
                                                iSql = iSql & " and ALM_RegionID=" & iRegionID & ""
                                            End If
                                            If iAreaID > 0 Then
                                                iSql = iSql & " and ALM_AreaID=" & iAreaID & ""
                                            End If
                                            If iBranchID > 0 Then
                                                iSql = iSql & " and ALM_BranchID=" & iBranchID & ""
                                            End If
                                            objDB.SQLExecuteNonQuery(sNameSpace, iSql)

                                        End If
                                    Next

                                End If

                            End If

                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next
            End If

            'Assets

            sSql = "" : sSql = "Select * from chart_of_Accounts where gl_head in(0) and gl_AccHead = 1 and gl_Delflag ='C' and gl_Status ='A' and "
            sSql = sSql & "gl_CompID =" & iCOmpID & " order by gl_id"
            dtGroup = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGroup.Rows.Count > 0 Then

                For i = 0 To dtGroup.Rows.Count - 1

                    aSql = "" : aSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGroup.Rows(i)("gl_ID") & " And gl_Delflag ='C' and "
                    aSql = aSql & "gl_Status ='A' and gl_CompID =" & iCOmpID & " order by gl_id"
                    dtSub = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtSub.Rows.Count > 0 Then
                        For j = 0 To dtSub.Rows.Count - 1

                            If (dtSub.Rows(j)("gl_Desc").ToString() = "Tangible Assets") Or (dtSub.Rows(j)("gl_Desc").ToString() = "Intangible Assets") Then
                                iFixedAssets = 1
                            Else
                                iFixedAssets = 0
                            End If

                            mSql = "" : mSql = "Select * from Schedule_Linkage_Master where SLM_Head =1 and SLM_GroupID =" & dtGroup.Rows(i)("gl_ID") & " and "
                            mSql = mSql & "SLM_SUbGroupID =" & dtSub.Rows(j)("gl_ID") & " and SLM_CompID =" & iCOmpID & ""
                            dtLink = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                            If dtLink.Rows.Count > 0 Then

                                sArray = dtLink.Rows(0)("SLM_GLLedger").ToString().Split(",")
                                If sArray.Length - 1 Then
                                    For k = 0 To sArray.Length - 1
                                        If sArray(k) <> "" Then
                                            If iFixedAssets = 0 Then

                                                iSql = "" : iSql = "Update Acc_Ledger_Masters Set ALM_Status='F' Where ALM_Year =" & iYearID & " and ALM_CompID =" & iCOmpID & " and ALM_GL =" & sArray(k) & " "
                                                If dFromDate <> "01/01/1900" And dFromDate <> "01-01-1900" And dToDate <> "01/01/1900" And dToDate <> "01-01-1900" Then
                                                    iSql = iSql & " and ALM_TrDate Between '" & objGen.FormatDtForRDBMS(dFromDate, "CT") & "' And '" & objGen.FormatDtForRDBMS(dToDate, "CT") & "' "
                                                End If
                                                If iZoneID > 0 Then
                                                    iSql = iSql & " and ALM_ZoneID=" & iZoneID & ""
                                                End If
                                                If iRegionID > 0 Then
                                                    iSql = iSql & " and ALM_RegionID=" & iRegionID & ""
                                                End If
                                                If iAreaID > 0 Then
                                                    iSql = iSql & " and ALM_AreaID=" & iAreaID & ""
                                                End If
                                                If iBranchID > 0 Then
                                                    iSql = iSql & " and ALM_BranchID=" & iBranchID & ""
                                                End If
                                                objDB.SQLExecuteNonQuery(sNameSpace, iSql)

                                            End If
                                        End If
                                    Next
                                End If

                            End If

                        Next
                    End If
                    iSLNo = iSLNo + 1
                Next
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetDefaultBranch(ByVal sNameSpace As String, ByVal iCompID As Integer) As Integer
        Dim sSql As String = ""
        Try
            sSql = "Select Org_Node From Sad_Org_Structure Where Org_LevelCode=4 And Org_Default=1 And Org_CompID=" & iCompID & " "
            GetDefaultBranch = objDB.SQLExecuteScalarInt(sNameSpace, sSql)
            Return GetDefaultBranch
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getOrgParent(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iNodeID As Integer)
        Dim sSql As String = ""
        Try
            sSql = "Select Org_Parent From Sad_Org_Structure Where Org_Node=" & iNodeID & " And Org_CompID=" & iCompID & " "
            getOrgParent = objDB.SQLExecuteScalarInt(sNameSpace, sSql)
            Return getOrgParent
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetStartDate(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As String
        Dim sSql As String = ""
        Try
            sSql = "Select YMS_FromDate From Acc_Year_Master Where YMS_ID=" & iYearID & " And YMS_CompID=" & iCompID & " "
            GetStartDate = objDB.SQLGetDescription(sNameSpace, sSql)
            Return GetStartDate
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetCurrentDate(ByVal sNameSpace As String, ByVal iCompID As Integer) As String
        Dim sSql As String = ""
        Try
            sSql = "Select GetDate() "
            GetCurrentDate = objDB.SQLGetDescription(sNameSpace, sSql)
            Return GetCurrentDate
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function CheckExist(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As String
        Dim sSql As String = ""
        Dim bCheck As Boolean
        Try
            sSql = "Select * From Acc_Ledger_Masters Where ALM_Status='F' And ALM_Year=" & iYearID - 1 & " And ALM_CompID=" & iCompID & " Order By ALM_ID Desc "
            bCheck = objDB.DBCheckForRecord(sNameSpace, sSql)
            If bCheck = True Then
                sSql = "Select ALM_ToDate From Acc_Ledger_Masters Where ALM_Status='F' And ALM_Year=" & iYearID - 1 & " And ALM_CompID=" & iCompID & " Order By ALM_ID Desc "
                CheckExist = objDB.SQLGetDescription(sNameSpace, sSql)
            Else
                CheckExist = ""
            End If
            Return CheckExist
        Catch ex As Exception
            Throw
        End Try
    End Function
    'Public Function LoadTrialBalanceActual(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
    '                                 ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
    '    Dim sSql As String = "", aSql As String = "", iSql As String = ""
    '    Dim mSql As String = "", kSql As String = "", lSql As String = ""
    '    Dim dt As New DataTable
    '    Dim dtGL As New DataTable, dtSubGL As New DataTable
    '    Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
    '    Dim dRow As DataRow
    '    Dim dtOB As New DataTable
    '    Dim dtOBGL As New DataTable   ' added by vijaylakshmi 29-07-2020
    '    Dim dtTrans As New DataTable
    '    Dim sStr As String = ""

    '    Dim dOpnDebit As Double = 0, dOpnCredit As Double = 0
    '    Dim dTransDebit As Double = 0, dTransCredit As Double = 0
    '    Dim dCloseDebit As Double = 0, dCloseCredit As Double = 0
    '    Dim iNext As Integer = 0

    '    Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
    '    Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
    '    Dim dTotalCloseDebit As Double = 0, dTotalCloseCredit As Double = 0

    '    Dim dGrandTotalOpnDebit As Double = 0 : Dim dGrandTotalOpnCredit As Double = 0
    '    Dim dGrandTotalTransDebit As Double = 0, dGrandTotalTransCredit As Double = 0
    '    Dim dGrandTotalCloseDebit As Double = 0, dGrandTotalCloseCredit As Double = 0

    '    Dim sCloseDebit As String = "" : Dim sCloseCredit As String = ""
    '    Dim sSubDebit As String = "" : Dim sSubCredit As String = ""
    '    Dim sSubTotalDebit As String = "" : Dim sSubTotalCredit As String = ""
    '    Dim sGrandTotalDebit As String = "" : Dim sGrandTotalCredit As String = ""


    '    Dim dtATD As New DataTable
    '    Try
    '        dt.Columns.Add("gl_id")
    '        dt.Columns.Add("gl_Code")
    '        dt.Columns.Add("gl_Desc")
    '        dt.Columns.Add("gl_Head")
    '        dt.Columns.Add("gl_AccHead")
    '        dt.Columns.Add("gl_Parent")
    '        dt.Columns.Add("OpDebit")
    '        dt.Columns.Add("OpCredit")
    '        dt.Columns.Add("TransDebit")
    '        dt.Columns.Add("TransCredit")
    '        dt.Columns.Add("ClosingDebit")
    '        dt.Columns.Add("ClosingCredit")


    '        sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
    '        sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
    '        sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
    '        sSql = sSql & "and A.gl_head in (2) and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
    '        dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGL.Rows.Count > 0 Then
    '            For i = 0 To dtGL.Rows.Count - 1
    '                dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
    '                dTotalOpnDebit = 0 : dTotalOpnCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
    '                dTotalCloseDebit = 0 : dTotalCloseCredit = 0
    '                dRow = dt.NewRow()

    '                If IsDBNull(dtGL.Rows(i)("gl_id").ToString()) = False Then
    '                    dRow("gl_id") = dtGL.Rows(i)("gl_id").ToString()
    '                End If

    '                If dtGL.Rows(i)("gl_glCode").ToString() = "A020301" Then
    '                    dRow("gl_id") = ""
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
    '                    dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
    '                End If

    '                If (dtGL.Rows(i)("gl_glCode").ToString() = "A020202" Or dtGL.Rows(i)("gl_glCode").ToString() = "L030201") Then
    '                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                        dRow("gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
    '                    End If
    '                Else
    '                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                        dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
    '                    End If
    '                End If

    '                'If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                '    dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
    '                'End If

    '                If IsDBNull(dtGL.Rows(i)("gl_head").ToString()) = False Then
    '                    dRow("gl_Head") = dtGL.Rows(i)("gl_head").ToString()
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("gl_Parent").ToString()) = False Then
    '                    dRow("gl_Parent") = dtGL.Rows(i)("gl_Parent").ToString()
    '                End If
    '                Dim dGLDebitTotal, dGLCreditTotal As Double
    '                Dim bCheck As Boolean
    '                Dim dtFL As New DataTable
    '                Dim sLastYearToDate As DateTime
    '                'Dim dfDate As Date
    '                ' dfDate = Convert.ToDateTime(dFromDate).ToString()objGen.FormatDtForRDBMS(dFromDate, "CT")
    '                sLastYearToDate = Convert.ToDateTime(objDB.SQLGetDescription(sNameSpace, "SELECT DATEADD(day, -1, '" & dFromDate & "')")).ToString()

    '                bCheck = objDB.SQLCheckForRecord(sNameSpace, "Select * From Freeze_Ledger Where FL_Head=2 And FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " ")
    '                If bCheck = True Then
    '                    iSql = "" : iSql = "Select * From Freeze_Ledger Where FL_Head=2 And FL_ToDate='" & sLastYearToDate.ToString("MM/dd/yyyy") & "' And FL_GL=" & dtGL.Rows(i)("gl_id").ToString() & " And FL_CompID=" & iCompID & " And FL_Year=" & iYearId & " "
    '                    If iZoneID > 0 Then
    '                        iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
    '                    End If
    '                    If iRegionID > 0 Then
    '                        iSql = iSql & " and FL_RegionID=" & iRegionID & ""
    '                    End If
    '                    If iAreaID > 0 Then
    '                        iSql = iSql & " and FL_AreaID=" & iAreaID & ""
    '                    End If
    '                    If iBranchID > 0 Then
    '                        iSql = iSql & " and FL_BranchID=" & iBranchID & ""
    '                    End If
    '                    dtFL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                    If dtFL.Rows.Count > 0 Then
    '                        If IsDBNull(dtFL.Rows(0)("FL_CloseDebit").ToString()) = False Then
    '                            dRow("OpDebit") = dtFL.Rows(0)("FL_CloseDebit").ToString()
    '                            dGLDebitTotal = dGLDebitTotal + dtFL.Rows(0)("FL_CloseDebit").ToString()
    '                        Else
    '                            dRow("OpDebit") = "0.00"
    '                        End If

    '                        If IsDBNull(dtFL.Rows(0)("FL_CloseCredit").ToString()) = False Then
    '                            dRow("OpCredit") = dtFL.Rows(0)("FL_CloseCredit").ToString()
    '                            dGLCreditTotal = dGLCreditTotal + dtFL.Rows(0)("FL_CloseCredit").ToString()
    '                        Else
    '                            dRow("OpCredit") = "0.00"
    '                        End If

    '                        dOpnDebit = dtFL.Rows(0)("FL_CloseDebit").ToString()
    '                        dOpnCredit = dtFL.Rows(0)("FL_CloseCredit").ToString()
    '                    Else
    '                        dRow("OpDebit") = 0
    '                        dOpnDebit = 0
    '                        dRow("OpCredit") = 0
    '                        dOpnCredit = 0
    '                    End If
    '                Else
    '                    If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger

    '                        '----- This is commented by vijaylakshmi 29-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )
    '                        'iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        'If iZoneID > 0 Then
    '                        '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        'End If
    '                        'If iRegionID > 0 Then
    '                        '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        'End If
    '                        'If iAreaID > 0 Then
    '                        '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        'End If
    '                        'If iBranchID > 0 Then
    '                        '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        'End If
    '                        'dGLDebitTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

    '                        'iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        'If iZoneID > 0 Then
    '                        '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        'End If
    '                        'If iRegionID > 0 Then
    '                        '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        'End If
    '                        'If iAreaID > 0 Then
    '                        '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        'End If
    '                        'If iBranchID > 0 Then
    '                        '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        'End If
    '                        'dGLCreditTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)


    '                        'dRow("OpDebit") = dGLDebitTotal
    '                        'dOpnDebit = dGLDebitTotal
    '                        'dRow("OpCredit") = dGLCreditTotal
    '                        'dOpnCredit = dGLCreditTotal

    '                        '------- ' This is commented by vijaylakshmi 29-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )

    '                        iSql = "" : iSql = "Select Sum(Opn_DebitAmt) as Opn_DebitAmt,Sum(Opn_CreditAmount) as Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If

    '                        dtOBGL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                        If dtOBGL.Rows.Count > 0 Then
    '                            If (dtOBGL.Rows(0)("Opn_DebitAmt") Is "" And dtOBGL.Rows(0)("Opn_CreditAmount") Is "") Then
    '                                dRow("OpDebit") = "0.00"
    '                                dRow("OpDebit") = "0.00"
    '                            Else
    '                                If IsDBNull(dtOBGL.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                    If dtOBGL.Rows(0)("Opn_DebitAmt").ToString() <> "" Then
    '                                        dRow("OpDebit") = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
    '                                        dGLDebitTotal = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
    '                                        dOpnDebit = dGLDebitTotal
    '                                    Else
    '                                        dRow("OpDebit") = "0.00"
    '                                    End If

    '                                Else
    '                                    dRow("OpDebit") = "0.00"
    '                                End If

    '                                If IsDBNull(dtOBGL.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                    If dtOBGL.Rows(0)("Opn_CreditAmount").ToString() <> "" Then
    '                                        dRow("OpCredit") = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
    '                                        dGLCreditTotal = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
    '                                        dOpnCredit = dGLCreditTotal
    '                                    Else
    '                                        dRow("OpCredit") = "0.00"
    '                                    End If
    '                                Else
    '                                    dRow("OpCredit") = "0.00"
    '                                End If
    '                            End If
    '                        End If

    '                    ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger
    '                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If
    '                        dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                        If dtOB.Rows.Count > 0 Then

    '                            If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                            Else
    '                                dRow("OpDebit") = "0.00"
    '                            End If

    '                            If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                            Else
    '                                dRow("OpCredit") = "0.00"
    '                            End If
    '                        End If
    '                    End If

    '                End If

    '                '*** Working But for deactivated record not worinkg so commented ***'
    '                'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details"
    '                'aSql = aSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                'aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
    '                '*** Working But for deactivated record not worinkg so commented ***'

    '                If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
    '                    aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from GL_Transactions_Details"
    '                    aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "

    '                ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger
    '                    aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from GL_Transactions_Details"
    '                    aSql = aSql & " where ATD_SubGL in (Select gl_ID From Chart_Of_Accounts Where gl_Parent = '" & dtGL.Rows(i)("gl_id").ToString() & "') and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "'  "
    '                End If

    '                If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
    '                ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
    '                ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
    '                ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
    '                ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
    '                ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
    '                ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                End If

    '                dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtTrans.Rows.Count > 0 Then
    '                    If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
    '                        If dtTrans.Rows(0)("Debit").ToString() <> "" Then
    '                            dRow("TransDebit") = dtTrans.Rows(0)("Debit").ToString()
    '                            dTransDebit = dtTrans.Rows(0)("Debit").ToString()
    '                            dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
    '                        Else
    '                            dRow("TransDebit") = "0.00"
    '                        End If
    '                    Else
    '                        dRow("TransDebit") = "0.00"
    '                    End If

    '                    If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
    '                        If dtTrans.Rows(0)("Credit").ToString() <> "" Then
    '                            dRow("TransCredit") = dtTrans.Rows(0)("Credit").ToString()
    '                            dTransCredit = dtTrans.Rows(0)("Credit").ToString()
    '                            dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
    '                        Else
    '                            dRow("TransCredit") = "0.00"
    '                        End If
    '                    Else
    '                        dRow("TransCredit") = "0.00"
    '                    End If
    '                Else
    '                    dRow("TransCredit") = "0.00"
    '                    dRow("TransCredit") = "0.00"
    '                End If


    '                Dim dClosingDborCr As Double = 0
    '                dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
    '                If dClosingDborCr > 0 Then
    '                    sCloseDebit = dClosingDborCr
    '                    'dRow("ClosingDebit") = dClosingDborCr
    '                    If sCloseDebit.StartsWith("-") = True Then
    '                        sCloseDebit = sCloseDebit.Remove(0, 1)
    '                    End If
    '                    dRow("ClosingDebit") = dClosingDborCr

    '                    dRow("ClosingCredit") = "0.00"
    '                    dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
    '                    dGrandTotalCloseDebit = dGrandTotalCloseDebit + dClosingDborCr
    '                Else
    '                    'dRow("ClosingCredit") = dClosingDborCr
    '                    sCloseCredit = dClosingDborCr
    '                    If sCloseCredit.StartsWith("-") = True Then
    '                        sCloseCredit = sCloseCredit.Remove(0, 1)
    '                    End If
    '                    dRow("ClosingCredit") = sCloseCredit

    '                    dRow("ClosingDebit") = "0.00"
    '                    dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
    '                    dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
    '                End If

    '                'Commented since GL Total has to be displayed.

    '                'Dim dtCheckSubGLs As New DataTable
    '                'dtCheckSubGLs = objDB.SQLExecuteDataSet(sNameSpace, "Select * From Chart_Of_Accounts Where GL_Parent=" & dtGL.Rows(i)("gl_id").ToString() & " And gl_CompID=" & iCompID & " ").Tables(0)
    '                'If dtCheckSubGLs.Rows.Count > 0 Then
    '                '    dRow("OpDebit") = "0.00"
    '                '    dRow("OpCredit") = "0.00"

    '                '    dRow("TransDebit") = "0.00"
    '                '    dRow("TransCredit") = "0.00"

    '                '    dRow("ClosingDebit") = "0.00"
    '                '    dRow("ClosingCredit") = "0.00"
    '                'End If
    '                'Commented since GL Total has to be displayed.

    '                dt.Rows.Add(dRow)


    '                '' SUb GL
    '                mSql = "" : mSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGL.Rows(i)("gl_id").ToString() & " and gl_CompID =" & iCompID & " and "
    '                mSql = mSql & "gl_head in (3) and gl_Delflag='C' and gl_Status ='A' Order by gl_glcode"
    '                dtSubGL = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                If dtSubGL.Rows.Count > 0 Then
    '                    For j = 0 To dtSubGL.Rows.Count - 1
    '                        dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSubGL.Rows(j)("gl_id").ToString()) = False Then
    '                            dRow("gl_id") = dtSubGL.Rows(j)("gl_id").ToString()
    '                        End If

    '                        If IsDBNull(dtSubGL.Rows(j)("gl_glCode").ToString()) = False Then
    '                            dRow("gl_Code") = dtSubGL.Rows(j)("gl_glCode").ToString()
    '                        End If

    '                        'If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
    '                        '    dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
    '                        'End If
    '                        If (dtSubGL.Rows(j)("gl_Parent").ToString() = "141" Or dtSubGL.Rows(j)("gl_Parent").ToString() = "67") Then
    '                            If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
    '                                dRow("gl_Desc") = "<b>" & dtSubGL.Rows(j)("Gl_Desc").ToString() & "</b>"
    '                            End If
    '                        Else
    '                            If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
    '                                dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
    '                            End If
    '                        End If

    '                        If IsDBNull(dtSubGL.Rows(j)("gl_head").ToString()) = False Then
    '                            dRow("gl_Head") = dtSubGL.Rows(j)("gl_head").ToString()
    '                        End If

    '                        If IsDBNull(dtSubGL.Rows(j)("gl_Parent").ToString()) = False Then
    '                            dRow("gl_Parent") = dtSubGL.Rows(j)("gl_Parent").ToString()
    '                        End If

    '                        sLastYearToDate = objDB.SQLGetDescription(sNameSpace, "SELECT DATEADD(day, -1, '" & dFromDate & "')")


    '                        bCheck = objDB.SQLCheckForRecord(sNameSpace, "Select * From Freeze_Ledger Where FL_Head=3 And FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " ")
    '                        If bCheck = True Then
    '                            iSql = "" : iSql = "Select * From Freeze_Ledger Where FL_Head=3 And FL_ToDate='" & sLastYearToDate.ToString("MM/dd/yyyy") & "' And FL_GL=" & dtSubGL.Rows(j)("gl_id").ToString() & " And FL_CompID=" & iCompID & " And FL_Year=" & iYearId & " "
    '                            If iZoneID > 0 Then
    '                                iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
    '                            End If
    '                            If iRegionID > 0 Then
    '                                iSql = iSql & " and FL_RegionID=" & iRegionID & ""
    '                            End If
    '                            If iAreaID > 0 Then
    '                                iSql = iSql & " and FL_AreaID=" & iAreaID & ""
    '                            End If
    '                            If iBranchID > 0 Then
    '                                iSql = iSql & " and FL_BranchID=" & iBranchID & ""
    '                            End If
    '                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                            If dtOB.Rows.Count > 0 Then

    '                                If IsDBNull(dtOB.Rows(0)("FL_CloseDebit").ToString()) = False Then
    '                                    dRow("OpDebit") = dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                    dOpnDebit = dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                    dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                    dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                Else
    '                                    dRow("OpDebit") = "0.00"
    '                                End If

    '                                If IsDBNull(dtOB.Rows(0)("FL_CloseCredit").ToString()) = False Then
    '                                    dRow("OpCredit") = dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                    dOpnCredit = dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                    dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                    dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                Else
    '                                    dRow("OpCredit") = "0.00"
    '                                End If
    '                            End If

    '                        Else

    '                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtSubGL.Rows(j)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
    '                            If iZoneID > 0 Then
    '                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                            End If
    '                            If iRegionID > 0 Then
    '                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                            End If
    '                            If iAreaID > 0 Then
    '                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                            End If
    '                            If iBranchID > 0 Then
    '                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                            End If
    '                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                            If dtOB.Rows.Count > 0 Then

    '                                If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                    dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                    dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                    dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                    dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                Else
    '                                    dRow("OpDebit") = "0.00"
    '                                End If

    '                                If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                    dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                    dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                    dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                    dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                Else
    '                                    dRow("OpCredit") = "0.00"
    '                                End If
    '                            End If

    '                        End If

    '                        '*** Working But for deactivated record not worinkg so commented ***'
    '                        'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                        'aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
    '                        '*** Working But for deactivated record not worinkg so commented ***'

    '                        aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from GL_Transactions_Details "
    '                        aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "

    '                        If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
    '                        ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
    '                        ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
    '                        ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
    '                        ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
    '                        ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
    '                        ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                        End If

    '                        dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                        If dtTrans.Rows.Count > 0 Then
    '                            If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
    '                                If dtTrans.Rows(0)("Debit").ToString() <> "" Then
    '                                    dRow("TransDebit") = dtTrans.Rows(0)("Debit").ToString()
    '                                    dTransDebit = dtTrans.Rows(0)("Debit").ToString()
    '                                    dTotalTransDebit = dTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
    '                                    dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
    '                                Else
    '                                    dRow("TransDebit") = "0.00"
    '                                End If
    '                            Else
    '                                dRow("TransDebit") = "0.00"
    '                            End If

    '                            If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
    '                                If dtTrans.Rows(0)("Credit").ToString() <> "" Then
    '                                    dRow("TransCredit") = dtTrans.Rows(0)("Credit").ToString()
    '                                    dTransCredit = dtTrans.Rows(0)("Credit").ToString()
    '                                    dTotalTransCredit = dTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
    '                                    dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
    '                                Else
    '                                    dRow("TransCredit") = "0.00"
    '                                End If
    '                            Else
    '                                dRow("TransCredit") = "0.00"
    '                            End If
    '                        Else
    '                            dRow("TransCredit") = "0.00"
    '                            dRow("TransCredit") = "0.00"
    '                        End If

    '                        dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
    '                        If dClosingDborCr > 0 Then
    '                            'dRow("ClosingDebit") = dClosingDborCr
    '                            sSubDebit = dClosingDborCr
    '                            If sSubDebit.StartsWith("-") = True Then
    '                                sSubDebit = sSubDebit.Remove(0, 1)
    '                            End If
    '                            dRow("ClosingDebit") = sSubDebit

    '                            dRow("ClosingCredit") = "0.00"
    '                            'dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
    '                            dGrandTotalCloseDebit = dGrandTotalCloseDebit + dRow("ClosingDebit")
    '                        Else
    '                            'dRow("ClosingCredit") = dClosingDborCr
    '                            sSubCredit = dClosingDborCr
    '                            If sSubCredit.StartsWith("-") = True Then
    '                                sSubCredit = sSubCredit.Remove(0, 1)
    '                            End If
    '                            dRow("ClosingCredit") = sSubCredit

    '                            dRow("ClosingDebit") = "0.00"
    '                            'dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
    '                            dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next

    '                    If j = dtSubGL.Rows.Count Then
    '                        dRow = dt.NewRow()
    '                        dRow("gl_Desc") = "<B>" & "TOTAL" & "</B>"
    '                        dRow("OpDebit") = dTotalOpnDebit
    '                        dRow("OpCredit") = dTotalOpnCredit
    '                        dRow("TransDebit") = dTotalTransDebit
    '                        dRow("TransCredit") = dTotalTransCredit

    '                        'dRow("ClosingDebit") = dTotalCloseDebit
    '                        'dRow("ClosingCredit") = dTotalCloseCredit
    '                        sSubTotalDebit = dTotalCloseDebit
    '                        If sSubTotalDebit.StartsWith("-") = True Then
    '                            sSubTotalDebit = sSubTotalDebit.Remove(0, 1)
    '                        End If
    '                        dRow("ClosingDebit") = sSubTotalDebit

    '                        sSubTotalCredit = dTotalCloseCredit
    '                        If sSubTotalCredit.StartsWith("-") = True Then
    '                            sSubTotalCredit = sSubTotalCredit.Remove(0, 1)
    '                        End If
    '                        dRow("ClosingCredit") = sSubTotalCredit

    '                        dt.Rows.Add(dRow)
    '                    End If
    '                End If
    '            Next
    '        End If

    '        If dt.Rows.Count > 0 Then
    '            dOpnDebit = 0 : dOpnCredit = 0
    '            dTransDebit = 0 : dTransCredit = 0
    '            dCloseDebit = 0 : dCloseCredit = 0
    '            For l = 0 To dt.Rows.Count - 1
    '                If dt.Rows(l)("gl_Head").ToString() = "2" Then
    '                    If dt.Rows(l)("OpDebit").ToString() <> "" Then
    '                        dOpnDebit = dOpnDebit + dt.Rows(l)("OpDebit").ToString()
    '                    Else
    '                        dOpnDebit = dOpnDebit + 0
    '                    End If

    '                    If dt.Rows(l)("OpCredit").ToString() <> "" Then
    '                        dOpnCredit = dOpnCredit + dt.Rows(l)("OpCredit").ToString()
    '                    Else
    '                        dOpnCredit = dOpnCredit + 0
    '                    End If

    '                    If dt.Rows(l)("TransDebit").ToString() <> "" Then
    '                        dTransDebit = dTransDebit + dt.Rows(l)("TransDebit").ToString()
    '                    Else
    '                        dTransDebit = dTransDebit + 0
    '                    End If

    '                    If dt.Rows(l)("TransCredit").ToString() <> "" Then
    '                        dTransCredit = dTransCredit + dt.Rows(l)("TransCredit").ToString()
    '                    Else
    '                        dTransCredit = dTransCredit + 0
    '                    End If

    '                    If dt.Rows(l)("ClosingDebit").ToString() <> "" Then
    '                        dCloseDebit = dCloseDebit + dt.Rows(l)("ClosingDebit").ToString()
    '                    Else
    '                        dCloseDebit = dCloseDebit + 0
    '                    End If

    '                    If dt.Rows(l)("ClosingCredit").ToString() <> "" Then
    '                        dCloseCredit = dCloseCredit + dt.Rows(l)("ClosingCredit").ToString()
    '                    Else
    '                        dCloseCredit = dCloseCredit + 0
    '                    End If

    '                End If
    '            Next

    '            dRow = dt.NewRow
    '            dt.Rows.Add(dRow)

    '            dRow = dt.NewRow
    '            dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
    '            dRow("OpDebit") = dOpnDebit
    '            dRow("OpCredit") = dOpnCredit
    '            dRow("TransDebit") = dTransDebit
    '            dRow("TransCredit") = dTransCredit

    '            'dRow("ClosingDebit") = dCloseDebit
    '            'dRow("ClosingCredit") = dCloseCredit

    '            sGrandTotalDebit = dCloseDebit
    '            If sGrandTotalDebit.StartsWith("-") = True Then
    '                sGrandTotalDebit = sGrandTotalDebit.Remove(0, 1)
    '            End If
    '            dRow("ClosingDebit") = sGrandTotalDebit

    '            'sGrandTotalCredit = dCloseDebit
    '            sGrandTotalCredit = dCloseCredit
    '            If sGrandTotalCredit.StartsWith("-") = True Then
    '                sGrandTotalCredit = sGrandTotalCredit.Remove(0, 1)
    '            End If
    '            dRow("ClosingCredit") = sGrandTotalCredit

    '            dt.Rows.Add(dRow)
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    '******Commented by Vijaylakshmi on 24_12_2020
    'Public Function LoadTrialBalanceActual(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
    '                                 ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
    '    Dim sSql As String = "", aSql As String = "", iSql As String = ""
    '    Dim mSql As String = "", kSql As String = "", lSql As String = ""
    '    Dim dt As New DataTable
    '    Dim dtGL As New DataTable, dtSubGL As New DataTable
    '    Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
    '    Dim dRow As DataRow
    '    Dim dtOB As New DataTable
    '    Dim dtOBGL As New DataTable   ' added by vijaylakshmi 29-07-2020
    '    Dim dtTrans As New DataTable
    '    Dim sStr As String = ""

    '    Dim dOpnDebit As Double = 0, dOpnCredit As Double = 0
    '    Dim dTransDebit As Double = 0, dTransCredit As Double = 0
    '    Dim dCloseDebit As Double = 0, dCloseCredit As Double = 0
    '    Dim iNext As Integer = 0

    '    Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
    '    Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
    '    Dim dTotalCloseDebit As Double = 0, dTotalCloseCredit As Double = 0

    '    Dim dGrandTotalOpnDebit As Double = 0 : Dim dGrandTotalOpnCredit As Double = 0
    '    Dim dGrandTotalTransDebit As Double = 0, dGrandTotalTransCredit As Double = 0
    '    Dim dGrandTotalCloseDebit As Double = 0, dGrandTotalCloseCredit As Double = 0

    '    Dim sCloseDebit As String = "" : Dim sCloseCredit As String = ""
    '    Dim sSubDebit As String = "" : Dim sSubCredit As String = ""
    '    Dim sSubTotalDebit As String = "" : Dim sSubTotalCredit As String = ""
    '    Dim sGrandTotalDebit As String = "" : Dim sGrandTotalCredit As String = ""


    '    Dim dtATD As New DataTable
    '    Try
    '        dt.Columns.Add("gl_id")
    '        dt.Columns.Add("gl_Code")
    '        dt.Columns.Add("gl_Desc")
    '        dt.Columns.Add("gl_Head")
    '        dt.Columns.Add("gl_AccHead")
    '        dt.Columns.Add("gl_Parent")
    '        dt.Columns.Add("OpDebit")
    '        dt.Columns.Add("OpCredit")
    '        dt.Columns.Add("TransDebit")
    '        dt.Columns.Add("TransCredit")
    '        dt.Columns.Add("ClosingDebit")
    '        dt.Columns.Add("ClosingCredit")


    '        sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
    '        sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
    '        sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
    '        sSql = sSql & "and A.gl_head in (2) and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
    '        dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
    '        If dtGL.Rows.Count > 0 Then
    '            For i = 0 To dtGL.Rows.Count - 1
    '                dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
    '                dTotalOpnDebit = 0 : dTotalOpnCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
    '                dTotalCloseDebit = 0 : dTotalCloseCredit = 0
    '                dRow = dt.NewRow()

    '                If IsDBNull(dtGL.Rows(i)("gl_id").ToString()) = False Then
    '                    dRow("gl_id") = dtGL.Rows(i)("gl_id").ToString()
    '                End If

    '                'If dtGL.Rows(i)("gl_glCode").ToString() = "A020301" Then
    '                '    dRow("gl_id") = ""
    '                'End If

    '                If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
    '                    dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
    '                End If

    '                If (dtGL.Rows(i)("gl_glCode").ToString() = "A020202" Or dtGL.Rows(i)("gl_glCode").ToString() = "L030201") Then
    '                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                        dRow("gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
    '                    End If
    '                Else
    '                    If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                        dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
    '                    End If
    '                End If



    '                'If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
    '                '    dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
    '                'End If

    '                If IsDBNull(dtGL.Rows(i)("gl_head").ToString()) = False Then
    '                    dRow("gl_Head") = dtGL.Rows(i)("gl_head").ToString()
    '                End If

    '                If IsDBNull(dtGL.Rows(i)("gl_Parent").ToString()) = False Then
    '                    dRow("gl_Parent") = dtGL.Rows(i)("gl_Parent").ToString()
    '                End If
    '                Dim dGLDebitTotal, dGLCreditTotal As Double
    '                Dim bCheck As Boolean
    '                Dim dtFL As New DataTable
    '                Dim sLastYearToDate As DateTime
    '                'Dim dfDate As Date
    '                'dfDate = Convert.ToDateTime(dFromDate).ToString()objGen.FormatDtForRDBMS(dFromDate, "CT")
    '                ' dfDate = objGen.FormatDtForRDBMS(dFromDate, "Q")
    '                sLastYearToDate = Convert.ToDateTime(objDB.SQLGetDescription(sNameSpace, "SELECT DATEADD(day, -1, '" & dFromDate & "')")).ToString()

    '                bCheck = objDB.SQLCheckForRecord(sNameSpace, "Select * From Freeze_Ledger Where FL_Head=2 And FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " ")
    '                If bCheck = True Then
    '                    iSql = "" : iSql = "Select * From Freeze_Ledger Where FL_Head=2 And FL_ToDate='" & sLastYearToDate.ToString("MM/dd/yyyy") & "' And FL_GL=" & dtGL.Rows(i)("gl_id").ToString() & " And FL_CompID=" & iCompID & " And FL_Year=" & iYearId & " "
    '                    If iZoneID > 0 Then
    '                        iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
    '                    End If
    '                    If iRegionID > 0 Then
    '                        iSql = iSql & " and FL_RegionID=" & iRegionID & ""
    '                    End If
    '                    If iAreaID > 0 Then
    '                        iSql = iSql & " and FL_AreaID=" & iAreaID & ""
    '                    End If
    '                    If iBranchID > 0 Then
    '                        iSql = iSql & " and FL_BranchID=" & iBranchID & ""
    '                    End If
    '                    dtFL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                    If dtFL.Rows.Count > 0 Then
    '                        If IsDBNull(dtFL.Rows(0)("FL_CloseDebit").ToString()) = False Then
    '                            dRow("OpDebit") = dtFL.Rows(0)("FL_CloseDebit").ToString()
    '                            dGLDebitTotal = dGLDebitTotal + dtFL.Rows(0)("FL_CloseDebit").ToString()
    '                        Else
    '                            dRow("OpDebit") = "0.00"
    '                        End If

    '                        If IsDBNull(dtFL.Rows(0)("FL_CloseCredit").ToString()) = False Then
    '                            dRow("OpCredit") = dtFL.Rows(0)("FL_CloseCredit").ToString()
    '                            dGLCreditTotal = dGLCreditTotal + dtFL.Rows(0)("FL_CloseCredit").ToString()
    '                        Else
    '                            dRow("OpCredit") = "0.00"
    '                        End If

    '                        dOpnDebit = dtFL.Rows(0)("FL_CloseDebit").ToString()
    '                        dOpnCredit = dtFL.Rows(0)("FL_CloseCredit").ToString()
    '                    Else
    '                        dRow("OpDebit") = 0
    '                        dOpnDebit = 0
    '                        dRow("OpCredit") = 0
    '                        dOpnCredit = 0
    '                    End If
    '                Else
    '                    If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger

    '                        '----- This is commented by vijaylakshmi 29-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )
    '                        'iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        'If iZoneID > 0 Then
    '                        '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        'End If
    '                        'If iRegionID > 0 Then
    '                        '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        'End If
    '                        'If iAreaID > 0 Then
    '                        '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        'End If
    '                        'If iBranchID > 0 Then
    '                        '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        'End If
    '                        'dGLDebitTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

    '                        'iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        'If iZoneID > 0 Then
    '                        '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        'End If
    '                        'If iRegionID > 0 Then
    '                        '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        'End If
    '                        'If iAreaID > 0 Then
    '                        '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        'End If
    '                        'If iBranchID > 0 Then
    '                        '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        'End If
    '                        'dGLCreditTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)


    '                        'dRow("OpDebit") = dGLDebitTotal
    '                        'dOpnDebit = dGLDebitTotal
    '                        'dRow("OpCredit") = dGLCreditTotal
    '                        'dOpnCredit = dGLCreditTotal

    '                        '------- ' This is commented by vijaylakshmi 29-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )

    '                        iSql = "" : iSql = "Select Sum(Opn_DebitAmt) as Opn_DebitAmt,Sum(Opn_CreditAmount) as Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_id =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If

    '                        dtOBGL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                        If dtOBGL.Rows.Count > 0 Then
    '                            If (dtOBGL.Rows(0)("Opn_DebitAmt") Is "" And dtOBGL.Rows(0)("Opn_CreditAmount") Is "") Then
    '                                dRow("OpDebit") = "0.00"
    '                                dRow("OpDebit") = "0.00"
    '                            Else
    '                                If IsDBNull(dtOBGL.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                    If dtOBGL.Rows(0)("Opn_DebitAmt").ToString() <> "" Then
    '                                        dRow("OpDebit") = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
    '                                        dGLDebitTotal = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
    '                                        dOpnDebit = dGLDebitTotal
    '                                    Else
    '                                        dRow("OpDebit") = "0.00"
    '                                    End If

    '                                Else
    '                                    dRow("OpDebit") = "0.00"
    '                                End If

    '                                If IsDBNull(dtOBGL.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                    If dtOBGL.Rows(0)("Opn_CreditAmount").ToString() <> "" Then
    '                                        dRow("OpCredit") = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
    '                                        dGLCreditTotal = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
    '                                        dOpnCredit = dGLCreditTotal
    '                                    Else
    '                                        dRow("OpCredit") = "0.00"
    '                                    End If
    '                                Else
    '                                    dRow("OpCredit") = "0.00"
    '                                End If
    '                            End If
    '                        End If

    '                    ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger

    '                        If dRow("gl_Code") = "L02020104" Then
    '                            Dim icode As String = "ABC"
    '                        End If
    '                        iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
    '                        If iZoneID > 0 Then
    '                            iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                        End If
    '                        If iRegionID > 0 Then
    '                            iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                        End If
    '                        If iAreaID > 0 Then
    '                            iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                        End If
    '                        If iBranchID > 0 Then
    '                            iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                        End If
    '                        dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                        If dtOB.Rows.Count > 0 Then

    '                            If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                            Else
    '                                dRow("OpDebit") = "0.00"
    '                            End If

    '                            If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                            Else
    '                                dRow("OpCredit") = "0.00"
    '                            End If
    '                        End If
    '                    End If

    '                End If

    '                '*** Working But for deactivated record not worinkg so commented ***'
    '                'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details"
    '                'aSql = aSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                'aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
    '                '*** Working But for deactivated record not worinkg so commented ***'

    '                If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
    '                    aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from ACC_Transactions_Details" 'GL_Transactions_Details commented 0n 01-09-2020 because itz fetching deactivated record
    '                    aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "

    '                ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger
    '                    aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from ACC_Transactions_Details" 'GL_Transactions_Details commented 0n 01-09-2020 because itz fetching deactivated record
    '                    aSql = aSql & " where ATD_SubGL in (Select gl_ID From Chart_Of_Accounts Where gl_Parent = '" & dtGL.Rows(i)("gl_id").ToString() & "') and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "'  "
    '                End If

    '                If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
    '                ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
    '                ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
    '                ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
    '                ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
    '                ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
    '                    aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
    '                ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
    '                    aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                End If

    '                dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                If dtTrans.Rows.Count > 0 Then
    '                    If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
    '                        If dtTrans.Rows(0)("Debit").ToString() <> "" Then
    '                            dRow("TransDebit") = dtTrans.Rows(0)("Debit").ToString()
    '                            dTransDebit = dtTrans.Rows(0)("Debit").ToString()
    '                            dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
    '                        Else
    '                            dRow("TransDebit") = "0.00"
    '                        End If
    '                    Else
    '                        dRow("TransDebit") = "0.00"
    '                    End If

    '                    If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
    '                        If dtTrans.Rows(0)("Credit").ToString() <> "" Then
    '                            dRow("TransCredit") = dtTrans.Rows(0)("Credit").ToString()
    '                            dTransCredit = dtTrans.Rows(0)("Credit").ToString()
    '                            dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
    '                        Else
    '                            dRow("TransCredit") = "0.00"
    '                        End If
    '                    Else
    '                        dRow("TransCredit") = "0.00"
    '                    End If
    '                Else
    '                    dRow("TransCredit") = "0.00"
    '                    dRow("TransCredit") = "0.00"
    '                End If


    '                Dim dClosingDborCr As Double = 0
    '                dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
    '                If dClosingDborCr > 0 Then
    '                    sCloseDebit = dClosingDborCr
    '                    'dRow("ClosingDebit") = dClosingDborCr
    '                    If sCloseDebit.StartsWith("-") = True Then
    '                        sCloseDebit = sCloseDebit.Remove(0, 1)
    '                    End If
    '                    dRow("ClosingDebit") = dClosingDborCr

    '                    dRow("ClosingCredit") = "0.00"
    '                    dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
    '                    dGrandTotalCloseDebit = dGrandTotalCloseDebit + dClosingDborCr
    '                Else
    '                    'dRow("ClosingCredit") = dClosingDborCr
    '                    sCloseCredit = dClosingDborCr
    '                    If sCloseCredit.StartsWith("-") = True Then
    '                        sCloseCredit = sCloseCredit.Remove(0, 1)
    '                    End If
    '                    dRow("ClosingCredit") = sCloseCredit

    '                    dRow("ClosingDebit") = "0.00"
    '                    dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
    '                    dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
    '                End If

    '                'Commented since GL Total has to be displayed.

    '                'Dim dtCheckSubGLs As New DataTable
    '                'dtCheckSubGLs = objDB.SQLExecuteDataSet(sNameSpace, "Select * From Chart_Of_Accounts Where GL_Parent=" & dtGL.Rows(i)("gl_id").ToString() & " And gl_CompID=" & iCompID & " ").Tables(0)
    '                'If dtCheckSubGLs.Rows.Count > 0 Then
    '                '    dRow("OpDebit") = "0.00"
    '                '    dRow("OpCredit") = "0.00"

    '                '    dRow("TransDebit") = "0.00"
    '                '    dRow("TransCredit") = "0.00"

    '                '    dRow("ClosingDebit") = "0.00"
    '                '    dRow("ClosingCredit") = "0.00"
    '                'End If
    '                'Commented since GL Total has to be displayed.

    '                dt.Rows.Add(dRow)


    '                '' SUb GL
    '                mSql = "" : mSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGL.Rows(i)("gl_id").ToString() & " and gl_CompID =" & iCompID & " and "
    '                mSql = mSql & "gl_head in (3) and gl_Delflag='C' and gl_Status ='A' Order by gl_glcode"
    '                dtSubGL = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
    '                If dtSubGL.Rows.Count > 0 Then
    '                    For j = 0 To dtSubGL.Rows.Count - 1
    '                        dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
    '                        dRow = dt.NewRow()
    '                        If IsDBNull(dtSubGL.Rows(j)("gl_id").ToString()) = False Then
    '                            dRow("gl_id") = dtSubGL.Rows(j)("gl_id").ToString()
    '                        End If

    '                        If IsDBNull(dtSubGL.Rows(j)("gl_glCode").ToString()) = False Then
    '                            dRow("gl_Code") = dtSubGL.Rows(j)("gl_glCode").ToString()
    '                        End If

    '                        'If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
    '                        '    dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
    '                        'End If
    '                        If (dtSubGL.Rows(j)("gl_Parent").ToString() = "141" Or dtSubGL.Rows(j)("gl_Parent").ToString() = "67") Then
    '                            If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
    '                                dRow("gl_Desc") = "<b>" & dtSubGL.Rows(j)("Gl_Desc").ToString() & "</b>"
    '                            End If
    '                        Else
    '                            If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
    '                                dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
    '                            End If
    '                        End If

    '                        If IsDBNull(dtSubGL.Rows(j)("gl_head").ToString()) = False Then
    '                            dRow("gl_Head") = dtSubGL.Rows(j)("gl_head").ToString()
    '                        End If

    '                        If IsDBNull(dtSubGL.Rows(j)("gl_Parent").ToString()) = False Then
    '                            dRow("gl_Parent") = dtSubGL.Rows(j)("gl_Parent").ToString()
    '                        End If

    '                        sLastYearToDate = objDB.SQLGetDescription(sNameSpace, "SELECT DATEADD(day, -1, '" & dFromDate & "')")


    '                        bCheck = objDB.SQLCheckForRecord(sNameSpace, "Select * From Freeze_Ledger Where FL_Head=3 And FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " ")
    '                        If bCheck = True Then
    '                            iSql = "" : iSql = "Select * From Freeze_Ledger Where FL_Head=3 And FL_ToDate='" & sLastYearToDate.ToString("MM/dd/yyyy") & "' And FL_GL=" & dtSubGL.Rows(j)("gl_id").ToString() & " And FL_CompID=" & iCompID & " And FL_Year=" & iYearId & " "
    '                            If iZoneID > 0 Then
    '                                iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
    '                            End If
    '                            If iRegionID > 0 Then
    '                                iSql = iSql & " and FL_RegionID=" & iRegionID & ""
    '                            End If
    '                            If iAreaID > 0 Then
    '                                iSql = iSql & " and FL_AreaID=" & iAreaID & ""
    '                            End If
    '                            If iBranchID > 0 Then
    '                                iSql = iSql & " and FL_BranchID=" & iBranchID & ""
    '                            End If
    '                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                            If dtOB.Rows.Count > 0 Then

    '                                If IsDBNull(dtOB.Rows(0)("FL_CloseDebit").ToString()) = False Then
    '                                    dRow("OpDebit") = dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                    dOpnDebit = dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                    dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                    dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("FL_CloseDebit").ToString()
    '                                Else
    '                                    dRow("OpDebit") = "0.00"
    '                                End If

    '                                If IsDBNull(dtOB.Rows(0)("FL_CloseCredit").ToString()) = False Then
    '                                    dRow("OpCredit") = dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                    dOpnCredit = dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                    dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                    dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("FL_CloseCredit").ToString()
    '                                Else
    '                                    dRow("OpCredit") = "0.00"
    '                                End If
    '                            End If

    '                        Else

    '                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtSubGL.Rows(j)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
    '                            If iZoneID > 0 Then
    '                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
    '                            End If
    '                            If iRegionID > 0 Then
    '                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
    '                            End If
    '                            If iAreaID > 0 Then
    '                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
    '                            End If
    '                            If iBranchID > 0 Then
    '                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
    '                            End If
    '                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
    '                            If dtOB.Rows.Count > 0 Then

    '                                If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
    '                                    dRow("OpDebit") = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                    dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                    dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                    dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
    '                                Else
    '                                    dRow("OpDebit") = "0.00"
    '                                End If

    '                                If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
    '                                    dRow("OpCredit") = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                    dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                    dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                    dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
    '                                Else
    '                                    dRow("OpCredit") = "0.00"
    '                                End If
    '                            End If

    '                        End If

    '                        '*** Working But for deactivated record not worinkg so commented ***'
    '                        'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
    '                        'aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
    '                        '*** Working But for deactivated record not worinkg so commented ***'

    '                        aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from acc_transactions_details " 'changed GL_Transactions_Details table to acc_transactions_details  on 02-09-2020 because itz fetching deactivated record
    '                        aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "

    '                        If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
    '                        ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
    '                        ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
    '                        ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
    '                        ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
    '                        ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
    '                            aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
    '                        ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                        ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
    '                            aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
    '                        End If

    '                        dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
    '                        If dtTrans.Rows.Count > 0 Then
    '                            If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
    '                                If dtTrans.Rows(0)("Debit").ToString() <> "" Then
    '                                    dRow("TransDebit") = dtTrans.Rows(0)("Debit").ToString()
    '                                    dTransDebit = dtTrans.Rows(0)("Debit").ToString()
    '                                    dTotalTransDebit = dTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
    '                                    dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
    '                                Else
    '                                    dRow("TransDebit") = "0.00"
    '                                End If
    '                            Else
    '                                dRow("TransDebit") = "0.00"
    '                            End If

    '                            If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
    '                                If dtTrans.Rows(0)("Credit").ToString() <> "" Then
    '                                    dRow("TransCredit") = dtTrans.Rows(0)("Credit").ToString()
    '                                    dTransCredit = dtTrans.Rows(0)("Credit").ToString()
    '                                    dTotalTransCredit = dTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
    '                                    dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
    '                                Else
    '                                    dRow("TransCredit") = "0.00"
    '                                End If
    '                            Else
    '                                dRow("TransCredit") = "0.00"
    '                            End If
    '                        Else
    '                            dRow("TransCredit") = "0.00"
    '                            dRow("TransCredit") = "0.00"
    '                        End If

    '                        dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
    '                        If dClosingDborCr > 0 Then
    '                            'dRow("ClosingDebit") = dClosingDborCr
    '                            sSubDebit = dClosingDborCr
    '                            If sSubDebit.StartsWith("-") = True Then
    '                                sSubDebit = sSubDebit.Remove(0, 1)
    '                            End If
    '                            dRow("ClosingDebit") = sSubDebit

    '                            dRow("ClosingCredit") = "0.00"
    '                            'dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
    '                            dGrandTotalCloseDebit = dGrandTotalCloseDebit + dRow("ClosingDebit")
    '                        Else
    '                            'dRow("ClosingCredit") = dClosingDborCr
    '                            sSubCredit = dClosingDborCr
    '                            If sSubCredit.StartsWith("-") = True Then
    '                                sSubCredit = sSubCredit.Remove(0, 1)
    '                            End If
    '                            dRow("ClosingCredit") = sSubCredit

    '                            dRow("ClosingDebit") = "0.00"
    '                            'dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
    '                            dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
    '                        End If
    '                        dt.Rows.Add(dRow)
    '                    Next

    '                    If j = dtSubGL.Rows.Count Then
    '                        dRow = dt.NewRow()
    '                        dRow("gl_Desc") = "<B>" & "TOTAL" & "</B>"
    '                        dRow("OpDebit") = dTotalOpnDebit
    '                        dRow("OpCredit") = dTotalOpnCredit
    '                        dRow("TransDebit") = dTotalTransDebit
    '                        dRow("TransCredit") = dTotalTransCredit

    '                        'dRow("ClosingDebit") = dTotalCloseDebit
    '                        'dRow("ClosingCredit") = dTotalCloseCredit
    '                        sSubTotalDebit = dTotalCloseDebit
    '                        If sSubTotalDebit.StartsWith("-") = True Then
    '                            sSubTotalDebit = sSubTotalDebit.Remove(0, 1)
    '                        End If
    '                        dRow("ClosingDebit") = sSubTotalDebit

    '                        sSubTotalCredit = dTotalCloseCredit
    '                        If sSubTotalCredit.StartsWith("-") = True Then
    '                            sSubTotalCredit = sSubTotalCredit.Remove(0, 1)
    '                        End If
    '                        dRow("ClosingCredit") = sSubTotalCredit

    '                        dt.Rows.Add(dRow)
    '                    End If
    '                End If
    '            Next
    '        End If

    '        If dt.Rows.Count > 0 Then
    '            dOpnDebit = 0 : dOpnCredit = 0
    '            dTransDebit = 0 : dTransCredit = 0
    '            dCloseDebit = 0 : dCloseCredit = 0
    '            For l = 0 To dt.Rows.Count - 1
    '                If dt.Rows(l)("gl_Head").ToString() = "2" Then
    '                    If dt.Rows(l)("OpDebit").ToString() <> "" Then
    '                        dOpnDebit = dOpnDebit + dt.Rows(l)("OpDebit").ToString()
    '                    Else
    '                        dOpnDebit = dOpnDebit + 0
    '                    End If

    '                    If dt.Rows(l)("OpCredit").ToString() <> "" Then
    '                        dOpnCredit = dOpnCredit + dt.Rows(l)("OpCredit").ToString()
    '                    Else
    '                        dOpnCredit = dOpnCredit + 0
    '                    End If

    '                    If dt.Rows(l)("TransDebit").ToString() <> "" Then
    '                        dTransDebit = dTransDebit + dt.Rows(l)("TransDebit").ToString()
    '                    Else
    '                        dTransDebit = dTransDebit + 0
    '                    End If

    '                    If dt.Rows(l)("TransCredit").ToString() <> "" Then
    '                        dTransCredit = dTransCredit + dt.Rows(l)("TransCredit").ToString()
    '                    Else
    '                        dTransCredit = dTransCredit + 0
    '                    End If

    '                    If dt.Rows(l)("ClosingDebit").ToString() <> "" Then
    '                        dCloseDebit = dCloseDebit + dt.Rows(l)("ClosingDebit").ToString()
    '                    Else
    '                        dCloseDebit = dCloseDebit + 0
    '                    End If

    '                    If dt.Rows(l)("ClosingCredit").ToString() <> "" Then
    '                        dCloseCredit = dCloseCredit + dt.Rows(l)("ClosingCredit").ToString()
    '                    Else
    '                        dCloseCredit = dCloseCredit + 0
    '                    End If

    '                End If
    '            Next

    '            dRow = dt.NewRow
    '            dt.Rows.Add(dRow)

    '            dRow = dt.NewRow
    '            dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
    '            dRow("OpDebit") = dOpnDebit
    '            dRow("OpCredit") = dOpnCredit
    '            dRow("TransDebit") = dTransDebit
    '            dRow("TransCredit") = dTransCredit

    '            'dRow("ClosingDebit") = dCloseDebit
    '            'dRow("ClosingCredit") = dCloseCredit

    '            sGrandTotalDebit = dCloseDebit
    '            If sGrandTotalDebit.StartsWith("-") = True Then
    '                sGrandTotalDebit = sGrandTotalDebit.Remove(0, 1)
    '            End If
    '            dRow("ClosingDebit") = sGrandTotalDebit

    '            'sGrandTotalCredit = dCloseDebit
    '            sGrandTotalCredit = dCloseCredit
    '            If sGrandTotalCredit.StartsWith("-") = True Then
    '                sGrandTotalCredit = sGrandTotalCredit.Remove(0, 1)
    '            End If
    '            dRow("ClosingCredit") = sGrandTotalCredit

    '            dt.Rows.Add(dRow)
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function LoadTrialBalanceActual(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim sSql As String = "", aSql As String = "", iSql As String = ""
        Dim mSql As String = "", kSql As String = "", lSql As String = ""
        Dim dt As New DataTable
        Dim dtGL As New DataTable, dtSubGL As New DataTable
        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
        Dim dRow As DataRow
        Dim dtOB As New DataTable
        Dim dtOBGL As New DataTable   ' added by vijaylakshmi 29-07-2020
        Dim dtTrans As New DataTable
        Dim sStr As String = ""

        Dim dOpnDebit As Double = 0, dOpnCredit As Double = 0
        Dim dTransDebit As Double = 0, dTransCredit As Double = 0
        Dim dCloseDebit As Double = 0, dCloseCredit As Double = 0
        Dim iNext As Integer = 0

        Dim dTotalOpnDebit As Double = 0, dTotalOpnCredit As Double = 0
        Dim dTotalTransDebit As Double = 0, dTotalTransCredit As Double = 0
        Dim dTotalCloseDebit As Double = 0, dTotalCloseCredit As Double = 0

        Dim dGrandTotalOpnDebit As Double = 0 : Dim dGrandTotalOpnCredit As Double = 0
        Dim dGrandTotalTransDebit As Double = 0, dGrandTotalTransCredit As Double = 0
        Dim dGrandTotalCloseDebit As Double = 0, dGrandTotalCloseCredit As Double = 0

        Dim sCloseDebit As String = "" : Dim sCloseCredit As String = ""
        Dim sSubDebit As String = "" : Dim sSubCredit As String = ""
        Dim sSubTotalDebit As String = "" : Dim sSubTotalCredit As String = ""
        Dim sGrandTotalDebit As String = "" : Dim sGrandTotalCredit As String = ""


        Dim dtATD As New DataTable
        Try
            dt.Columns.Add("gl_id")
            dt.Columns.Add("gl_Code")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("gl_Head")
            dt.Columns.Add("gl_AccHead")
            dt.Columns.Add("gl_Parent")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TransDebit")
            dt.Columns.Add("TransCredit")
            dt.Columns.Add("ClosingDebit")
            dt.Columns.Add("ClosingCredit")


            sSql = "" : sSql = "Select Distinct(A.gl_id) As gl_id,A.gl_glCode,A.gl_Parent,A.Gl_Desc,A.gl_head,A.gl_AccHead "
            sSql = sSql & "from chart_of_Accounts A join chart_of_Accounts B On "
            sSql = sSql & "A.gl_glcode = B.gl_glcode And A.gl_head = B.gl_head And A.gl_glcode <> '' "
            sSql = sSql & "and A.gl_head in (2) and A.gl_Delflag='C' and A.gl_Status ='A' order by A.gl_glcode"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
                    dTotalOpnDebit = 0 : dTotalOpnCredit = 0 : dTotalTransDebit = 0 : dTotalTransCredit = 0
                    dTotalCloseDebit = 0 : dTotalCloseCredit = 0
                    dRow = dt.NewRow()

                    If IsDBNull(dtGL.Rows(i)("gl_id").ToString()) = False Then
                        dRow("gl_id") = dtGL.Rows(i)("gl_id").ToString()
                    End If

                    'If dtGL.Rows(i)("gl_glCode").ToString() = "A020301" Then
                    '    dRow("gl_id") = ""
                    'End If

                    If IsDBNull(dtGL.Rows(i)("gl_glCode").ToString()) = False Then
                        dRow("gl_Code") = dtGL.Rows(i)("gl_glCode").ToString()
                    End If

                    If (dtGL.Rows(i)("gl_glCode").ToString() = "A020202" Or dtGL.Rows(i)("gl_glCode").ToString() = "L030201") Then
                        If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                            dRow("gl_Desc") = "<b>" & dtGL.Rows(i)("Gl_Desc").ToString() & "</b>"
                        End If
                    Else
                        If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                            dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                        End If
                    End If



                    'If IsDBNull(dtGL.Rows(i)("Gl_Desc").ToString()) = False Then
                    '    dRow("gl_Desc") = dtGL.Rows(i)("Gl_Desc").ToString()
                    'End If

                    If IsDBNull(dtGL.Rows(i)("gl_head").ToString()) = False Then
                        dRow("gl_Head") = dtGL.Rows(i)("gl_head").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("gl_Parent").ToString()) = False Then
                        dRow("gl_Parent") = dtGL.Rows(i)("gl_Parent").ToString()
                    End If
                    Dim dGLDebitTotal, dGLCreditTotal As Double
                    Dim bCheck As Boolean
                    Dim dtFL As New DataTable
                    Dim sLastYearToDate As DateTime
                    'Dim dfDate As Date
                    'dfDate = Convert.ToDateTime(dFromDate).ToString()objGen.FormatDtForRDBMS(dFromDate, "CT")
                    ' dfDate = objGen.FormatDtForRDBMS(dFromDate, "Q")
                    sLastYearToDate = Convert.ToDateTime(objDB.SQLGetDescription(sNameSpace, "SELECT DATEADD(day, -1, '" & dFromDate & "')")).ToString()

                    bCheck = objDB.SQLCheckForRecord(sNameSpace, "Select * From Freeze_Ledger Where FL_Head=2 And FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " ")
                    If bCheck = True Then
                        iSql = "" : iSql = "Select * From Freeze_Ledger Where FL_Head=2 And FL_ToDate='" & sLastYearToDate.ToString("MM/dd/yyyy") & "' And FL_GL=" & dtGL.Rows(i)("gl_id").ToString() & " And FL_CompID=" & iCompID & " And FL_Year=" & iYearId & " "
                        If iZoneID > 0 Then
                            iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                        End If
                        If iRegionID > 0 Then
                            iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                        End If
                        If iAreaID > 0 Then
                            iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                        End If
                        If iBranchID > 0 Then
                            iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                        End If
                        dtFL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                        If dtFL.Rows.Count > 0 Then
                            If IsDBNull(dtFL.Rows(0)("FL_CloseDebit").ToString()) = False Then
                                dRow("OpDebit") = Convert.ToDecimal(dtFL.Rows(0)("FL_CloseDebit").ToString()).ToString("#,##0.00")
                                dGLDebitTotal = dGLDebitTotal + dtFL.Rows(0)("FL_CloseDebit").ToString()
                            Else
                                dRow("OpDebit") = "0.00"
                            End If

                            If IsDBNull(dtFL.Rows(0)("FL_CloseCredit").ToString()) = False Then
                                dRow("OpCredit") = Convert.ToDecimal(dtFL.Rows(0)("FL_CloseCredit").ToString()).ToString("#,##0.00")
                                dGLCreditTotal = dGLCreditTotal + dtFL.Rows(0)("FL_CloseCredit").ToString()
                            Else
                                dRow("OpCredit") = "0.00"
                            End If

                            dOpnDebit = dtFL.Rows(0)("FL_CloseDebit").ToString()
                            dOpnCredit = dtFL.Rows(0)("FL_CloseCredit").ToString()
                        Else
                            dRow("OpDebit") = 0
                            dOpnDebit = 0
                            dRow("OpCredit") = 0
                            dOpnCredit = 0
                        End If
                    Else
                        If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger

                            '----- This is commented by vijaylakshmi 29-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )
                            'iSql = "" : iSql = "Select Sum(Opn_DebitAmt) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            'If iZoneID > 0 Then
                            '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            'End If
                            'If iRegionID > 0 Then
                            '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            'End If
                            'If iAreaID > 0 Then
                            '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            'End If
                            'If iBranchID > 0 Then
                            '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            'End If
                            'dGLDebitTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)

                            'iSql = "" : iSql = "Select Sum(Opn_CreditAmount) From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_Parent =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            'If iZoneID > 0 Then
                            '    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            'End If
                            'If iRegionID > 0 Then
                            '    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            'End If
                            'If iAreaID > 0 Then
                            '    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            'End If
                            'If iBranchID > 0 Then
                            '    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            'End If
                            'dGLCreditTotal = objDB.SQLExecuteScalarInt(sNameSpace, iSql)


                            'dRow("OpDebit") = dGLDebitTotal
                            'dOpnDebit = dGLDebitTotal
                            'dRow("OpCredit") = dGLCreditTotal
                            'dOpnCredit = dGLCreditTotal

                            '------- ' This is commented by vijaylakshmi 29-07-2020 (because it is not returning decimal value for that GL total amount not match with SubGl Total Amount  )

                            iSql = "" : iSql = "Select Sum(Opn_DebitAmt) as Opn_DebitAmt,Sum(Opn_CreditAmount) as Opn_CreditAmount From Acc_Opening_Balance Where Opn_GLID In (Select gl_ID From Chart_Of_Accounts Where gl_id =" & dtGL.Rows(i)("gl_id").ToString() & ") And Opn_CompID=" & iCompID & " And Opn_YearID=" & iYearId & ""
                            If iZoneID > 0 Then
                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            End If
                            If iRegionID > 0 Then
                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            End If
                            If iAreaID > 0 Then
                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            End If
                            If iBranchID > 0 Then
                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            End If

                            dtOBGL = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                            If dtOBGL.Rows.Count > 0 Then
                                If (dtOBGL.Rows(0)("Opn_DebitAmt") Is "" And dtOBGL.Rows(0)("Opn_CreditAmount") Is "") Then
                                    dRow("OpDebit") = "0.00"
                                    dRow("OpDebit") = "0.00"
                                Else
                                    If IsDBNull(dtOBGL.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                                        If dtOBGL.Rows(0)("Opn_DebitAmt").ToString() <> "" Then
                                            dRow("OpDebit") = Convert.ToDecimal(dtOBGL.Rows(0)("Opn_DebitAmt").ToString()).ToString("#,##0.00")
                                            dGLDebitTotal = dtOBGL.Rows(0)("Opn_DebitAmt").ToString()
                                            dOpnDebit = dGLDebitTotal
                                        Else
                                            dRow("OpDebit") = "0.00"
                                        End If

                                    Else
                                        dRow("OpDebit") = "0.00"
                                    End If

                                    If IsDBNull(dtOBGL.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                                        If dtOBGL.Rows(0)("Opn_CreditAmount").ToString() <> "" Then
                                            dRow("OpCredit") = Convert.ToDecimal(dtOBGL.Rows(0)("Opn_CreditAmount").ToString()).ToString("#,##0.00")
                                            dGLCreditTotal = dtOBGL.Rows(0)("Opn_CreditAmount").ToString()
                                            dOpnCredit = dGLCreditTotal
                                        Else
                                            dRow("OpCredit") = "0.00"
                                        End If
                                    Else
                                        dRow("OpCredit") = "0.00"
                                    End If
                                End If
                            End If

                        ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger

                            If dRow("gl_Code") = "L02020104" Then
                                Dim icode As String = "ABC"
                            End If
                            iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtGL.Rows(i)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                            If iZoneID > 0 Then
                                iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                            End If
                            If iRegionID > 0 Then
                                iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                            End If
                            If iAreaID > 0 Then
                                iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                            End If
                            If iBranchID > 0 Then
                                iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                            End If
                            dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                            If dtOB.Rows.Count > 0 Then

                                If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                                    dRow("OpDebit") = Convert.ToDecimal(dtOB.Rows(0)("Opn_DebitAmt").ToString()).ToString("#,##0.00")
                                    dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                    dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                Else
                                    dRow("OpDebit") = "0.00"
                                End If

                                If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                                    dRow("OpCredit") = Convert.ToDecimal(dtOB.Rows(0)("Opn_CreditAmount").ToString()).ToString("#,##0.00")
                                    dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                    dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                Else
                                    dRow("OpCredit") = "0.00"
                                End If
                            End If
                        End If

                    End If

                    '*** Working But for deactivated record not worinkg so commented ***'
                    'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details"
                    'aSql = aSql & " Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                    'aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
                    '*** Working But for deactivated record not worinkg so commented ***'

                    If (dtGL.Rows(i)("gl_Head").ToString() = "2") Then  'General Ledger
                        aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from ACC_Transactions_Details" 'GL_Transactions_Details commented 0n 01-09-2020 because itz fetching deactivated record
                        aSql = aSql & " where ATD_GL = '" & dtGL.Rows(i)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "

                    ElseIf (dtGL.Rows(i)("gl_Head").ToString() = "3") Then  'Sub General Ledger
                        aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from ACC_Transactions_Details" 'GL_Transactions_Details commented 0n 01-09-2020 because itz fetching deactivated record
                        aSql = aSql & " where ATD_SubGL in (Select gl_ID From Chart_Of_Accounts Where gl_Parent = '" & dtGL.Rows(i)("gl_id").ToString() & "') and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "'  "
                    End If

                    If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
                    ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
                    ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
                    ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
                    ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
                    ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
                        aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
                    ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                    ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
                        aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                    End If

                    dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                    If dtTrans.Rows.Count > 0 Then
                        If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
                            If dtTrans.Rows(0)("Debit").ToString() <> "" Then
                                dRow("TransDebit") = Convert.ToDecimal(dtTrans.Rows(0)("Debit").ToString()).ToString("#,##0.00")
                                dTransDebit = dtTrans.Rows(0)("Debit").ToString()
                                dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
                            Else
                                dRow("TransDebit") = "0.00"
                            End If
                        Else
                            dRow("TransDebit") = "0.00"
                        End If

                        If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
                            If dtTrans.Rows(0)("Credit").ToString() <> "" Then
                                dRow("TransCredit") = Convert.ToDecimal(dtTrans.Rows(0)("Credit").ToString()).ToString("#,##0.00")
                                dTransCredit = dtTrans.Rows(0)("Credit").ToString()
                                dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
                            Else
                                dRow("TransCredit") = "0.00"
                            End If
                        Else
                            dRow("TransCredit") = "0.00"
                        End If
                    Else
                        dRow("TransCredit") = "0.00"
                        dRow("TransCredit") = "0.00"
                    End If


                    Dim dClosingDborCr As Double = 0
                    dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
                    If dClosingDborCr > 0 Then
                        sCloseDebit = Math.Round(dClosingDborCr, 2)
                        'dRow("ClosingDebit") = dClosingDborCr
                        If sCloseDebit.StartsWith("-") = True Then
                            sCloseDebit = sCloseDebit.Remove(0, 1)
                        End If

                        dRow("ClosingDebit") = Convert.ToDecimal(dClosingDborCr).ToString("#,##0.00")

                        dRow("ClosingCredit") = "0.00"
                        dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
                        dGrandTotalCloseDebit = dGrandTotalCloseDebit + dClosingDborCr
                    Else
                        'dRow("ClosingCredit") = dClosingDborCr
                        sCloseCredit = dClosingDborCr
                        If sCloseCredit.StartsWith("-") = True Then
                            sCloseCredit = sCloseCredit.Remove(0, 1)
                        End If
                        dRow("ClosingCredit") = Convert.ToDecimal(sCloseCredit).ToString("#,##0.00")

                        dRow("ClosingDebit") = "0.00"
                        dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
                        dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
                    End If

                    'Commented since GL Total has to be displayed.

                    'Dim dtCheckSubGLs As New DataTable
                    'dtCheckSubGLs = objDB.SQLExecuteDataSet(sNameSpace, "Select * From Chart_Of_Accounts Where GL_Parent=" & dtGL.Rows(i)("gl_id").ToString() & " And gl_CompID=" & iCompID & " ").Tables(0)
                    'If dtCheckSubGLs.Rows.Count > 0 Then
                    '    dRow("OpDebit") = "0.00"
                    '    dRow("OpCredit") = "0.00"

                    '    dRow("TransDebit") = "0.00"
                    '    dRow("TransCredit") = "0.00"

                    '    dRow("ClosingDebit") = "0.00"
                    '    dRow("ClosingCredit") = "0.00"
                    'End If
                    'Commented since GL Total has to be displayed.

                    dt.Rows.Add(dRow)


                    '' SUb GL
                    mSql = "" : mSql = "Select * from chart_of_Accounts where gl_Parent = " & dtGL.Rows(i)("gl_id").ToString() & " and gl_CompID =" & iCompID & " and "
                    mSql = mSql & "gl_head in (3) and gl_Delflag='C' and gl_Status ='A' Order by gl_glcode"
                    dtSubGL = objDB.SQLExecuteDataSet(sNameSpace, mSql).Tables(0)
                    If dtSubGL.Rows.Count > 0 Then
                        For j = 0 To dtSubGL.Rows.Count - 1
                            dOpnDebit = 0 : dOpnCredit = 0 : dTransDebit = 0 : dTransCredit = 0
                            dRow = dt.NewRow()
                            If IsDBNull(dtSubGL.Rows(j)("gl_id").ToString()) = False Then
                                dRow("gl_id") = dtSubGL.Rows(j)("gl_id").ToString()
                            End If

                            If IsDBNull(dtSubGL.Rows(j)("gl_glCode").ToString()) = False Then
                                dRow("gl_Code") = dtSubGL.Rows(j)("gl_glCode").ToString()
                            End If

                            'If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
                            '    dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
                            'End If
                            If (dtSubGL.Rows(j)("gl_Parent").ToString() = "141" Or dtSubGL.Rows(j)("gl_Parent").ToString() = "67") Then
                                If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
                                    dRow("gl_Desc") = "<b>" & dtSubGL.Rows(j)("Gl_Desc").ToString() & "</b>"
                                End If
                            Else
                                If IsDBNull(dtSubGL.Rows(j)("Gl_Desc").ToString()) = False Then
                                    dRow("gl_Desc") = dtSubGL.Rows(j)("Gl_Desc").ToString()
                                End If
                            End If

                            If IsDBNull(dtSubGL.Rows(j)("gl_head").ToString()) = False Then
                                dRow("gl_Head") = dtSubGL.Rows(j)("gl_head").ToString()
                            End If

                            If IsDBNull(dtSubGL.Rows(j)("gl_Parent").ToString()) = False Then
                                dRow("gl_Parent") = dtSubGL.Rows(j)("gl_Parent").ToString()
                            End If

                            sLastYearToDate = objDB.SQLGetDescription(sNameSpace, "SELECT DATEADD(day, -1, '" & dFromDate & "')")


                            bCheck = objDB.SQLCheckForRecord(sNameSpace, "Select * From Freeze_Ledger Where FL_Head=3 And FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " ")
                            If bCheck = True Then
                                iSql = "" : iSql = "Select * From Freeze_Ledger Where FL_Head=3 And FL_ToDate='" & sLastYearToDate.ToString("MM/dd/yyyy") & "' And FL_GL=" & dtSubGL.Rows(j)("gl_id").ToString() & " And FL_CompID=" & iCompID & " And FL_Year=" & iYearId & " "
                                If iZoneID > 0 Then
                                    iSql = iSql & " and FL_ZoneID=" & iZoneID & ""
                                End If
                                If iRegionID > 0 Then
                                    iSql = iSql & " and FL_RegionID=" & iRegionID & ""
                                End If
                                If iAreaID > 0 Then
                                    iSql = iSql & " and FL_AreaID=" & iAreaID & ""
                                End If
                                If iBranchID > 0 Then
                                    iSql = iSql & " and FL_BranchID=" & iBranchID & ""
                                End If
                                dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                If dtOB.Rows.Count > 0 Then

                                    If IsDBNull(dtOB.Rows(0)("FL_CloseDebit").ToString()) = False Then
                                        dRow("OpDebit") = Convert.ToDecimal(dtOB.Rows(0)("FL_CloseDebit").ToString()).ToString("#,##0.00")
                                        dOpnDebit = dtOB.Rows(0)("FL_CloseDebit").ToString()
                                        dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("FL_CloseDebit").ToString()
                                        dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("FL_CloseDebit").ToString()
                                    Else
                                        dRow("OpDebit") = "0.00"
                                    End If

                                    If IsDBNull(dtOB.Rows(0)("FL_CloseCredit").ToString()) = False Then
                                        dRow("OpCredit") = Convert.ToDecimal(dtOB.Rows(0)("FL_CloseCredit").ToString()).ToString("#,##0.00")
                                        dOpnCredit = dtOB.Rows(0)("FL_CloseCredit").ToString()
                                        dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("FL_CloseCredit").ToString()
                                        dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("FL_CloseCredit").ToString()
                                    Else
                                        dRow("OpCredit") = "0.00"
                                    End If
                                End If

                            Else

                                iSql = "" : iSql = "Select * from acc_Opening_Balance where Opn_GLID ='" & dtSubGL.Rows(j)("gl_id").ToString() & "' and  Opn_YearID =" & iYearId & " and Opn_CompID =" & iCompID & ""
                                If iZoneID > 0 Then
                                    iSql = iSql & " and Opn_ZoneID=" & iZoneID & ""
                                End If
                                If iRegionID > 0 Then
                                    iSql = iSql & " and Opn_RegionID=" & iRegionID & ""
                                End If
                                If iAreaID > 0 Then
                                    iSql = iSql & " and Opn_AreaID=" & iAreaID & ""
                                End If
                                If iBranchID > 0 Then
                                    iSql = iSql & " and Opn_BranchID=" & iBranchID & ""
                                End If
                                dtOB = objDB.SQLExecuteDataSet(sNameSpace, iSql).Tables(0)
                                If dtOB.Rows.Count > 0 Then

                                    If IsDBNull(dtOB.Rows(0)("Opn_DebitAmt").ToString()) = False Then
                                        dRow("OpDebit") = Convert.ToDecimal(dtOB.Rows(0)("Opn_DebitAmt").ToString()).ToString("#,##0.00")
                                        dOpnDebit = dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                        dTotalOpnDebit = dTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                        dGrandTotalOpnDebit = dGrandTotalOpnDebit + dtOB.Rows(0)("Opn_DebitAmt").ToString()
                                    Else
                                        dRow("OpDebit") = "0.00"
                                    End If

                                    If IsDBNull(dtOB.Rows(0)("Opn_CreditAmount").ToString()) = False Then
                                        dRow("OpCredit") = Convert.ToDecimal(dtOB.Rows(0)("Opn_CreditAmount").ToString()).ToString("#,##0.00")
                                        dOpnCredit = dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                        dTotalOpnCredit = dTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                        dGrandTotalOpnCredit = dGrandTotalOpnCredit + dtOB.Rows(0)("Opn_CreditAmount").ToString()
                                    Else
                                        dRow("OpCredit") = "0.00"
                                    End If
                                End If

                            End If

                            '*** Working But for deactivated record not worinkg so commented ***'
                            'aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from Acc_Transactions_Details Left Join Acc_payment_master On Acc_PM_ID=ATD_BIllID"
                            'aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & "  "
                            '*** Working But for deactivated record not worinkg so commented ***'

                            aSql = "" : aSql = "Select Sum(ATD_Debit) as Debit ,sum(ATD_Credit) as Credit from acc_transactions_details " 'changed GL_Transactions_Details table to acc_transactions_details  on 02-09-2020 because itz fetching deactivated record
                            aSql = aSql & " where ATD_SubGL = '" & dtSubGL.Rows(j)("gl_id").ToString() & "' and ATD_YearID =" & iYearId & " and ATD_CompID=" & iCompID & " And ATD_Status='A' And ATD_Status<>'D' And ATD_TransactionDate Between '" & dFromDate & "' And '" & dToDate & "' "

                            If iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " "
                            ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_RegionID=" & iRegionID & " "
                            ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_AreaID=" & iAreaID & " "
                            ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID = 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " "
                            ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID > 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_AreaID=" & iAreaID & " "
                            ElseIf iZoneID > 0 And iRegionID = 0 And iAreaID = 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID > 0 And iBranchID = 0 Then
                                aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " "
                            ElseIf iZoneID = 0 And iRegionID > 0 And iAreaID = 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_RegionID=" & iRegionID & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID = 0 And iRegionID = 0 And iAreaID > 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                            ElseIf iZoneID > 0 And iRegionID > 0 And iAreaID > 0 And iBranchID > 0 Then
                                aSql = aSql & " And ATD_ZoneID=" & iZoneID & " And ATD_RegionID=" & iRegionID & " And ATD_AreaID=" & iAreaID & " And ATD_BranchID=" & iBranchID & " "
                            End If

                            dtTrans = objDB.SQLExecuteDataSet(sNameSpace, aSql).Tables(0)
                            If dtTrans.Rows.Count > 0 Then
                                If IsDBNull(dtTrans.Rows(0)("Debit").ToString()) = False Then
                                    If dtTrans.Rows(0)("Debit").ToString() <> "" Then
                                        dRow("TransDebit") = Convert.ToDecimal(dtTrans.Rows(0)("Debit").ToString()).ToString("#,##0.00")
                                        dTransDebit = dtTrans.Rows(0)("Debit").ToString()
                                        dTotalTransDebit = dTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
                                        dGrandTotalTransDebit = dGrandTotalTransDebit + dtTrans.Rows(0)("Debit").ToString()
                                    Else
                                        dRow("TransDebit") = "0.00"
                                    End If
                                Else
                                    dRow("TransDebit") = "0.00"
                                End If

                                If IsDBNull(dtTrans.Rows(0)("Credit").ToString()) = False Then
                                    If dtTrans.Rows(0)("Credit").ToString() <> "" Then
                                        dRow("TransCredit") = Convert.ToDecimal(dtTrans.Rows(0)("Credit").ToString()).ToString("#,##0.00")
                                        dTransCredit = dtTrans.Rows(0)("Credit").ToString()
                                        dTotalTransCredit = dTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
                                        dGrandTotalTransCredit = dGrandTotalTransCredit + dtTrans.Rows(0)("Credit").ToString()
                                    Else
                                        dRow("TransCredit") = "0.00"
                                    End If
                                Else
                                    dRow("TransCredit") = "0.00"
                                End If
                            Else
                                dRow("TransCredit") = "0.00"
                                dRow("TransCredit") = "0.00"
                            End If

                            dClosingDborCr = (dOpnDebit + dTransDebit) - (dOpnCredit + dTransCredit)
                            If dClosingDborCr > 0 Then
                                'dRow("ClosingDebit") = dClosingDborCr
                                sSubDebit = dClosingDborCr
                                If sSubDebit.StartsWith("-") = True Then
                                    sSubDebit = sSubDebit.Remove(0, 1)
                                End If
                                dRow("ClosingDebit") = Convert.ToDecimal(sSubDebit).ToString("#,##0.00")

                                dRow("ClosingCredit") = "0.00"
                                'dTotalCloseDebit = dTotalCloseDebit + dRow("ClosingDebit")
                                dGrandTotalCloseDebit = dGrandTotalCloseDebit + dRow("ClosingDebit")
                            Else
                                'dRow("ClosingCredit") = dClosingDborCr
                                sSubCredit = dClosingDborCr
                                If sSubCredit.StartsWith("-") = True Then
                                    sSubCredit = sSubCredit.Remove(0, 1)
                                End If
                                dRow("ClosingCredit") = Convert.ToDecimal(sSubCredit).ToString("#,##0.00")

                                dRow("ClosingDebit") = "0.00"
                                'dTotalCloseCredit = dTotalCloseCredit + dRow("ClosingCredit")
                                dGrandTotalCloseCredit = dGrandTotalCloseCredit + dRow("ClosingCredit")
                            End If
                            dt.Rows.Add(dRow)
                        Next

                        If j = dtSubGL.Rows.Count Then
                            dRow = dt.NewRow()
                            dRow("gl_Desc") = "<B>" & "TOTAL" & "</B>"
                            dRow("OpDebit") = Convert.ToDecimal(dTotalOpnDebit).ToString("#,##0.00")
                            dRow("OpCredit") = Convert.ToDecimal(dTotalOpnCredit).ToString("#,##0.00")
                            dRow("TransDebit") = Convert.ToDecimal(dTotalTransDebit).ToString("#,##0.00")
                            dRow("TransCredit") = Convert.ToDecimal(dTotalTransCredit).ToString("#,##0.00")

                            'dRow("ClosingDebit") = dTotalCloseDebit
                            'dRow("ClosingCredit") = dTotalCloseCredit
                            sSubTotalDebit = dTotalCloseDebit
                            If sSubTotalDebit.StartsWith("-") = True Then
                                sSubTotalDebit = sSubTotalDebit.Remove(0, 1)
                            End If
                            dRow("ClosingDebit") = Convert.ToDecimal(sSubTotalDebit).ToString("#,##0.00")

                            sSubTotalCredit = dTotalCloseCredit
                            If sSubTotalCredit.StartsWith("-") = True Then
                                sSubTotalCredit = sSubTotalCredit.Remove(0, 1)
                            End If
                            dRow("ClosingCredit") = Convert.ToDecimal(sSubTotalCredit).ToString("#,##0.00")

                            dt.Rows.Add(dRow)
                        End If
                    End If
                Next
            End If

            If dt.Rows.Count > 0 Then
                dOpnDebit = 0 : dOpnCredit = 0
                dTransDebit = 0 : dTransCredit = 0
                dCloseDebit = 0 : dCloseCredit = 0
                For l = 0 To dt.Rows.Count - 1
                    If dt.Rows(l)("gl_Head").ToString() = "2" Then
                        If dt.Rows(l)("OpDebit").ToString() <> "" Then
                            dOpnDebit = dOpnDebit + dt.Rows(l)("OpDebit").ToString()
                        Else
                            dOpnDebit = dOpnDebit + 0
                        End If

                        If dt.Rows(l)("OpCredit").ToString() <> "" Then
                            dOpnCredit = dOpnCredit + dt.Rows(l)("OpCredit").ToString()
                        Else
                            dOpnCredit = dOpnCredit + 0
                        End If

                        If dt.Rows(l)("TransDebit").ToString() <> "" Then
                            dTransDebit = dTransDebit + dt.Rows(l)("TransDebit").ToString()
                        Else
                            dTransDebit = dTransDebit + 0
                        End If

                        If dt.Rows(l)("TransCredit").ToString() <> "" Then
                            dTransCredit = dTransCredit + dt.Rows(l)("TransCredit").ToString()
                        Else
                            dTransCredit = dTransCredit + 0
                        End If

                        If dt.Rows(l)("ClosingDebit").ToString() <> "" Then
                            dCloseDebit = dCloseDebit + dt.Rows(l)("ClosingDebit").ToString()
                        Else
                            dCloseDebit = dCloseDebit + 0
                        End If

                        If dt.Rows(l)("ClosingCredit").ToString() <> "" Then
                            dCloseCredit = dCloseCredit + dt.Rows(l)("ClosingCredit").ToString()
                        Else
                            dCloseCredit = dCloseCredit + 0
                        End If

                    End If
                Next

                dRow = dt.NewRow
                dt.Rows.Add(dRow)

                dRow = dt.NewRow
                dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
                dRow("OpDebit") = Convert.ToDecimal(dOpnDebit).ToString("#,##0.00")
                dRow("OpCredit") = Convert.ToDecimal(dOpnCredit).ToString("#,##0.00")
                dRow("TransDebit") = Convert.ToDecimal(dTransDebit).ToString("#,##0.00")
                dRow("TransCredit") = Convert.ToDecimal(dTransCredit).ToString("#,##0.00")

                'dRow("ClosingDebit") = dCloseDebit
                'dRow("ClosingCredit") = dCloseCredit

                sGrandTotalDebit = dCloseDebit
                If sGrandTotalDebit.StartsWith("-") = True Then
                    sGrandTotalDebit = sGrandTotalDebit.Remove(0, 1)
                End If
                dRow("ClosingDebit") = Convert.ToDecimal(sGrandTotalDebit).ToString("#,##0.00")

                'sGrandTotalCredit = dCloseDebit
                sGrandTotalCredit = dCloseCredit
                If sGrandTotalCredit.StartsWith("-") = True Then
                    sGrandTotalCredit = sGrandTotalCredit.Remove(0, 1)
                End If
                dRow("ClosingCredit") = Convert.ToDecimal(sGrandTotalCredit).ToString("#,##0.00")

                dt.Rows.Add(dRow)
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function FreezeGL(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal objFL As clsReports.TrailBal)
        Dim sSql As String = ""
        Dim iMax As Integer
        Try
            iMax = objFasAllgnrl.GetMaxID(sNameSpace, iCompID, "Freeze_Ledger", "FL_ID", "FL_CompID")
            sSql = "Insert Into Freeze_Ledger(FL_ID,FL_AccHead,FL_Head,FL_GL,FL_FromDate,FL_ToDate,FL_OBDebit,FL_OBCredit,FL_TrDebit,FL_TrCredit,FL_CloseDebit,FL_CloseCredit,FL_Year,FL_CompID,FL_Status,FL_CreatedBy,FL_CreatedOn,FL_ZoneID,FL_RegionID,FL_AreaID,FL_BranchID) "
            sSql = sSql & "Values(" & iMax & "," & objFL.iAccHead & "," & objFL.iHead & "," & objFL.iGLID & ",'" & objGen.FormatDtForRDBMS(objFL.dFromDate, "CT") & "','" & objGen.FormatDtForRDBMS(objFL.dToDate, "CT") & "'," & objFL.dOpDebit & "," & objFL.dOpCredit & "," & objFL.dTrDebit & "," & objFL.dTrCredit & "," & objFL.dClDebit & "," & objFL.dClCredit & "," & objFL.iYearId & "," & objFL.iCompid & ",'F'," & objFL.iUserid & ",'" & Today.ToString("yyyy/MM/dd") & "'," & objFL.iZoneID & "," & objFL.iReigionID & "," & objFL.iAreaID & "," & objFL.iBranchID & ")"
            objDB.SQLExecuteNonQuery(sNameSpace, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function CheckFreezeDtae(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As String
        Dim sSql As String = ""
        Dim bCheck As Boolean
        Dim sDate As String = ""
        Try
            sSql = "" : sSql = "Select * From Freeze_Ledger Where FL_Status='F' And FL_Year=" & iYearID & " And FL_CompID=" & iCompID & " Order By FL_ID Desc "
            bCheck = objDB.DBCheckForRecord(sNameSpace, sSql)
            If bCheck = True Then
                sSql = "" : sSql = "Select Top 1 FL_ToDate From Freeze_Ledger Where FL_Status='F' And FL_Year=" & iYearID & " And FL_CompID=" & iCompID & " Order By FL_ID Desc "
                sDate = objDB.SQLGetDescription(sNameSpace, sSql)

                sSql = "" : sSql = "SELECT DATEADD(day, 1, '" & objGen.FormatDtForRDBMS(sDate, "CT") & "')"
                CheckFreezeDtae = objDB.SQLGetDescription(sNameSpace, sSql)
            Else
                CheckFreezeDtae = ""
            End If
            Return CheckFreezeDtae
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadDuration(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer) As DataTable
        Dim sSql As String = ""
        Try
            sSql = "SELECT CONVERT(VARCHAR(20), FL_FromDate, 103) + ' - ' + CONVERT(VARCHAR(20), FL_ToDate, 103) as FreezeDate From Freeze_Ledger Where FL_Year=" & iYearID & " And FL_CompID=" & iCompID & " Group By FL_FromDate,FL_Todate "
            LoadDuration = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return LoadDuration
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetFreezedData(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearID As Integer, ByVal sFromDate As String, ByVal sToDate As String) As DataTable
        Dim sSql As String = ""
        Dim sArray As String()
        Dim sArray2 As String()
        Dim sbret As String
        Dim sbret2 As String
        Dim dt, dt1 As New DataTable
        Dim dRow As DataRow
        Dim vDate As String, vMonth As String, vYear As String, vDate2 As String, vMonth2 As String, vYear2 As String, SCon As String, SCon2 As String
        Try
            sbret = sToDate
            sArray = sbret.Split("/")   'vijeth

            vDate = sArray(0)
            vMonth = sArray(1)
            vYear = sArray(2)

            SCon = vMonth & "/" & vDate & "/" & vYear  'toDate

            sbret2 = sFromDate
            sArray2 = sbret2.Split("/")


            vDate2 = sArray2(0)
            vMonth2 = sArray2(1)
            vYear2 = sArray2(2)

            SCon2 = vMonth2 & "/" & vDate2 & "/" & vYear2  'fromDate

            dt.Columns.Add("gl_id")
            dt.Columns.Add("gl_Code")
            dt.Columns.Add("gl_Desc")
            dt.Columns.Add("gl_Head")
            dt.Columns.Add("gl_AccHead")
            dt.Columns.Add("gl_Parent")
            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TransDebit")
            dt.Columns.Add("TransCredit")
            dt.Columns.Add("ClosingDebit")
            dt.Columns.Add("ClosingCredit")

            sSql = "Select * From Freeze_Ledger Where FL_FromDate='" & SCon2 & "' And FL_ToDate='" & SCon & "' And FL_Year=" & iYearID & " And FL_CompID=" & iCompID & " order by FL_ID "
            dt1 = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)

            If dt1.Rows.Count > 0 Then
                For i = 0 To dt1.Rows.Count - 1
                    dRow = dt.NewRow()
                    dRow("gl_id") = dt1.Rows(i)("FL_GL")

                    If dt1.Rows(i)("FL_GL") = 0 Then
                        dRow("gl_Code") = ""
                        dRow("gl_Desc") = "<B>" & "TOTAL" & "</B>"
                    Else
                        dRow("gl_Code") = objDB.SQLGetDescription(sNameSpace, "Select Gl_glCode From Chart_Of_Accounts Where GL_ID=" & dt1.Rows(i)("FL_GL") & " And GL_CompID=" & iCompID & " ")
                        dRow("gl_Desc") = objDB.SQLGetDescription(sNameSpace, "Select Gl_Desc From Chart_Of_Accounts Where GL_ID=" & dt1.Rows(i)("FL_GL") & " And GL_CompID=" & iCompID & " ")
                    End If

                    dRow("gl_Head") = dt1.Rows(i)("FL_Head")
                    dRow("gl_AccHead") = 0
                    dRow("gl_Parent") = 0
                    dRow("OpDebit") = dt1.Rows(i)("FL_OBDebit")
                    dRow("OpCredit") = dt1.Rows(i)("FL_OBCredit")
                    dRow("TransDebit") = dt1.Rows(i)("FL_TrDebit")
                    dRow("TransCredit") = dt1.Rows(i)("FL_TrCredit")
                    dRow("ClosingDebit") = dt1.Rows(i)("FL_CloseDebit")
                    dRow("ClosingCredit") = dt1.Rows(i)("FL_CloseCredit")

                    If i = dt1.Rows.Count - 1 Then
                        If dt1.Rows(i)("FL_GL") = 0 Then
                            dRow("gl_Code") = ""
                            dRow("gl_Desc") = "<B>" & "GRAND TOTAL" & "</B>"
                        End If
                    End If

                    dt.Rows.Add(dRow)
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadTrialBalanceReportDetails(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iGLID As Integer, ByVal sGLCode As String, ByVal sGLDesc As String) As DataTable
        Dim sSql As String = ""
        Dim dt, dtAssetGrp, dtAssetSubGrp, dtGL As New DataTable
        Dim dtIncomeGrp, dtIncomeSubGrp, dtIncomeGL As New DataTable
        Dim dr As DataRow
        Dim sStr As String = ""
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("Description")

            dt.Columns.Add("OBDebit")
            dt.Columns.Add("OBCredit")
            dt.Columns.Add("TrDebit")
            dt.Columns.Add("TrCredit")
            dt.Columns.Add("ClDebit")
            dt.Columns.Add("ClCredit")

            'Asset
            sSql = "" : sSql = "Select FL_GL,FL_OBDebit As OBDebit,FL_OBCredit As OBCredit,FL_TrDebit As TrDebit,FL_TrCredit As TrCredit,FL_CloseDebit As CloseDebit,FL_CloseCredit As CloseCredit From Freeze_Ledger 
                                        where FL_Todate in (Select Top 1 FL_Todate From Freeze_Ledger where FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " And FL_Status='F' Order By FL_ToDate Desc) And FL_Head=2 And FL_Gl in (Select GL_ID From Chart_Of_Accounts Where gl_Status='A' And GL_Parent=" & iGLID & " And GL_CompID=1) And Fl_Year=" & iYearId & " And FL_compid=" & iCompID & " And FL_Status='F'"
            dtAssetGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtAssetGrp.Rows.Count > 0 Then

                dr = dt.NewRow()
                dr("GLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_GlCode From Chart_Of_Accounts Where gl_Status='A' And gl_ID in (Select GL_Parent From Chart_Of_Accounts Where gl_Status='A' And GL_Desc='" & sGLDesc & "' And gl_CompID=" & iCompID & ") And gl_CompID=" & iCompID & "")
                dr("Description") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_Status='A' And gl_ID in (Select GL_Parent From Chart_Of_Accounts Where gl_Status='A' And GL_Desc='" & sGLDesc & "' And gl_CompID=" & iCompID & ") And gl_CompID=" & iCompID & "")
                dt.Rows.Add(dr)


                dr = dt.NewRow()
                dr("GLCode") = sGLCode
                dr("Description") = sGLDesc
                dt.Rows.Add(dr)

                For i = 0 To dtAssetGrp.Rows.Count - 1
                    dr = dt.NewRow()
                    dr("ID") = "" & dtAssetGrp.Rows(i)("FL_GL") & ""
                    dr("GLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_glCode From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & dtAssetGrp.Rows(i)("FL_GL") & " And gl_CompID=" & iCompID & "")
                    dr("Description") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & dtAssetGrp.Rows(i)("FL_GL") & " And gl_CompID=" & iCompID & "")

                    If IsDBNull(dtAssetGrp.Rows(i)("OBDebit")) = False Then
                        dr("OBDebit") = dtAssetGrp.Rows(i)("OBDebit")
                    End If
                    If IsDBNull(dtAssetGrp.Rows(i)("OBCredit")) = False Then
                        dr("OBCredit") = dtAssetGrp.Rows(i)("OBCredit")
                    End If
                    If IsDBNull(dtAssetGrp.Rows(i)("TrDebit")) = False Then
                        dr("TrDebit") = dtAssetGrp.Rows(i)("TrDebit")
                    End If
                    If IsDBNull(dtAssetGrp.Rows(i)("TrCredit")) = False Then
                        dr("TrCredit") = dtAssetGrp.Rows(i)("TrCredit")
                    End If
                    If IsDBNull(dtAssetGrp.Rows(i)("CloseDebit")) = False Then
                        dr("ClDebit") = dtAssetGrp.Rows(i)("CloseDebit")
                    End If
                    If IsDBNull(dtAssetGrp.Rows(i)("CloseCredit")) = False Then
                        dr("ClCredit") = dtAssetGrp.Rows(i)("CloseCredit")
                    End If

                    dt.Rows.Add(dr)

                    sSql = "" : sSql = "Select FL_GL,FL_OBDebit As OBDebit,FL_OBCredit As OBCredit,FL_TrDebit As TrDebit,FL_TrCredit As TrCredit,FL_CloseDebit As CloseDebit,FL_CloseCredit As CloseCredit From Freeze_Ledger 
                                        where FL_Todate in (Select Top 1 FL_Todate From Freeze_Ledger where FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " And FL_Status='F' Order By FL_ToDate Desc) And FL_Head=3 And FL_GL in (Select gl_ID From Chart_Of_Accounts Where gl_Status='A' And gl_Parent=" & dtAssetGrp.Rows(i)("FL_GL") & " And Gl_CompID=" & iCompID & ") And Fl_Year=" & iYearId & " And FL_compid=" & iCompID & " And FL_Status='F'"
                    dtAssetSubGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dtAssetSubGrp.Rows.Count > 0 Then
                        For j = 0 To dtAssetSubGrp.Rows.Count - 1
                            dr = dt.NewRow()
                            dr("ID") = "" & dtAssetSubGrp.Rows(j)("FL_GL") & ""
                            dr("GLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_glCode From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & dtAssetSubGrp.Rows(j)("FL_GL") & " And gl_CompID=" & iCompID & "")
                            dr("Description") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & dtAssetSubGrp.Rows(j)("FL_GL") & " And gl_CompID=" & iCompID & "")

                            If IsDBNull(dtAssetSubGrp.Rows(j)("OBDebit")) = False Then
                                dr("OBDebit") = dtAssetSubGrp.Rows(j)("OBDebit")
                            End If
                            If IsDBNull(dtAssetSubGrp.Rows(j)("OBCredit")) = False Then
                                dr("OBCredit") = dtAssetSubGrp.Rows(j)("OBCredit")
                            End If
                            If IsDBNull(dtAssetSubGrp.Rows(j)("TrDebit")) = False Then
                                dr("TrDebit") = dtAssetSubGrp.Rows(j)("TrDebit")
                            End If
                            If IsDBNull(dtAssetSubGrp.Rows(j)("TrCredit")) = False Then
                                dr("TrCredit") = dtAssetSubGrp.Rows(j)("TrCredit")
                            End If
                            If IsDBNull(dtAssetSubGrp.Rows(j)("CloseDebit")) = False Then
                                dr("ClDebit") = dtAssetSubGrp.Rows(j)("CloseDebit")
                            End If
                            If IsDBNull(dtAssetSubGrp.Rows(j)("CloseCredit")) = False Then
                                dr("ClCredit") = dtAssetSubGrp.Rows(j)("CloseCredit")
                            End If

                            dt.Rows.Add(dr)
                        Next
                    End If

                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadTrialBalanceReport(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt, dtAssetGrp, dtAssetSubGrp, dtGL As New DataTable
        Dim dtIncomeGrp, dtIncomeSubGrp, dtIncomeGL As New DataTable
        Dim dr As DataRow
        Dim sStr As String = ""
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("Description")

            dt.Columns.Add("OpDebit")
            dt.Columns.Add("OpCredit")
            dt.Columns.Add("TrDebit")
            dt.Columns.Add("TrCredit")
            dt.Columns.Add("ClDebit")
            dt.Columns.Add("ClCredit")

            'Asset
            sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=0 And gl_AccHead=1"
            dtAssetGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtAssetGrp.Rows.Count > 0 Then
                dr = dt.NewRow()
                dr("Description") = "Asset"
                dt.Rows.Add(dr)

                For i = 0 To dtAssetGrp.Rows.Count - 1
                    dr = dt.NewRow()
                    dr("ID") = "" & dtAssetGrp.Rows(i)("gl_ID") & ""
                    dr("GLCode") = "" & dtAssetGrp.Rows(i)("gl_GLCode") & ""
                    dr("Description") = "" & dtAssetGrp.Rows(i)("gl_Desc") & ""
                    dt.Rows.Add(dr)

                    sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=" & dtAssetGrp.Rows(i)("gl_ID") & " And gl_AccHead=1"
                    dtAssetSubGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dtAssetSubGrp.Rows.Count > 0 Then
                        For j = 0 To dtAssetSubGrp.Rows.Count - 1
                            dr = dt.NewRow()
                            dr("ID") = "" & dtAssetSubGrp.Rows(j)("gl_ID") & ""
                            dr("GLCode") = "" & dtAssetSubGrp.Rows(j)("gl_GLCode") & ""
                            dr("Description") = "" & dtAssetSubGrp.Rows(j)("gl_Desc") & ""

                            sSql = "" : sSql = "Select Sum(FL_OBDebit) As OBDebit,Sum(FL_OBCredit)As OBCredit,Sum(FL_TrDebit) As TrDebit,Sum(FL_TrCredit) As TrCredit,Sum(FL_CloseDebit) As CloseDebit,Sum(FL_CloseCredit) As CloseCredit From Freeze_Ledger 
                                                where FL_Todate in (Select Top 1 FL_Todate From Freeze_Ledger where FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " And FL_Status='F' Order By FL_ToDate Desc) And FL_Gl in (Select gl_ID From Chart_Of_Accounts where gl_parent=" & dtAssetSubGrp.Rows(j)("gl_id") & " And gl_AccHead=1) And Fl_Year=" & iYearId & " And FL_compid=" & iCompID & " And FL_Status='F'"
                            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtGL.Rows.Count > 0 Then
                                If IsDBNull(dtGL.Rows(0)("OBDebit")) = False Then
                                    dr("OpDebit") = dtGL.Rows(0)("OBDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("OBCredit")) = False Then
                                    dr("OpCredit") = dtGL.Rows(0)("OBCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrDebit")) = False Then
                                    dr("TrDebit") = dtGL.Rows(0)("TrDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrCredit")) = False Then
                                    dr("TrCredit") = dtGL.Rows(0)("TrCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseDebit")) = False Then
                                    dr("ClDebit") = dtGL.Rows(0)("CloseDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseCredit")) = False Then
                                    dr("ClCredit") = dtGL.Rows(0)("CloseCredit")
                                End If
                            End If
                            dt.Rows.Add(dr)
                        Next
                    End If

                Next
            End If


            'Income
            sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=0 And gl_AccHead=2"
            dtAssetGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtAssetGrp.Rows.Count > 0 Then
                dr = dt.NewRow()
                dr("Description") = "Income"
                dt.Rows.Add(dr)

                For i = 0 To dtAssetGrp.Rows.Count - 1
                    dr = dt.NewRow()
                    dr("ID") = "" & dtAssetGrp.Rows(i)("gl_ID") & ""
                    dr("GLCode") = "" & dtAssetGrp.Rows(i)("gl_GLCode") & ""
                    dr("Description") = "" & dtAssetGrp.Rows(i)("gl_Desc") & ""
                    dt.Rows.Add(dr)

                    sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=" & dtAssetGrp.Rows(i)("gl_ID") & " And gl_AccHead=2"
                    dtAssetSubGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dtAssetSubGrp.Rows.Count > 0 Then
                        For j = 0 To dtAssetSubGrp.Rows.Count - 1
                            dr = dt.NewRow()
                            dr("ID") = "" & dtAssetSubGrp.Rows(j)("gl_ID") & ""
                            dr("GLCode") = "" & dtAssetSubGrp.Rows(j)("gl_GLCode") & ""
                            dr("Description") = "" & dtAssetSubGrp.Rows(j)("gl_Desc") & ""

                            sSql = "" : sSql = "Select Sum(FL_OBDebit) As OBDebit,Sum(FL_OBCredit)As OBCredit,Sum(FL_TrDebit) As TrDebit,Sum(FL_TrCredit) As TrCredit,Sum(FL_CloseDebit) As CloseDebit,Sum(FL_CloseCredit) As CloseCredit From Freeze_Ledger 
                                                where FL_Todate in (Select Top 1 FL_Todate From Freeze_Ledger where FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " And FL_Status='F' Order By FL_ToDate Desc) And FL_Gl in (Select gl_ID From Chart_Of_Accounts where gl_parent=" & dtAssetSubGrp.Rows(j)("gl_id") & " And gl_AccHead=2) And Fl_Year=" & iYearId & " And FL_compid=" & iCompID & " And FL_Status='F'"
                            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtGL.Rows.Count > 0 Then
                                If IsDBNull(dtGL.Rows(0)("OBDebit")) = False Then
                                    dr("OpDebit") = dtGL.Rows(0)("OBDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("OBCredit")) = False Then
                                    dr("OpCredit") = dtGL.Rows(0)("OBCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrDebit")) = False Then
                                    dr("TrDebit") = dtGL.Rows(0)("TrDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrCredit")) = False Then
                                    dr("TrCredit") = dtGL.Rows(0)("TrCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseDebit")) = False Then
                                    dr("ClDebit") = dtGL.Rows(0)("CloseDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseCredit")) = False Then
                                    dr("ClCredit") = dtGL.Rows(0)("CloseCredit")
                                End If
                            End If
                            dt.Rows.Add(dr)
                        Next
                    End If

                Next
            End If



            'Liabilities
            sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=0 And gl_AccHead=3"
            dtAssetGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtAssetGrp.Rows.Count > 0 Then
                dr = dt.NewRow()
                dr("Description") = "Liabilities"
                dt.Rows.Add(dr)

                For i = 0 To dtAssetGrp.Rows.Count - 1
                    dr = dt.NewRow()
                    dr("ID") = "" & dtAssetGrp.Rows(i)("gl_ID") & ""
                    dr("GLCode") = "" & dtAssetGrp.Rows(i)("gl_GLCode") & ""
                    dr("Description") = "" & dtAssetGrp.Rows(i)("gl_Desc") & ""
                    dt.Rows.Add(dr)

                    sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=" & dtAssetGrp.Rows(i)("gl_ID") & " And gl_AccHead=3"
                    dtAssetSubGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dtAssetSubGrp.Rows.Count > 0 Then
                        For j = 0 To dtAssetSubGrp.Rows.Count - 1
                            dr = dt.NewRow()
                            dr("ID") = "" & dtAssetSubGrp.Rows(j)("gl_ID") & ""
                            dr("GLCode") = "" & dtAssetSubGrp.Rows(j)("gl_GLCode") & ""
                            dr("Description") = "" & dtAssetSubGrp.Rows(j)("gl_Desc") & ""

                            sSql = "" : sSql = "Select Sum(FL_OBDebit) As OBDebit,Sum(FL_OBCredit)As OBCredit,Sum(FL_TrDebit) As TrDebit,Sum(FL_TrCredit) As TrCredit,Sum(FL_CloseDebit) As CloseDebit,Sum(FL_CloseCredit) As CloseCredit From Freeze_Ledger 
                                                where FL_Todate in (Select Top 1 FL_Todate From Freeze_Ledger where FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " And FL_Status='F' Order By FL_ToDate Desc) And FL_Gl in (Select gl_ID From Chart_Of_Accounts where gl_parent=" & dtAssetSubGrp.Rows(j)("gl_id") & " And gl_AccHead=3) And Fl_Year=" & iYearId & " And FL_compid=" & iCompID & " And FL_Status='F'"
                            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtGL.Rows.Count > 0 Then
                                If IsDBNull(dtGL.Rows(0)("OBDebit")) = False Then
                                    dr("OpDebit") = dtGL.Rows(0)("OBDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("OBCredit")) = False Then
                                    dr("OpCredit") = dtGL.Rows(0)("OBCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrDebit")) = False Then
                                    dr("TrDebit") = dtGL.Rows(0)("TrDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrCredit")) = False Then
                                    dr("TrCredit") = dtGL.Rows(0)("TrCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseDebit")) = False Then
                                    dr("ClDebit") = dtGL.Rows(0)("CloseDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseCredit")) = False Then
                                    dr("ClCredit") = dtGL.Rows(0)("CloseCredit")
                                End If
                            End If
                            dt.Rows.Add(dr)
                        Next
                    End If

                Next
            End If


            'Expenditure
            sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=0 And gl_AccHead=4"
            dtAssetGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtAssetGrp.Rows.Count > 0 Then
                dr = dt.NewRow()
                dr("Description") = <b>Expenditure</b>
                dt.Rows.Add(dr)

                For i = 0 To dtAssetGrp.Rows.Count - 1
                    dr = dt.NewRow()
                    dr("ID") = "" & dtAssetGrp.Rows(i)("gl_ID") & ""
                    dr("GLCode") = "" & dtAssetGrp.Rows(i)("gl_GLCode") & ""
                    dr("Description") = "" & dtAssetGrp.Rows(i)("gl_Desc") & ""
                    dt.Rows.Add(dr)

                    sSql = "" : sSql = "Select * From Chart_Of_Accounts where gl_Status='A' And gl_parent=" & dtAssetGrp.Rows(i)("gl_ID") & " And gl_AccHead=4"
                    dtAssetSubGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                    If dtAssetSubGrp.Rows.Count > 0 Then
                        For j = 0 To dtAssetSubGrp.Rows.Count - 1
                            dr = dt.NewRow()
                            dr("ID") = "" & dtAssetSubGrp.Rows(j)("gl_ID") & ""
                            dr("GLCode") = "" & dtAssetSubGrp.Rows(j)("gl_GLCode") & ""
                            dr("Description") = "" & dtAssetSubGrp.Rows(j)("gl_Desc") & ""

                            sSql = "" : sSql = "Select Sum(FL_OBDebit) As OBDebit,Sum(FL_OBCredit)As OBCredit,Sum(FL_TrDebit) As TrDebit,Sum(FL_TrCredit) As TrCredit,Sum(FL_CloseDebit) As CloseDebit,Sum(FL_CloseCredit) As CloseCredit From Freeze_Ledger 
                                                where FL_Todate in (Select Top 1 FL_Todate From Freeze_Ledger where FL_Year=" & iYearId & " And FL_CompID=" & iCompID & " And FL_Status='F' Order By FL_ToDate Desc) And FL_Gl in (Select gl_ID From Chart_Of_Accounts where gl_parent=" & dtAssetSubGrp.Rows(j)("gl_id") & " And gl_AccHead=4) And Fl_Year=" & iYearId & " And FL_compid=" & iCompID & " And FL_Status='F'"
                            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
                            If dtGL.Rows.Count > 0 Then
                                If IsDBNull(dtGL.Rows(0)("OBDebit")) = False Then
                                    dr("OpDebit") = dtGL.Rows(0)("OBDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("OBCredit")) = False Then
                                    dr("OpCredit") = dtGL.Rows(0)("OBCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrDebit")) = False Then
                                    dr("TrDebit") = dtGL.Rows(0)("TrDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("TrCredit")) = False Then
                                    dr("TrCredit") = dtGL.Rows(0)("TrCredit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseDebit")) = False Then
                                    dr("ClDebit") = dtGL.Rows(0)("CloseDebit")
                                End If
                                If IsDBNull(dtGL.Rows(0)("CloseCredit")) = False Then
                                    dr("ClCredit") = dtGL.Rows(0)("CloseCredit")
                                End If
                            End If
                            dt.Rows.Add(dr)
                        Next
                    End If

                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadTrialBalanceTransactions(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer,
                                     ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal iGLID As Integer, ByVal sGLCode As String, ByVal sGLDesc As String) As DataTable
        Dim sSql As String = ""
        Dim dt, dtAssetGrp, dtAssetSubGrp, dtGL As New DataTable
        Dim dtIncomeGrp, dtIncomeSubGrp, dtIncomeGL As New DataTable
        Dim dr As DataRow
        Dim sStr As String = ""
        Try
            dt.Columns.Add("ID")
            dt.Columns.Add("GLCode")
            dt.Columns.Add("Description")
            dt.Columns.Add("SubGLCode")
            dt.Columns.Add("SubGLDescription")
            dt.Columns.Add("TrDebit")
            dt.Columns.Add("TrCredit")

            sSql = "" : sSql = "Select * From GL_Transactions_Details Where ATD_YearID=" & iYearId & " And ATD_GL=" & iGLID & " And ATD_CompID=" & iCompID & " "
            dtAssetGrp = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtAssetGrp.Rows.Count > 0 Then
                For i = 0 To dtAssetGrp.Rows.Count - 1
                    dr = dt.NewRow()
                    dr("ID") = "" & dtAssetGrp.Rows(i)("ATD_ID") & ""

                    dr("GLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_GlCode From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & iGLID & " And gl_CompID=" & iCompID & "")
                    dr("Description") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & iGLID & " And gl_CompID=" & iCompID & "")

                    If IsDBNull(dtAssetGrp.Rows(i)("ATD_SubGL")) = False Then
                        If dtAssetGrp.Rows(i)("ATD_SubGL") > 0 Then
                            dr("SubGLCode") = objDB.SQLGetDescription(sNameSpace, "Select gl_GlCode From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & dtAssetGrp.Rows(i)("ATD_SubGL") & " And gl_CompID=" & iCompID & "")
                            dr("SubGLDescription") = objDB.SQLGetDescription(sNameSpace, "Select gl_Desc From Chart_Of_Accounts Where gl_Status='A' And gl_ID=" & dtAssetGrp.Rows(i)("ATD_SubGL") & " And gl_CompID=" & iCompID & "")
                        Else
                            dr("SubGLCode") = ""
                            dr("SubGLDescription") = ""
                        End If
                    Else
                        dr("SubGLCode") = ""
                        dr("SubGLDescription") = ""
                    End If

                    If IsDBNull(dtAssetGrp.Rows(i)("ATD_Debit")) = False Then
                        dr("TrDebit") = dtAssetGrp.Rows(i)("ATD_Debit")
                    End If
                    If IsDBNull(dtAssetGrp.Rows(i)("ATD_Credit")) = False Then
                        dr("TrCredit") = dtAssetGrp.Rows(i)("ATD_Credit")
                    End If
                    dt.Rows.Add(dr)
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadBIllType(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Mas_ID,Mas_Desc from ACC_General_Master where mas_master = 25 and mas_Delflag ='A' and mas_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadPBillType(ByVal sNameSpace As String, ByVal iCompID As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = "Select Mas_ID,Mas_Desc from ACC_General_Master where mas_master = 9 and mas_Delflag ='A' and mas_CompID =" & iCompID & ""
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetUnGroupedGL(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer) As String
        Dim dt, dt1 As New DataTable
        Dim sSql As String = ""
        Dim sStr As String = ""
        Dim sDesc As String = ""
        Dim sGL As String = ""
        Try
            sSql = "Select SLM_GLLedger From Schedule_Linkage_Master Where SLM_CompID=" & iCompID & " "
            dt = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dt.Rows.Count > 0 Then
                For i = 0 To dt.Rows.Count - 1
                    sGL = dt.Rows(i)("SLM_GLLedger")
                    If sGL.StartsWith(",") Then
                        sGL = sGL.Remove(0, 1)
                    End If
                    If sGL.EndsWith(",") Then
                        sGL = sGL.Remove(Len(sGL) - 1, 1)
                    End If
                    sStr = sStr & "," & sGL
                Next
                If sStr.StartsWith(",,") Then
                    sStr = sStr.Remove(0, 2)
                End If
                If sStr.StartsWith(",") Then
                    sStr = sStr.Remove(0, 1)
                End If
                If sStr.EndsWith(",") Then
                    sStr = sStr.Remove(Len(sStr) - 1, 1)
                End If
            End If

            If sStr <> "" Then
                sSql = "" : sSql = "Select gl_ID,gl_Desc,gl_head From Chart_Of_Accounts Where gl_ID Not In (" & sStr & ") And gl_head in(2,3) and gl_CompID=" & iCompID & " and gl_delflag ='C' and (gl_parent<> 0 and gl_head <> 0) order by gl_ID"
                dt1 = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)

                If dt1.Rows.Count > 0 Then
                    For j = 0 To dt1.Rows.Count - 1
                        sDesc = sDesc & "," & dt1.Rows(j)("gl_Desc")
                    Next
                End If
                If sDesc.StartsWith(",") Then
                    sDesc = sDesc.Remove(0, 1)
                End If
                If sDesc.EndsWith(",") Then
                    sDesc = sDesc.Remove(Len(sDesc) - 1, 1)
                End If
            End If

            Return sDesc
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadPereticularsDes(ByVal sNameSpace As String, ByVal iPerticulars As String) As String
        Dim sSql As String
        Dim perticular As String
        Try
            sSql = "Select   gl_desc as GlDesc From chart_of_Accounts  Where  gl_id=" & iPerticulars & " "
            perticular = objDB.SQLExecuteScalar(sNameSpace, sSql)
            Return perticular
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function getEomDate(ByVal sNameSpace As String, ByVal sdrtFRMMonth As String) As Date
        Dim ssql As String
        Dim sDateFormate As String
        Try
            ssql = "SELECT EOMONTH('" & sdrtFRMMonth & "') "
            sDateFormate = objDB.SQLExecuteScalar(sNameSpace, ssql)
            Return sDateFormate
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadAllSubGL(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iGL As Integer, Optional ByVal iglindex As Integer = 0) As DataSet
        Dim sSql As String = ""
        Dim ds As New DataSet
        Try

            sSql = "" : sSql = "Select gl_id, (gl_glCode + ' - ' + gl_desc) as Description from Chart_Of_Accounts where gl_head = 3 and "
            sSql = sSql & "gl_Parent =" & iGL & " And gl_CompId =" & iCompID & " order by gl_id"
            ds = objDB.SQLExecuteDataSet(sNameSpace, sSql)
            Return ds
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadGlSummary(ByVal sNameSpace As String) As DataTable
        Dim ssql As String
        Dim dtTotal As DataTable, dt As New DataTable, dttotalOP As New DataTable
        Dim dr As DataRow, drow As DataRow
        Dim totalGLDebit As Double = 0, totalGLDebittemp As Double = 0
        Dim totalGLCredit As Double = 0, totalSGLCredittemp As Double = 0

        Try
            dt.Columns.Add("Srno")
            dt.Columns.Add("Transaction_Nos")
            dt.Columns.Add("Transaction_Type")
            dt.Columns.Add("Debit")
            dt.Columns.Add("Credit")
            ssql = "select count(atd_id) as TransactionNos,Atd_trtype,sum(ATD_debit) Debit, sum(atd_credit) as Credit from Acc_Transactions_Details"
            ssql = ssql & " group by Atd_trtype"
            dtTotal = objDB.SQLExecuteDataTable(sNameSpace, ssql)
            'ssql = "" : ssql = "Select A.gl_Id,B.Opn_DebitAmt,B.Opn_CreditAmount,A.gl_Head from chart_of_Accounts A"
            'ssql = ssql & " Left join Acc_opening_balance B On B.Opn_glid = A.Gl_ID "
            'ssql = ssql & " Where A.gl_Head<>0 And A.gl_Head<>1 And A.gl_delflag='C' and A.gl_Status ='A' and (A.gl_head=2)"
            'ssql = ssql & " and (b.Opn_DebitAmt<>0 or b.Opn_CreditAmount<>0) and A.gl_compid= " & 1 & ""
            ssql = "" : ssql = "select count(A.gl_Id) as counttransNos ,sum(B.Opn_DebitAmt) as Debit,sum(B.Opn_CreditAmount) as Credit from chart_of_Accounts A"
            ssql = ssql & " Left join Acc_opening_balance B On B.Opn_glid = A.Gl_ID "
            ssql = ssql & " Where A.gl_Head<>0 And A.gl_Head<>1 And A.gl_delflag='C' and A.gl_Status ='A' and (A.gl_head=2)"
            ssql = ssql & " and (b.Opn_DebitAmt<>0 or b.Opn_CreditAmount<>0) and A.gl_compid= " & 1 & ""
            dttotalOP = objDB.SQLExecuteDataTable(sNameSpace, ssql)
            For i = 0 To dtTotal.Rows.Count - 1
                dr = dt.NewRow()
                dr("Srno") = i + 1
                If IsDBNull(dtTotal.Rows(i)("TransactionNos")) = False Then
                    dr("Transaction_Nos") = dtTotal.Rows(i)("TransactionNos")
                Else
                    dr("Transaction_Nos") = 0
                End If
                If IsDBNull(dtTotal.Rows(i)("Atd_trtype")) = False Then
                    If Val(dtTotal.Rows(i)("Atd_trtype")) = 1 Then
                        dr("Transaction_Type") = "Payment"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 2 Then
                        dr("Transaction_Type") = "Petty Cash"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 3 Then
                        dr("Transaction_Type") = "Reciepts"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 4 Then
                        dr("Transaction_Type") = "Journal Entry"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 5 Then
                        dr("Transaction_Type") = "Purchase JE"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 6 Then
                        dr("Transaction_Type") = "Sales JE"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 8 Then
                        dr("Transaction_Type") = "Purchase Voucher"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 9 Then
                        dr("Transaction_Type") = "Sales Voucher"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 10 Then
                        dr("Transaction_Type") = "Non Trading Purchase voucher"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 11 Then
                        dr("Transaction_Type") = "bankreconcilation form transaction"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 12 Then
                        dr("Transaction_Type") = "Petty Cash Daybook"
                    ElseIf Val(dtTotal.Rows(i)("Atd_trtype")) = 7 Then
                        dr("Transaction_Type") = "Purchase Voucher"
                    End If
                Else
                    dr("Transaction_Nos") = ""
                End If
                If IsDBNull(dtTotal.Rows(i)("Debit")) = False Then
                    dr("Debit") = dtTotal.Rows(i)("Debit")
                Else
                    dr("Debit") = 0
                End If
                If IsDBNull(dtTotal.Rows(i)("Credit")) = False Then
                    dr("Credit") = dtTotal.Rows(i)("Credit")
                Else
                    dr("Credit") = 0
                End If
                dt.Rows.Add(dr)
            Next
            If dttotalOP.Rows.Count > 0 Then
                'For i = 0 To dttotalOP.Rows.Count - 1
                '    If dttotalOP.Rows(0)("gl_head").ToString() = 2 Then  'GL
                '        If (IsDBNull(dttotalOP.Rows(i)("Opn_DebitAmt").ToString()) = False) And (dttotalOP.Rows(i)("Opn_DebitAmt").ToString() <> "") Then
                '            If Convert.ToDouble(dttotalOP.Rows(i)("Opn_DebitAmt").ToString()) = 0.00 Then
                '                totalGLDebittemp = "0.00"
                '            Else
                '                totalGLDebittemp = Convert.ToDecimal(dttotalOP.Rows(i)("Opn_DebitAmt").ToString()).ToString("#,##0.00")
                '                totalGLDebit = totalGLDebit + totalGLDebittemp
                '            End If
                '        Else
                '            totalGLDebittemp = "0.00"
                '        End If
                '        If (IsDBNull(dttotalOP.Rows(i)("Opn_CreditAmount").ToString()) = False) And (dttotalOP.Rows(i)("Opn_CreditAmount").ToString() <> "") Then
                '            If Convert.ToDouble(dttotalOP.Rows(i)("Opn_CreditAmount").ToString()) = 0.00 Then
                '                totalSGLCredittemp = "0.00"
                '            Else
                '                totalSGLCredittemp = Convert.ToDecimal(dttotalOP.Rows(i)("Opn_CreditAmount").ToString()).ToString("#,##0.00")
                '                totalGLCredit = totalGLCredit + totalSGLCredittemp
                '            End If
                '        Else
                '            totalSGLCredittemp = "0.00"
                '        End If
                '        'ElseIf dttotalOP.Rows(0)("gl_head").ToString() = 3 Then  'SubGL
                '        '    If (IsDBNull(dttotalOP.Rows(0)("Opn_DebitAmt").ToString()) = False) And (dttotalOP.Rows(0)("Opn_DebitAmt").ToString() <> "") Then
                '        '        If Convert.ToDouble(dttotalOP.Rows(0)("Opn_DebitAmt").ToString()) = 0.00 Then
                '        '            drow("SubGLDebit") = "0.00"
                '        '        Else
                '        '            drow("SubGLDebit") = Convert.ToDecimal(dttotalOP.Rows(0)("Opn_DebitAmt").ToString()).ToString("#,##0.00")
                '        '            totalSGLDebit = totalSGLDebit + drow("SubGLDebit")
                '        '        End If
                '        '    Else
                '        '        drow("SubGLDebit") = "0.00"
                '        '    End If
                '        '    If (IsDBNull(dttotalOP.Rows(0)("Opn_CreditAmount").ToString()) = False) And (dttotalOP.Rows(0)("Opn_CreditAmount").ToString() <> "") Then
                '        '        If Convert.ToDouble(dttotalOP.Rows(0)("Opn_CreditAmount").ToString()) = 0.00 Then
                '        '            drow("SubGLCredit") = "0.00"
                '        '        Else
                '        '            drow("SubGLCredit") = Convert.ToDecimal(dttotalOP.Rows(0)("Opn_CreditAmount").ToString()).ToString("#,##0.00")
                '        '            totalSGLCredit = totalSGLCredit + drow("SubGLCredit")
                '        '        End If
                '        '    Else
                '        '        drow("SubGLCredit") = "0.00"
                '        '    End If
                '    End If
                'Next
                dr = dt.NewRow()
                dr("Srno") = dtTotal.Rows.Count + 1
                dr("Transaction_Nos") = dttotalOP.Rows(0)("counttransNos")
                dr("Transaction_Type") = "Opening Balance"
                dr("Credit") = dttotalOP.Rows(0)("Debit")
                dr("Debit") = dttotalOP.Rows(0)("Credit")
            Else
                dr = dt.NewRow()
                dr("Transaction_Nos") = 0
                dr("Transaction_Type") = "Opening Balance"
                dr("Credit") = 0
                dr("Debit") = 0
            End If
            dt.Rows.Add(dr)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadGLSummaryReport(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearId As Integer, ByVal imonthID As Integer, ByVal iParty As Integer, ByVal iCustPartyType As Integer,
                                       ByVal iZoneID As Integer, ByVal iRegionID As Integer, ByVal iAreaID As Integer, ByVal iBranchID As Integer, ByVal dFromDate As String, ByVal dToDate As String) As DataTable
        Dim dt As New DataTable, dtGL As New DataTable, dtBank As New DataTable, dtSubGL As New DataTable, dtPay As New DataTable, dtReceipt As New DataTable, dtPetty As New DataTable, dtJE As New DataTable
        Dim sSql As String = "", iSql As String = "", aSql As String = "", strUser As String = ""
        Dim i As Integer = 0, j As Integer = 0
        Dim dRow As DataRow
        Dim drUsr As OleDb.OleDbDataReader

        Dim dtData As New DataTable
        Dim sNarration, sTablename, sBillNo, sStatus, sCompid As String

        Try
            dt.Columns.Add("ATD_TransactionDate")
            dt.Columns.Add("ATD_BillId")
            dt.Columns.Add("VoucherNo")
            dt.Columns.Add("ATD_TrType")
            dt.Columns.Add("ATD_OpenDebit")
            dt.Columns.Add("ATD_OpenCredit")
            dt.Columns.Add("ATD_Debit")
            dt.Columns.Add("ATD_Credit")
            dt.Columns.Add("ATD_ClosingDebit")
            dt.Columns.Add("ATD_ClosingCredit")
            dt.Columns.Add("ATD_GlDesc")
            dt.Columns.Add("Narration")


            sSql = "" : sSql = "Select ATD_GL,ATD_TransactionDate, ATD_TrType, ATD_BillId,ATD_OpenDebit,ATD_OpenCredit,ATD_Debit,ATD_Credit,ATD_ClosingDebit,ATD_ClosingCredit from Acc_Transactions_Details "
            If iCustPartyType = 3 Then
                sSql = sSql & " where ATD_YearID=" & iYearId & " and ATD_CompID= " & iCompID & " And ATD_GL In (" & iParty & ") "
            ElseIf iCustPartyType = 1 Or iCustPartyType = 2 Then
                sSql = sSql & " where ATD_YearID=" & iYearId & " and ATD_CompID= " & iCompID & " And ATD_SubGL In (" & iParty & ") "
            ElseIf iCustPartyType = 0 Then
                sSql = sSql & " where ATD_YearID=" & iYearId & " and ATD_CompID= " & iCompID & ""
            End If

            If iZoneID > 0 Then
                sSql = sSql & " and Atd_ZoneID=" & iZoneID & ""
            End If
            If iRegionID > 0 Then
                sSql = sSql & " and Atd_RegionID=" & iRegionID & ""
            End If
            If iAreaID > 0 Then
                sSql = sSql & " and Atd_AreaID=" & iAreaID & ""
            End If
            If iBranchID > 0 Then
                sSql = sSql & " and Atd_BranchID=" & iBranchID & ""
            End If
            sSql = sSql & " and ATD_SeqReferenceNum <> 0 order by ATD_SeqReferenceNum"
            dtGL = objDB.SQLExecuteDataSet(sNameSpace, sSql).Tables(0)
            If dtGL.Rows.Count > 0 Then
                For i = 0 To dtGL.Rows.Count - 1
                    dRow = dt.NewRow()
                    sNarration = "" : sTablename = "" : sBillNo = "" : sStatus = "" : sCompid = ""

                    If IsDBNull(dtGL.Rows(i)("ATD_TransactionDate").ToString()) = False Then
                        dRow("ATD_TransactionDate") = objGen.FormatDtForRDBMS(dtGL.Rows(i)("ATD_TransactionDate").ToString(), "D")
                    End If
                    If IsDBNull(dtGL.Rows(i)("ATD_GL").ToString()) = False Then
                        If iCustPartyType = 0 Then
                            dRow("ATD_GlDesc") = ""
                        Else
                            dRow("ATD_GlDesc") = GetGLName(sNameSpace, iCompID, iYearId, (dtGL.Rows(i)("ATD_GL")))
                        End If

                    End If

                    If IsDBNull(dtGL.Rows(i)("ATD_BillId").ToString()) = False Then
                        dRow("ATD_BillId") = dtGL.Rows(i)("ATD_BillId").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("ATD_TrType").ToString()) = False Then
                        dRow("ATD_TrType") = dtGL.Rows(i)("ATD_TrType").ToString()
                        If dRow("ATD_TrType") = 1 Then
                            dRow("ATD_TrType") = "Payment"
                            sNarration = "Acc_Bill_Narration" : sTablename = "Acc_Payment_Master" : sBillNo = "Acc_PM_ID" : sStatus = "Acc_PM_Status" : sCompid = "Acc_PM_CompID"
                            dRow("Narration") = GetGLNarration(sNameSpace, iCompID, dRow("ATD_BillId"), sNarration, sTablename, sStatus, sBillNo, sCompid)
                        ElseIf dRow("ATD_TrType") = 2 Then
                            dRow("ATD_TrType") = "Petty Cash"
                            sNarration = "Acc_PCM_PaymentNarration" : sTablename = "Acc_PettyCash_Master" : sBillNo = "Acc_PCM_ID" : sStatus = "Acc_PCM_Status" : sCompid = "Acc_PCM_CompID"
                            dRow("Narration") = GetGLNarration(sNameSpace, iCompID, dRow("ATD_BillId"), sNarration, sTablename, sStatus, sBillNo, sCompid)
                        ElseIf dRow("ATD_TrType") = 3 Then
                            dRow("ATD_TrType") = "Receipt"
                            sNarration = "Acc_RM_BillNarration" : sTablename = "Acc_Receipt_Master" : sBillNo = "Acc_RM_ID" : sStatus = "Acc_RM_Status" : sCompid = "Acc_RM_CompID"
                            dRow("Narration") = GetGLNarration(sNameSpace, iCompID, dRow("ATD_BillId"), sNarration, sTablename, sStatus, sBillNo, sCompid)
                        ElseIf dRow("ATD_TrType") = 4 Then
                            dRow("ATD_TrType") = "Journal Entry"
                            sNarration = "Acc_JE_AdvanceNaration" : sTablename = "Acc_JE_Master" : sBillNo = "Acc_JE_ID" : sStatus = "Acc_JE_Status" : sCompid = "Acc_JE_CompID"
                            dRow("Narration") = GetGLNarration(sNameSpace, iCompID, dRow("ATD_BillId"), sNarration, sTablename, sStatus, sBillNo, sCompid)
                        ElseIf dRow("ATD_TrType") = 5 Then
                            dRow("ATD_TrType") = "Purchase"
                            ' sNarration = "" : sTablename = "acc_purchase_je_master" : sBillNo = "Acc_Purchase_ID" : sStatus = "Acc_Purchase_Status" : sCompid = "Acc_Purchase_CompID"
                        ElseIf dRow("ATD_TrType") = 6 Then
                            dRow("ATD_TrType") = "Sales"
                            ' sNarration = "" : sTablename = "acc_Sales_je_master" : sBillNo = "" : sStatus = "" : sCompid = ""
                        ElseIf dRow("ATD_TrType") = 8 Then
                            dRow("ATD_TrType") = "Purchase Direct"
                            ' sNarration = "" : sTablename = "Acc_Purchase_Master" : sBillNo = "" : sStatus = "" : sCompid = ""
                        ElseIf dRow("ATD_TrType") = 9 Then
                            dRow("ATD_TrType") = "Sales Direct"
                            ' sNarration = "" : sTablename = "acc_Sales_masters" : sBillNo = "" : sStatus = "" : sCompid = ""
                        ElseIf dRow("ATD_TrType") = 10 Then
                            dRow("ATD_TrType") = "NonTrading Purchase"
                            ' sNarration = "" : sTablename = "" : sBillNo = "" : sStatus = "" : sCompid = ""
                        ElseIf dRow("ATD_TrType") = 11 Then
                            dRow("ATD_TrType") = "Bank Reconcilation"
                            ' sNarration = "" : sTablename = "" : sBillNo = "" : sStatus = "" : sCompid = ""
                        ElseIf dRow("ATD_TrType") = 12 Then
                            dRow("ATD_TrType") = "Opening BreakUp"
                            ' sNarration = "" : sTablename = "" : sBillNo = "" : sStatus = "" : sCompid = ""
                        ElseIf dRow("ATD_TrType") = 13 Then
                            dRow("ATD_TrType") = "Petty Cash Day Book"
                            ' sNarration = "" : sTablename = "ACC_PettyCashDayBookMaster" : sBillNo = "PDB_PKID" : sStatus = "PDB_Status" : sCompid = "PDB_CompID"
                        End If
                    End If


                    If IsDBNull(dtGL.Rows(i)("ATD_OpenDebit").ToString()) = False Then
                        dRow("ATD_OpenDebit") = dtGL.Rows(i)("ATD_OpenDebit").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("ATD_OpenCredit").ToString()) = False Then
                        dRow("ATD_OpenCredit") = dtGL.Rows(i)("ATD_OpenCredit").ToString()
                    End If
                    If IsDBNull(dtGL.Rows(i)("ATD_Debit").ToString()) = False Then
                        dRow("ATD_Debit") = dtGL.Rows(i)("ATD_Debit").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("ATD_Credit").ToString()) = False Then
                        dRow("ATD_Credit") = dtGL.Rows(i)("ATD_Credit").ToString()
                    End If
                    If IsDBNull(dtGL.Rows(i)("ATD_ClosingDebit").ToString()) = False Then
                        dRow("ATD_ClosingDebit") = dtGL.Rows(i)("ATD_ClosingDebit").ToString()
                    End If

                    If IsDBNull(dtGL.Rows(i)("ATD_ClosingCredit").ToString()) = False Then
                        dRow("ATD_ClosingCredit") = dtGL.Rows(i)("ATD_ClosingCredit").ToString()
                    End If
                    dt.Rows.Add(dRow)
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetGLName(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iYearid As Integer, ByVal iGLID As Integer) As String
        Dim sSql As String = ""
        Try
            sSql = "Select Gl_Desc From Chart_Of_Accounts Where GL_ID =" & iGLID & " "
            GetGLName = objDB.SQLGetDescription(sNameSpace, sSql)
            Return GetGLName
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetGLNarration(ByVal sNameSpace As String, ByVal iCompID As Integer, ByVal iBillId As Integer, ByVal sNarration As String, ByVal sTablename As String, ByVal sStatus As String, ByVal sBillNo As String, ByVal sCompid As String) As String
        Dim sSql As String = ""
        Try
            sSql = "Select " & sNarration & " From " & sTablename & " Where " & sStatus & "='A' And " & sBillNo & "=" & iBillId & " And " & sCompid & "=" & iCompID & ""
            GetGLNarration = objDB.SQLGetDescription(sNameSpace, sSql)
            Return GetGLNarration
        Catch ex As Exception
            Throw
        End Try
    End Function
End Class
